## <a name="call-the-web-api-with-jquery"></a><span data-ttu-id="11261-101">使用 jQuery 调用 Web API</span><span class="sxs-lookup"><span data-stu-id="11261-101">Call the Web API with jQuery</span></span>

<span data-ttu-id="11261-102">在本部分中，添加了 HTML 页面使用 jQuery 调用 Web API。</span><span class="sxs-lookup"><span data-stu-id="11261-102">In this section, an HTML page is added that uses jQuery to call the Web API.</span></span> <span data-ttu-id="11261-103">jQuery 启动请求，并用 API 响应中的详细信息更新页面。</span><span class="sxs-lookup"><span data-stu-id="11261-103">jQuery initiates the request and updates the page with the details from the API's response.</span></span>

<span data-ttu-id="11261-104">配置项目提供静态文件并启用默认文件映射。</span><span class="sxs-lookup"><span data-stu-id="11261-104">Configure the project to serve static files and to enable default file mapping.</span></span> <span data-ttu-id="11261-105">通过在 Startup.Configure 中调用 [UseStaticFiles](/dotnet/api/microsoft.aspnetcore.builder.staticfileextensions.usestaticfiles#Microsoft_AspNetCore_Builder_StaticFileExtensions_UseStaticFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) 和 [UseDefaultFiles](/dotnet/api/microsoft.aspnetcore.builder.defaultfilesextensions.usedefaultfiles#Microsoft_AspNetCore_Builder_DefaultFilesExtensions_UseDefaultFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) 扩展方法完成这一点。</span><span class="sxs-lookup"><span data-stu-id="11261-105">This is accomplished by invoking the [UseStaticFiles](/dotnet/api/microsoft.aspnetcore.builder.staticfileextensions.usestaticfiles#Microsoft_AspNetCore_Builder_StaticFileExtensions_UseStaticFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) and [UseDefaultFiles](/dotnet/api/microsoft.aspnetcore.builder.defaultfilesextensions.usedefaultfiles#Microsoft_AspNetCore_Builder_DefaultFilesExtensions_UseDefaultFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) extension methods in *Startup.Configure*.</span></span> <span data-ttu-id="11261-106">有关详细信息，请参阅[静态文件](xref:fundamentals/static-files)。</span><span class="sxs-lookup"><span data-stu-id="11261-106">For more information, see [Static files](xref:fundamentals/static-files).</span></span>

[!code-csharp[](../../tutorials/first-web-api/samples/2.0/TodoApi/Startup2.cs?name=snippet_Configure&highlight=3-4)]

<span data-ttu-id="11261-107">将一个名为 index.html 的 HTML 文件添加至项目的 wwwroot 目录。</span><span class="sxs-lookup"><span data-stu-id="11261-107">Add an HTML file, named *index.html*, to the project's *wwwroot* directory.</span></span> <span data-ttu-id="11261-108">用以下标记替代其内容：</span><span class="sxs-lookup"><span data-stu-id="11261-108">Replace its contents with the following markup:</span></span>

[!code-html[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/index.html)]

<span data-ttu-id="11261-109">将名为 site.js 的 JavaScript 文件添加至项目的 wwwroot 目录。</span><span class="sxs-lookup"><span data-stu-id="11261-109">Add a JavaScript file, named *site.js*, to the project's *wwwroot* directory.</span></span> <span data-ttu-id="11261-110">用以下代码替代其内容：</span><span class="sxs-lookup"><span data-stu-id="11261-110">Replace its contents with the following code:</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_SiteJs)]

<span data-ttu-id="11261-111">可能需要更改 ASP.NET Core 项目的启动设置，以便对 HTML 页面进行本地测试。</span><span class="sxs-lookup"><span data-stu-id="11261-111">A change to the ASP.NET Core project's launch settings may be required to test the HTML page locally.</span></span> <span data-ttu-id="11261-112">打开项目“属性”目录中的 launchSettings.json。</span><span class="sxs-lookup"><span data-stu-id="11261-112">Open *launchSettings.json* in the *Properties* directory of the project.</span></span> <span data-ttu-id="11261-113">删除 `launchUrl` 以便在项目的默认文件 index.html 强制打开应用。</span><span class="sxs-lookup"><span data-stu-id="11261-113">Remove the `launchUrl` property to force the app to open at *index.html*&mdash;the project's default file.</span></span>

<span data-ttu-id="11261-114">有多种方式可以获取 jQuery.。</span><span class="sxs-lookup"><span data-stu-id="11261-114">There are several ways to get jQuery.</span></span> <span data-ttu-id="11261-115">在前面的代码片段中，库是从 CDN 中加载的。</span><span class="sxs-lookup"><span data-stu-id="11261-115">In the preceding snippet, the library is loaded from a CDN.</span></span> <span data-ttu-id="11261-116">此示例是一个使用 jQuery 调用 API 的完整 CRUD 示例。</span><span class="sxs-lookup"><span data-stu-id="11261-116">This sample is a complete CRUD example of calling the API with jQuery.</span></span> <span data-ttu-id="11261-117">此实例中有很多其他功能可以丰富你的体验。</span><span class="sxs-lookup"><span data-stu-id="11261-117">There are additional features in this sample to make the experience richer.</span></span> <span data-ttu-id="11261-118">以下是关于调用 API 的说明。</span><span class="sxs-lookup"><span data-stu-id="11261-118">Below are explanations around the calls to the API.</span></span>

### <a name="get-a-list-of-to-do-items"></a><span data-ttu-id="11261-119">获取待办事项的列表</span><span class="sxs-lookup"><span data-stu-id="11261-119">Get a list of to-do items</span></span>

<span data-ttu-id="11261-120">若要获取待办事项列表，请将 HTTP GET 请求发送到 /api/todo。</span><span class="sxs-lookup"><span data-stu-id="11261-120">To get a list of to-do items, send an HTTP GET request to */api/todo*.</span></span>

<span data-ttu-id="11261-121">jQuery [ajax](https://api.jquery.com/jquery.ajax/) 函数将 AJAX 请求发送至 API，这将返回代表对象或数组的 JSON。</span><span class="sxs-lookup"><span data-stu-id="11261-121">The jQuery [ajax](https://api.jquery.com/jquery.ajax/) function sends an AJAX request to the API, which returns JSON representing an object or array.</span></span> <span data-ttu-id="11261-122">此函数可以处理所有形式的 HTTP 交互、将 HTTP 请求发送至指定的 `url`。</span><span class="sxs-lookup"><span data-stu-id="11261-122">This function can handle all forms of HTTP interaction, sending an HTTP request to the specified `url`.</span></span> <span data-ttu-id="11261-123">`GET` 被用作 `type`。</span><span class="sxs-lookup"><span data-stu-id="11261-123">`GET` is used as the `type`.</span></span> <span data-ttu-id="11261-124">如果请求成功，则调用 `success` 回调函数。</span><span class="sxs-lookup"><span data-stu-id="11261-124">The `success` callback function is invoked if the request succeeds.</span></span> <span data-ttu-id="11261-125">在该回调中使用待办事项信息更新 DOM。</span><span class="sxs-lookup"><span data-stu-id="11261-125">In the callback, the DOM is updated with the to-do information.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_GetData)]

### <a name="add-a-to-do-item"></a><span data-ttu-id="11261-126">添加待办事项</span><span class="sxs-lookup"><span data-stu-id="11261-126">Add a to-do item</span></span>

<span data-ttu-id="11261-127">若要添加代办实现，请将 HTTP POST 请求发送至 /api/todo/。</span><span class="sxs-lookup"><span data-stu-id="11261-127">To add a to-do item, send an HTTP POST request to */api/todo/*.</span></span> <span data-ttu-id="11261-128">请求正文应包含待办对象。</span><span class="sxs-lookup"><span data-stu-id="11261-128">The request body should contain a to-do object.</span></span> <span data-ttu-id="11261-129">[ajax](https://api.jquery.com/jquery.ajax/) 函数使用 `POST` 调用 API。</span><span class="sxs-lookup"><span data-stu-id="11261-129">The [ajax](https://api.jquery.com/jquery.ajax/) function is using `POST` to call the API.</span></span> <span data-ttu-id="11261-130">对于 `POST` 和 `PUT` 请求，请求正文表示发送至 API 的数据。</span><span class="sxs-lookup"><span data-stu-id="11261-130">For `POST` and `PUT` requests, the request body represents the data sent to the API.</span></span> <span data-ttu-id="11261-131">API 需要 JSON 请求正文。</span><span class="sxs-lookup"><span data-stu-id="11261-131">The API is expecting a JSON request body.</span></span> <span data-ttu-id="11261-132">将 `accepts` 和 `contentType` 设为 `application/json`，以便分别对接收和发送的媒体类型进行分类。</span><span class="sxs-lookup"><span data-stu-id="11261-132">The `accepts` and `contentType` options are set to `application/json` to classify the media type being received and sent, respectively.</span></span> <span data-ttu-id="11261-133">使用 [`JSON.stringify`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify) 将数据转换为 JSON 对象。</span><span class="sxs-lookup"><span data-stu-id="11261-133">The data is converted to a JSON object using [`JSON.stringify`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify).</span></span> <span data-ttu-id="11261-134">当 API 返回成功状态的代码时，将调用 `getData` 函数来更新 HTML 表。</span><span class="sxs-lookup"><span data-stu-id="11261-134">When the API returns a successful status code, the `getData` function is invoked to update the HTML table.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_AddItem)]

### <a name="update-a-to-do-item"></a><span data-ttu-id="11261-135">更新待办事项</span><span class="sxs-lookup"><span data-stu-id="11261-135">Update a to-do item</span></span>

<span data-ttu-id="11261-136">待办事项的更新与添加非常类似，因为两者都依赖于请求正文。</span><span class="sxs-lookup"><span data-stu-id="11261-136">Updating a to-do item is very similar to adding one, since both rely on a request body.</span></span> <span data-ttu-id="11261-137">这种情况下，两者间真正的区别在于添加该项的唯一标识符时会更改 `url`，且 `type` 为 `PUT`。</span><span class="sxs-lookup"><span data-stu-id="11261-137">The only real difference between the two in this case is that the `url` changes to add the unique identifier of the item, and the `type` is `PUT`.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_AjaxPut)]

### <a name="delete-a-to-do-item"></a><span data-ttu-id="11261-138">删除待办事项</span><span class="sxs-lookup"><span data-stu-id="11261-138">Delete a to-do item</span></span>

<span data-ttu-id="11261-139">若要删除待办事项，请将 AJAX 调用上的 `type` 设为 `DELETE` 并指定该项在 URL 中的唯一标识符。</span><span class="sxs-lookup"><span data-stu-id="11261-139">Deleting a to-do item is accomplished by setting the `type` on the AJAX call to `DELETE` and specifing the item's unique identifier in the URL.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_AjaxDelete)]
