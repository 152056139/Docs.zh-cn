# <a name="key-vault-configuration-provider-sample-application-aspnet-core-2x"></a><span data-ttu-id="25337-101">密钥保管库配置提供程序示例应用程序 (ASP.NET Core 2.x)</span><span class="sxs-lookup"><span data-stu-id="25337-101">Key Vault Configuration Provider sample application (ASP.NET Core 2.x)</span></span>

<span data-ttu-id="25337-102">此示例演示如何使用 Azure 密钥保管库配置提供程序的 ASP.NET Core 2.x。</span><span class="sxs-lookup"><span data-stu-id="25337-102">This sample illustrates the use of the Azure Key Vault Configuration Provider for ASP.NET Core 2.x.</span></span> <span data-ttu-id="25337-103">有关 ASP.NET 核心 1.x 示例，请参阅[密钥保管库配置提供程序示例应用程序 (ASP.NET Core 1.x)](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/basic-sample/1.x)。</span><span class="sxs-lookup"><span data-stu-id="25337-103">For the ASP.NET Core 1.x sample, see [Key Vault Configuration Provider sample application (ASP.NET Core 1.x)](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/basic-sample/1.x).</span></span>

<span data-ttu-id="25337-104">此示例的工作原理的详细信息，请参阅[Azure 密钥保管库配置提供程序](xref:security/key-vault-configuration)主题。</span><span class="sxs-lookup"><span data-stu-id="25337-104">For more information on how the sample works, see the [Azure Key Vault configuration provider](xref:security/key-vault-configuration) topic.</span></span>

## <a name="using-the-sample"></a><span data-ttu-id="25337-105">使用示例</span><span class="sxs-lookup"><span data-stu-id="25337-105">Using the sample</span></span>
1. <span data-ttu-id="25337-106">创建密钥保管库并设置应用程序的指南的 Azure Active Directory (Azure AD)[开始使用 Azure 密钥保管库](https://azure.microsoft.com/documentation/articles/key-vault-get-started/)。</span><span class="sxs-lookup"><span data-stu-id="25337-106">Create a key vault and set up Azure Active Directory (Azure AD) for the application following the guidance in [Get started with Azure Key Vault](https://azure.microsoft.com/documentation/articles/key-vault-get-started/).</span></span>
  * <span data-ttu-id="25337-107">将机密添加到密钥保管库使用[AzureRM 密钥保管库 PowerShell 模块](/powershell/module/azurerm.keyvault)可从[PowerShell 库](https://www.powershellgallery.com/packages/AzureRM.KeyVault)、 [Azure 密钥保管库 REST API](/rest/api/keyvault/)，或[Azure 门户](https://portal.azure.com/)。</span><span class="sxs-lookup"><span data-stu-id="25337-107">Add secrets to the key vault using the [AzureRM Key Vault PowerShell Module](/powershell/module/azurerm.keyvault) available from the [PowerShell Gallery](https://www.powershellgallery.com/packages/AzureRM.KeyVault), the [Azure Key Vault REST API](/rest/api/keyvault/), or the [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="25337-108">机密创建为*手动*或*证书*机密。</span><span class="sxs-lookup"><span data-stu-id="25337-108">Secrets are created as either *Manual* or *Certificate* secrets.</span></span> <span data-ttu-id="25337-109">*证书*机密是使用应用程序和服务的证书，但不是支持配置提供程序。</span><span class="sxs-lookup"><span data-stu-id="25337-109">*Certificate* secrets are certificates for use by apps and services but are not supported by the configuration provider.</span></span> <span data-ttu-id="25337-110">应使用*手动*选项可创建带有配置提供程序使用的名称-值对机密。</span><span class="sxs-lookup"><span data-stu-id="25337-110">You should use the *Manual* option to create name-value pair secrets for use with the configuration provider.</span></span>
    * <span data-ttu-id="25337-111">创建简单的机密的名称-值对。</span><span class="sxs-lookup"><span data-stu-id="25337-111">Simple secrets are created as name-value pairs.</span></span> <span data-ttu-id="25337-112">Azure 密钥保管库密钥名称被限制为字母数字字符和短划线。</span><span class="sxs-lookup"><span data-stu-id="25337-112">Azure Key Vault secret names are limited to alphanumeric characters and dashes.</span></span>
    * <span data-ttu-id="25337-113">分层值 （配置节） 使用`--`（两个短划线） 作为分隔符，在此示例。</span><span class="sxs-lookup"><span data-stu-id="25337-113">Hierarchical values (configuration sections) use `--` (two dashes) as a separator in the sample.</span></span> <span data-ttu-id="25337-114">通常用于分隔的子项中的一部分的冒号[ASP.NET 核心配置](xref:fundamentals/configuration)，机密名称中不允许出现。</span><span class="sxs-lookup"><span data-stu-id="25337-114">Colons, which are normally used to delimit a section from a subkey in [ASP.NET Core configuration](xref:fundamentals/configuration), aren't allowed in secret names.</span></span> <span data-ttu-id="25337-115">因此，两个短划线的使用和机密加载到应用程序的配置时交换冒号。</span><span class="sxs-lookup"><span data-stu-id="25337-115">Therefore, two dashes are used and swapped for a colon when the secrets are loaded into the app's configuration.</span></span>
    * <span data-ttu-id="25337-116">创建两个*手动*具有以下名称-值对的机密。</span><span class="sxs-lookup"><span data-stu-id="25337-116">Create two *Manual* secrets with the following name-value pairs.</span></span> <span data-ttu-id="25337-117">第一个密钥是一个简单的名称和值，并第二个密钥创建一个部分和子项中的密钥名称机密值：</span><span class="sxs-lookup"><span data-stu-id="25337-117">The first secret is a simple name and value, and the second secret creates a secret value with a section and subkey in the secret name:</span></span>
      * <span data-ttu-id="25337-118">`SecretName`: `secret_value_1`</span><span class="sxs-lookup"><span data-stu-id="25337-118">`SecretName`: `secret_value_1`</span></span>
      * <span data-ttu-id="25337-119">`Section--SecretName`: `secret_value_2`</span><span class="sxs-lookup"><span data-stu-id="25337-119">`Section--SecretName`: `secret_value_2`</span></span>
  * <span data-ttu-id="25337-120">向 Azure Active Directory 注册示例应用程序。</span><span class="sxs-lookup"><span data-stu-id="25337-120">Register the sample app with Azure Active Directory.</span></span>
  * <span data-ttu-id="25337-121">授权应用程序访问密钥保管库。</span><span class="sxs-lookup"><span data-stu-id="25337-121">Authorize the app to access the key vault.</span></span> <span data-ttu-id="25337-122">当你使用`Set-AzureRmKeyVaultAccessPolicy`PowerShell cmdlet 来授权应用程序访问密钥保管库，提供`List`和`Get`访问与机密`-PermissionsToKeys list,get`。</span><span class="sxs-lookup"><span data-stu-id="25337-122">When you use the `Set-AzureRmKeyVaultAccessPolicy` PowerShell cmdlet to authorize the app to access the key vault, provide `List` and `Get` access to secrets with `-PermissionsToKeys list,get`.</span></span>
2. <span data-ttu-id="25337-123">更新应用程序的*appsettings.json*的值的文件`Vault`， `ClientId`，和`ClientSecret`。</span><span class="sxs-lookup"><span data-stu-id="25337-123">Update the app's *appsettings.json* file with the values of `Vault`, `ClientId`, and `ClientSecret`.</span></span>
3. <span data-ttu-id="25337-124">运行示例应用程序，它可以通过获取其配置值从`IConfigurationRoot`机密的名称与同名。</span><span class="sxs-lookup"><span data-stu-id="25337-124">Run the sample app, which obtains its configuration values from `IConfigurationRoot` with the same name as the secret name.</span></span>
  * <span data-ttu-id="25337-125">非分层值： 的值`SecretName`一起被获取`config["SecretName"]`。</span><span class="sxs-lookup"><span data-stu-id="25337-125">Non-hierarchical values: The value for `SecretName` is obtained with `config["SecretName"]`.</span></span>
  * <span data-ttu-id="25337-126">分层值 （节）： 使用`:`（冒号） 表示法或`GetSection`扩展方法。</span><span class="sxs-lookup"><span data-stu-id="25337-126">Hierarchical values (sections): Use `:` (colon) notation or the `GetSection` extension method.</span></span> <span data-ttu-id="25337-127">使用这些方法之一获取配置值：</span><span class="sxs-lookup"><span data-stu-id="25337-127">Use either of these approaches to obtain the configuration value:</span></span>
    * `config["Section:SecretName"]`
    * `config.GetSection("Section")["SecretName"]`
