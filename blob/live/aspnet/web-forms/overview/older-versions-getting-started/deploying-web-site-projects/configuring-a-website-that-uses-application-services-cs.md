---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-cs
title: "配置网站，以使用应用程序服务 (C#) |Microsoft 文档"
author: rick-anderson
description: "ASP.NET 版本 2.0 引入了一系列的应用程序服务，这是.NET Framework 的一部分，并且作为构建基块的一套服务，则..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/23/2009
ms.topic: article
ms.assetid: 1e33d1c6-3f9f-4c26-81e2-2a8f8907bb05
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-cs
msc.type: authoredcontent
ms.openlocfilehash: 030b0bb218ca05ec270b8fb0a9321e31d9ab5180
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2017
---
<a name="configuring-a-website-that-uses-application-services-c"></a><span data-ttu-id="bcf15-103">配置网站，以使用应用程序服务 (C#)</span><span class="sxs-lookup"><span data-stu-id="bcf15-103">Configuring a Website that Uses Application Services (C#)</span></span>
====================
<span data-ttu-id="bcf15-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="bcf15-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="bcf15-105">[下载代码](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_CS.zip)或[下载 PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="bcf15-105">[Download Code](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_CS.zip) or [Download PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_cs.pdf)</span></span>

> <span data-ttu-id="bcf15-106">ASP.NET 版本 2.0 引入了一系列的应用程序服务，这是.NET Framework 的一部分并且用作一套可用于将丰富的功能添加到 web 应用程序的构建基块服务。</span><span class="sxs-lookup"><span data-stu-id="bcf15-106">ASP.NET version 2.0 introduced a series of application services, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="bcf15-107">本教程探究了如何在要使用应用程序服务的生产环境中配置网站，并介绍了与管理用户帐户和角色在生产环境的常见问题。</span><span class="sxs-lookup"><span data-stu-id="bcf15-107">This tutorial explores how to configure a website in the production environment to use application services and addresses common issues with managing user accounts and roles on the production environment.</span></span>


## <a name="introduction"></a><span data-ttu-id="bcf15-108">介绍</span><span class="sxs-lookup"><span data-stu-id="bcf15-108">Introduction</span></span>

<span data-ttu-id="bcf15-109">ASP.NET 版本 2.0 引入了一系列*应用程序服务*，这是.NET Framework 的一部分，并且作为构建基块的一套服务，您可以使用将丰富的功能添加到 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="bcf15-109">ASP.NET version 2.0 introduced a series of *application services*, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="bcf15-110">应用程序服务包括：</span><span class="sxs-lookup"><span data-stu-id="bcf15-110">The application services include:</span></span>

- <span data-ttu-id="bcf15-111">**成员资格**-的 API，用于创建和管理用户帐户。</span><span class="sxs-lookup"><span data-stu-id="bcf15-111">**Membership** - an API for creating and managing user accounts.</span></span>
- <span data-ttu-id="bcf15-112">**角色**-API 对用户进行分类分组的。</span><span class="sxs-lookup"><span data-stu-id="bcf15-112">**Roles** - an API for categorizing users into groups.</span></span>
- <span data-ttu-id="bcf15-113">**配置文件**-的 API，用于存储自定义的、 特定于用户的内容。</span><span class="sxs-lookup"><span data-stu-id="bcf15-113">**Profile** - an API for storing custom, user-specific content.</span></span>
- <span data-ttu-id="bcf15-114">**站点地图**-的用于定义在层次结构，然后可以通过导航控件，如菜单和痕迹导航，显示的窗体中的站点 s 逻辑结构的 API。</span><span class="sxs-lookup"><span data-stu-id="bcf15-114">**Site Map** - an API for defining a site s logical structure in the form of a hierarchy, which can then be displayed via navigation controls, such as menus and breadcrumbs.</span></span>
- <span data-ttu-id="bcf15-115">**个性化**-的 API，用于维护自定义项首选项，最常用于[ *web 部件*](https://msdn.microsoft.com/en-us/library/e0s9t4ck.aspx)。</span><span class="sxs-lookup"><span data-stu-id="bcf15-115">**Personalization** - an API for maintaining customization preferences, most often used with [*WebParts*](https://msdn.microsoft.com/en-us/library/e0s9t4ck.aspx).</span></span>
- <span data-ttu-id="bcf15-116">**运行状况监视**-的 API，用于监视性能、 安全、 错误和运行的 web 应用程序其他系统运行状况度量值。</span><span class="sxs-lookup"><span data-stu-id="bcf15-116">**Health Monitoring** - an API for monitoring performance, security, errors, and other system health metrics for a running web application.</span></span>
  

<span data-ttu-id="bcf15-117">应用程序服务 Api 不限于特定的实现。</span><span class="sxs-lookup"><span data-stu-id="bcf15-117">The application services APIs are not tied to a specific implementation.</span></span> <span data-ttu-id="bcf15-118">相反，指示要使用特定的应用程序服务*提供程序*，并该提供程序实现使用特定的技术的服务。</span><span class="sxs-lookup"><span data-stu-id="bcf15-118">Instead, you instruct the application services to use a particular *provider*, and that provider implements the service using a particular technology.</span></span> <span data-ttu-id="bcf15-119">最常用的提供程序托管在 web 托管公司的基于 Internet 的 web 应用程序都是使用 SQL Server 数据库实现这些提供程序。</span><span class="sxs-lookup"><span data-stu-id="bcf15-119">The most commonly used providers for Internet-based web applications hosted at a web hosting company are those providers that use a SQL Server database implementation.</span></span> <span data-ttu-id="bcf15-120">例如，`SqlMembershipProvider`是将用户帐户信息存储在 Microsoft SQL Server 数据库中的成员资格 api 提供程序。</span><span class="sxs-lookup"><span data-stu-id="bcf15-120">For example, the `SqlMembershipProvider` is a provider for the Membership API that stores user account information in a Microsoft SQL Server database.</span></span>

<span data-ttu-id="bcf15-121">部署应用程序时，使用的应用程序服务和 SQL Server 提供程序将添加一些难题。</span><span class="sxs-lookup"><span data-stu-id="bcf15-121">Using the application services and SQL Server providers adds some challenges when deploying the application.</span></span> <span data-ttu-id="bcf15-122">对于初学者，必须在开发和生产数据库上正确创建应用程序服务数据库对象并将其正确初始化。</span><span class="sxs-lookup"><span data-stu-id="bcf15-122">For starters, the application services database objects must be properly created on both the development and production databases and appropriately initialized.</span></span> <span data-ttu-id="bcf15-123">也有需要进行的重要的配置设置。</span><span class="sxs-lookup"><span data-stu-id="bcf15-123">There are also important configuration settings that need to be made.</span></span>

> [!NOTE]
> <span data-ttu-id="bcf15-124">应用程序服务 Api 设计使用[*提供程序模型*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)，允许 API s 的实现详细信息，以在运行时提供的设计模式。</span><span class="sxs-lookup"><span data-stu-id="bcf15-124">The application services APIs were designed using the [*provider model*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), a design pattern that allows for an API s implementation details to be provided at runtime.</span></span> <span data-ttu-id="bcf15-125">.NET Framework 附带有很多应用程序服务提供商，可以使用，如`SqlMembershipProvider`和`SqlRoleProvider`、 它们的成员身份提供程序和角色使用的 Api，SQL Server 数据库实现。</span><span class="sxs-lookup"><span data-stu-id="bcf15-125">The .NET Framework ships with a number of application service providers that can be used, such as the `SqlMembershipProvider` and `SqlRoleProvider`, which are providers for the Membership and Roles APIs that use a SQL Server database implementation.</span></span> <span data-ttu-id="bcf15-126">你还可以创建和插件自定义提供程序。</span><span class="sxs-lookup"><span data-stu-id="bcf15-126">You can also create and plug-in a custom provider.</span></span> <span data-ttu-id="bcf15-127">事实上，图书评论 web 应用程序已包含的自定义提供程序站点映射 API (`ReviewSiteMapProvider`)，它构造中的数据中的站点映射`Genres`和`Books`数据库中的表。</span><span class="sxs-lookup"><span data-stu-id="bcf15-127">In fact, the Book Reviews web application already contains a custom provider for the Site Map API (`ReviewSiteMapProvider`), which constructs the site map from the data in the `Genres` and `Books` tables in the database.</span></span>


<span data-ttu-id="bcf15-128">本教程开头看我如何扩展图书评论 web 应用程序使用的成员资格和角色 Api。</span><span class="sxs-lookup"><span data-stu-id="bcf15-128">This tutorial starts with a look at how I extended the Book Reviews web application to use the Membership and Roles APIs.</span></span> <span data-ttu-id="bcf15-129">它然后指导完成部署的 web 应用程序使用 SQL Server 数据库实现，使用应用程序服务，并通过解决常见问题的管理用户帐户和角色在生产环境来结束。</span><span class="sxs-lookup"><span data-stu-id="bcf15-129">It then walks through deploying a web application that uses application services with a SQL Server database implementation, and concludes by addressing common issues with managing user accounts and roles on the production environment.</span></span>

## <a name="updates-to-the-book-reviews-application"></a><span data-ttu-id="bcf15-130">对簿评审应用程序的更新</span><span class="sxs-lookup"><span data-stu-id="bcf15-130">Updates to the Book Reviews Application</span></span>

<span data-ttu-id="bcf15-131">过去的几教程簿查看 web 应用程序已更新从静态网站，以动态、 数据驱动的 web 应用程序的一组用于管理风格和评论的管理页面完成。</span><span class="sxs-lookup"><span data-stu-id="bcf15-131">Over the past couple tutorials the Book Reviews web application was updated from a static website to a dynamic, data-driven web application complete with a set of administration pages for managing genres and reviews.</span></span> <span data-ttu-id="bcf15-132">但是，当前不受保护管理本节-任何用户都知道 （或猜出） 管理页的 URL 可以 waltz 中和创建、 编辑或删除在我们站点上的评审。</span><span class="sxs-lookup"><span data-stu-id="bcf15-132">However, this administration section is currently not protected - any user who knows (or guesses) the administration page URL can waltz in and create, edit, or delete reviews on our site.</span></span> <span data-ttu-id="bcf15-133">若要保护的某些部分的常用方法是网站的实现用户帐户，然后使用 URL 授权规则来限制对某些用户或角色的访问。</span><span class="sxs-lookup"><span data-stu-id="bcf15-133">A common way to protect certain portions of a website is to implement user accounts and then use URL authorization rules to restrict access to certain users or roles.</span></span> <span data-ttu-id="bcf15-134">可供下载本教程的学习图书评论 web 应用程序支持用户帐户和角色。</span><span class="sxs-lookup"><span data-stu-id="bcf15-134">The Book Reviews web application available for download with this tutorial supports user accounts and roles.</span></span> <span data-ttu-id="bcf15-135">它具有一个定义角色名为管理员，并且只有此角色中的用户可以访问管理页。</span><span class="sxs-lookup"><span data-stu-id="bcf15-135">It has a single role defined named Admin and only users in this role can access the administration pages.</span></span>

> [!NOTE]
> <span data-ttu-id="bcf15-136">我已在图书评论 web 应用程序中创建三个用户帐户： Scott、 Jisun 和 Alice。</span><span class="sxs-lookup"><span data-stu-id="bcf15-136">I ve created three user accounts in the Book Reviews web application: Scott, Jisun, and Alice.</span></span> <span data-ttu-id="bcf15-137">所有三个用户都具有相同的密码：**密码 ！**</span><span class="sxs-lookup"><span data-stu-id="bcf15-137">All three users have the same password: **password!**</span></span> <span data-ttu-id="bcf15-138">Scott 和 Jisun 是管理员角色中，Alice 不是。</span><span class="sxs-lookup"><span data-stu-id="bcf15-138">Scott and Jisun are in the Admin role, Alice is not.</span></span> <span data-ttu-id="bcf15-139">站点 s 非管理页面都匿名用户仍可以访问。</span><span class="sxs-lookup"><span data-stu-id="bcf15-139">The site s non-administration pages are still accessible to anonymous users.</span></span> <span data-ttu-id="bcf15-140">也就是说，不需要登录以访问站点，除非你想要管理它，在这种情况下您必须登录为管理员角色中的用户。</span><span class="sxs-lookup"><span data-stu-id="bcf15-140">That is, you do not need to sign in to visit the site, unless you want to administer it, in which case you must sign in as a user in the Admin role.</span></span>


<span data-ttu-id="bcf15-141">簿评审应用程序 s master 页已更新以包括不同的用户界面为经过身份验证和匿名用户。</span><span class="sxs-lookup"><span data-stu-id="bcf15-141">The Book Reviews application s master page has been updated to include a different user interface for authenticated and anonymous users.</span></span> <span data-ttu-id="bcf15-142">如果匿名用户访问该站点她将看到右上角的登录链接。</span><span class="sxs-lookup"><span data-stu-id="bcf15-142">If an anonymous user visits the site she sees a Login link in the upper right corner.</span></span> <span data-ttu-id="bcf15-143">身份验证的用户将看到此消息，"欢迎回来，*用户名*！"</span><span class="sxs-lookup"><span data-stu-id="bcf15-143">An authenticated user sees the message, "Welcome back, *username*!"</span></span> <span data-ttu-id="bcf15-144">并将其注销的链接。此处 s 还登录页 (`~/Login.aspx`)，其中包含用于进行身份验证访问者提供的用户界面和逻辑的登录 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="bcf15-144">and a link to log out. There s also a login page (`~/Login.aspx`), which contains a Login Web control that provides the user interface and logic for authenticating a visitor.</span></span> <span data-ttu-id="bcf15-145">只有管理员才能创建新帐户。</span><span class="sxs-lookup"><span data-stu-id="bcf15-145">Only administrators can create new accounts.</span></span> <span data-ttu-id="bcf15-146">(已用于创建和管理中的用户帐户的页`~/Admin`文件夹。)</span><span class="sxs-lookup"><span data-stu-id="bcf15-146">(There are pages for creating and managing user accounts in the `~/Admin` folder.)</span></span>

### <a name="configuring-the-membership-and-roles-apis"></a><span data-ttu-id="bcf15-147">配置成员资格和角色 Api</span><span class="sxs-lookup"><span data-stu-id="bcf15-147">Configuring the Membership and Roles APIs</span></span>

<span data-ttu-id="bcf15-148">图书评论 web 应用程序使用的成员资格和角色 Api 以支持用户帐户并分组为角色 （即管理员角色） 的这些用户。</span><span class="sxs-lookup"><span data-stu-id="bcf15-148">The Book Reviews web application uses the Membership and Roles APIs to support user accounts and to group those users into roles (namely, the Admin role).</span></span> <span data-ttu-id="bcf15-149">`SqlMembershipProvider`和`SqlRoleProvider`使用提供程序类进行，因为我们想要在 SQL Server 数据库中存储帐户和角色的信息。</span><span class="sxs-lookup"><span data-stu-id="bcf15-149">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes are used because we want to store account and role information in a SQL Server database.</span></span>

> [!NOTE]
> <span data-ttu-id="bcf15-150">本教程不是要在配置 web 应用程序以支持的成员资格和角色 Api 的详细的信息。</span><span class="sxs-lookup"><span data-stu-id="bcf15-150">This tutorial is not intended to be a detailed examination at configuring a web application to support the Membership and Roles APIs.</span></span> <span data-ttu-id="bcf15-151">全面查看这些 Api 和需要采取以配置网站以使用它们的步骤，请阅读我[*网站安全教程*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="bcf15-151">For a thorough look at these APIs and the steps you need to take to configure a website to use them, please read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>


<span data-ttu-id="bcf15-152">若要使用应用程序服务和 SQL Server 数据库必须首先添加到数据库这些提供程序用于你在这些位置的用户帐户的数据库对象和存储的角色信息。</span><span class="sxs-lookup"><span data-stu-id="bcf15-152">To use the application services with a SQL Server database you must first add the database objects used by these providers to the database where you want the user account and role information stored.</span></span> <span data-ttu-id="bcf15-153">这些必备项的数据库对象包括各种表、 视图和存储的过程。</span><span class="sxs-lookup"><span data-stu-id="bcf15-153">These requisite database objects include a variety of tables, views, and stored procedures.</span></span> <span data-ttu-id="bcf15-154">除非另行指定，否则，`SqlMembershipProvider`和`SqlRoleProvider`提供程序类使用名为的 SQL Server Express Edition 数据库`ASPNETDB`位于应用程序的`App_Data`文件夹; 如果此类数据库不存在，它将自动创建通过这些提供程序在运行时的必要的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="bcf15-154">Unless specified otherwise, the `SqlMembershipProvider` and `SqlRoleProvider` provider classes use a SQL Server Express Edition database named `ASPNETDB` located in the application s `App_Data` folder; if such a database does not exist, it is automatically created with the necessary database objects by these providers at runtime.</span></span>

<span data-ttu-id="bcf15-155">可能实现，且通常理想，若要创建应用程序服务网站 s 应用程序特定数据的存储位置位于同一数据库中的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="bcf15-155">It is possible, and usually ideal, to create the application services database objects in the same database where the website s application-specific data is stored.</span></span> <span data-ttu-id="bcf15-156">.NET Framework 附带有一个名为工具`aspnet_regsql.exe`用于指定数据库上安装的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="bcf15-156">The .NET Framework ships with a tool named `aspnet_regsql.exe` that installs the database objects on a specified database.</span></span> <span data-ttu-id="bcf15-157">我已继续进入并使用此工具将添加到这些对象`Reviews.mdf`数据库中`App_Data`文件夹 （开发数据库）。</span><span class="sxs-lookup"><span data-stu-id="bcf15-157">I have gone ahead and used this tool to add these objects to the `Reviews.mdf` database in the `App_Data` folder (the development database).</span></span> <span data-ttu-id="bcf15-158">我们将了解如何在本教程后面使用此工具，当我们将这些对象添加到生产数据库。</span><span class="sxs-lookup"><span data-stu-id="bcf15-158">We'll see how to use this tool later in this tutorial when we add these objects to the production database.</span></span>

<span data-ttu-id="bcf15-159">如果应用程序服务到数据库的数据库对象而不添加`ASPNETDB`将需要自定义`SqlMembershipProvider`和`SqlRoleProvider`提供程序类配置，以便他们使用相应的数据库。</span><span class="sxs-lookup"><span data-stu-id="bcf15-159">If you add the application services database objects to a database other than `ASPNETDB` you will need to customize the `SqlMembershipProvider` and `SqlRoleProvider` provider classes configurations so that they use the appropriate database.</span></span> <span data-ttu-id="bcf15-160">若要自定义成员资格提供程序将添加[ *&lt;成员资格&gt;元素*](https://msdn.microsoft.com/en-us/library/1b9hw62f.aspx)内`<system.web>`主题中`Web.config`; 使用[ *&lt;roleManager&gt;元素*](https://msdn.microsoft.com/en-us/library/ms164660.aspx)配置角色提供程序。</span><span class="sxs-lookup"><span data-stu-id="bcf15-160">To customize the Membership provider add a [*&lt;membership&gt; element*](https://msdn.microsoft.com/en-us/library/1b9hw62f.aspx) within the `<system.web>` section in `Web.config`; use the [*&lt;roleManager&gt; element*](https://msdn.microsoft.com/en-us/library/ms164660.aspx) to configure the Roles provider.</span></span> <span data-ttu-id="bcf15-161">下面的代码段取自簿评审应用程序的`Web.config`和显示的成员资格和角色 Api 的配置设置。</span><span class="sxs-lookup"><span data-stu-id="bcf15-161">The following snippet is taken from the Book Reviews application s `Web.config` and shows the configure settings for the Membership and Roles APIs.</span></span> <span data-ttu-id="bcf15-162">请注意同时注册新的提供程序-`ReviewMembership`和`ReviewRole`-使用`SqlMembershipProvider`和`SqlRoleProvider`提供程序，分别。</span><span class="sxs-lookup"><span data-stu-id="bcf15-162">Note that both register a new provider - `ReviewMembership` and `ReviewRole` - that use the `SqlMembershipProvider` and `SqlRoleProvider` providers, respectively.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample1.xml)]

<span data-ttu-id="bcf15-163">`Web.config`文件的`<authentication>`元素也已配置为支持基于窗体的身份验证。</span><span class="sxs-lookup"><span data-stu-id="bcf15-163">The `Web.config` file s `<authentication>` element has also been configured to support forms-based authentication.</span></span>
  

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample2.xml)]

### <a name="limiting-access-to-the-administration-pages"></a><span data-ttu-id="bcf15-164">限制访问管理页</span><span class="sxs-lookup"><span data-stu-id="bcf15-164">Limiting Access to the Administration Pages</span></span>

<span data-ttu-id="bcf15-165">ASP.NET，可以轻松地授予或拒绝对特定文件或文件夹由用户或角色通过访问其*URL 授权*功能。</span><span class="sxs-lookup"><span data-stu-id="bcf15-165">ASP.NET makes it easy to grant or deny access to a particular file or folder by user or by role via its *URL authorization* feature.</span></span> <span data-ttu-id="bcf15-166">(我们简要讨论中的 URL 授权*核心差异之间 IIS 和 ASP.NET Development Server*教程并显示 IIS 和 ASP.NET Development Server 将以不同方式适用于静态 URL 授权规则的应用而不是动态的内容。）因为我们想要禁止访问`~/Admin`除外管理员角色中的这些用户的文件夹，我们需要将 URL 授权规则添加到此文件夹。</span><span class="sxs-lookup"><span data-stu-id="bcf15-166">(We briefly discussed URL authorization in the *Core Differences Between IIS and the ASP.NET Development Server* tutorial and showed how IIS and the ASP.NET Development Server apply URL authorization rules differently for static versus dynamic content.) Because we want to prohibit access to the `~/Admin` folder except for those users in the Admin role, we need to add URL authorization rules to this folder.</span></span> <span data-ttu-id="bcf15-167">具体而言，URL 授权规则需要允许管理员角色中的用户和拒绝所有其他用户。</span><span class="sxs-lookup"><span data-stu-id="bcf15-167">Specifically, the URL authorization rules need to allow users in the Admin role and deny all other users.</span></span> <span data-ttu-id="bcf15-168">这通过添加实现`Web.config`文件为`~/Admin`文件夹具有以下内容：</span><span class="sxs-lookup"><span data-stu-id="bcf15-168">This is accomplished by adding a `Web.config` file to the `~/Admin` folder with the following contents:</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample3.xml)]

<span data-ttu-id="bcf15-169">为 ASP.NET 的 URL 授权功能以及如何使用它来拼写出用户和角色，授权规则的详细信息请务必阅读[*基于用户的授权*](../../older-versions-security/membership/user-based-authorization-cs.md)和[*基于角色的授权*](../../older-versions-security/roles/role-based-authorization-cs.md)从教程我[*网站安全教程*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="bcf15-169">For more information on ASP.NET s URL authorization feature and how to use it to spell out authorization rules for users and for roles, be sure to read the [*User-Based Authorization*](../../older-versions-security/membership/user-based-authorization-cs.md) and [*Role-Based Authorization*](../../older-versions-security/roles/role-based-authorization-cs.md) tutorials from my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

## <a name="deploying-a-web-application-that-uses-application-services"></a><span data-ttu-id="bcf15-170">部署的 Web 应用程序使用应用程序服务</span><span class="sxs-lookup"><span data-stu-id="bcf15-170">Deploying a Web Application That Uses Application Services</span></span>

<span data-ttu-id="bcf15-171">在部署时使用应用程序服务和应用程序服务信息存储在数据库中的提供程序的网站，则务必，在生产数据库上创建应用程序服务所需的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="bcf15-171">When deploying a website that uses application services and a provider that stores the application services information in a database, it is imperative that the database objects needed by the application services be created on the production database.</span></span> <span data-ttu-id="bcf15-172">最初生产数据库不包含这些对象，因此第一次部署应用程序时 （或在添加应用程序服务后首次部署时），你必须采取额外的步骤来获取这些必备项的数据库对象上生产数据库。</span><span class="sxs-lookup"><span data-stu-id="bcf15-172">Initially the production database does not contain these objects, so when the application is first deployed (or when it is deployed for the first time after application services have been added), you must take extra steps to get these requisite database objects on the production database.</span></span>

<span data-ttu-id="bcf15-173">部署使用应用程序服务，如果你想要复制到生产环境开发环境中创建的用户帐户的网站时，可能会出现另一个难题。</span><span class="sxs-lookup"><span data-stu-id="bcf15-173">Another challenge can arise when deploying a website that uses application services if you intend to replicate the user accounts created in the development environment to the production environment.</span></span> <span data-ttu-id="bcf15-174">根据成员资格和角色的配置，有可能，即使你已成功复制到生产数据库开发环境中创建的用户帐户，这些用户将无法登录到 web 应用程序在生产环境中。</span><span class="sxs-lookup"><span data-stu-id="bcf15-174">Depending on the Membership and Roles configuration, it is possible that even if you successfully copy the user accounts that were created in the development environment to the production database, these users cannot sign into the web application in production.</span></span> <span data-ttu-id="bcf15-175">我们将看一下此问题的原因，并讨论如何防止发生。</span><span class="sxs-lookup"><span data-stu-id="bcf15-175">We'll look at the cause of this issue and discuss how to prevent it from happening.</span></span>

<span data-ttu-id="bcf15-176">ASP.NET 附带 nice [*网站管理工具 (WSAT)* ](https://msdn.microsoft.com/en-us/library/yy40ytx0.aspx) ，可以从 Visual Studio 启动，并允许用户帐户、 角色和授权规则，以通过基于 web 的管理接口。</span><span class="sxs-lookup"><span data-stu-id="bcf15-176">ASP.NET ships with a nice [*Web Site Administration Tool (WSAT)*](https://msdn.microsoft.com/en-us/library/yy40ytx0.aspx) that can be launched from Visual Studio and allows the user account, roles, and authorization rules to be managed through a web-based interface.</span></span> <span data-ttu-id="bcf15-177">遗憾的是，WSAT 仅适用于本地网站，这意味着不能用来远程管理用户帐户、 角色和 web 应用程序在生产环境中的授权规则。</span><span class="sxs-lookup"><span data-stu-id="bcf15-177">Unfortunately, the WSAT only works for local websites, meaning that it cannot be used to remotely manage user accounts, roles, and authorization rules for the web application in the production environment.</span></span> <span data-ttu-id="bcf15-178">我们将查看不同的方式来实现从您的生产网站 WSAT 类似的行为。</span><span class="sxs-lookup"><span data-stu-id="bcf15-178">We'll look at different ways to implement WSAT-like behavior from your production website.</span></span>

### <a name="adding-the-database-objects-using-aspnetregsqlexe"></a><span data-ttu-id="bcf15-179">添加的数据库对象使用 aspnet\_regsql.exe</span><span class="sxs-lookup"><span data-stu-id="bcf15-179">Adding the Database Objects Using aspnet\_regsql.exe</span></span>

<span data-ttu-id="bcf15-180">*部署数据库*教程介绍了如何将从开发数据库的表和数据复制到生产数据库中，和肯定可以使用这些技术将复制到的应用程序服务数据库对象生产数据库。</span><span class="sxs-lookup"><span data-stu-id="bcf15-180">The *Deploying a Database* tutorial showed how to copy the tables and data from the development database to the production database, and these techniques can certainly be used to copy the application services database objects to the production database.</span></span> <span data-ttu-id="bcf15-181">另一个选项是`aspnet_regsql.exe`工具，它将添加或从数据库中删除应用程序服务数据库对象。</span><span class="sxs-lookup"><span data-stu-id="bcf15-181">Another option is the `aspnet_regsql.exe` tool, which adds or removes the application services database objects from a database.</span></span>

> [!NOTE]
> <span data-ttu-id="bcf15-182">`aspnet_regsql.exe`工具在指定的数据库上创建数据库对象。</span><span class="sxs-lookup"><span data-stu-id="bcf15-182">The `aspnet_regsql.exe` tool creates the database objects on a specified database.</span></span> <span data-ttu-id="bcf15-183">它不会为生产数据库从开发数据库迁移这些数据库对象中的数据。</span><span class="sxs-lookup"><span data-stu-id="bcf15-183">It does not migrate data in those database objects from the development database to the production database.</span></span> <span data-ttu-id="bcf15-184">如果您想要开发数据库中的用户帐户和角色信息复制到生产数据库使用中介绍的技术*部署数据库*教程。</span><span class="sxs-lookup"><span data-stu-id="bcf15-184">If you mean to copy the user account and role information in the development database to the production database use the techniques covered in the *Deploying a Database* tutorial.</span></span>


<span data-ttu-id="bcf15-185">让我们来看一下如何将数据库对象添加到生产数据库使用`aspnet_regsql.exe`工具。</span><span class="sxs-lookup"><span data-stu-id="bcf15-185">Let s look at how to add the database objects to the production database using the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="bcf15-186">首先，打开 Windows 资源管理器并导航到你的计算机，%WINDIR%\ 上的.NET Framework 2.0 版目录Microsoft.NET\Framework\v2.0.50727。</span><span class="sxs-lookup"><span data-stu-id="bcf15-186">Start by opening Windows Explorer and navigating to the .NET Framework version 2.0 directory on your computer, %WINDIR%\ Microsoft.NET\Framework\v2.0.50727.</span></span> <span data-ttu-id="bcf15-187">你应会发现那里`aspnet_regsql.exe`工具。</span><span class="sxs-lookup"><span data-stu-id="bcf15-187">There you should find the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="bcf15-188">可以从命令行中，使用此工具，但它还包括图形用户界面;双击`aspnet_regsql.exe`文件以启动其图形的组件。</span><span class="sxs-lookup"><span data-stu-id="bcf15-188">This tool can be used from the command-line, but it also includes a graphical user interface; double-click the `aspnet_regsql.exe` file to launch its graphical component.</span></span>

<span data-ttu-id="bcf15-189">此工具将启动通过显示说明其用途的初始屏幕。</span><span class="sxs-lookup"><span data-stu-id="bcf15-189">The tool starts by displaying a splash screen explaining its purpose.</span></span> <span data-ttu-id="bcf15-190">单击旁边前进到"选择安装选项"屏幕，其中图 1 所示。</span><span class="sxs-lookup"><span data-stu-id="bcf15-190">Click Next to advance to the "Select a Setup Option" screen, which is shown in Figure 1.</span></span> <span data-ttu-id="bcf15-191">从此处你可以选择添加应用程序服务数据库对象，或从数据库中删除它们。</span><span class="sxs-lookup"><span data-stu-id="bcf15-191">From here you can choose to add the application services database objects or remove them from a database.</span></span> <span data-ttu-id="bcf15-192">因为我们想要将这些对象添加到生产数据库，选择"配置应用程序服务的 SQL Server"选项，然后单击下一步。</span><span class="sxs-lookup"><span data-stu-id="bcf15-192">Because we want to add these objects to the production database, select the "Configure SQL Server for application services" option and click Next.</span></span>


<span data-ttu-id="bcf15-193">[![选择将 SQL Server 配置为应用程序服务](configuring-a-website-that-uses-application-services-cs/_static/image2.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="bcf15-193">[![Choose to Configure SQL Server for Application Services](configuring-a-website-that-uses-application-services-cs/_static/image2.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image1.jpg)</span></span>

<span data-ttu-id="bcf15-194">**图 1**： 为应用程序服务选择到配置 SQL Server ([单击以查看实际尺寸的图像](configuring-a-website-that-uses-application-services-cs/_static/image3.jpg))</span><span class="sxs-lookup"><span data-stu-id="bcf15-194">**Figure 1**: Choose to Configure SQL Server for Application Services ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image3.jpg))</span></span>


<span data-ttu-id="bcf15-195">在"选择服务器和数据库"屏幕提示输入信息以连接到数据库。</span><span class="sxs-lookup"><span data-stu-id="bcf15-195">In "Select the Server and Database" screen prompts for information to connect to the database.</span></span> <span data-ttu-id="bcf15-196">输入数据库服务器、 安全凭据和按您的 web 托管公司提供给你的数据库名称，然后单击下一步。</span><span class="sxs-lookup"><span data-stu-id="bcf15-196">Enter the database server, the security credentials, and the database name supplied to you by your web hosting company and click Next.</span></span>

> [!NOTE]
> <span data-ttu-id="bcf15-197">输入您的数据库服务器和凭据后可能会收到错误，当展开数据库下拉列表时。</span><span class="sxs-lookup"><span data-stu-id="bcf15-197">After entering your database server and credentials you may get an error when expanding the database drop-down list.</span></span> <span data-ttu-id="bcf15-198">`aspnet_regsql.exe`工具查询`sysdatabases`系统表以检索上服务器，但一些 web 托管公司锁定其数据库服务器，因此就不公开提供此信息的数据库列表。</span><span class="sxs-lookup"><span data-stu-id="bcf15-198">The `aspnet_regsql.exe` tool queries the `sysdatabases` system table to retrieve a list of databases on the server, but some web hosting companies lock down their database servers so that this information is not publicly available.</span></span> <span data-ttu-id="bcf15-199">如果收到此错误可以直接在下拉列表中键入数据库名称。</span><span class="sxs-lookup"><span data-stu-id="bcf15-199">If you get this error you can type the database name directly into the drop-down list.</span></span>


<span data-ttu-id="bcf15-200">[![提供你的数据库的连接信息的工具](configuring-a-website-that-uses-application-services-cs/_static/image5.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="bcf15-200">[![Supply the Tool With Your Database s Connection Information](configuring-a-website-that-uses-application-services-cs/_static/image5.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image4.jpg)</span></span>

<span data-ttu-id="bcf15-201">**图 2**： 提供工具与您的数据库 s 连接信息 ([单击以查看实际尺寸的图像](configuring-a-website-that-uses-application-services-cs/_static/image6.jpg))</span><span class="sxs-lookup"><span data-stu-id="bcf15-201">**Figure 2**: Supply the Tool With Your Database s Connection Information ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image6.jpg))</span></span>


<span data-ttu-id="bcf15-202">后续屏幕总结了要执行的位置，即的操作的应用程序服务数据库对象添加到指定的数据库。</span><span class="sxs-lookup"><span data-stu-id="bcf15-202">The subsequent screen summarizes the actions that are about to take place, namely that the application services database objects are going to be added to the specified database.</span></span> <span data-ttu-id="bcf15-203">单击旁边完成此操作。</span><span class="sxs-lookup"><span data-stu-id="bcf15-203">Click Next to complete this action.</span></span> <span data-ttu-id="bcf15-204">几分钟后的最后一个屏幕会显示，注意数据库对象已添加的 （请参见图 3）。</span><span class="sxs-lookup"><span data-stu-id="bcf15-204">After a few moments, the final screen is displayed, noting that the database objects have been added (see Figure 3).</span></span>


<span data-ttu-id="bcf15-205">[![成功 ！应用程序服务数据库对象已添加到生产数据库](configuring-a-website-that-uses-application-services-cs/_static/image8.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="bcf15-205">[![Success! The Application Services Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-cs/_static/image8.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image7.jpg)</span></span>

<span data-ttu-id="bcf15-206">**图 3**： 成功 ！</span><span class="sxs-lookup"><span data-stu-id="bcf15-206">**Figure 3**: Success!</span></span> <span data-ttu-id="bcf15-207">应用程序服务数据库对象已添加到生产数据库 ([单击以查看实际尺寸的图像](configuring-a-website-that-uses-application-services-cs/_static/image9.jpg))</span><span class="sxs-lookup"><span data-stu-id="bcf15-207">The Application Services Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image9.jpg))</span></span>


<span data-ttu-id="bcf15-208">若要验证的应用程序服务数据库对象已成功添加到生产数据库，请打开 SQL Server Management Studio 并连接到你的生产数据库。</span><span class="sxs-lookup"><span data-stu-id="bcf15-208">To verify that the application services database objects were successfully added to the production database, open SQL Server Management Studio and connect to your production database.</span></span> <span data-ttu-id="bcf15-209">如图 4 所示，你现在应该在数据库中，会看到应用程序服务数据库表`aspnet_Applications`， `aspnet_Membership`， `aspnet_Users`，依次类推。</span><span class="sxs-lookup"><span data-stu-id="bcf15-209">As Figure 4 shows, you should now see the application services database tables in your database, `aspnet_Applications`, `aspnet_Membership`, `aspnet_Users`, and so forth.</span></span>


<span data-ttu-id="bcf15-210">[![确认已将数据库对象添加到生产数据库](configuring-a-website-that-uses-application-services-cs/_static/image11.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image10.jpg)</span><span class="sxs-lookup"><span data-stu-id="bcf15-210">[![Confirm That the Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-cs/_static/image11.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image10.jpg)</span></span>

<span data-ttu-id="bcf15-211">**图 4**： 确认已将数据库对象添加到生产数据库 ([单击以查看实际尺寸的图像](configuring-a-website-that-uses-application-services-cs/_static/image12.jpg))</span><span class="sxs-lookup"><span data-stu-id="bcf15-211">**Figure 4**: Confirm That the Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image12.jpg))</span></span>


<span data-ttu-id="bcf15-212">你只需使用`aspnet_regsql.exe`工具时部署 web 应用程序第一次或首次使用应用程序服务启动后。</span><span class="sxs-lookup"><span data-stu-id="bcf15-212">You will only need to use the `aspnet_regsql.exe` tool when deploying your web application for the first time or for the first time after you have started using the application services.</span></span> <span data-ttu-id="bcf15-213">这些数据库对象是在生产数据库后它们获胜 t 需要重新添加或修改。</span><span class="sxs-lookup"><span data-stu-id="bcf15-213">Once these database objects are on the production database they won t need to be re-added or modified.</span></span>

### <a name="copying-user-accounts-from-development-to-production"></a><span data-ttu-id="bcf15-214">从开发到生产环境的复制用户帐户</span><span class="sxs-lookup"><span data-stu-id="bcf15-214">Copying User Accounts from Development to Production</span></span>

<span data-ttu-id="bcf15-215">使用时`SqlMembershipProvider`和`SqlRoleProvider`提供程序类，以将应用程序服务信息存储在 SQL Server 数据库中，用户帐户和角色信息存储在数据库表，包括各种`aspnet_Users`， `aspnet_Membership`，`aspnet_Roles`，和`aspnet_UsersInRoles`，等等。</span><span class="sxs-lookup"><span data-stu-id="bcf15-215">When using the `SqlMembershipProvider` and `SqlRoleProvider` provider classes to store the application services information in a SQL Server database, the user account and role information is stored in a variety of database tables, including `aspnet_Users`, `aspnet_Membership`, `aspnet_Roles`, and `aspnet_UsersInRoles`, among others.</span></span> <span data-ttu-id="bcf15-216">如果在开发过程中创建用户帐户在开发环境中你可以通过将相应的记录复制适用的数据库表中复制在生产环境中的这些用户帐户。</span><span class="sxs-lookup"><span data-stu-id="bcf15-216">If during development you create user accounts in the development environment you can replicate those user accounts in production by copying the corresponding records from the applicable database tables.</span></span> <span data-ttu-id="bcf15-217">如果你使用数据库发布向导来部署应用程序服务数据库对象您可能还选择要复制的记录，可能会导致在开发也是在生产中创建的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="bcf15-217">If you used the Database Publishing Wizard to deploy the application services database objects you may have also elected to copy the records, which would result in the user accounts created in development to also be on production.</span></span> <span data-ttu-id="bcf15-218">但是，具体取决于你的配置设置，你可能会发现这些用户已在开发过程中创建其帐户并将其复制到生产环境都无法从生产网站登录。</span><span class="sxs-lookup"><span data-stu-id="bcf15-218">But, depending on your configuration settings, you may find that those users whose accounts were created in development and copied to production are unable to login from the production website.</span></span> <span data-ttu-id="bcf15-219">提供什么？</span><span class="sxs-lookup"><span data-stu-id="bcf15-219">What gives?</span></span>

<span data-ttu-id="bcf15-220">`SqlMembershipProvider`和`SqlRoleProvider`提供程序类已设计，单个数据库可用作用户存储为多个应用程序，其中每个应用程序可以从理论上讲，都具有重叠的用户名的用户和角色具有相同的名称。</span><span class="sxs-lookup"><span data-stu-id="bcf15-220">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes were designed such that a single database could serve as a user store for multiple applications, where each application could, in theory, have users with overlapping usernames and roles with the same name.</span></span> <span data-ttu-id="bcf15-221">若要允许这种灵活性，数据库将维护中的应用程序列表`aspnet_Applications`表和每个用户都使用这些应用程序之一相关联。</span><span class="sxs-lookup"><span data-stu-id="bcf15-221">To allow for this flexibility, the database maintains a list of applications in the `aspnet_Applications` table, and each user is associated with one of these applications.</span></span> <span data-ttu-id="bcf15-222">具体而言，`aspnet_Users`表具有`ApplicationId`会绑定到中的记录每个用户的列`aspnet_Applications`表。</span><span class="sxs-lookup"><span data-stu-id="bcf15-222">Specifically, the `aspnet_Users` table has an `ApplicationId` column that ties each user to a record in the `aspnet_Applications` table.</span></span>

<span data-ttu-id="bcf15-223">除了`ApplicationId`列，`aspnet_Applications`该表还包括`ApplicationName`列，提供应用程序的多用户友好名称。</span><span class="sxs-lookup"><span data-stu-id="bcf15-223">In addition to the `ApplicationId` column, the `aspnet_Applications` table also includes an `ApplicationName` column, which provides a more human-friendly name for the application.</span></span> <span data-ttu-id="bcf15-224">当尝试使用用户帐户，如正在验证的登录页上，从用户的凭据必须告知网站`SqlMembershipProvider`类哪些应用程序以使用。</span><span class="sxs-lookup"><span data-stu-id="bcf15-224">When a website attempts to work with a user account, such as validating a user s credentials from the login page, it must tell the `SqlMembershipProvider` class what application to work with.</span></span> <span data-ttu-id="bcf15-225">它通常执行这一点提供应用程序名称，并且此值来自中的提供程序的配置`Web.config`-专门通过`applicationName`属性。</span><span class="sxs-lookup"><span data-stu-id="bcf15-225">It usually does this by supplying the application name, and the this value comes from the provider s configuration in `Web.config` - specifically via the `applicationName` attribute.</span></span>

<span data-ttu-id="bcf15-226">但如果会发生什么情况`applicationName`中未指定属性`Web.config`？</span><span class="sxs-lookup"><span data-stu-id="bcf15-226">But what happens if the `applicationName` attribute is not specified in `Web.config`?</span></span> <span data-ttu-id="bcf15-227">在这种情况下成员资格系统使用应用程序根路径为`applicationName`值。</span><span class="sxs-lookup"><span data-stu-id="bcf15-227">In such a case the Membership system uses the application root path as the `applicationName` value.</span></span> <span data-ttu-id="bcf15-228">如果`applicationName`未显式设置属性`Web.config`，然后，则可能会出现的开发环境和生产环境使用不同的应用程序的根，因此将无法与不同的应用程序相关联在应用程序服务的名称。</span><span class="sxs-lookup"><span data-stu-id="bcf15-228">If the `applicationName` attribute is not explicitly set in `Web.config`, then, there is the possibility that the development environment and production environment use a different application root and therefore will be associated with different application names in the application services.</span></span> <span data-ttu-id="bcf15-229">如果出现此类不匹配，然后在开发环境中创建这些用户将拥有`ApplicationId`与不匹配的值`ApplicationId`生产环境的值。</span><span class="sxs-lookup"><span data-stu-id="bcf15-229">If such a mismatch occurs then those users created in the development environment will have an `ApplicationId` value that does not match with the `ApplicationId` value for the production environment.</span></span> <span data-ttu-id="bcf15-230">最终结果是获胜 t 这些用户能够登录。</span><span class="sxs-lookup"><span data-stu-id="bcf15-230">The net result is that those users won t be able to login.</span></span>

> [!NOTE]
> <span data-ttu-id="bcf15-231">如果你发现自己在此情况下-复制到生产环境且不匹配的用户帐户与`ApplicationId`值-无法编写查询以更新这些不正确`ApplicationId`值复制到`ApplicationId`用于生产。</span><span class="sxs-lookup"><span data-stu-id="bcf15-231">If you find yourself in this situation - with user accounts copied to production with a mismatched `ApplicationId` value - you could write a query to update these incorrect `ApplicationId` values to the `ApplicationId` used on production.</span></span> <span data-ttu-id="bcf15-232">后更新，在开发环境创建其帐户的用户现在将能够登录到 web 应用程序在生产环境。</span><span class="sxs-lookup"><span data-stu-id="bcf15-232">Once updated, the users whose accounts were created on the development environment would now be able to sign into the web application on production.</span></span>


<span data-ttu-id="bcf15-233">好消息是一个简单的步骤，可以采取用来确保两种环境使用相同`ApplicationId`-显式设置`applicationName`属性中`Web.config`所有应用程序服务提供商。</span><span class="sxs-lookup"><span data-stu-id="bcf15-233">The good news is that there is a simple step you can take to ensure that the two environments use the same `ApplicationId` - explicitly set the `applicationName` attribute in `Web.config` for all of your application services providers.</span></span> <span data-ttu-id="bcf15-234">我显式设置`applicationName`属性设为"BookReviews"中`<membership>`和`<roleManager>`元素作为此代码段从`Web.config`显示。</span><span class="sxs-lookup"><span data-stu-id="bcf15-234">I explicitly set the `applicationName` attribute to "BookReviews" in the `<membership>` and `<roleManager>` elements as this snippet from `Web.config` shows.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample4.xml)]

<span data-ttu-id="bcf15-235">有关设置的详细讨论`applicationName`属性和的基本原理，请参阅[ *Scott Guthrie* ](https://weblogs.asp.net/scottgu/) s 博客文章[*始终设置应用程序名称属性配置 ASP.NET 成员资格和其他提供程序时*](https://weblogs.asp.net/scottgu/443634)。</span><span class="sxs-lookup"><span data-stu-id="bcf15-235">For more discussion on setting the `applicationName` attribute and the rationale behind it, refer to [*Scott Guthrie*](https://weblogs.asp.net/scottgu/) s blog post, [*Always set the applicationName property when configuring ASP.NET Membership and other Providers*](https://weblogs.asp.net/scottgu/443634).</span></span>

### <a name="managing-user-accounts-in-the-production-environment"></a><span data-ttu-id="bcf15-236">在生产环境中的管理用户帐户</span><span class="sxs-lookup"><span data-stu-id="bcf15-236">Managing User Accounts in the Production Environment</span></span>

<span data-ttu-id="bcf15-237">ASP.NET 网站管理工具 (WSAT)，可以轻松创建和管理用户帐户、 定义和应用角色和拼写出用户和基于角色的授权规则。</span><span class="sxs-lookup"><span data-stu-id="bcf15-237">The ASP.NET Web Site Administration Tool (WSAT) makes it easy to create and manage user accounts, define and apply roles, and spell out user- and role-based authorization rules.</span></span> <span data-ttu-id="bcf15-238">您可以在启动从 Visual Studio WSAT 通过转到解决方案资源管理器并单击 ASP.NET 配置图标，或通过转到网站或项目菜单并选择 ASP.NET 配置菜单项。</span><span class="sxs-lookup"><span data-stu-id="bcf15-238">You can launch the WSAT from Visual Studio by going to the Solution Explorer and clicking the ASP.NET Configuration icon or by going to the Website or Project menus and selecting the ASP.NET Configuration menu item.</span></span> <span data-ttu-id="bcf15-239">遗憾的是，WSAT 可以只适用于本地的网站。</span><span class="sxs-lookup"><span data-stu-id="bcf15-239">Unfortunately, the WSAT can only work with local websites.</span></span> <span data-ttu-id="bcf15-240">因此，不能从工作站使用 WSAT 管理生产环境中的网站。</span><span class="sxs-lookup"><span data-stu-id="bcf15-240">Therefore, you cannot use the WSAT from your workstation to manage the website in the production environment.</span></span>

<span data-ttu-id="bcf15-241">好消息是功能的所有公开由 WSAT 可用的成员资格和角色 Api; 通过以编程方式此外，许多 WSAT 屏幕使用 ASP.NET 登录相关的标准控件。</span><span class="sxs-lookup"><span data-stu-id="bcf15-241">The good news is that all of the functionality exposed provided by the WSAT is available programmatically through the Membership and Roles APIs; furthermore, many of the WSAT screens use the standard ASP.NET Login-related controls.</span></span> <span data-ttu-id="bcf15-242">简单地说，你可以将 ASP.NET 页添加到你提供必要的管理功能的网站。</span><span class="sxs-lookup"><span data-stu-id="bcf15-242">In short, you can add ASP.NET pages to your website that offer the necessary management capabilities.</span></span>

<span data-ttu-id="bcf15-243">回想一下之前教程更新图书评论 web 应用程序，以包括`~/Admin`已配置为仅允许管理员角色中的用户文件夹和此文件夹。</span><span class="sxs-lookup"><span data-stu-id="bcf15-243">Recall that an earlier tutorial updated the Book Reviews web application to include an `~/Admin` folder, and this folder has been configured to only allow users in the Admin role.</span></span> <span data-ttu-id="bcf15-244">我添加到名为该文件夹中的页`CreateAccount.aspx`该管理员可以通过创建新的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="bcf15-244">I added a page to that folder named `CreateAccount.aspx` from which an administrator can create a new user account.</span></span> <span data-ttu-id="bcf15-245">此页使用通过来显示用于创建新的用户帐户的用户界面和后端逻辑。</span><span class="sxs-lookup"><span data-stu-id="bcf15-245">This page uses the CreateUserWizard control to display the user interface and backend logic for creating a new user account.</span></span> <span data-ttu-id="bcf15-246">自的新增功能，定义要包括一个提示是否还应将新用户添加到管理员角色的复选框的控件 （请参见图 5）。</span><span class="sxs-lookup"><span data-stu-id="bcf15-246">What s more, I customized the control to include a CheckBox that prompts whether the new user should also be added to the Admin role (see Figure 5).</span></span> <span data-ttu-id="bcf15-247">通过工作很少可以生成实现用户和角色管理相关的任务，否则将由 WSAT 提供一自定义组页面。</span><span class="sxs-lookup"><span data-stu-id="bcf15-247">With a little bit of work you can build a custom set of pages that implements the user and role management-related tasks that would otherwise be provided by the WSAT.</span></span>

> [!NOTE]
> <span data-ttu-id="bcf15-248">有关详细信息使用的成员资格和角色 Api 以及与登录相关的 ASP.NET Web 控件中，请务必阅读我[*网站安全教程*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="bcf15-248">For more information on using the Membership and Roles APIs along with the Login-related ASP.NET Web controls, be sure to read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span> <span data-ttu-id="bcf15-249">有关如何通过自定义的详细信息，请参阅[*创建用户帐户*](../../older-versions-security/membership/creating-user-accounts-cs.md)和[*存储的其他用户信息*](../../older-versions-security/membership/storing-additional-user-information-cs.md)教程，或签出[ *Erich Peterson* ](http://www.erichpeterson.com/) s 文章[*自定义通过*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="bcf15-249">For more on customizing the CreateUserWizard control refer to the [*Creating User Accounts*](../../older-versions-security/membership/creating-user-accounts-cs.md) and [*Storing Additional User Information*](../../older-versions-security/membership/storing-additional-user-information-cs.md) tutorials, or check out [*Erich Peterson*](http://www.erichpeterson.com/) s article, [*Customizing the CreateUserWizard Control*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx).</span></span>


<span data-ttu-id="bcf15-250">[![管理员可以创建新用户帐户](configuring-a-website-that-uses-application-services-cs/_static/image14.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image13.jpg)</span><span class="sxs-lookup"><span data-stu-id="bcf15-250">[![Administrators Can Create New User Accounts](configuring-a-website-that-uses-application-services-cs/_static/image14.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image13.jpg)</span></span>

<span data-ttu-id="bcf15-251">**图 5**： 管理员可以创建新的用户帐户 ([单击以查看实际尺寸的图像](configuring-a-website-that-uses-application-services-cs/_static/image15.jpg))</span><span class="sxs-lookup"><span data-stu-id="bcf15-251">**Figure 5**: Administrators Can Create New User Accounts ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image15.jpg))</span></span>


<span data-ttu-id="bcf15-252">如果你需要该 WSAT 签出的完整功能[*滚动你自己网站管理工具*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)，在哪个作者 Dan Clem 逐步的过程生成一个自定义的 WSAT 类似的工具。</span><span class="sxs-lookup"><span data-stu-id="bcf15-252">If you need the full functionality of the WSAT check out [*Rolling Your Own Web Site Administration Tool*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx), in which author Dan Clem walks through the process of building a custom WSAT-like tool.</span></span> <span data-ttu-id="bcf15-253">Dan 共享其应用程序的源代码 （在 C# 中)，并提供有关将其添加到托管网站的分步说明。</span><span class="sxs-lookup"><span data-stu-id="bcf15-253">Dan shares his application s source code (in C#) and provides step-by-step instructions for adding it to your hosted website.</span></span>

## <a name="summary"></a><span data-ttu-id="bcf15-254">摘要</span><span class="sxs-lookup"><span data-stu-id="bcf15-254">Summary</span></span>

<span data-ttu-id="bcf15-255">部署的 web 应用程序使用的应用程序服务数据库实现时你首先必须确保生产数据库具有所需的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="bcf15-255">When deploying a web application that uses the application services database implementation you must first ensure that the production database has the requisite database objects.</span></span> <span data-ttu-id="bcf15-256">这些对象可添加使用中讨论的技术*部署数据库*教程; 或者，可以使用`aspnet_regsql.exe`工具，如我们在本教程中看到。</span><span class="sxs-lookup"><span data-stu-id="bcf15-256">These objects can be added using the techniques discussed in the *Deploying a Database* tutorial; alternatively, you can use the `aspnet_regsql.exe` tool, as we saw in this tutorial.</span></span> <span data-ttu-id="bcf15-257">上以同步中 （这是重要信息： 如果你希望用户并在开发环境中创建的角色才能对生产有效） 的开发和生产环境和技术的使用的应用程序名称为中心，我们接触其他挑战管理用户和生产环境中的角色。</span><span class="sxs-lookup"><span data-stu-id="bcf15-257">Other challenges we touched on center around synchronizing the application name used in the development and production environments (which is important if you want users and roles created in the development environment to be valid on production) and techniques for managing the users and roles in the production environment.</span></span>

<span data-ttu-id="bcf15-258">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="bcf15-258">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="bcf15-259">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="bcf15-259">Further Reading</span></span>

<span data-ttu-id="bcf15-260">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="bcf15-260">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="bcf15-261">*ASP.NET SQL 服务器注册工具 (aspnet_regsql.exe)*</span><span class="sxs-lookup"><span data-stu-id="bcf15-261">*ASP.NET SQL Server Registration Tool (aspnet_regsql.exe)*</span></span>](https://msdn.microsoft.com/en-us/library/ms229862.aspx)
- [<span data-ttu-id="bcf15-262">*为 SQL Server 中创建应用程序服务数据库*</span><span class="sxs-lookup"><span data-stu-id="bcf15-262">*Creating the Application Services Database for SQL Server*</span></span>](https://msdn.microsoft.com/en-us/library/x28wfk74.aspx)
- [<span data-ttu-id="bcf15-263">*在 SQL Server 中创建成员身份架构*</span><span class="sxs-lookup"><span data-stu-id="bcf15-263">*Creating the Membership Schema in SQL Server*</span></span>](../../older-versions-security/membership/creating-the-membership-schema-in-sql-server-cs.md)
- [<span data-ttu-id="bcf15-264">*检查 ASP.NET s 成员资格、 角色和配置文件*</span><span class="sxs-lookup"><span data-stu-id="bcf15-264">*Examining ASP.NET s Membership, Roles, and Profile*</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="bcf15-265">*滚动你自己的网站管理工具*</span><span class="sxs-lookup"><span data-stu-id="bcf15-265">*Rolling Your Own Web Site Administration Tool*</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="bcf15-266">*网站安全教程*</span><span class="sxs-lookup"><span data-stu-id="bcf15-266">*Website Security Tutorials*</span></span>](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)
- [<span data-ttu-id="bcf15-267">*网站管理工具概述*</span><span class="sxs-lookup"><span data-stu-id="bcf15-267">*Web Site Administration Tool Overview*</span></span>](https://msdn.microsoft.com/en-us/library/yy40ytx0.aspx)

>[!div class="step-by-step"]
<span data-ttu-id="bcf15-268">[上一页](configuring-the-production-web-application-to-use-the-production-database-cs.md)
[下一页](strategies-for-database-development-and-deployment-cs.md)</span><span class="sxs-lookup"><span data-stu-id="bcf15-268">[Previous](configuring-the-production-web-application-to-use-the-production-database-cs.md)
[Next](strategies-for-database-development-and-deployment-cs.md)</span></span>
