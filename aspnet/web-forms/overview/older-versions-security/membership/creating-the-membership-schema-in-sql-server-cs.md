---
uid: web-forms/overview/older-versions-security/membership/creating-the-membership-schema-in-sql-server-cs
title: "在 SQL Server (C#) 中创建成员身份架构 |Microsoft 文档"
author: rick-anderson
description: "本教程开始通过检查用于向数据库添加必要的架构，才能使用 SqlMembershipProvider 技术。 以下，我们 wi..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/18/2008
ms.topic: article
ms.assetid: b4ac129d-1b8e-41ca-a38f-9b19d7c7bb0e
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/membership/creating-the-membership-schema-in-sql-server-cs
msc.type: authoredcontent
ms.openlocfilehash: 2155f9b0893a0b1d3cf60bc63d80df4417649beb
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2017
---
<a name="creating-the-membership-schema-in-sql-server-c"></a><span data-ttu-id="7665e-104">在 SQL Server (C#) 中创建成员身份架构</span><span class="sxs-lookup"><span data-stu-id="7665e-104">Creating the Membership Schema in SQL Server (C#)</span></span>
====================
<span data-ttu-id="7665e-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7665e-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7665e-106">[下载代码](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_04_CS.zip)或[下载 PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial04_MembershipSetup_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="7665e-106">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_04_CS.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial04_MembershipSetup_cs.pdf)</span></span>

> <span data-ttu-id="7665e-107">本教程开始通过检查用于向数据库添加必要的架构，才能使用 SqlMembershipProvider 技术。</span><span class="sxs-lookup"><span data-stu-id="7665e-107">This tutorial starts by examining techniques for adding the necessary schema to the database in order to use the SqlMembershipProvider.</span></span> <span data-ttu-id="7665e-108">接下来，我们将检查架构中的键的表，并讨论它们的目的和重要性。</span><span class="sxs-lookup"><span data-stu-id="7665e-108">Following that, we will examine the key tables in the schema and discuss their purpose and importance.</span></span> <span data-ttu-id="7665e-109">本教程结尾一下如何判断成员资格框架应使用的提供程序的 ASP.NET 应用程序。</span><span class="sxs-lookup"><span data-stu-id="7665e-109">This tutorial ends with a look at how to tell an ASP.NET application which provider the Membership framework should use.</span></span>


## <a name="introduction"></a><span data-ttu-id="7665e-110">介绍</span><span class="sxs-lookup"><span data-stu-id="7665e-110">Introduction</span></span>

<span data-ttu-id="7665e-111">前面的两个教程，用于检查使用窗体身份验证标识网站访问者。</span><span class="sxs-lookup"><span data-stu-id="7665e-111">The previous two tutorials examined using forms authentication to identify website visitors.</span></span> <span data-ttu-id="7665e-112">窗体身份验证框架轻松开发人员可以将用户登录到网站，并通过使用身份验证票证的网页访问跨记住它们。</span><span class="sxs-lookup"><span data-stu-id="7665e-112">The forms authentication framework makes it easy for developers to log a user into a website and to remember them across page visits through the use of authentication tickets.</span></span> <span data-ttu-id="7665e-113">`FormsAuthentication`类包含用于生成票证和将其添加到访问者的 cookie 的方法。</span><span class="sxs-lookup"><span data-stu-id="7665e-113">The `FormsAuthentication` class includes methods for generating the ticket and adding it to the visitor's cookies.</span></span> <span data-ttu-id="7665e-114">`FormsAuthenticationModule`检查所有传入请求，用于具有有效的身份验证票证，创建并关联`GenericPrincipal`和`FormsIdentity`与当前请求的对象。</span><span class="sxs-lookup"><span data-stu-id="7665e-114">The `FormsAuthenticationModule` examines all incoming requests and, for those with a valid authentication ticket, creates and associates a `GenericPrincipal` and a `FormsIdentity` object with the current request.</span></span> <span data-ttu-id="7665e-115">窗体身份验证是仅用于授予访问者的身份验证票证时日志记录中，然后在后续请求，分析该票证，以确定用户的标识的机制。</span><span class="sxs-lookup"><span data-stu-id="7665e-115">Forms authentication is merely a mechanism for granting an authentication ticket to a visitor when logging in and, on subsequent requests, parsing that ticket to determine the user's identity.</span></span> <span data-ttu-id="7665e-116">Web 应用程序以支持用户帐户，我们仍需要实现用户存储区并添加功能来验证凭据，注册新用户，并与其他用户帐户相关的任务花费更多。</span><span class="sxs-lookup"><span data-stu-id="7665e-116">For a web application to support user accounts, we still need to implement a user store and add functionality to validate credentials, register new users, and the myriad of other user account-related tasks.</span></span>

<span data-ttu-id="7665e-117">在 ASP.NET 2.0 中之前, 开发人员在实现所有这些用户帐户相关的任务的挂钩。</span><span class="sxs-lookup"><span data-stu-id="7665e-117">Prior to ASP.NET 2.0, developers were on the hook for implementing all of these user account-related tasks.</span></span> <span data-ttu-id="7665e-118">幸运的是 ASP.NET 团队识别这种不足，并引入 ASP.NET 2.0 的成员资格 framework。</span><span class="sxs-lookup"><span data-stu-id="7665e-118">Fortunately the ASP.NET team recognized this shortcoming and introduced the Membership framework with ASP.NET 2.0.</span></span> <span data-ttu-id="7665e-119">成员资格 framework 是一套.NET Framework 中提供了完成核心用户帐户相关任务的编程接口的类。</span><span class="sxs-lookup"><span data-stu-id="7665e-119">The Membership framework is a set of classes in the .NET Framework that provide a programmatic interface for accomplishing core user account-related tasks.</span></span> <span data-ttu-id="7665e-120">此框架生成之上[提供程序模型](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)，它允许开发人员插入标准化 API 的自定义的实现。</span><span class="sxs-lookup"><span data-stu-id="7665e-120">This framework is built atop the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), which allows developers to plug a customized implementation into a standardized API.</span></span>

<span data-ttu-id="7665e-121">中所述<a id="Tutorial1"> </a> [*安全性基础知识和 ASP.NET 支持*](../introduction/security-basics-and-asp-net-support-cs.md)教程中，.NET Framework 附带两个内置的成员资格提供程序： [ `ActiveDirectoryMembershipProvider` ](https://msdn.microsoft.com/en-us/library/system.web.security.activedirectorymembershipprovider.aspx)和[ `SqlMembershipProvider` ](https://msdn.microsoft.com/en-us/library/system.web.security.sqlmembershipprovider.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7665e-121">As discussed in the <a id="Tutorial1"></a>[*Security Basics and ASP.NET Support*](../introduction/security-basics-and-asp-net-support-cs.md) tutorial, the .NET Framework ships with two built-in Membership providers: [`ActiveDirectoryMembershipProvider`](https://msdn.microsoft.com/en-us/library/system.web.security.activedirectorymembershipprovider.aspx) and [`SqlMembershipProvider`](https://msdn.microsoft.com/en-us/library/system.web.security.sqlmembershipprovider.aspx).</span></span> <span data-ttu-id="7665e-122">顾名思义，`SqlMembershipProvider`使用 Microsoft SQL Server 数据库作为用户存储区。</span><span class="sxs-lookup"><span data-stu-id="7665e-122">As its name implies, the `SqlMembershipProvider` uses a Microsoft SQL Server database as the user store.</span></span> <span data-ttu-id="7665e-123">若要在应用程序中使用此提供程序，我们需要告诉哪些数据库以使用作为存储的提供程序。</span><span class="sxs-lookup"><span data-stu-id="7665e-123">In order to use this provider in an application, we need to tell the provider what database to use as the store.</span></span> <span data-ttu-id="7665e-124">正如您想像，`SqlMembershipProvider`需要具有某些数据库表、 视图和存储的过程对用户存储数据库。</span><span class="sxs-lookup"><span data-stu-id="7665e-124">As you might imagine, the `SqlMembershipProvider` expects the user store database to have certain database tables, views, and stored procedures.</span></span> <span data-ttu-id="7665e-125">我们需要将此预期的架构添加到所选数据库。</span><span class="sxs-lookup"><span data-stu-id="7665e-125">We need to add this expected schema to the selected database.</span></span>

<span data-ttu-id="7665e-126">本教程开始通过检查用于向数据库添加必要的架构，若要使用技术`SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="7665e-126">This tutorial starts by examining techniques for adding the necessary schema to the database in order to use the `SqlMembershipProvider`.</span></span> <span data-ttu-id="7665e-127">接下来，我们将检查架构中的键的表，并讨论它们的目的和重要性。</span><span class="sxs-lookup"><span data-stu-id="7665e-127">Following that, we will examine the key tables in the schema and discuss their purpose and importance.</span></span> <span data-ttu-id="7665e-128">本教程结尾一下如何判断成员资格框架应使用的提供程序的 ASP.NET 应用程序。</span><span class="sxs-lookup"><span data-stu-id="7665e-128">This tutorial ends with a look at how to tell an ASP.NET application which provider the Membership framework should use.</span></span>

<span data-ttu-id="7665e-129">让我们进入正题！</span><span class="sxs-lookup"><span data-stu-id="7665e-129">Let's get started!</span></span>

## <a name="step-1-deciding-where-to-place-the-user-store"></a><span data-ttu-id="7665e-130">步骤 1： 决定在何处放置用户存储区</span><span class="sxs-lookup"><span data-stu-id="7665e-130">Step 1: Deciding Where to Place the User Store</span></span>

<span data-ttu-id="7665e-131">ASP.NET 应用程序的数据通常存储在多个数据库中的表中。</span><span class="sxs-lookup"><span data-stu-id="7665e-131">An ASP.NET application's data is commonly stored in a number of tables in a database.</span></span> <span data-ttu-id="7665e-132">在实现时`SqlMembershipProvider`我们必须决定是否要将成员资格架构放在应用程序数据与相同的数据库或另一个数据库中的数据库架构。</span><span class="sxs-lookup"><span data-stu-id="7665e-132">When implementing the `SqlMembershipProvider` database schema we must decide whether to place the Membership schema in the same database as the application data or in an alternate database.</span></span>

<span data-ttu-id="7665e-133">建议的应用程序数据与同一数据库中查找成员资格架构，原因如下：</span><span class="sxs-lookup"><span data-stu-id="7665e-133">I recommend locating the Membership schema in the same database as the application data for the following reasons:</span></span>

- <span data-ttu-id="7665e-134">**可维护性**其数据封装在一个数据库的应用程序更轻松地理解、 维护和比具有两个单独的数据库的应用程序部署。</span><span class="sxs-lookup"><span data-stu-id="7665e-134">**Maintainability** � an application whose data is encapsulated in one database is easier to understand, maintain, and deploy than an application that has two separate databases.</span></span>
- <span data-ttu-id="7665e-135">**关系的完整性**通过定位同一数据库中的成员资格相关的表，为应用程序表它是可以建立[外键约束](http://en.wikipedia.org/wiki/Foreign_key)之间中的主键成员资格相关的表和相关的应用程序表。</span><span class="sxs-lookup"><span data-stu-id="7665e-135">**Relational Integrity** � by locating the Membership-related tables in the same database as the application tables it is possible to establish [foreign key constraints](http://en.wikipedia.org/wiki/Foreign_key) between the primary keys in the Membership-related tables and related application tables.</span></span>

<span data-ttu-id="7665e-136">仅分离到不同的数据库的用户存储和应用程序数据是有意义，如果你有多个应用程序每个使用单独的数据库，但需要共享通用的用户存储。</span><span class="sxs-lookup"><span data-stu-id="7665e-136">Decoupling the user store and application data into separate databases only makes sense if you have multiple applications that each use separate databases, but need to share a common user store.</span></span>

### <a name="creating-a-database"></a><span data-ttu-id="7665e-137">创建数据库</span><span class="sxs-lookup"><span data-stu-id="7665e-137">Creating a Database</span></span>

<span data-ttu-id="7665e-138">因为第二个教程不需要数据库时，才具有已我们构建的应用程序。</span><span class="sxs-lookup"><span data-stu-id="7665e-138">The application we have been building since the second tutorial has not yet needed a database.</span></span> <span data-ttu-id="7665e-139">我们需要一个现在，但是，用户存储区。</span><span class="sxs-lookup"><span data-stu-id="7665e-139">We need one now, however, for the user store.</span></span> <span data-ttu-id="7665e-140">让我们创建一个，然后向其中添加所需的架构`SqlMembershipProvider`提供程序 （请参阅步骤 2）。</span><span class="sxs-lookup"><span data-stu-id="7665e-140">Let's create one and then add to it the schema required by the `SqlMembershipProvider` provider (see Step 2).</span></span>

> [!NOTE]
> <span data-ttu-id="7665e-141">我们将使用在本教程系列整个[Microsoft SQL Server 2005 Express Edition](https://msdn.microsoft.com/en-us/sql/Aa336346.aspx)数据库来存储我们的应用程序表和`SqlMembershipProvider`架构。</span><span class="sxs-lookup"><span data-stu-id="7665e-141">Throughout this tutorial series we will be using a [Microsoft SQL Server 2005 Express Edition](https://msdn.microsoft.com/en-us/sql/Aa336346.aspx) database to store our application tables and the `SqlMembershipProvider` schema.</span></span> <span data-ttu-id="7665e-142">有两个原因做出此决定是： 首先，由于其成本-免费的 Express Edition 是最 readably 访问版本的 SQL Server 2005;其次，SQL Server 2005 Express Edition 数据库可以放置直接在 web 应用程序的`App_Data`文件夹，使其简单来打包数据库和 web 应用程序一起在一个 ZIP 文件并将它重新部署而无需任何特殊的设置说明或配置选项。</span><span class="sxs-lookup"><span data-stu-id="7665e-142">This decision was made for two reasons: first, due to its cost - free - the Express Edition is the most readably accessible version of SQL Server 2005; second, SQL Server 2005 Express Edition databases can be placed directly in the web application's `App_Data` folder, making it a cinch to package the database and web application together in one ZIP file and to redeploy it without any special setup instructions or configuration options.</span></span> <span data-ttu-id="7665e-143">如果你想要遵循使用非-Express Edition 版本的 SQL Server，随意。</span><span class="sxs-lookup"><span data-stu-id="7665e-143">If you'd prefer to follow along using a non-Express Edition version of SQL Server, feel free.</span></span> <span data-ttu-id="7665e-144">几乎相同的步骤。</span><span class="sxs-lookup"><span data-stu-id="7665e-144">The steps are virtually identical.</span></span> <span data-ttu-id="7665e-145">`SqlMembershipProvider`架构将工作的任何版本的 Microsoft SQL Server 2000 和最多。</span><span class="sxs-lookup"><span data-stu-id="7665e-145">The `SqlMembershipProvider` schema will work with any version of Microsoft SQL Server 2000 and up.</span></span>


<span data-ttu-id="7665e-146">从解决方案资源管理器，右键单击`App_Data`文件夹，然后选择添加新项。</span><span class="sxs-lookup"><span data-stu-id="7665e-146">From the Solution Explorer, right-click on the `App_Data` folder and choose to Add New Item.</span></span> <span data-ttu-id="7665e-147">(如果看不到`App_Data`文件夹在项目中，右键单击解决方案资源管理器中的项目，选择添加 ASP.NET 文件夹，并选择`App_Data`。)从添加新项对话框中，选择要添加名为的新 SQL 数据库`SecurityTutorials.mdf`。</span><span class="sxs-lookup"><span data-stu-id="7665e-147">(If you do not see an `App_Data` folder in your project, right-click on the project in Solution Explorer, select Add ASP.NET Folder, and pick `App_Data`.) From the Add New Item dialog box, choose to add a new SQL Database named `SecurityTutorials.mdf`.</span></span> <span data-ttu-id="7665e-148">在本教程中我们将添加`SqlMembershipProvider`架构到此数据库; 在后续教程中我们将创建其他要捕获应用程序数据的表。</span><span class="sxs-lookup"><span data-stu-id="7665e-148">In this tutorial we will add the `SqlMembershipProvider` schema to this database; in subsequent tutorials we will create additional tables to capture our application data.</span></span>


<span data-ttu-id="7665e-149">[![添加新命名的 App_Data 文件夹 SecurityTutorials.mdf 数据库的 SQL 数据库](creating-the-membership-schema-in-sql-server-cs/_static/image2.png)](creating-the-membership-schema-in-sql-server-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7665e-149">[![Add a New SQL Database Named SecurityTutorials.mdf Database to the App_Data Folder](creating-the-membership-schema-in-sql-server-cs/_static/image2.png)](creating-the-membership-schema-in-sql-server-cs/_static/image1.png)</span></span>

<span data-ttu-id="7665e-150">**图 1**： 添加新的 SQL 数据库命名`SecurityTutorials.mdf`数据库到`App_Data`文件夹 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="7665e-150">**Figure 1**: Add a New SQL Database Named `SecurityTutorials.mdf` Database to the `App_Data` Folder ([Click to view full-size image](creating-the-membership-schema-in-sql-server-cs/_static/image3.png))</span></span>


<span data-ttu-id="7665e-151">添加到数据库`App_Data`文件夹会自动包括它在数据库资源管理器视图中。</span><span class="sxs-lookup"><span data-stu-id="7665e-151">Adding a database to the `App_Data` folder automatically includes it in the Database Explorer view.</span></span> <span data-ttu-id="7665e-152">（在 Visual Studio 的非-速成版版本中，数据库资源管理器称为服务器资源管理器。）转到数据库资源管理器并展开刚-添加`SecurityTutorials`数据库。</span><span class="sxs-lookup"><span data-stu-id="7665e-152">(In the non-Express Edition version of Visual Studio, the Database Explorer is called the Server Explorer.) Go to the Database Explorer and expand the just-added `SecurityTutorials` database.</span></span> <span data-ttu-id="7665e-153">如果你未显示在屏幕的数据库资源管理器，转到视图菜单上，选择数据库资源管理器，或按 Ctrl + Alt + S。</span><span class="sxs-lookup"><span data-stu-id="7665e-153">If you do not see the Database Explorer on screen, go to the View menu and choose Database Explorer, or hit Ctrl+Alt+S.</span></span> <span data-ttu-id="7665e-154">如图 2 所示，`SecurityTutorials`数据库为空-它包含任何表、 任何视图和存储的过程。</span><span class="sxs-lookup"><span data-stu-id="7665e-154">As Figure 2 shows, the `SecurityTutorials` database is empty - it contains no tables, no views, and no stored procedures.</span></span>


<span data-ttu-id="7665e-155">[![SecurityTutorials 数据库目前是空](creating-the-membership-schema-in-sql-server-cs/_static/image5.png)](creating-the-membership-schema-in-sql-server-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="7665e-155">[![The SecurityTutorials Database is Currently Empty](creating-the-membership-schema-in-sql-server-cs/_static/image5.png)](creating-the-membership-schema-in-sql-server-cs/_static/image4.png)</span></span>

<span data-ttu-id="7665e-156">**图 2**:`SecurityTutorials`数据库目前是空 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="7665e-156">**Figure 2**: The `SecurityTutorials` Database is Currently Empty ([Click to view full-size image](creating-the-membership-schema-in-sql-server-cs/_static/image6.png))</span></span>


## <a name="step-2-adding-thesqlmembershipproviderschema-to-the-database"></a><span data-ttu-id="7665e-157">步骤 2： 添加`SqlMembershipProvider`到数据库的架构</span><span class="sxs-lookup"><span data-stu-id="7665e-157">Step 2: Adding the`SqlMembershipProvider`Schema to the Database</span></span>

<span data-ttu-id="7665e-158">`SqlMembershipProvider`需要一组特定的表、 视图和存储的过程以安装在用户存储数据库中。</span><span class="sxs-lookup"><span data-stu-id="7665e-158">The `SqlMembershipProvider` requires a particular set of tables, views, and stored procedures to be installed in the user store database.</span></span> <span data-ttu-id="7665e-159">可以使用添加这些必备项的数据库对象[`aspnet_regsql.exe`工具](https://msdn.microsoft.com/en-us/library/ms229862.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7665e-159">These requisite database objects can be added using the [`aspnet_regsql.exe` tool](https://msdn.microsoft.com/en-us/library/ms229862.aspx).</span></span> <span data-ttu-id="7665e-160">此文件位于`%WINDIR%\Microsoft.Net\Framework\v2.0.50727\`文件夹。</span><span class="sxs-lookup"><span data-stu-id="7665e-160">This file is located in the `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\` folder.</span></span>

> [!NOTE]
> <span data-ttu-id="7665e-161">`aspnet_regsql.exe`工具提供命令行功能和图形用户界面。</span><span class="sxs-lookup"><span data-stu-id="7665e-161">The `aspnet_regsql.exe` tool offers both command line functionality and a graphical user interface.</span></span> <span data-ttu-id="7665e-162">图形界面是多个用户友好，我们在本教程中将检查。</span><span class="sxs-lookup"><span data-stu-id="7665e-162">The graphical interface is more user friendly and is what we will examine in this tutorial.</span></span> <span data-ttu-id="7665e-163">命令行界面非常有用的添加`SqlMembershipProvider`架构需要可来自动执行，例如，生成脚本或自动测试方案。</span><span class="sxs-lookup"><span data-stu-id="7665e-163">The command line interface is useful when the addition of the `SqlMembershipProvider` schema needs to be automated, such as in build scripts or automated testing scenarios.</span></span>


<span data-ttu-id="7665e-164">`aspnet_regsql.exe`工具用于添加或删除*ASP.NET 应用程序服务*到指定的 SQL Server 数据库。</span><span class="sxs-lookup"><span data-stu-id="7665e-164">The `aspnet_regsql.exe` tool is used to add or remove *ASP.NET application services* to a specified SQL Server database.</span></span> <span data-ttu-id="7665e-165">ASP.NET 应用程序服务包含的架构`SqlMembershipProvider`和`SqlRoleProvider`，以及为其他 ASP.NET 2.0 框架的基于 SQL 的提供程序的架构。</span><span class="sxs-lookup"><span data-stu-id="7665e-165">The ASP.NET application services encompass the schemas for the `SqlMembershipProvider` and `SqlRoleProvider`, along with the schemas for the SQL-based providers for other ASP.NET 2.0 frameworks.</span></span> <span data-ttu-id="7665e-166">我们需要提供的信息的两个位`aspnet_regsql.exe`工具：</span><span class="sxs-lookup"><span data-stu-id="7665e-166">We need to provide two bits of information to the `aspnet_regsql.exe` tool:</span></span>

- <span data-ttu-id="7665e-167">我们是否想要添加或删除应用程序服务和</span><span class="sxs-lookup"><span data-stu-id="7665e-167">Whether we want to add or remove application services, and</span></span>
- <span data-ttu-id="7665e-168">从其中添加或删除应用程序服务架构的数据库</span><span class="sxs-lookup"><span data-stu-id="7665e-168">The database from which to add or remove the application services schema</span></span>

<span data-ttu-id="7665e-169">在提示输入数据库后，若要使用，`aspnet_regsql.exe`工具会询问一些我们提供的安全凭据连接到数据库，数据库所在的服务器的名称和数据库名称。</span><span class="sxs-lookup"><span data-stu-id="7665e-169">In prompting for the database to use, the `aspnet_regsql.exe` tool asks us to provide the name of the server the database resides on, the security credentials for connecting to the database, and the database name.</span></span> <span data-ttu-id="7665e-170">如果使用非 Express Edition 的 SQL Server，您应该已经知道此信息，因为它是使用通过 ASP.NET web 页的数据库时，必须提供通过连接字符串的相同信息。</span><span class="sxs-lookup"><span data-stu-id="7665e-170">If you are using the non-Express Edition of SQL Server, you should already know this information, as it is the same information you must provide through a connection string when working with the database through an ASP.NET web page.</span></span> <span data-ttu-id="7665e-171">使用中的 SQL Server 2005 Express Edition 数据库时确定的服务器和数据库名称`App_Data`文件夹，但是，会有点更为复杂。</span><span class="sxs-lookup"><span data-stu-id="7665e-171">Determining the server and database name when using a SQL Server 2005 Express Edition database in the `App_Data` folder, however, is a bit more involved.</span></span>

<span data-ttu-id="7665e-172">以下部分介绍采用简单的方式，用于指定中的 SQL Server 2005 Express Edition 数据库的服务器和数据库名称`App_Data`文件夹。</span><span class="sxs-lookup"><span data-stu-id="7665e-172">The following section examines a straightforward way for specifying the server and database name for a SQL Server 2005 Express Edition database in the `App_Data` folder.</span></span> <span data-ttu-id="7665e-173">如果你不使用 SQL Server 2005 Express Edition 随意直接跳至安装应用程序服务部分。</span><span class="sxs-lookup"><span data-stu-id="7665e-173">If you are not using SQL Server 2005 Express Edition feel free to skip ahead to the Installing the Application Services section.</span></span>

### <a name="determining-the-server-and-database-name-for-a-sql-server-2005-express-edition-database-in-theappdatafolder"></a><span data-ttu-id="7665e-174">确定服务器和数据库名称中的 SQL Server 2005 Express Edition 数据库`App_Data`文件夹</span><span class="sxs-lookup"><span data-stu-id="7665e-174">Determining the Server and Database Name for a SQL Server 2005 Express Edition Database in the`App_Data`Folder</span></span>

<span data-ttu-id="7665e-175">若要使用`aspnet_regsql.exe`我们需要了解的服务器和数据库名称的工具。</span><span class="sxs-lookup"><span data-stu-id="7665e-175">In order to use the `aspnet_regsql.exe` tool we need to know the server and database names.</span></span> <span data-ttu-id="7665e-176">服务器名称是`localhost\InstanceName`。</span><span class="sxs-lookup"><span data-stu-id="7665e-176">The server name is `localhost\InstanceName`.</span></span> <span data-ttu-id="7665e-177">最有可能， *InstanceName*是`SQLExpress`。</span><span class="sxs-lookup"><span data-stu-id="7665e-177">Most likely, the *InstanceName* is `SQLExpress`.</span></span> <span data-ttu-id="7665e-178">但是，如果你手动安装 SQL Server 2005 Express Edition （即，你不安装它自动安装 Visual Studio 时），则可能选择不同的实例名称。</span><span class="sxs-lookup"><span data-stu-id="7665e-178">However, if you installed SQL Server 2005 Express Edition manually (that is, you did not install it automatically while installing Visual Studio), then it is possible that you selected a different instance name.</span></span>

<span data-ttu-id="7665e-179">数据库名称是有点棘手，以确定。</span><span class="sxs-lookup"><span data-stu-id="7665e-179">The database name is a bit trickier to determine.</span></span> <span data-ttu-id="7665e-180">数据库在`App_Data`文件夹通常具有一个包括的数据库名称[全局唯一标识符](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)以及数据库文件的路径。</span><span class="sxs-lookup"><span data-stu-id="7665e-180">Databases in the `App_Data` folder typically have a database name that includes a [globally unique identifier](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) along with the path to the database file.</span></span> <span data-ttu-id="7665e-181">我们需要确定此数据库名称以添加应用程序服务架构通过`aspnet_regsql.exe`。</span><span class="sxs-lookup"><span data-stu-id="7665e-181">We need to determine this database name in order to add the application services schema through `aspnet_regsql.exe`.</span></span>

<span data-ttu-id="7665e-182">确定数据库名称的最简单方法是通过 SQL Server Management Studio 对其进行检查。</span><span class="sxs-lookup"><span data-stu-id="7665e-182">The easiest way to ascertain the database name is to examine it through SQL Server Management Studio.</span></span> <span data-ttu-id="7665e-183">SQL Server Management Studio 提供一个图形界面，用于管理 SQL Server 2005 数据库，但不随附 Express Edition 的 SQL Server 2005。</span><span class="sxs-lookup"><span data-stu-id="7665e-183">SQL Server Management Studio provides a graphical interface for managing SQL Server 2005 databases, but it does not ship with the Express Edition of SQL Server 2005.</span></span> <span data-ttu-id="7665e-184">好消息是[可以下载](https://www.microsoft.com/downloads/details.aspx?FamilyId=C243A5AE-4BD1-4E3D-94B8-5A0F62BF7796&amp;displaylang=en)免费 Express Edition 的 SQL Server Management Studio。</span><span class="sxs-lookup"><span data-stu-id="7665e-184">The good news is that [you can download](https://www.microsoft.com/downloads/details.aspx?FamilyId=C243A5AE-4BD1-4E3D-94B8-5A0F62BF7796&amp;displaylang=en) the free Express Edition of SQL Server Management Studio.</span></span>

> [!NOTE]
> <span data-ttu-id="7665e-185">如果你还可以安装在你的桌面上，则可能安装 Management Studio 的完整版本的 SQL Server 2005 的非-Express Edition 版本。</span><span class="sxs-lookup"><span data-stu-id="7665e-185">If you also have a non-Express Edition version of SQL Server 2005 installed on your desktop then the full version of Management Studio is likely installed.</span></span> <span data-ttu-id="7665e-186">完整版本可用于确定数据库名称，按如下所述的 Express 版本执行相同的步骤。</span><span class="sxs-lookup"><span data-stu-id="7665e-186">You can use the full version to determine the database name, following the same steps as outlined below for the Express Edition.</span></span>


<span data-ttu-id="7665e-187">通过关闭 Visual Studio 以确保任何锁施加的数据库文件上的 Visual Studio 开始，将关闭。</span><span class="sxs-lookup"><span data-stu-id="7665e-187">Start by closing Visual Studio to ensure that any locks imposed by Visual Studio on the database file are closed.</span></span> <span data-ttu-id="7665e-188">接下来，启动 SQL Server Management Studio 并连接到`localhost\InstanceName`SQL Server 2005 Express edition 数据库。</span><span class="sxs-lookup"><span data-stu-id="7665e-188">Next, launch SQL Server Management Studio and connect to the `localhost\InstanceName` database for SQL Server 2005 Express Edition.</span></span> <span data-ttu-id="7665e-189">如前文所述，则很有实例名称是`SQLExpress`。</span><span class="sxs-lookup"><span data-stu-id="7665e-189">As noted earlier, chances are the instance name is `SQLExpress`.</span></span> <span data-ttu-id="7665e-190">对于身份验证选项中，选择 Windows 身份验证。</span><span class="sxs-lookup"><span data-stu-id="7665e-190">For the Authentication option, select Windows Authentication.</span></span>


<span data-ttu-id="7665e-191">[![连接到 SQL Server 2005 Express Edition 实例](creating-the-membership-schema-in-sql-server-cs/_static/image8.png)](creating-the-membership-schema-in-sql-server-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="7665e-191">[![Connect to the SQL Server 2005 Express Edition Instance](creating-the-membership-schema-in-sql-server-cs/_static/image8.png)](creating-the-membership-schema-in-sql-server-cs/_static/image7.png)</span></span>

<span data-ttu-id="7665e-192">**图 3**： 连接到 SQL Server 2005 Express Edition 实例 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="7665e-192">**Figure 3**: Connect to the SQL Server 2005 Express Edition Instance ([Click to view full-size image](creating-the-membership-schema-in-sql-server-cs/_static/image9.png))</span></span>


<span data-ttu-id="7665e-193">连接到 SQL Server 2005 Express Edition 实例后，Management Studio 显示文件夹的数据库、 安全设置、 服务器对象和等等。</span><span class="sxs-lookup"><span data-stu-id="7665e-193">After connecting to the SQL Server 2005 Express Edition instance, Management Studio displays folders for the Databases, the Security settings, the Server Objects, and so on.</span></span> <span data-ttu-id="7665e-194">如果展开数据库选项卡你将看到`SecurityTutorials.mdf`数据库是*不*我们需要先附加该数据库中的数据库实例的注册。</span><span class="sxs-lookup"><span data-stu-id="7665e-194">If you expand the Databases tab you will see that the `SecurityTutorials.mdf` database is *not* registered in the database instance - we need to attach the database first.</span></span>

<span data-ttu-id="7665e-195">右键单击数据库文件夹，然后从上下文菜单中选择附加。</span><span class="sxs-lookup"><span data-stu-id="7665e-195">Right-click on the Databases folder and choose Attach from the context menu.</span></span> <span data-ttu-id="7665e-196">这将显示附加数据库对话框。</span><span class="sxs-lookup"><span data-stu-id="7665e-196">This will display the Attach Databases dialog box.</span></span> <span data-ttu-id="7665e-197">从这里，单击添加按钮，浏览到`SecurityTutorials.mdf`数据库，并单击确定。</span><span class="sxs-lookup"><span data-stu-id="7665e-197">From here, click the Add button, browse to the `SecurityTutorials.mdf` database, and click OK.</span></span> <span data-ttu-id="7665e-198">图 4 显示了附加数据库对话框后的`SecurityTutorials.mdf`选择数据库。</span><span class="sxs-lookup"><span data-stu-id="7665e-198">Figure 4 shows the Attach Databases dialog box after the `SecurityTutorials.mdf` database has been selected.</span></span> <span data-ttu-id="7665e-199">图 5 演示 Management Studio 对象资源管理器之后已成功附加该数据库。</span><span class="sxs-lookup"><span data-stu-id="7665e-199">Figure 5 shows Management Studio's Object Explorer after the database has been successfully attached.</span></span>


<span data-ttu-id="7665e-200">[![附加 SecurityTutorials.mdf 数据库](creating-the-membership-schema-in-sql-server-cs/_static/image11.png)](creating-the-membership-schema-in-sql-server-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="7665e-200">[![Attach the SecurityTutorials.mdf Database](creating-the-membership-schema-in-sql-server-cs/_static/image11.png)](creating-the-membership-schema-in-sql-server-cs/_static/image10.png)</span></span>

<span data-ttu-id="7665e-201">**图 4**： 附加`SecurityTutorials.mdf`数据库 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="7665e-201">**Figure 4**: Attach the `SecurityTutorials.mdf` Database ([Click to view full-size image](creating-the-membership-schema-in-sql-server-cs/_static/image12.png))</span></span>


<span data-ttu-id="7665e-202">[![SecurityTutorials.mdf 数据库显示在数据库文件夹](creating-the-membership-schema-in-sql-server-cs/_static/image14.png)](creating-the-membership-schema-in-sql-server-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="7665e-202">[![The SecurityTutorials.mdf Database Appears in the Databases Folder](creating-the-membership-schema-in-sql-server-cs/_static/image14.png)](creating-the-membership-schema-in-sql-server-cs/_static/image13.png)</span></span>

<span data-ttu-id="7665e-203">**图 5**:`SecurityTutorials.mdf`数据库将出现在数据库文件夹 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="7665e-203">**Figure 5**: The `SecurityTutorials.mdf` Database Appears in the Databases Folder ([Click to view full-size image](creating-the-membership-schema-in-sql-server-cs/_static/image15.png))</span></span>


<span data-ttu-id="7665e-204">如图 5 所示，`SecurityTutorials.mdf`数据库具有而是 abstruse 名称。</span><span class="sxs-lookup"><span data-stu-id="7665e-204">As Figure 5 shows, the `SecurityTutorials.mdf` database has a rather abstruse name.</span></span> <span data-ttu-id="7665e-205">让我们将其更改为更容易记忆 （和更方便地键入） 名称。</span><span class="sxs-lookup"><span data-stu-id="7665e-205">Let's change it to a more memorable (and easier to type) name.</span></span> <span data-ttu-id="7665e-206">右键单击数据库，从上下文菜单中，选择重命名，然后将其重命名`SecurityTutorialsDatabase`。</span><span class="sxs-lookup"><span data-stu-id="7665e-206">Right-click on the database, choose Rename from the context menu, and rename it `SecurityTutorialsDatabase`.</span></span> <span data-ttu-id="7665e-207">这不会更改文件名，只是数据库的名称用于向 SQL Server 标识自身。</span><span class="sxs-lookup"><span data-stu-id="7665e-207">This does not change the filename, just the name the database uses to identify itself to SQL Server.</span></span>


<span data-ttu-id="7665e-208">[![将数据库重命名为 SecurityTutorialsDatabase](creating-the-membership-schema-in-sql-server-cs/_static/image17.png)](creating-the-membership-schema-in-sql-server-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="7665e-208">[![Rename the Database to SecurityTutorialsDatabase](creating-the-membership-schema-in-sql-server-cs/_static/image17.png)](creating-the-membership-schema-in-sql-server-cs/_static/image16.png)</span></span>

<span data-ttu-id="7665e-209">**图 6**： 重命名为数据库`SecurityTutorialsDatabase`([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="7665e-209">**Figure 6**: Rename the Database to `SecurityTutorialsDatabase`([Click to view full-size image](creating-the-membership-schema-in-sql-server-cs/_static/image18.png))</span></span>


<span data-ttu-id="7665e-210">此时我们知道的服务器和数据库名称`SecurityTutorials.mdf`数据库文件：`localhost\InstanceName`和`SecurityTutorialsDatabase`分别。</span><span class="sxs-lookup"><span data-stu-id="7665e-210">At this point we know the server and database names for the `SecurityTutorials.mdf` database file: `localhost\InstanceName` and `SecurityTutorialsDatabase`, respectively.</span></span> <span data-ttu-id="7665e-211">我们现在已准备好安装应用程序服务通过`aspnet_regsql.exe`工具。</span><span class="sxs-lookup"><span data-stu-id="7665e-211">We are now ready to install the application services through the `aspnet_regsql.exe` tool.</span></span>

### <a name="installing-the-application-services"></a><span data-ttu-id="7665e-212">安装应用程序服务</span><span class="sxs-lookup"><span data-stu-id="7665e-212">Installing the Application Services</span></span>

<span data-ttu-id="7665e-213">若要启动`aspnet_regsql.exe`工具，请转到开始菜单，选择运行。</span><span class="sxs-lookup"><span data-stu-id="7665e-213">To launch the `aspnet_regsql.exe` tool, go to the start menu and choose Run.</span></span> <span data-ttu-id="7665e-214">输入`%WINDIR%\Microsoft.Net\Framework\v2.0.50727\aspnet_regsql.exe`在文本框中单击确定。</span><span class="sxs-lookup"><span data-stu-id="7665e-214">Enter `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\aspnet_regsql.exe` into the textbox and click OK.</span></span> <span data-ttu-id="7665e-215">或者，你可以使用 Windows 资源管理器中深化到相应文件夹然后通过双击`aspnet_regsql.exe`文件。</span><span class="sxs-lookup"><span data-stu-id="7665e-215">Alternatively, you can use Windows Explorer to drill down to the appropriate folder and double-click the `aspnet_regsql.exe` file.</span></span> <span data-ttu-id="7665e-216">这两种方法将 net 相同的结果。</span><span class="sxs-lookup"><span data-stu-id="7665e-216">Either approach will net the same results.</span></span>

<span data-ttu-id="7665e-217">运行`aspnet_regsql.exe`工具而无需任何命令行参数启动 ASP.NET SQL Server 安装向导的图形用户界面。</span><span class="sxs-lookup"><span data-stu-id="7665e-217">Running the `aspnet_regsql.exe` tool without any command line arguments launches the ASP.NET SQL Server Setup Wizard graphical user interface.</span></span> <span data-ttu-id="7665e-218">该向导可以轻松添加或删除指定的数据库上的 ASP.NET 应用程序服务。</span><span class="sxs-lookup"><span data-stu-id="7665e-218">The wizard makes it easy to add or remove the ASP.NET application services on a specified database.</span></span> <span data-ttu-id="7665e-219">图 7 所示在向导的第一个屏幕描述该工具的目的。</span><span class="sxs-lookup"><span data-stu-id="7665e-219">The first screen of the wizard, shown in Figure 7, describes the purpose of the tool.</span></span>


<span data-ttu-id="7665e-220">[![使用 ASP.NET SQL Server 安装程序向导使添加成员资格架构](creating-the-membership-schema-in-sql-server-cs/_static/image20.png)](creating-the-membership-schema-in-sql-server-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="7665e-220">[![Use the ASP.NET SQL Server Setup Wizard Makes to Add the Membership Schema](creating-the-membership-schema-in-sql-server-cs/_static/image20.png)](creating-the-membership-schema-in-sql-server-cs/_static/image19.png)</span></span>

<span data-ttu-id="7665e-221">**图 7**： 使用 ASP.NET SQL Server 安装程序向导使网添加成员资格架构 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="7665e-221">**Figure 7**: Use the ASP.NET SQL Server Setup Wizard Makes to Add the Membership Schema ([Click to view full-size image](creating-the-membership-schema-in-sql-server-cs/_static/image21.png))</span></span>


<span data-ttu-id="7665e-222">在向导中的第二步要求我们是否我们想要添加的应用程序服务或删除它们。</span><span class="sxs-lookup"><span data-stu-id="7665e-222">The second step in the wizard asks us whether we want to add the application services or remove them.</span></span> <span data-ttu-id="7665e-223">由于我们想要添加表、 视图和存储的过程所需`SqlMembershipProvider`，选择为应用程序服务选项的配置 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="7665e-223">Since we want to add the tables, views, and stored procedures necessary for the `SqlMembershipProvider`, choose the Configure SQL Server for application services option.</span></span> <span data-ttu-id="7665e-224">更高版本，如果你想要从数据库中删除此架构，重新运行此向导，但改为选择从现有的数据库选项的删除应用程序服务信息。</span><span class="sxs-lookup"><span data-stu-id="7665e-224">Later, if you want to remove this schema from your database, re-run this wizard, but instead choose the Remove application services information from an existing database option.</span></span>


<span data-ttu-id="7665e-225">[![选择配置 SQL Server 的应用程序服务选项](creating-the-membership-schema-in-sql-server-cs/_static/image23.png)](creating-the-membership-schema-in-sql-server-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="7665e-225">[![Choose the Configure SQL Server for Application Services Option](creating-the-membership-schema-in-sql-server-cs/_static/image23.png)](creating-the-membership-schema-in-sql-server-cs/_static/image22.png)</span></span>

<span data-ttu-id="7665e-226">**图 8**： 为应用程序服务选项中选择配置 SQL Server ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="7665e-226">**Figure 8**: Choose the Configure SQL Server for Application Services Option ([Click to view full-size image](creating-the-membership-schema-in-sql-server-cs/_static/image24.png))</span></span>


<span data-ttu-id="7665e-227">第三个步骤提示输入数据库信息： 服务器名称、 身份验证信息和数据库名称。</span><span class="sxs-lookup"><span data-stu-id="7665e-227">The third step prompts for the database information: the server name, authentication information, and the database name.</span></span> <span data-ttu-id="7665e-228">如果你按照本教程中，并添加了`SecurityTutorials.mdf`数据库到`App_Data`，附加到`localhost\InstanceName`，和重命名到`SecurityTutorialsDatabase`，然后使用以下值：</span><span class="sxs-lookup"><span data-stu-id="7665e-228">If you have been following along with this tutorial and have added the `SecurityTutorials.mdf` database to `App_Data`, attached it to `localhost\InstanceName`, and renamed it to `SecurityTutorialsDatabase`, then use the following values:</span></span>

- <span data-ttu-id="7665e-229">服务器：`localhost\InstanceName`</span><span class="sxs-lookup"><span data-stu-id="7665e-229">Server: `localhost\InstanceName`</span></span>
- <span data-ttu-id="7665e-230">Windows 身份验证</span><span class="sxs-lookup"><span data-stu-id="7665e-230">Windows authentication</span></span>
- <span data-ttu-id="7665e-231">数据库：`SecurityTutorialsDatabase`</span><span class="sxs-lookup"><span data-stu-id="7665e-231">Database: `SecurityTutorialsDatabase`</span></span>


<span data-ttu-id="7665e-232">[![输入数据库信息](creating-the-membership-schema-in-sql-server-cs/_static/image26.png)](creating-the-membership-schema-in-sql-server-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="7665e-232">[![Enter the Database Information](creating-the-membership-schema-in-sql-server-cs/_static/image26.png)](creating-the-membership-schema-in-sql-server-cs/_static/image25.png)</span></span>

<span data-ttu-id="7665e-233">**图 9**： 输入数据库信息 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="7665e-233">**Figure 9**: Enter the Database Information ([Click to view full-size image](creating-the-membership-schema-in-sql-server-cs/_static/image27.png))</span></span>


<span data-ttu-id="7665e-234">输入数据库信息后，单击下一步。</span><span class="sxs-lookup"><span data-stu-id="7665e-234">After entering the database information, click Next.</span></span> <span data-ttu-id="7665e-235">最后一步总结了将采取的步骤。</span><span class="sxs-lookup"><span data-stu-id="7665e-235">The final step summarizes the steps that will be taken.</span></span> <span data-ttu-id="7665e-236">单击下一步以安装应用程序服务并完成以完成向导。</span><span class="sxs-lookup"><span data-stu-id="7665e-236">Click Next to install the application services and then Finish to complete the wizard.</span></span>

> [!NOTE]
> <span data-ttu-id="7665e-237">如果你使用 Management Studio 将附加数据库以及如何重命名数据库文件，请务必分离数据库并重新打开 Visual Studio 之前关闭 Management Studio。</span><span class="sxs-lookup"><span data-stu-id="7665e-237">If you used Management Studio to attach the database and rename the database file, be sure to detach the database and close Management Studio before reopening Visual Studio.</span></span> <span data-ttu-id="7665e-238">若要分离`SecurityTutorialsDatabase`数据库，右键单击数据库名称，然后从任务菜单中选择分离。</span><span class="sxs-lookup"><span data-stu-id="7665e-238">To detach the `SecurityTutorialsDatabase` database, right-click on the database name and, from the Tasks menu, choose Detach.</span></span>


<span data-ttu-id="7665e-239">在向导完成，返回到 Visual Studio，并导航到数据库资源管理器。</span><span class="sxs-lookup"><span data-stu-id="7665e-239">Upon completion of the wizard, return to Visual Studio and navigate to the Database Explorer.</span></span> <span data-ttu-id="7665e-240">展开表文件夹。</span><span class="sxs-lookup"><span data-stu-id="7665e-240">Expand the Tables folder.</span></span> <span data-ttu-id="7665e-241">你应看到名称以前缀开头的表的一系列`aspnet_`。</span><span class="sxs-lookup"><span data-stu-id="7665e-241">You should see a series of tables whose names start with the prefix `aspnet_`.</span></span> <span data-ttu-id="7665e-242">同样，可以在视图和存储过程文件夹下找到的各种视图和存储的过程。</span><span class="sxs-lookup"><span data-stu-id="7665e-242">Likewise, a variety of views and stored procedures can be found under the Views and Stored Procedures folders.</span></span> <span data-ttu-id="7665e-243">这些数据库对象构成了应用程序服务架构。</span><span class="sxs-lookup"><span data-stu-id="7665e-243">These database objects make up the application services schema.</span></span> <span data-ttu-id="7665e-244">我们将检查在步骤 3 中的成员资格和角色特定数据库对象。</span><span class="sxs-lookup"><span data-stu-id="7665e-244">We will examine the membership- and role-specific database objects in Step 3.</span></span>


<span data-ttu-id="7665e-245">[![各种表、 视图和存储的过程已添加到数据库](creating-the-membership-schema-in-sql-server-cs/_static/image29.png)](creating-the-membership-schema-in-sql-server-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="7665e-245">[![A Variety of Tables, Views, and Stored Procedures Have Been Added to the Database](creating-the-membership-schema-in-sql-server-cs/_static/image29.png)](creating-the-membership-schema-in-sql-server-cs/_static/image28.png)</span></span>

<span data-ttu-id="7665e-246">**图 10**: 各种的表、 视图和存储过程已添加到数据库 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="7665e-246">**Figure 10**: A Variety of Tables, Views, and Stored Procedures Have Been Added to the Database ([Click to view full-size image](creating-the-membership-schema-in-sql-server-cs/_static/image30.png))</span></span>


> [!NOTE]
> <span data-ttu-id="7665e-247">`aspnet_regsql.exe`工具的图形用户界面安装整个应用程序服务架构。</span><span class="sxs-lookup"><span data-stu-id="7665e-247">The `aspnet_regsql.exe` tool's graphical user interface installs the entire application services schema.</span></span> <span data-ttu-id="7665e-248">但在执行时`aspnet_regsql.exe`可以从命令行指定哪些特定的应用程序服务组件，安装 （或移除）。</span><span class="sxs-lookup"><span data-stu-id="7665e-248">But when executing `aspnet_regsql.exe` from the command-line you can specify what particular application services components to install (or remove).</span></span> <span data-ttu-id="7665e-249">因此，如果你想要添加只需表，视图，以及存储过程所需`SqlMembershipProvider`和`SqlRoleProvider`提供程序，运行`aspnet_regsql.exe`从命令行。</span><span class="sxs-lookup"><span data-stu-id="7665e-249">Therefore, if you want to add just the tables, views, and stored procedures necessary for the `SqlMembershipProvider` and `SqlRoleProvider` providers, run `aspnet_regsql.exe` from the command-line.</span></span> <span data-ttu-id="7665e-250">或者，你可以手动运行相应的 T-SQL 子集创建使用脚本`aspnet_regsql.exe`。</span><span class="sxs-lookup"><span data-stu-id="7665e-250">Alternatively, you can manually run the appropriate subset of T-SQL create scripts used by `aspnet_regsql.exe`.</span></span> <span data-ttu-id="7665e-251">这些脚本位于`WINDIR%\Microsoft.Net\Framework\v2.0.50727\`具有类似名称文件夹`InstallCommon.sql`，`InstallMembership.sql`，`InstallRoles.sql`， `InstallProfile.sql`，`InstallSqlState.sql`，依次类推。</span><span class="sxs-lookup"><span data-stu-id="7665e-251">These scripts are located in the `WINDIR%\Microsoft.Net\Framework\v2.0.50727\` folder with names like `InstallCommon.sql`,`InstallMembership.sql`,`InstallRoles.sql`, `InstallProfile.sql`,`InstallSqlState.sql`, and so on.</span></span>


<span data-ttu-id="7665e-252">此时，我们已创建所需的数据库对象`SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="7665e-252">At this point we have created the database objects needed by the `SqlMembershipProvider`.</span></span> <span data-ttu-id="7665e-253">但是，我们仍需要指示它应使用成员资格 framework `SqlMembershipProvider` (而不是，说， `ActiveDirectoryMembershipProvider`) 并且`SqlMembershipProvider`应使用`SecurityTutorials`数据库。</span><span class="sxs-lookup"><span data-stu-id="7665e-253">However, we still need to instruct the Membership framework that it should use the `SqlMembershipProvider` (versus, say, the `ActiveDirectoryMembershipProvider`) and that the `SqlMembershipProvider` should use the `SecurityTutorials` database.</span></span> <span data-ttu-id="7665e-254">我们将了解如何指定要使用哪些提供程序以及如何自定义在步骤 4 中的所选提供程序的设置。</span><span class="sxs-lookup"><span data-stu-id="7665e-254">We'll look at how to specify what provider to use and how to customize the selected provider's settings in Step 4.</span></span> <span data-ttu-id="7665e-255">但首先让我们深入了解一下刚刚创建的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="7665e-255">But first, let's take a deeper look at the database objects that were just created.</span></span>

## <a name="step-3-a-look-at-the-schemas-core-tables"></a><span data-ttu-id="7665e-256">步骤 3： 查看架构的核心表</span><span class="sxs-lookup"><span data-stu-id="7665e-256">Step 3: A Look at the Schema's Core Tables</span></span>

<span data-ttu-id="7665e-257">在使用 ASP.NET 应用程序中的成员资格和角色框架，提供程序封装的实现详细信息。</span><span class="sxs-lookup"><span data-stu-id="7665e-257">When working with the Membership and Roles frameworks in an ASP.NET application, the implementation details are encapsulated by the provider.</span></span> <span data-ttu-id="7665e-258">在将来我们将与通过.NET Framework 的这些框架之间的接口的教程`Membership`和`Roles`类。</span><span class="sxs-lookup"><span data-stu-id="7665e-258">In future tutorials we will interface with these frameworks via the .NET Framework's `Membership` and `Roles` classes.</span></span> <span data-ttu-id="7665e-259">使用这些高级 Api 时我们不需要考虑自己的低级别的详细信息，如执行哪些查询的或哪些表进行修改`SqlMembershipProvider`和`SqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="7665e-259">When using these high-level APIs we do not need to concern ourselves with the low-level details, like what queries are executed or what tables are modified by the `SqlMembershipProvider` and `SqlRoleProvider`.</span></span>

<span data-ttu-id="7665e-260">鉴于此，我们可以放心地使用成员资格和角色框架而无需具有探讨在步骤 2 中创建的数据库架构。</span><span class="sxs-lookup"><span data-stu-id="7665e-260">Given this, we could confidently use the Membership and Roles frameworks without having explored the database schema created in Step 2.</span></span> <span data-ttu-id="7665e-261">但是，在创建表以存储应用程序数据时我们可能需要创建与用户或角色相关的实体。</span><span class="sxs-lookup"><span data-stu-id="7665e-261">However, when creating the tables to store application data we may need to create entities that relate to users or roles.</span></span> <span data-ttu-id="7665e-262">它有助于熟悉`SqlMembershipProvider`和`SqlRoleProvider`架构时建立外键约束的应用程序数据的表和在步骤 2 中创建这些表之间。</span><span class="sxs-lookup"><span data-stu-id="7665e-262">It helps to have a familiarity with the `SqlMembershipProvider` and `SqlRoleProvider` schemas when establishing foreign key constraints between the application data tables and those tables created in Step 2.</span></span> <span data-ttu-id="7665e-263">此外，在某些极少数情况下，我们可能需要与用户交互并直接在数据库级别的角色将存储 (而不是通过`Membership`或`Roles`类)。</span><span class="sxs-lookup"><span data-stu-id="7665e-263">Moreover, in certain rare circumstances we may need to interface with the user and role stores directly at the database level (instead of through the `Membership` or `Roles` classes).</span></span>

### <a name="partitioning-the-user-store-into-applications"></a><span data-ttu-id="7665e-264">分区到应用程序的用户存储区</span><span class="sxs-lookup"><span data-stu-id="7665e-264">Partitioning the User Store Into Applications</span></span>

<span data-ttu-id="7665e-265">成员资格和角色框架经过专门设计，这样，可以在许多不同的应用程序之间共享单个用户和角色存储。</span><span class="sxs-lookup"><span data-stu-id="7665e-265">The Membership and Roles frameworks are designed such that a single user and role store can be shared among many different applications.</span></span> <span data-ttu-id="7665e-266">ASP.NET 应用程序使用的成员身份或角色框架必须指定要使用哪些应用程序分区。</span><span class="sxs-lookup"><span data-stu-id="7665e-266">An ASP.NET application that uses the Membership or Roles frameworks must specify what application partition to use.</span></span> <span data-ttu-id="7665e-267">简单地说，多个 web 应用程序可以使用相同的用户和角色存储区。</span><span class="sxs-lookup"><span data-stu-id="7665e-267">In short, multiple web applications can use the same user and role stores.</span></span> <span data-ttu-id="7665e-268">图 11 描述了分区到三个应用程序的用户和角色存储： HRSite、 CustomerSite 和 SalesSite。</span><span class="sxs-lookup"><span data-stu-id="7665e-268">Figure 11 depicts user and role stores that are partitioned into three applications: HRSite, CustomerSite, and SalesSite.</span></span> <span data-ttu-id="7665e-269">这些三个 web 应用程序每个有其自己的唯一用户和角色，但它们都以物理方式将他们的用户帐户和角色信息存储在同一个数据库表。</span><span class="sxs-lookup"><span data-stu-id="7665e-269">These three web applications each have their own unique users and roles, yet they all physically store their user account and role information in the same database tables.</span></span>


<span data-ttu-id="7665e-270">[![用户帐户可能会被分解跨多个应用程序](creating-the-membership-schema-in-sql-server-cs/_static/image32.png)](creating-the-membership-schema-in-sql-server-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="7665e-270">[![User Accounts May Be Partitioned Across Multiple Applications](creating-the-membership-schema-in-sql-server-cs/_static/image32.png)](creating-the-membership-schema-in-sql-server-cs/_static/image31.png)</span></span>

<span data-ttu-id="7665e-271">**图 11**： 用户帐户可能是分区跨多个应用程序 ([单击以查看实际尺寸的图像](creating-the-membership-schema-in-sql-server-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="7665e-271">**Figure 11**: User Accounts May Be Partitioned Across Multiple Applications ([Click to view full-size image](creating-the-membership-schema-in-sql-server-cs/_static/image33.png))</span></span>


<span data-ttu-id="7665e-272">`aspnet_Applications`表是定义这些分区的内容。</span><span class="sxs-lookup"><span data-stu-id="7665e-272">The `aspnet_Applications` table is what defines these partitions.</span></span> <span data-ttu-id="7665e-273">此表中的行表示每个应用程序使用数据库来存储用户帐户信息。</span><span class="sxs-lookup"><span data-stu-id="7665e-273">Each application that uses the database to store user account information is represented by a row in this table.</span></span> <span data-ttu-id="7665e-274">`aspnet_Applications`表具有四个列： `ApplicationId`， `ApplicationName`， `LoweredApplicationName`，和`Description`。</span><span class="sxs-lookup"><span data-stu-id="7665e-274">The `aspnet_Applications` table has four columns: `ApplicationId`, `ApplicationName`, `LoweredApplicationName`, and `Description`.</span></span> <span data-ttu-id="7665e-275">`ApplicationId`类型[ `uniqueidentifier` ](https://msdn.microsoft.com/en-us/library/ms187942.aspx)和表的主键;`ApplicationName`提供每个应用程序的唯一用户友好名称。</span><span class="sxs-lookup"><span data-stu-id="7665e-275">`ApplicationId` is of type [`uniqueidentifier`](https://msdn.microsoft.com/en-us/library/ms187942.aspx) and is the table's primary key; `ApplicationName` provides a unique human-friendly name for each application.</span></span>

<span data-ttu-id="7665e-276">其他成员资格和角色相关的表将链接回`ApplicationId`字段`aspnet_Applications`。</span><span class="sxs-lookup"><span data-stu-id="7665e-276">The other Membership- and Role-related tables link back to the `ApplicationId` field in `aspnet_Applications`.</span></span> <span data-ttu-id="7665e-277">例如，`aspnet_Users`表，其中包含每个用户帐户的记录，具有`ApplicationId`外键字段; 有关 ditto`aspnet_Roles`表。</span><span class="sxs-lookup"><span data-stu-id="7665e-277">For example, the `aspnet_Users` table, which contains a record for each user account, has an `ApplicationId` foreign key field; ditto for the `aspnet_Roles` table.</span></span> <span data-ttu-id="7665e-278">`ApplicationId`这些表中的字段指定应用程序分区的用户帐户或所属角色。</span><span class="sxs-lookup"><span data-stu-id="7665e-278">The `ApplicationId` field in these tables specifies the application partition the user account or role belongs to.</span></span>

### <a name="storing-user-account-information"></a><span data-ttu-id="7665e-279">存储用户帐户信息</span><span class="sxs-lookup"><span data-stu-id="7665e-279">Storing User Account Information</span></span>

<span data-ttu-id="7665e-280">用户帐户信息存放在两个表：`aspnet_Users`和`aspnet_Membership`。</span><span class="sxs-lookup"><span data-stu-id="7665e-280">User account information is housed in two tables: `aspnet_Users` and `aspnet_Membership`.</span></span> <span data-ttu-id="7665e-281">`aspnet_Users`表中包含保存的基本的用户帐户信息的字段。</span><span class="sxs-lookup"><span data-stu-id="7665e-281">The `aspnet_Users` table contains fields that hold the essential user account information.</span></span> <span data-ttu-id="7665e-282">三个最相关列有：</span><span class="sxs-lookup"><span data-stu-id="7665e-282">The three most pertinent columns are:</span></span>

- `UserId`
- `UserName`
- `ApplicationId`

<span data-ttu-id="7665e-283">`UserId`是的主键 (和类型的`uniqueidentifier`)。</span><span class="sxs-lookup"><span data-stu-id="7665e-283">`UserId` is the primary key (and of type `uniqueidentifier`).</span></span> <span data-ttu-id="7665e-284">`UserName`类型`nvarchar(256)`以及的密码，使用户的凭据。</span><span class="sxs-lookup"><span data-stu-id="7665e-284">`UserName` is of type `nvarchar(256)` and, along with the password, makes up the user's credentials.</span></span> <span data-ttu-id="7665e-285">(用户的密码存储在`aspnet_Membership`表。)`ApplicationId`链接到特定的应用程序中的用户帐户`aspnet_Applications`。</span><span class="sxs-lookup"><span data-stu-id="7665e-285">(A user's password is stored in the `aspnet_Membership` table.) `ApplicationId` links the user account to a particular application in `aspnet_Applications`.</span></span> <span data-ttu-id="7665e-286">没有复合[`UNIQUE`约束](https://msdn.microsoft.com/en-us/library/ms191166.aspx)上`UserName`和`ApplicationId`列。</span><span class="sxs-lookup"><span data-stu-id="7665e-286">There is a composite [`UNIQUE` constraint](https://msdn.microsoft.com/en-us/library/ms191166.aspx) on the `UserName` and `ApplicationId` columns.</span></span> <span data-ttu-id="7665e-287">这可确保在给定的应用程序中每个用户名是唯一的但它允许对同一`UserName`要在不同的应用程序中使用。</span><span class="sxs-lookup"><span data-stu-id="7665e-287">This ensures that in a given application each UserName is unique, yet it allows for the same `UserName` to be used in different applications.</span></span>

<span data-ttu-id="7665e-288">`aspnet_Membership`表包括其他用户帐户信息，如用户的密码、 电子邮件地址、 最后一个登录名日期和时间，以及等。</span><span class="sxs-lookup"><span data-stu-id="7665e-288">The `aspnet_Membership` table includes additional user account information, like the user's password, email address, the last login date and time, and so forth.</span></span> <span data-ttu-id="7665e-289">中的记录之间不存在一对一的对应关系`aspnet_Users`和`aspnet_Membership`表。</span><span class="sxs-lookup"><span data-stu-id="7665e-289">There is a one-to-one correspondence between records in the `aspnet_Users` and `aspnet_Membership` tables.</span></span> <span data-ttu-id="7665e-290">通过将确保此关系`UserId`字段`aspnet_Membership`，它用作表的主键。</span><span class="sxs-lookup"><span data-stu-id="7665e-290">This relationship is ensured by the `UserId` field in `aspnet_Membership`, which serves as the table's primary key.</span></span> <span data-ttu-id="7665e-291">如`aspnet_Users`表，`aspnet_Membership`包括`ApplicationId`会绑定到特定应用程序分区此信息的字段。</span><span class="sxs-lookup"><span data-stu-id="7665e-291">Like the `aspnet_Users` table, `aspnet_Membership` includes an `ApplicationId` field that ties this information to a particular application partition.</span></span>

### <a name="securing-passwords"></a><span data-ttu-id="7665e-292">保护密码</span><span class="sxs-lookup"><span data-stu-id="7665e-292">Securing Passwords</span></span>

<span data-ttu-id="7665e-293">密码信息存储在`aspnet_Membership`表。</span><span class="sxs-lookup"><span data-stu-id="7665e-293">Password information is stored in the `aspnet_Membership` table.</span></span> <span data-ttu-id="7665e-294">`SqlMembershipProvider`允许密码存储在数据库中使用以下三个方法之一：</span><span class="sxs-lookup"><span data-stu-id="7665e-294">The `SqlMembershipProvider` allows for passwords to be stored in the database using one of the following three techniques:</span></span>

- <span data-ttu-id="7665e-295">**清除**-密码存储在数据库作为纯文本。</span><span class="sxs-lookup"><span data-stu-id="7665e-295">**Clear** - the password is stored in the database as plain-text.</span></span> <span data-ttu-id="7665e-296">我强烈建议您不要使用此选项。</span><span class="sxs-lookup"><span data-stu-id="7665e-296">I strongly discourage using this option.</span></span> <span data-ttu-id="7665e-297">如果数据库被泄露的可由黑客则找到后门或不满的员工具有数据库访问的每个单个用户的凭据有用于接管。</span><span class="sxs-lookup"><span data-stu-id="7665e-297">If the database is compromised - be it by a hacker who finds a back door or a disgruntled employee who has database access - every single user's credentials are there for the taking.</span></span>
- <span data-ttu-id="7665e-298">**哈希处理**-密码哈希使用单向哈希算法和随机生成的 salt 值。</span><span class="sxs-lookup"><span data-stu-id="7665e-298">**Hashed** - passwords are hashed using a one-way hash algorithm and a randomly generated salt value.</span></span> <span data-ttu-id="7665e-299">此哈希的值 （连同 salt) 存储在数据库中。</span><span class="sxs-lookup"><span data-stu-id="7665e-299">This hashed value (along with the salt) is stored in the database.</span></span>
- <span data-ttu-id="7665e-300">**加密**-在数据库中存储密码的加密的版本。</span><span class="sxs-lookup"><span data-stu-id="7665e-300">**Encrypted** - an encrypted version of the password is stored in the database.</span></span>

<span data-ttu-id="7665e-301">使用的密码存储方法取决于`SqlMembershipProvider`中指定设置`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="7665e-301">The password storage technique used depends on the `SqlMembershipProvider` settings specified in `Web.config`.</span></span> <span data-ttu-id="7665e-302">我们将着眼于自定义`SqlMembershipProvider`在步骤 4 中的设置。</span><span class="sxs-lookup"><span data-stu-id="7665e-302">We will look at customizing the `SqlMembershipProvider` settings in Step 4.</span></span> <span data-ttu-id="7665e-303">默认行为是存储密码哈希。</span><span class="sxs-lookup"><span data-stu-id="7665e-303">The default behavior is to store the hash of the password.</span></span>

<span data-ttu-id="7665e-304">负责存储密码的列是`Password`， `PasswordFormat`，和`PasswordSalt`。</span><span class="sxs-lookup"><span data-stu-id="7665e-304">The columns responsible for storing the password are `Password`, `PasswordFormat`, and `PasswordSalt`.</span></span> <span data-ttu-id="7665e-305">`PasswordFormat`是类型的字段`int`其值指示用于存储密码的技术： 0 清除; 1 表示 Hashed; 2 表示加密。</span><span class="sxs-lookup"><span data-stu-id="7665e-305">`PasswordFormat` is a field of type `int` whose value indicates the technique used for storing the password: 0 for Clear; 1 for Hashed; 2 for Encrypted.</span></span> <span data-ttu-id="7665e-306">`PasswordSalt`分配一个随机生成的字符串而不考虑使用; 的密码存储技术值`PasswordSalt`计算密码的哈希值时才使用。</span><span class="sxs-lookup"><span data-stu-id="7665e-306">`PasswordSalt` is assigned a randomly generated string regardless of the password storage technique used; the value of `PasswordSalt` is only used when computing the hash of the password.</span></span> <span data-ttu-id="7665e-307">最后，`Password`列包含的实际密码数据，可以是纯文本密码，密码或加密的密码的哈希。</span><span class="sxs-lookup"><span data-stu-id="7665e-307">Finally, the `Password` column contains the actual password data, be it the plain-text password, the hash of the password, or the encrypted password.</span></span>

<span data-ttu-id="7665e-308">表 1 说明什么这三列可能如下所示的各种存储技术存储的密码 MySecret 时 ！</span><span class="sxs-lookup"><span data-stu-id="7665e-308">Table 1 illustrates what these three columns might look like for the various storage techniques when storing the password MySecret!</span></span> <span data-ttu-id="7665e-309">.</span><span class="sxs-lookup"><span data-stu-id="7665e-309">.</span></span>

| <span data-ttu-id="7665e-310">**存储技术&lt;\_o3a\_p /&gt;**</span><span class="sxs-lookup"><span data-stu-id="7665e-310">**Storage Technique&lt;\_o3a\_p /&gt;**</span></span> | <span data-ttu-id="7665e-311">**密码&lt;\_o3a\_p /&gt;**</span><span class="sxs-lookup"><span data-stu-id="7665e-311">**Password&lt;\_o3a\_p /&gt;**</span></span> | <span data-ttu-id="7665e-312">**PasswordFormat&lt;\_o3a\_p /&gt;**</span><span class="sxs-lookup"><span data-stu-id="7665e-312">**PasswordFormat&lt;\_o3a\_p /&gt;**</span></span> | <span data-ttu-id="7665e-313">**PasswordSalt&lt;\_o3a\_p /&gt;**</span><span class="sxs-lookup"><span data-stu-id="7665e-313">**PasswordSalt&lt;\_o3a\_p /&gt;**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="7665e-314">清除</span><span class="sxs-lookup"><span data-stu-id="7665e-314">Clear</span></span> | <span data-ttu-id="7665e-315">MySecret ！</span><span class="sxs-lookup"><span data-stu-id="7665e-315">MySecret!</span></span> | <span data-ttu-id="7665e-316">0</span><span class="sxs-lookup"><span data-stu-id="7665e-316">0</span></span> | <span data-ttu-id="7665e-317">tTnkPlesqissc2y2SMEygA = =</span><span class="sxs-lookup"><span data-stu-id="7665e-317">tTnkPlesqissc2y2SMEygA==</span></span> |
| <span data-ttu-id="7665e-318">哈希处理</span><span class="sxs-lookup"><span data-stu-id="7665e-318">Hashed</span></span> | <span data-ttu-id="7665e-319">2oXm6sZHWbTHFgjgkGQsc2Ec9ZM =</span><span class="sxs-lookup"><span data-stu-id="7665e-319">2oXm6sZHWbTHFgjgkGQsc2Ec9ZM=</span></span> | <span data-ttu-id="7665e-320">1</span><span class="sxs-lookup"><span data-stu-id="7665e-320">1</span></span> | <span data-ttu-id="7665e-321">wFgjUfhdUFOCKQiI61vtiQ = =</span><span class="sxs-lookup"><span data-stu-id="7665e-321">wFgjUfhdUFOCKQiI61vtiQ==</span></span> |
| <span data-ttu-id="7665e-322">加密</span><span class="sxs-lookup"><span data-stu-id="7665e-322">Encrypted</span></span> | <span data-ttu-id="7665e-323">62RZgDvhxykkqsMchZ0Yly7HS6onhpaoCYaRxV8g0F4CW56OXUU3e7Inza9j9BKp</span><span class="sxs-lookup"><span data-stu-id="7665e-323">62RZgDvhxykkqsMchZ0Yly7HS6onhpaoCYaRxV8g0F4CW56OXUU3e7Inza9j9BKp</span></span> | <span data-ttu-id="7665e-324">2</span><span class="sxs-lookup"><span data-stu-id="7665e-324">2</span></span> | <span data-ttu-id="7665e-325">LSRzhGS/aa/oqAXGLHJNBw = =</span><span class="sxs-lookup"><span data-stu-id="7665e-325">LSRzhGS/aa/oqAXGLHJNBw==</span></span> |

<span data-ttu-id="7665e-326">**表 1**： 密码相关字段存储密码 MySecret 时的示例值 ！</span><span class="sxs-lookup"><span data-stu-id="7665e-326">**Table 1**: Example Values for the Password-Related Fields When Storing the Password MySecret!</span></span>

> [!NOTE]
> <span data-ttu-id="7665e-327">特定的加密或使用的哈希算法`SqlMembershipProvider`由中设置`<machineKey>`元素。</span><span class="sxs-lookup"><span data-stu-id="7665e-327">The particular encryption or hashing algorithm used by the `SqlMembershipProvider` is determined by the settings in the `<machineKey>` element.</span></span> <span data-ttu-id="7665e-328">我们讨论了此配置元素的步骤 3 中<a id="Tutorial3"> </a> [*窗体身份验证配置和高级主题*](../introduction/forms-authentication-configuration-and-advanced-topics-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="7665e-328">We discussed this configuration element in Step 3 of the <a id="Tutorial3"></a>[*Forms Authentication Configuration and Advanced Topics*](../introduction/forms-authentication-configuration-and-advanced-topics-cs.md) tutorial.</span></span>


### <a name="storing-roles-and-role-associations"></a><span data-ttu-id="7665e-329">存储的角色和角色关联</span><span class="sxs-lookup"><span data-stu-id="7665e-329">Storing Roles and Role Associations</span></span>

<span data-ttu-id="7665e-330">该角色框架允许开发人员定义的角色集和指定哪些用户属于哪些角色。</span><span class="sxs-lookup"><span data-stu-id="7665e-330">The Roles framework allows developers to define a set of roles and specify what users belong to what roles.</span></span> <span data-ttu-id="7665e-331">在数据库中通过两个表中捕获此信息：`aspnet_Roles`和`aspnet_UsersInRoles`。</span><span class="sxs-lookup"><span data-stu-id="7665e-331">This information is captured in the database through two tables: `aspnet_Roles` and `aspnet_UsersInRoles`.</span></span> <span data-ttu-id="7665e-332">在每个记录`aspnet_Roles`表表示为特定的应用程序的角色。</span><span class="sxs-lookup"><span data-stu-id="7665e-332">Each record in the `aspnet_Roles` table represents a role for a particular application.</span></span> <span data-ttu-id="7665e-333">非常类似`aspnet_Users`表，`aspnet_Roles`表具有与我们讨论相关的三个列：</span><span class="sxs-lookup"><span data-stu-id="7665e-333">Much like the `aspnet_Users` table, the `aspnet_Roles` table has three columns pertinent to our discussion:</span></span>

- `RoleId`
- `RoleName`
- `ApplicationId`

<span data-ttu-id="7665e-334">`RoleId`是的主键 (和类型的`uniqueidentifier`)。</span><span class="sxs-lookup"><span data-stu-id="7665e-334">`RoleId` is the primary key (and of type `uniqueidentifier`).</span></span> <span data-ttu-id="7665e-335">`RoleName` 的类型为 `nvarchar(256)`。</span><span class="sxs-lookup"><span data-stu-id="7665e-335">`RoleName` is of type `nvarchar(256)`.</span></span> <span data-ttu-id="7665e-336">和`ApplicationId`链接到特定的应用程序中的用户帐户`aspnet_Applications`。</span><span class="sxs-lookup"><span data-stu-id="7665e-336">And `ApplicationId` links the user account to a particular application in `aspnet_Applications`.</span></span> <span data-ttu-id="7665e-337">没有复合`UNIQUE`约束`RoleName`和`ApplicationId`列，确保在给定的应用程序中每个角色名称是否唯一。</span><span class="sxs-lookup"><span data-stu-id="7665e-337">There is a composite `UNIQUE` constraint on the `RoleName` and `ApplicationId` columns, ensuring that in a given application each role name is unique.</span></span>

<span data-ttu-id="7665e-338">`aspnet_UsersInRoles`表用作用户和角色之间的映射。</span><span class="sxs-lookup"><span data-stu-id="7665e-338">The `aspnet_UsersInRoles` table serves as a mapping between users and roles.</span></span> <span data-ttu-id="7665e-339">只有两个列-`UserId`和`RoleId`-和一起构成复合主键。</span><span class="sxs-lookup"><span data-stu-id="7665e-339">There are only two columns - `UserId` and `RoleId` - and together they make up a composite primary key.</span></span>

## <a name="step-4-specifying-the-provider-and-customizing-its-settings"></a><span data-ttu-id="7665e-340">步骤 4： 指定提供程序和自定义其设置</span><span class="sxs-lookup"><span data-stu-id="7665e-340">Step 4: Specifying the Provider and Customizing Its Settings</span></span>

<span data-ttu-id="7665e-341">所有支持提供程序模型-如的成员资格和角色的框架的框架缺少本身的实现详细信息，并改用该责任委派给提供程序类。</span><span class="sxs-lookup"><span data-stu-id="7665e-341">All of the frameworks that support the provider model - such as the Membership and Roles frameworks - lack implementation details themselves and instead delegate that responsibility to a provider class.</span></span> <span data-ttu-id="7665e-342">成员资格 framework 中，对于`Membership`类定义了 API，用于管理用户帐户，但不直接与任何用户存储区不进行交互。</span><span class="sxs-lookup"><span data-stu-id="7665e-342">In the case of the Membership framework, the `Membership` class defines the API for managing user accounts, but it does not interact directly with any user store.</span></span> <span data-ttu-id="7665e-343">相反，`Membership`类的方法移交到配置提供程序的请求，我们将使用`SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="7665e-343">Rather, the `Membership` class's methods hand off the request to the configured provider - we will be using the `SqlMembershipProvider`.</span></span> <span data-ttu-id="7665e-344">当我们调用中的方法之一`Membership`类，如何的成员资格框架知道委派对的调用`SqlMembershipProvider`？</span><span class="sxs-lookup"><span data-stu-id="7665e-344">When we invoke one of the methods in the `Membership` class, how does the Membership framework know to delegate the call to the `SqlMembershipProvider`?</span></span>

<span data-ttu-id="7665e-345">`Membership`类具有[`Providers`属性](https://msdn.microsoft.com/en-us/library/system.web.security.membership.providers.aspx)成员资格 framework 包含对所有可供使用的已注册的提供程序类的引用。</span><span class="sxs-lookup"><span data-stu-id="7665e-345">The `Membership` class has a [`Providers` property](https://msdn.microsoft.com/en-us/library/system.web.security.membership.providers.aspx) that contains a reference to all of the registered provider classes available for use by the Membership framework.</span></span> <span data-ttu-id="7665e-346">每个已注册的提供程序具有关联的名称和类型。</span><span class="sxs-lookup"><span data-stu-id="7665e-346">Each registered provider has an associated name and type.</span></span> <span data-ttu-id="7665e-347">名称提供用户友好的方式来引用中的特定提供程序`Providers`集合，而类型标识提供程序类。</span><span class="sxs-lookup"><span data-stu-id="7665e-347">The name offers a human-friendly way to reference a particular provider in the `Providers` collection, while the type identifies the provider class.</span></span> <span data-ttu-id="7665e-348">此外，每个已注册的提供程序可能包括配置设置。</span><span class="sxs-lookup"><span data-stu-id="7665e-348">Moreover, each registered provider may include configuration settings.</span></span> <span data-ttu-id="7665e-349">成员资格框架的配置设置包括`passwordFormat`和`requiresUniqueEmail`，此外还有许多其他。</span><span class="sxs-lookup"><span data-stu-id="7665e-349">Configuration settings for the Membership framework include `passwordFormat` and `requiresUniqueEmail`, among many others.</span></span> <span data-ttu-id="7665e-350">有关使用配置设置的完整列表请参阅表 2 `SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="7665e-350">See Table 2 for a complete list of configuration settings used by the `SqlMembershipProvider`.</span></span>

<span data-ttu-id="7665e-351">`Providers` Web 应用程序的配置设置可以通过指定服务属性的内容。</span><span class="sxs-lookup"><span data-stu-id="7665e-351">The `Providers` property's contents are specified through the web application's configuration settings.</span></span> <span data-ttu-id="7665e-352">默认情况下，所有 web 应用程序都具有名为提供程序`AspNetSqlMembershipProvider`类型的`SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="7665e-352">By default, all web applications have a provider named `AspNetSqlMembershipProvider` of type `SqlMembershipProvider`.</span></span> <span data-ttu-id="7665e-353">此默认成员资格提供程序注册中`machine.config`(位于`%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG)`:</span><span class="sxs-lookup"><span data-stu-id="7665e-353">This default Membership provider is registered in `machine.config` (located at `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG)`:</span></span>

[!code-xml[Main](creating-the-membership-schema-in-sql-server-cs/samples/sample1.xml)]

<span data-ttu-id="7665e-354">为上面所示，标记[`<membership>`元素](https://msdn.microsoft.com/en-us/library/1b9hw62f.aspx)定义成员资格框架时的配置设置[`<providers>`子元素](https://msdn.microsoft.com/en-us/library/6d4936ht.aspx)指定的已注册提供程序。</span><span class="sxs-lookup"><span data-stu-id="7665e-354">As the markup above shows, the [`<membership>` element](https://msdn.microsoft.com/en-us/library/1b9hw62f.aspx) defines the configuration settings for the Membership framework while the [`<providers>` child element](https://msdn.microsoft.com/en-us/library/6d4936ht.aspx) specifies the registered providers.</span></span> <span data-ttu-id="7665e-355">提供程序可能添加或删除使用[ `<add>` ](https://msdn.microsoft.com/en-us/library/whae3t94.aspx)或[ `<remove>` ](https://msdn.microsoft.com/en-us/library/aykw9a6d.aspx)元素; 请改用[ `<clear>` ](https://msdn.microsoft.com/en-us/library/t062y6yc.aspx)要删除所有当前元素注册的提供程序。</span><span class="sxs-lookup"><span data-stu-id="7665e-355">Providers may be added or removed using the [`<add>`](https://msdn.microsoft.com/en-us/library/whae3t94.aspx) or [`<remove>`](https://msdn.microsoft.com/en-us/library/aykw9a6d.aspx) elements; use the [`<clear>`](https://msdn.microsoft.com/en-us/library/t062y6yc.aspx) element to remove all currently registered providers.</span></span> <span data-ttu-id="7665e-356">为上面所示，标记`machine.config`添加提供程序名为`AspNetSqlMembershipProvider`类型的`SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="7665e-356">As the markup above shows, `machine.config` adds a provider named `AspNetSqlMembershipProvider` of type `SqlMembershipProvider`.</span></span>

<span data-ttu-id="7665e-357">除了`name`和`type`特性，`<add>`元素包含定义各种配置设置的值的属性。</span><span class="sxs-lookup"><span data-stu-id="7665e-357">In addition to the `name` and `type` attributes, the `<add>` element contains attributes that define the values for various configuring settings.</span></span> <span data-ttu-id="7665e-358">表 2 列出了可用`SqlMembershipProvider`-特定的配置设置，以及每个说明。</span><span class="sxs-lookup"><span data-stu-id="7665e-358">Table 2 lists the available `SqlMembershipProvider`-specific configuration settings, along with a description of each.</span></span>

> [!NOTE]
> <span data-ttu-id="7665e-359">在表 2 中记下任何默认值是指中定义的默认值`SqlMembershipProvider`类。</span><span class="sxs-lookup"><span data-stu-id="7665e-359">Any default values noted in Table 2 refer to the default values defined in the `SqlMembershipProvider` class.</span></span> <span data-ttu-id="7665e-360">请注意该 not 中的配置设置的所有`AspNetSqlMembershipProvider`对应的默认值`SqlMembershipProvider`类。</span><span class="sxs-lookup"><span data-stu-id="7665e-360">Note that not all of the configuration settings in `AspNetSqlMembershipProvider` correspond to the default values of the `SqlMembershipProvider` class.</span></span> <span data-ttu-id="7665e-361">例如，如果未指定成员资格提供程序中,`requiresUniqueEmail`将默认值设置为 true。</span><span class="sxs-lookup"><span data-stu-id="7665e-361">For example, if not specified in a Membership provider, the `requiresUniqueEmail` setting defaults to true.</span></span> <span data-ttu-id="7665e-362">但是，`AspNetSqlMembershipProvider`通过显式指定的值来重写此默认值`false`。</span><span class="sxs-lookup"><span data-stu-id="7665e-362">However, the `AspNetSqlMembershipProvider` overrides this default value by explicitly specifying a value of `false`.</span></span>


| <span data-ttu-id="7665e-363">**设置&lt;\_o3a\_p /&gt;**</span><span class="sxs-lookup"><span data-stu-id="7665e-363">**Setting&lt;\_o3a\_p /&gt;**</span></span> | <span data-ttu-id="7665e-364">**说明&lt;\_o3a\_p /&gt;**</span><span class="sxs-lookup"><span data-stu-id="7665e-364">**Description&lt;\_o3a\_p /&gt;**</span></span> |
| --- | --- |
| `ApplicationName` | <span data-ttu-id="7665e-365">回想一下，该成员身份框架允许在单个用户存储分区跨多个应用程序。</span><span class="sxs-lookup"><span data-stu-id="7665e-365">Recall that the Membership framework allows for a single user store to be partitioned across multiple applications.</span></span> <span data-ttu-id="7665e-366">此设置指示所使用的成员资格提供程序的应用程序分区的名称。</span><span class="sxs-lookup"><span data-stu-id="7665e-366">This setting indicates the name of the application partition used by the Membership provider.</span></span> <span data-ttu-id="7665e-367">如果此值不显式指定时，其设置为，在运行时，应用程序的虚拟根路径的值。</span><span class="sxs-lookup"><span data-stu-id="7665e-367">If this value is not explicitly specified, it is set, at runtime, to the value of the application's virtual root path.</span></span> |
| `commandTimeout` | <span data-ttu-id="7665e-368">指定的 SQL 命令超时值 （以秒为单位）。</span><span class="sxs-lookup"><span data-stu-id="7665e-368">Specifies the SQL command timeout value (in seconds).</span></span> <span data-ttu-id="7665e-369">默认值为 30。</span><span class="sxs-lookup"><span data-stu-id="7665e-369">The default value is 30.</span></span> |
| `connectionStringName` | <span data-ttu-id="7665e-370">中的连接字符串的名称`<connectionStrings>`元素要用于连接到用户存储区数据库。</span><span class="sxs-lookup"><span data-stu-id="7665e-370">The name of the connection string in the `<connectionStrings>` element to use to connect to the user store database.</span></span> <span data-ttu-id="7665e-371">此值是必需的。</span><span class="sxs-lookup"><span data-stu-id="7665e-371">This value is required.</span></span> |
| `description` | <span data-ttu-id="7665e-372">提供已注册的提供程序的用户友好说明。</span><span class="sxs-lookup"><span data-stu-id="7665e-372">Provides a human-friendly description of the registered provider.</span></span> |
| `enablePasswordRetrieval` | <span data-ttu-id="7665e-373">指定用户是否可能检索其忘记了的密码。</span><span class="sxs-lookup"><span data-stu-id="7665e-373">Specifies whether users may retrieve their forgotten password.</span></span> <span data-ttu-id="7665e-374">默认值为 `false`。</span><span class="sxs-lookup"><span data-stu-id="7665e-374">The default value is `false`.</span></span> |
| `enablePasswordReset` | <span data-ttu-id="7665e-375">指示是否允许用户重置其密码。</span><span class="sxs-lookup"><span data-stu-id="7665e-375">Indicates whether users are allowed to reset their password.</span></span> <span data-ttu-id="7665e-376">默认为 `true`。</span><span class="sxs-lookup"><span data-stu-id="7665e-376">Defaults to `true`.</span></span> |
| `maxInvalidPasswordAttempts` | <span data-ttu-id="7665e-377">在指定过程中为给定的用户可能发生的失败登录尝试次数上限`passwordAttemptWindow`用户锁定之前。默认值为 5。</span><span class="sxs-lookup"><span data-stu-id="7665e-377">The maximum number of unsuccessful login attempts that may occur for a given user during the specified `passwordAttemptWindow` before the user is locked out. The default value is 5.</span></span> |
| `minRequiredNonalphanumericCharacters` | <span data-ttu-id="7665e-378">最小必须出现在用户的密码的非字母数字字符数。</span><span class="sxs-lookup"><span data-stu-id="7665e-378">The minimum number of non-alphanumeric characters that must appear in a user's password.</span></span> <span data-ttu-id="7665e-379">此值必须介于 0 和 128; 之间默认值为 1。</span><span class="sxs-lookup"><span data-stu-id="7665e-379">This value must be between 0 and 128; the default is 1.</span></span> |
| `minRequiredPasswordLength` | <span data-ttu-id="7665e-380">最小密码中所需的字符数。</span><span class="sxs-lookup"><span data-stu-id="7665e-380">The minimum number of characters required in a password.</span></span> <span data-ttu-id="7665e-381">此值必须介于 0 和 128; 之间默认值为 7。</span><span class="sxs-lookup"><span data-stu-id="7665e-381">This value must be between 0 and 128; the default is 7.</span></span> |
| `name` | <span data-ttu-id="7665e-382">已注册的提供程序的名称。</span><span class="sxs-lookup"><span data-stu-id="7665e-382">The name of the registered provider.</span></span> <span data-ttu-id="7665e-383">此值是必需的。</span><span class="sxs-lookup"><span data-stu-id="7665e-383">This value is required.</span></span> |
| `passwordAttemptWindow` | <span data-ttu-id="7665e-384">在此期间的分钟数失败的登录尝试进行跟踪。</span><span class="sxs-lookup"><span data-stu-id="7665e-384">The number of minutes during which failed login attempts are tracked.</span></span> <span data-ttu-id="7665e-385">如果一个用户提供登录凭据无效`maxInvalidPasswordAttempts`时间在此指定窗口，它们被锁定。默认值为 10。</span><span class="sxs-lookup"><span data-stu-id="7665e-385">If a user supplies invalid login credentials `maxInvalidPasswordAttempts` times within this specified window, they are locked out. The default value is 10.</span></span> |
| `PasswordFormat` | <span data-ttu-id="7665e-386">密码存储格式： `Clear`， `Hashed`，或`Encrypted`。</span><span class="sxs-lookup"><span data-stu-id="7665e-386">The password storage format: `Clear`, `Hashed`, or `Encrypted`.</span></span> <span data-ttu-id="7665e-387">默认值为 `Hashed`。</span><span class="sxs-lookup"><span data-stu-id="7665e-387">The default is `Hashed`.</span></span> |
| `passwordStrengthRegularExpression` | <span data-ttu-id="7665e-388">如果提供，此正则表达式用于评估的强度的所选用户的密码创建新帐户时，或更改其密码时。</span><span class="sxs-lookup"><span data-stu-id="7665e-388">If provided, this regular expression is used to evaluate the strength of the user's selected password when creating a new account or when changing their password.</span></span> <span data-ttu-id="7665e-389">默认值为一个空字符串。</span><span class="sxs-lookup"><span data-stu-id="7665e-389">The default value is an empty string.</span></span> |
| `requiresQuestionAndAnswer` | <span data-ttu-id="7665e-390">指定用户是否必须回答其安全问题时检索或重置其密码。</span><span class="sxs-lookup"><span data-stu-id="7665e-390">Specifies whether a user must answer his security question when retrieving or resetting his password.</span></span> <span data-ttu-id="7665e-391">默认值为 `true`。</span><span class="sxs-lookup"><span data-stu-id="7665e-391">The default value is `true`.</span></span> |
| `requiresUniqueEmail` | <span data-ttu-id="7665e-392">指示是否在给定应用程序分区中的所有用户帐户必须都具有唯一的电子邮件地址。</span><span class="sxs-lookup"><span data-stu-id="7665e-392">Indicates whether all user accounts in a given application partition must have a unique email address.</span></span> <span data-ttu-id="7665e-393">默认值为 `true`。</span><span class="sxs-lookup"><span data-stu-id="7665e-393">The default value is `true`.</span></span> |
| `type` | <span data-ttu-id="7665e-394">指定提供程序的类型。</span><span class="sxs-lookup"><span data-stu-id="7665e-394">Specifies the type of the provider.</span></span> <span data-ttu-id="7665e-395">此值是必需的。</span><span class="sxs-lookup"><span data-stu-id="7665e-395">This value is required.</span></span> |

<span data-ttu-id="7665e-396">**表 2**： 成员身份和`SqlMembershipProvider`配置设置</span><span class="sxs-lookup"><span data-stu-id="7665e-396">**Table 2**: Membership and `SqlMembershipProvider` Configuration Settings</span></span>

<span data-ttu-id="7665e-397">除了`AspNetSqlMembershipProvider`，其他成员资格提供程序可能通过类似将标记添加到注册应用程序的应用程序根据`Web.config`文件。</span><span class="sxs-lookup"><span data-stu-id="7665e-397">In addition to `AspNetSqlMembershipProvider`, other Membership providers may be registered on an application-by-application basis by adding similar markup to the `Web.config` file.</span></span>

> [!NOTE]
> <span data-ttu-id="7665e-398">角色 framework 工作方式在很大程度相同： 没有中的默认值已注册的角色提供程序`machine.config`和注册的提供程序可以自定义应用程序的应用程序形式交付`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="7665e-398">The Roles framework works in much the same way: there is a default registered role provider in `machine.config` and the registered providers may be customized on an application-by-application basis in `Web.config`.</span></span> <span data-ttu-id="7665e-399">在将来的教程中，我们将检查角色 framework 和详细信息中的其配置标记。</span><span class="sxs-lookup"><span data-stu-id="7665e-399">We will examine the Roles framework and its configuration markup in detail in a future tutorial.</span></span>


### <a name="customizing-thesqlmembershipprovidersettings"></a><span data-ttu-id="7665e-400">自定义`SqlMembershipProvider`设置</span><span class="sxs-lookup"><span data-stu-id="7665e-400">Customizing the`SqlMembershipProvider`Settings</span></span>

<span data-ttu-id="7665e-401">默认值`SqlMembershipProvider`(`AspNetSqlMembershipProvider`) 具有其`connectionStringName`属性设置为`LocalSqlServer`。</span><span class="sxs-lookup"><span data-stu-id="7665e-401">The default `SqlMembershipProvider` (`AspNetSqlMembershipProvider`) has its `connectionStringName` attribute set to `LocalSqlServer`.</span></span> <span data-ttu-id="7665e-402">如`AspNetSqlMembershipProvider`提供程序，该连接字符串名称`LocalSqlServer`中定义`machine.config`。</span><span class="sxs-lookup"><span data-stu-id="7665e-402">Like the `AspNetSqlMembershipProvider` provider, the connection string name `LocalSqlServer` is defined in `machine.config`.</span></span>

[!code-xml[Main](creating-the-membership-schema-in-sql-server-cs/samples/sample2.xml)]

<span data-ttu-id="7665e-403">如你所见，此连接字符串定义数据库位于 SQL 2005 速成版 |DataDirectory|aspnetdb.mdf。</span><span class="sxs-lookup"><span data-stu-id="7665e-403">As you can see, this connection string defines a SQL 2005 Express Edition database located at |DataDirectory|aspnetdb.mdf�.</span></span> <span data-ttu-id="7665e-404">字符串 |DataDirectory | 转换在运行时以指向`~/App_Data/`目录中，因此数据库路径 |DataDirectory|aspnetdb.mdf"转换为`~/App_Data` / `aspnet.mdf`。</span><span class="sxs-lookup"><span data-stu-id="7665e-404">The string |DataDirectory|� is translated at runtime to point to the `~/App_Data/` directory, so the database path |DataDirectory|aspnetdb.mdf" translates to `~/App_Data`/`aspnet.mdf`.</span></span>

<span data-ttu-id="7665e-405">如果我们未指定任何成员资格提供程序信息中我们的应用程序`Web.config`文件，应用程序使用注册的默认成员资格提供程序， `AspNetSqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="7665e-405">If we did not specify any Membership provider information in our application's `Web.config` file, the application uses the default registered Membership provider, `AspNetSqlMembershipProvider`.</span></span> <span data-ttu-id="7665e-406">如果`~/App_Data/aspnet.mdf`数据库不存在，ASP.NET 运行时将自动创建它并添加应用程序服务架构。</span><span class="sxs-lookup"><span data-stu-id="7665e-406">If the `~/App_Data/aspnet.mdf` database does not exist, the ASP.NET runtime will automatically create it and add the application services schema.</span></span> <span data-ttu-id="7665e-407">但是，我们不想使用`aspnet.mdf`数据库; 相反，我们想要使用`SecurityTutorials.mdf`我们在步骤 2 中创建的数据库。</span><span class="sxs-lookup"><span data-stu-id="7665e-407">However, we don't want to use the `aspnet.mdf` database; rather, we want to use the `SecurityTutorials.mdf` database we created in Step 2.</span></span> <span data-ttu-id="7665e-408">此修改，可以处于两种方式之一实现：</span><span class="sxs-lookup"><span data-stu-id="7665e-408">This modification can be accomplished in one of two ways:</span></span>

- <span data-ttu-id="7665e-409">**指定的值 * * *`LocalSqlServer`* * * 中的连接字符串名称 * * *`Web.config`* * *。**</span><span class="sxs-lookup"><span data-stu-id="7665e-409">**Specify a value for the****`LocalSqlServer`****connection string name in****`Web.config`****.**</span></span> <span data-ttu-id="7665e-410">通过覆盖`LocalSqlServer`连接字符串名称值中的`Web.config`，我们可以使用注册的默认成员资格提供程序 (`AspNetSqlMembershipProvider`)，并将其正确使用`SecurityTutorials.mdf`数据库。</span><span class="sxs-lookup"><span data-stu-id="7665e-410">By overwriting the `LocalSqlServer` connection string name value in `Web.config`, we can use the default registered Membership provider (`AspNetSqlMembershipProvider`) and have it correctly work with the `SecurityTutorials.mdf` database.</span></span> <span data-ttu-id="7665e-411">这种方法是如果你是内容替换指定的配置设置正常`AspNetSqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="7665e-411">This approach is fine if you are content with the configuration settings specified by `AspNetSqlMembershipProvider`.</span></span> <span data-ttu-id="7665e-412">有关此技术的详细信息，请参阅[Scott Guthrie](https://weblogs.asp.net/scottgu/)的博客文章[配置 ASP.NET 2.0 应用程序服务添加到使用 SQL Server 2000 或 SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7665e-412">For more information on this technique, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog post, [Configuring ASP.NET 2.0 Application Services to Use SQL Server 2000 or SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span></span>
- <span data-ttu-id="7665e-413">**添加新的已注册提供程序的类型 * * *`SqlMembershipProvider`* * * 并配置其 * * *`connectionStringName`* * * 设置为指向 * * *`SecurityTutorials.mdf`* * * 数据库。**</span><span class="sxs-lookup"><span data-stu-id="7665e-413">**Add a new registered provider of type****`SqlMembershipProvider`****and configure its****`connectionStringName`****setting to point to the****`SecurityTutorials.mdf`****database.**</span></span> <span data-ttu-id="7665e-414">这种方法是你想要自定义的数据库连接字符串除了其他配置属性的方案中十分有用。</span><span class="sxs-lookup"><span data-stu-id="7665e-414">This approach is useful in scenarios where you want to customize other configuration properties in addition to the database connection string.</span></span> <span data-ttu-id="7665e-415">在我自己的项目我始终使用这种方法由于其灵活性和可读性。</span><span class="sxs-lookup"><span data-stu-id="7665e-415">In my own projects I always use this approach because of its flexibility and readability.</span></span>

<span data-ttu-id="7665e-416">我们可以添加新的已注册的提供程序引用之前`SecurityTutorials.mdf`数据库，我们首先需要添加适当的连接字符串值中`<connectionStrings>`主题中`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="7665e-416">Before we can add a new registered provider that references the `SecurityTutorials.mdf` database, we first need to add an appropriate connection string value in the `<connectionStrings>` section in `Web.config`.</span></span> <span data-ttu-id="7665e-417">以下标记将添加名为新的连接字符串`SecurityTutorialsConnectionString`引用 SQL Server 2005 Express Edition`SecurityTutorials.mdf`数据库中`App_Data`文件夹。</span><span class="sxs-lookup"><span data-stu-id="7665e-417">The following markup adds a new connection string named `SecurityTutorialsConnectionString` that references the SQL Server 2005 Express Edition `SecurityTutorials.mdf` database in the `App_Data` folder.</span></span>

[!code-xml[Main](creating-the-membership-schema-in-sql-server-cs/samples/sample3.xml)]

> [!NOTE]
> <span data-ttu-id="7665e-418">如果你使用的另一个数据库文件，请根据需要更新连接字符串。</span><span class="sxs-lookup"><span data-stu-id="7665e-418">If you are using an alternate database file, update the connection string as needed.</span></span> <span data-ttu-id="7665e-419">有关构成正确的连接字符串的详细信息，请参阅[ConnectionStrings.com](http://www.connectionstrings.com/)。</span><span class="sxs-lookup"><span data-stu-id="7665e-419">For more information on forming the correct connection string, refer to [ConnectionStrings.com](http://www.connectionstrings.com/).</span></span>

<span data-ttu-id="7665e-420">接下来，添加到以下的成员身份配置标记`Web.config`文件。</span><span class="sxs-lookup"><span data-stu-id="7665e-420">Next, add the following Membership configuration markup to the `Web.config` file.</span></span> <span data-ttu-id="7665e-421">此标记注册新的提供程序名为`SecurityTutorialsSqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="7665e-421">This markup registers a new provider named `SecurityTutorialsSqlMembershipProvider`.</span></span>

[!code-xml[Main](creating-the-membership-schema-in-sql-server-cs/samples/sample4.xml)]

<span data-ttu-id="7665e-422">除了注册`SecurityTutorialsSqlMembershipProvider`提供程序，上面的标记定义`SecurityTutorialsSqlMembershipProvider`作为默认提供程序 (通过`defaultProvider`属性中`<membership>`元素)。</span><span class="sxs-lookup"><span data-stu-id="7665e-422">In addition to registering the `SecurityTutorialsSqlMembershipProvider` provider, the above markup defines the `SecurityTutorialsSqlMembershipProvider` as the default provider (via the `defaultProvider` attribute in the `<membership>` element).</span></span> <span data-ttu-id="7665e-423">回想一下，成员身份 framework 可以有多个已注册的提供程序。</span><span class="sxs-lookup"><span data-stu-id="7665e-423">Recall that the Membership framework can have multiple registered providers.</span></span> <span data-ttu-id="7665e-424">由于`AspNetSqlMembershipProvider`注册中的第一个提供程序为`machine.config`，除非我们指示，否则用作默认的提供程序。</span><span class="sxs-lookup"><span data-stu-id="7665e-424">Since `AspNetSqlMembershipProvider` is registered as the first provider in `machine.config`, it serves as the default provider unless we indicate otherwise.</span></span>

<span data-ttu-id="7665e-425">目前，我们的应用程序具有两个已注册的提供程序：`AspNetSqlMembershipProvider`和`SecurityTutorialsSqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="7665e-425">Currently, our application has two registered providers: `AspNetSqlMembershipProvider` and `SecurityTutorialsSqlMembershipProvider`.</span></span> <span data-ttu-id="7665e-426">但是，在注册之前`SecurityTutorialsSqlMembershipProvider`通过添加我们无法清除了所有以前的提供程序已注册的提供程序[`<clear />`元素](https://msdn.microsoft.com/en-us/library/t062y6yc.aspx)立即之前我们`<add>`元素。</span><span class="sxs-lookup"><span data-stu-id="7665e-426">However, before registering the `SecurityTutorialsSqlMembershipProvider` provider we could have cleared out all previously registered providers by adding a [`<clear />` element](https://msdn.microsoft.com/en-us/library/t062y6yc.aspx) immediately before our `<add>` element.</span></span> <span data-ttu-id="7665e-427">这将清除`AspNetSqlMembershipProvider`从注册的提供程序列表中，这意味着`SecurityTutorialsSqlMembershipProvider`是唯一的已注册成员资格提供程序。</span><span class="sxs-lookup"><span data-stu-id="7665e-427">This would clear out the `AspNetSqlMembershipProvider` from the list of registered providers, meaning that the `SecurityTutorialsSqlMembershipProvider` would be the only registered Membership provider.</span></span> <span data-ttu-id="7665e-428">如果我们使用此方法中，那么我们不需要将标记`SecurityTutorialsSqlMembershipProvider`为默认的提供程序，因为它将是唯一的已注册成员资格提供程序。</span><span class="sxs-lookup"><span data-stu-id="7665e-428">If we used this approach, then we would not need to mark the `SecurityTutorialsSqlMembershipProvider` as the default provider, since it would be the only registered Membership provider.</span></span> <span data-ttu-id="7665e-429">有关详细信息使用`<clear />`，请参阅[使用`<clear />`时添加的提供程序](https://weblogs.asp.net/scottgu/archive/2006/11/20/common-gotcha-don-t-forget-to-clear-when-adding-providers.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7665e-429">For more information on using `<clear />`, see [Using `<clear />` When Adding Providers](https://weblogs.asp.net/scottgu/archive/2006/11/20/common-gotcha-don-t-forget-to-clear-when-adding-providers.aspx).</span></span>

<span data-ttu-id="7665e-430">请注意，`SecurityTutorialsSqlMembershipProvider`的`connectionStringName`设置引用刚才-添加`SecurityTutorialsConnectionString`连接字符串名称，并且其`applicationName`设置已被设置为 SecurityTutorials 的值。</span><span class="sxs-lookup"><span data-stu-id="7665e-430">Note that the `SecurityTutorialsSqlMembershipProvider`'s `connectionStringName` setting references the just-added `SecurityTutorialsConnectionString` connection string name, and that its `applicationName` setting has been set to a value of SecurityTutorials.</span></span> <span data-ttu-id="7665e-431">此外，`requiresUniqueEmail`设置已设置为`true`。</span><span class="sxs-lookup"><span data-stu-id="7665e-431">Additionally, the `requiresUniqueEmail` setting has been set to `true`.</span></span> <span data-ttu-id="7665e-432">所有其他配置选项中的值相等`AspNetSqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="7665e-432">All other configuration options are identical to the values in `AspNetSqlMembershipProvider`.</span></span> <span data-ttu-id="7665e-433">如果您愿意，则请尝试进行任何配置修改在这里。</span><span class="sxs-lookup"><span data-stu-id="7665e-433">Feel free to make any configuration modifications here, if you wish.</span></span> <span data-ttu-id="7665e-434">例如，你无法通过要求提供两个非字母数字字符，而不是一个，或通过增加为而不是七个八个字符的密码长度增强密码强度。</span><span class="sxs-lookup"><span data-stu-id="7665e-434">For example, you could tighten the password strength by requiring two non-alphanumeric characters instead of one, or by increasing the password length to eight characters instead of seven.</span></span>

> [!NOTE]
> <span data-ttu-id="7665e-435">回想一下，该成员身份框架允许在单个用户存储分区跨多个应用程序。</span><span class="sxs-lookup"><span data-stu-id="7665e-435">Recall that the Membership framework allows for a single user store to be partitioned across multiple applications.</span></span> <span data-ttu-id="7665e-436">成员资格提供程序的`applicationName`设置指示提供程序时如何使用用户存储区使用哪些应用程序。</span><span class="sxs-lookup"><span data-stu-id="7665e-436">The Membership provider's `applicationName` setting indicates what application the provider uses when working with the user store.</span></span> <span data-ttu-id="7665e-437">你显式设置的值很重要`applicationName`配置设置，因为如果`applicationName`未显式设置，它将分配给在运行时的 web 应用程序的虚拟根路径。</span><span class="sxs-lookup"><span data-stu-id="7665e-437">It is important that you explicitly set a value for the `applicationName` configuration setting because if the `applicationName` is not explicitly set, it is assigned to the web application's virtual root path at runtime.</span></span> <span data-ttu-id="7665e-438">这很好地配合，只要不会更改应用程序的虚拟根路径，但是，如果将移到不同的路径，该应用程序`applicationName`也将更改设置。</span><span class="sxs-lookup"><span data-stu-id="7665e-438">This works fine as long as the application's virtual root path doesn't change, but if you move the application to a different path, the `applicationName` setting will change too.</span></span> <span data-ttu-id="7665e-439">在此情况下，成员资格提供程序将开始使用不同的应用程序分区，不是以前使用过。</span><span class="sxs-lookup"><span data-stu-id="7665e-439">When this happens, the Membership provider will start working with a different application partition than was previously used.</span></span> <span data-ttu-id="7665e-440">在移动之前创建的用户帐户将位于不同的应用程序分区，并且这些用户将不再能够登录到网站。</span><span class="sxs-lookup"><span data-stu-id="7665e-440">User accounts created prior to the move will reside in a different application partition and those users will no longer be able to log into the site.</span></span> <span data-ttu-id="7665e-441">有关此问题的更深入讨论，请参阅[始终设置`applicationName`属性时配置 ASP.NET 2.0 成员资格和其他提供程序](https://weblogs.asp.net/scottgu/443634)。</span><span class="sxs-lookup"><span data-stu-id="7665e-441">For a more in-depth discussion on this matter, see [Always Set the `applicationName` Property When Configuring ASP.NET 2.0 Membership and Other Providers](https://weblogs.asp.net/scottgu/443634).</span></span>


## <a name="summary"></a><span data-ttu-id="7665e-442">摘要</span><span class="sxs-lookup"><span data-stu-id="7665e-442">Summary</span></span>

<span data-ttu-id="7665e-443">此时我们具有配置的应用程序服务的数据库 (`SecurityTutorials.mdf`) 并且已配置 web 应用程序，以便成员资格框架使用`SecurityTutorialsSqlMembershipProvider`我们刚刚注册的提供程序。</span><span class="sxs-lookup"><span data-stu-id="7665e-443">At this point we have a database with the configured application services (`SecurityTutorials.mdf`) and have configured our web application so that the Membership framework uses the `SecurityTutorialsSqlMembershipProvider` provider we just registered.</span></span> <span data-ttu-id="7665e-444">此注册的提供程序类型的`SqlMembershipProvider`并具有其`connectionStringName`设置为适当的连接字符串 (`SecurityTutorialsConnectionString`) 并将其`applicationName`显式设置的值。</span><span class="sxs-lookup"><span data-stu-id="7665e-444">This registered provider is of type `SqlMembershipProvider` and has its `connectionStringName` set to the appropriate connection string (`SecurityTutorialsConnectionString`) and its `applicationName` value explicitly set.</span></span>

<span data-ttu-id="7665e-445">现在我们就可以使用我们的应用程序中的成员资格框架。</span><span class="sxs-lookup"><span data-stu-id="7665e-445">We are now ready to use the Membership framework from our application.</span></span> <span data-ttu-id="7665e-446">在下一教程中我们将学习如何创建新用户帐户。</span><span class="sxs-lookup"><span data-stu-id="7665e-446">In the next tutorial we will examine how to create new user accounts.</span></span> <span data-ttu-id="7665e-447">以下，我们将探讨用户，执行基于用户的授权，并将与用户相关的其他信息存储在数据库中进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="7665e-447">Following that we will explore authenticating users, performing user-based authorization, and storing additional user-related information in the database.</span></span>

<span data-ttu-id="7665e-448">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="7665e-448">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="7665e-449">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="7665e-449">Further Reading</span></span>

<span data-ttu-id="7665e-450">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="7665e-450">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="7665e-451">始终设置`applicationName`属性配置 ASP.NET 2.0 时成员身份和其他提供商</span><span class="sxs-lookup"><span data-stu-id="7665e-451">Always Set the `applicationName` Property When Configuring ASP.NET 2.0 Membership and Other Providers</span></span>](https://weblogs.asp.net/scottgu/443634)
- [<span data-ttu-id="7665e-452">ASP.NET 2.0 应用程序服务配置为使用 SQL Server 2000 或 SQL Server 2005</span><span class="sxs-lookup"><span data-stu-id="7665e-452">Configuring ASP.NET 2.0 Application Services to Use SQL Server 2000 or SQL Server 2005</span></span>](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx)
- [<span data-ttu-id="7665e-453">下载 SQL Server Management Studio Express Edition</span><span class="sxs-lookup"><span data-stu-id="7665e-453">Download SQL Server Management Studio Express Edition</span></span>](https://www.microsoft.com/downloads/details.aspx?FamilyId=C243A5AE-4BD1-4E3D-94B8-5A0F62BF7796&amp;displaylang=en)
- [<span data-ttu-id="7665e-454">检查 ASP.NET 2.0 s 成员资格、 角色和配置文件</span><span class="sxs-lookup"><span data-stu-id="7665e-454">Examining ASP.NET 2.0�s Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="7665e-455">`<add>`成员资格提供程序的元素</span><span class="sxs-lookup"><span data-stu-id="7665e-455">The `<add>` Element for Providers for Membership</span></span>](https://msdn.microsoft.com/en-us/library/whae3t94.aspx)
- [<span data-ttu-id="7665e-456">`<membership>`元素</span><span class="sxs-lookup"><span data-stu-id="7665e-456">The `<membership>` Element</span></span>](https://msdn.microsoft.com/en-us/library/1b9hw62f.aspx)
- [<span data-ttu-id="7665e-457">`<providers>`元素的成员身份</span><span class="sxs-lookup"><span data-stu-id="7665e-457">The `<providers>` Element for Membership</span></span>](https://msdn.microsoft.com/en-us/library/6d4936ht.aspx)
- [<span data-ttu-id="7665e-458">使用`<clear />`时添加提供程序</span><span class="sxs-lookup"><span data-stu-id="7665e-458">Using `<clear />` When Adding Providers</span></span>](https://weblogs.asp.net/scottgu/archive/2006/11/20/common-gotcha-don-t-forget-to-clear-when-adding-providers.aspx)
- [<span data-ttu-id="7665e-459">直接使用`SqlMembershipProvider`</span><span class="sxs-lookup"><span data-stu-id="7665e-459">Working Directly with the `SqlMembershipProvider`</span></span>](http://aspnet.4guysfromrolla.com/articles/091207-1.aspx)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="7665e-460">在本教程中包含的主题的视频培训</span><span class="sxs-lookup"><span data-stu-id="7665e-460">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="7665e-461">了解 ASP.NET 成员身份</span><span class="sxs-lookup"><span data-stu-id="7665e-461">Understanding ASP.NET Memberships</span></span>](../../../videos/authentication/understanding-aspnet-memberships.md)
- [<span data-ttu-id="7665e-462">使用成员资格架构配置到工作的 SQL</span><span class="sxs-lookup"><span data-stu-id="7665e-462">Configuring SQL To Work with Membership Schemas</span></span>](../../../videos/authentication/configuring-sql-to-work-with-membership-schemas.md)
- [<span data-ttu-id="7665e-463">更改默认成员身份架构中的成员身份设置</span><span class="sxs-lookup"><span data-stu-id="7665e-463">Changing Membership Settings in the Default Membership Schema</span></span>](../../../videos/authentication/changing-membership-settings-in-the-default-membership-schema.md)

### <a name="about-the-author"></a><span data-ttu-id="7665e-464">关于作者</span><span class="sxs-lookup"><span data-stu-id="7665e-464">About the Author</span></span>

<span data-ttu-id="7665e-465">Scott Mitchell，多个 ASP/ASP.NET 丛书的作者和创始人 4GuysFromRolla.com，具有已使用自 1998 年 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="7665e-465">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="7665e-466">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="7665e-466">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="7665e-467">最新书籍是 *[Sam 教授自己 ASP.NET 2.0 24 小时内](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*。</span><span class="sxs-lookup"><span data-stu-id="7665e-467">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="7665e-468">可以在达到 Scott [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)或通过在其博客地址[http://ScottOnWriting.NET](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="7665e-468">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="7665e-469">特别感谢</span><span class="sxs-lookup"><span data-stu-id="7665e-469">Special Thanks To</span></span>

<span data-ttu-id="7665e-470">本教程系列已由许多有用的审阅者评审。</span><span class="sxs-lookup"><span data-stu-id="7665e-470">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="7665e-471">本教程中的前导审阅者已 Alicja Maziarz。</span><span class="sxs-lookup"><span data-stu-id="7665e-471">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="7665e-472">对感兴趣查看我即将到来的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="7665e-472">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="7665e-473">如果是这样，删除我一行[ mitchell@4GuysFromRolla.com ](mailto:mitchell@4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="7665e-473">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

>[!div class="step-by-step"]
[<span data-ttu-id="7665e-474">下一篇</span><span class="sxs-lookup"><span data-stu-id="7665e-474">Next</span></span>](creating-user-accounts-cs.md)
