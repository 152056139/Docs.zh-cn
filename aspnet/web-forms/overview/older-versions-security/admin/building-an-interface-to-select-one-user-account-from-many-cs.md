---
uid: web-forms/overview/older-versions-security/admin/building-an-interface-to-select-one-user-account-from-many-cs
title: 生成一个接口，以便从很多的 (C#) 中选择一个用户帐户 |Microsoft 文档
author: rick-anderson
description: 在本教程中我们将生成与分页，可筛选网格的用户界面。 具体而言，我们的用户界面将包含的一系列的 LinkButtons...
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/01/2008
ms.topic: article
ms.assetid: 9e4e687c-b4ec-434f-a4ef-edb0b8f365e4
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/admin/building-an-interface-to-select-one-user-account-from-many-cs
msc.type: authoredcontent
ms.openlocfilehash: 304505b18e330425ea1dc8df87a552f3d8cd15f3
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/06/2018
ms.locfileid: "30890666"
---
<a name="building-an-interface-to-select-one-user-account-from-many-c"></a><span data-ttu-id="50794-104">生成一个接口，以便从很多的 (C#) 中选择一个用户帐户</span><span class="sxs-lookup"><span data-stu-id="50794-104">Building an Interface to Select One User Account from Many (C#)</span></span>
====================
<span data-ttu-id="50794-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="50794-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="50794-106">[下载代码](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.12.zip)或[下载 PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial12_SelectUser_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="50794-106">[Download Code](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.12.zip) or [Download PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial12_SelectUser_cs.pdf)</span></span>

> <span data-ttu-id="50794-107">在本教程中我们将生成与分页，可筛选网格的用户界面。</span><span class="sxs-lookup"><span data-stu-id="50794-107">In this tutorial we will build a user interface with a paged, filterable grid.</span></span> <span data-ttu-id="50794-108">具体而言，我们的用户界面将包含的一系列 LinkButtons 筛选基于的用户名，以及用来显示匹配的用户的 GridView 控件的起始字母结果。</span><span class="sxs-lookup"><span data-stu-id="50794-108">In particular, our user interface will consist of a series of LinkButtons for filtering the results based on the starting letter of the username, and a GridView control to show the matching users.</span></span> <span data-ttu-id="50794-109">我们将开始通过列出所有 GridView 中的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="50794-109">We'll start by listing all of the user accounts in a GridView.</span></span> <span data-ttu-id="50794-110">然后，在步骤 3 中，我们将添加筛选器 LinkButtons。</span><span class="sxs-lookup"><span data-stu-id="50794-110">Then, in Step 3, we will add the filter LinkButtons.</span></span> <span data-ttu-id="50794-111">步骤 4 来看待分页筛选的结果。</span><span class="sxs-lookup"><span data-stu-id="50794-111">Step 4 looks at paging the filtered results.</span></span> <span data-ttu-id="50794-112">在步骤 2 中构造至 4 的接口将在后续教程，用于执行针对特定用户帐户管理任务。</span><span class="sxs-lookup"><span data-stu-id="50794-112">The interface constructed in Steps 2 through 4 will be used in the subsequent tutorials to perform administrative tasks for a particular user account.</span></span>


## <a name="introduction"></a><span data-ttu-id="50794-113">介绍</span><span class="sxs-lookup"><span data-stu-id="50794-113">Introduction</span></span>

<span data-ttu-id="50794-114">在<a id="_msoanchor_1"> </a> [*向用户分配角色*](../roles/assigning-roles-to-users-cs.md)教程中，我们创建的管理员可以选择用户和管理其角色的基本接口。</span><span class="sxs-lookup"><span data-stu-id="50794-114">In the <a id="_msoanchor_1"></a>[*Assigning Roles to Users*](../roles/assigning-roles-to-users-cs.md) tutorial, we created a rudimentary interface for an administrator to select a user and manage her roles.</span></span> <span data-ttu-id="50794-115">具体而言，该接口向管理员显示的所有用户的下拉列表。</span><span class="sxs-lookup"><span data-stu-id="50794-115">Specifically, the interface presented the administrator with a drop-down list of all of the users.</span></span> <span data-ttu-id="50794-116">此类接口适合，当存在但十几用户帐户，但臃肿针对包含数百或数千个帐户的网站。</span><span class="sxs-lookup"><span data-stu-id="50794-116">Such an interface is suitable when there are but a dozen or so user accounts, but is unwieldy for sites with hundreds or thousands of accounts.</span></span> <span data-ttu-id="50794-117">分页，可筛选网格是具有大型用户基的网站的更适合用户界面。</span><span class="sxs-lookup"><span data-stu-id="50794-117">A paged, filterable grid is more suitable user interface for websites with large user bases.</span></span>

<span data-ttu-id="50794-118">在本教程中我们将生成此类用户界面。</span><span class="sxs-lookup"><span data-stu-id="50794-118">In this tutorial we will build such a user interface.</span></span> <span data-ttu-id="50794-119">具体而言，我们的用户界面将包含的一系列 LinkButtons 筛选基于的用户名，以及用来显示匹配的用户的 GridView 控件的起始字母结果。</span><span class="sxs-lookup"><span data-stu-id="50794-119">In particular, our user interface will consist of a series of LinkButtons for filtering the results based on the starting letter of the username, and a GridView control to show the matching users.</span></span> <span data-ttu-id="50794-120">我们将开始通过列出所有 GridView 中的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="50794-120">We'll start by listing all of the user accounts in a GridView.</span></span> <span data-ttu-id="50794-121">然后，在步骤 3 中，我们将添加筛选器 LinkButtons。</span><span class="sxs-lookup"><span data-stu-id="50794-121">Then, in Step 3, we will add the filter LinkButtons.</span></span> <span data-ttu-id="50794-122">步骤 4 来看待分页筛选的结果。</span><span class="sxs-lookup"><span data-stu-id="50794-122">Step 4 looks at paging the filtered results.</span></span> <span data-ttu-id="50794-123">在步骤 2 中构造至 4 的接口将在后续教程，用于执行针对特定用户帐户管理任务。</span><span class="sxs-lookup"><span data-stu-id="50794-123">The interface constructed in Steps 2 through 4 will be used in the subsequent tutorials to perform administrative tasks for a particular user account.</span></span>

<span data-ttu-id="50794-124">让我们进入正题！</span><span class="sxs-lookup"><span data-stu-id="50794-124">Let's get started!</span></span>

## <a name="step-1-adding-new-aspnet-pages"></a><span data-ttu-id="50794-125">步骤 1： 添加新的 ASP.NET 页</span><span class="sxs-lookup"><span data-stu-id="50794-125">Step 1: Adding New ASP.NET Pages</span></span>

<span data-ttu-id="50794-126">我们将在本教程和后面的两个检查各种与管理相关的函数和功能。</span><span class="sxs-lookup"><span data-stu-id="50794-126">In this tutorial and the next two we will be examining various administration-related functions and capabilities.</span></span> <span data-ttu-id="50794-127">我们将需要一系列的 ASP.NET 网页来实现检查整个这些教程的主题。</span><span class="sxs-lookup"><span data-stu-id="50794-127">We will need a series of ASP.NET pages to implement the topics examined throughout these tutorials.</span></span> <span data-ttu-id="50794-128">让我们创建这些页面和更新站点映射。</span><span class="sxs-lookup"><span data-stu-id="50794-128">Let's create these pages and update the site map.</span></span>

<span data-ttu-id="50794-129">首先创建一个新文件夹中名为的项目`Administration`。</span><span class="sxs-lookup"><span data-stu-id="50794-129">Start by creating a new folder in the project named `Administration`.</span></span> <span data-ttu-id="50794-130">接下来，将两个新的 ASP.NET 页添加到文件夹，链接与每个页面`Site.master`母版页。</span><span class="sxs-lookup"><span data-stu-id="50794-130">Next, add two new ASP.NET pages to the folder, linking each page with the `Site.master` master page.</span></span> <span data-ttu-id="50794-131">命名页：</span><span class="sxs-lookup"><span data-stu-id="50794-131">Name the pages:</span></span>

- `ManageUsers.aspx`
- `UserInformation.aspx`

<span data-ttu-id="50794-132">此外将两个页添加到网站的根目录：`ChangePassword.aspx`和`RecoverPassword.aspx`。</span><span class="sxs-lookup"><span data-stu-id="50794-132">Also add two pages to the website's root directory: `ChangePassword.aspx` and `RecoverPassword.aspx`.</span></span>

<span data-ttu-id="50794-133">这些四个页面，在这种情况下，应有两个内容控件，每个母版页的 ContentPlaceHolders:`MainContent`和`LoginContent`。</span><span class="sxs-lookup"><span data-stu-id="50794-133">These four pages should, at this point, have two Content controls, one for each of the master page's ContentPlaceHolders: `MainContent` and `LoginContent`.</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample1.aspx)]

<span data-ttu-id="50794-134">我们希望能够显示主控页的默认标记`LoginContent`ContentPlaceHolder 为这些页面。</span><span class="sxs-lookup"><span data-stu-id="50794-134">We want to show the master page's default markup for the `LoginContent` ContentPlaceHolder for these pages.</span></span> <span data-ttu-id="50794-135">因此，删除的声明性标记`Content2`内容控件。</span><span class="sxs-lookup"><span data-stu-id="50794-135">Therefore, remove the declarative markup for the `Content2` Content control.</span></span> <span data-ttu-id="50794-136">这么做，页的标记应包含几个内容控件。</span><span class="sxs-lookup"><span data-stu-id="50794-136">After doing so, the pages' markup should contain just one Content control.</span></span>

<span data-ttu-id="50794-137">ASP.NET 页`Administration`文件夹旨在仅供管理用户。</span><span class="sxs-lookup"><span data-stu-id="50794-137">The ASP.NET pages in the `Administration` folder are intended solely for administrative users.</span></span> <span data-ttu-id="50794-138">我们将管理员角色添加到中的系统<a id="_msoanchor_2"> </a> [*创建和管理角色*](../roles/creating-and-managing-roles-cs.md)教程; 限制对这些两个页面到此角色的访问。</span><span class="sxs-lookup"><span data-stu-id="50794-138">We added an Administrators role to the system in the <a id="_msoanchor_2"></a>[*Creating and Managing Roles*](../roles/creating-and-managing-roles-cs.md) tutorial; restrict access to these two pages to this role.</span></span> <span data-ttu-id="50794-139">若要完成此操作，将添加`Web.config`文件为`Administration`文件夹和配置其`<authorization>`元素来承认管理员角色中的用户，并拒绝所有其他人。</span><span class="sxs-lookup"><span data-stu-id="50794-139">To accomplish this, add a `Web.config` file to the `Administration` folder and configure its `<authorization>` element to admit users in the Administrators role and to deny all others.</span></span>

[!code-xml[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample2.xml)]

<span data-ttu-id="50794-140">此时你的项目的解决方案资源管理器应类似于的屏幕快照中图 1 所示。</span><span class="sxs-lookup"><span data-stu-id="50794-140">At this point your project's Solution Explorer should look similar to the screen shot shown in Figure 1.</span></span>


<span data-ttu-id="50794-141">[![四个新页面和 Web.config 文件添加到网站](building-an-interface-to-select-one-user-account-from-many-cs/_static/image2.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="50794-141">[![Four New Pages and a Web.config File Have Been Added to the Website](building-an-interface-to-select-one-user-account-from-many-cs/_static/image2.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image1.png)</span></span>

<span data-ttu-id="50794-142">**图 1**： 四个新页面和`Web.config`文件已添加到网站 ([单击以查看实际尺寸的图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="50794-142">**Figure 1**: Four New Pages and a `Web.config` File Have Been Added to the Website  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image3.png))</span></span>


<span data-ttu-id="50794-143">最后，更新站点图 (`Web.sitemap`) 以包括进入`ManageUsers.aspx`页。</span><span class="sxs-lookup"><span data-stu-id="50794-143">Finally, update the site map (`Web.sitemap`) to include an entry to the `ManageUsers.aspx` page.</span></span> <span data-ttu-id="50794-144">添加以下 XML 后的`<siteMapNode>`我们添加了角色教程。</span><span class="sxs-lookup"><span data-stu-id="50794-144">Add the following XML after the `<siteMapNode>` we added for the Roles tutorials.</span></span>

[!code-xml[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample3.xml)]

<span data-ttu-id="50794-145">使用站点映射更新，请访问通过浏览器的站点。</span><span class="sxs-lookup"><span data-stu-id="50794-145">With the site map updated, visit the site through a browser.</span></span> <span data-ttu-id="50794-146">如图 2 所示，在左侧的导航现在将包括管理教程的项。</span><span class="sxs-lookup"><span data-stu-id="50794-146">As Figure 2 shows, the navigation on the left now includes items for the Administration tutorials.</span></span>


<span data-ttu-id="50794-147">[![站点图包括标题为用户管理的节点](building-an-interface-to-select-one-user-account-from-many-cs/_static/image5.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="50794-147">[![The Site Map Includes a Node Titled User Administration](building-an-interface-to-select-one-user-account-from-many-cs/_static/image5.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image4.png)</span></span>

<span data-ttu-id="50794-148">**图 2**： 站点图包括节点标题为的用户管理 ([单击以查看实际尺寸的图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="50794-148">**Figure 2**: The Site Map Includes a Node Titled User Administration  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image6.png))</span></span>


## <a name="step-2-listing-all-user-accounts-in-a-gridview"></a><span data-ttu-id="50794-149">步骤 2： 列出一个 GridView 中的所有用户帐户</span><span class="sxs-lookup"><span data-stu-id="50794-149">Step 2: Listing All User Accounts in a GridView</span></span>

<span data-ttu-id="50794-150">本教程中我们最终目标是创建一个分页，可筛选网格，通过该管理员可以选择要管理的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="50794-150">Our end goal for this tutorial is to create a paged, filterable grid through which an administrator can select a user account to manage.</span></span> <span data-ttu-id="50794-151">让我们开始通过列出*所有*GridView 中的用户。</span><span class="sxs-lookup"><span data-stu-id="50794-151">Let's start by listing *all* users in a GridView.</span></span> <span data-ttu-id="50794-152">完成此操作后，我们将添加的筛选和分页接口和功能。</span><span class="sxs-lookup"><span data-stu-id="50794-152">Once this is complete, we will add the filtering and paging interfaces and functionality.</span></span>

<span data-ttu-id="50794-153">打开`ManageUsers.aspx`页面`Administration`文件夹并添加一个 GridView，设置其`ID`到`UserAccounts`。</span><span class="sxs-lookup"><span data-stu-id="50794-153">Open the `ManageUsers.aspx` page in the `Administration` folder and add a GridView, setting its `ID` to `UserAccounts`.</span></span> <span data-ttu-id="50794-154">在稍后，我们将编写代码以将用户帐户的组绑定到 GridView 使用`Membership`类的`GetAllUsers`方法。</span><span class="sxs-lookup"><span data-stu-id="50794-154">In a moment, we will write code to bind the set of user accounts to the GridView using the `Membership` class's `GetAllUsers` method.</span></span> <span data-ttu-id="50794-155">如前面的教程中所述，GetAllUsers 方法返回`MembershipUserCollection`对象，这是集合的`MembershipUser`对象。</span><span class="sxs-lookup"><span data-stu-id="50794-155">As discussed in earlier tutorials, the GetAllUsers method returns a `MembershipUserCollection` object, which is a collection of `MembershipUser` objects.</span></span> <span data-ttu-id="50794-156">每个`MembershipUser`集合中包含属性，例如`UserName`， `Email`， `IsApproved`，依次类推。</span><span class="sxs-lookup"><span data-stu-id="50794-156">Each `MembershipUser` in the collection includes properties like `UserName`, `Email`, `IsApproved`, and so on.</span></span>

<span data-ttu-id="50794-157">为了在 GridView 中显示的所需的用户帐户信息，请将设置 GridView`AutoGenerateColumns`属性设置为 False 并添加为 BoundFields `UserName`， `Email`，和`Comment`属性和为 CheckBoxFields `IsApproved`，`IsLockedOut`，和`IsOnline`属性。</span><span class="sxs-lookup"><span data-stu-id="50794-157">In order to display the desired user account information in the GridView, set the GridView's `AutoGenerateColumns` property to False and add BoundFields for the `UserName`, `Email`, and `Comment` properties and CheckBoxFields for the `IsApproved`, `IsLockedOut`, and `IsOnline` properties.</span></span> <span data-ttu-id="50794-158">通过控件的声明性标记或通过字段对话框中，可以应用此配置。</span><span class="sxs-lookup"><span data-stu-id="50794-158">This configuration can be applied through the control's declarative markup or via the Fields dialog box.</span></span> <span data-ttu-id="50794-159">图 3 显示的字段的屏幕截图的自动生成字段复选框已取消选中并添加并配置 BoundFields 和 CheckBoxFields 后，此对话框。</span><span class="sxs-lookup"><span data-stu-id="50794-159">Figure 3 shows a screen shot of the Fields dialog box after the Auto-generate fields checkbox has been unchecked and the BoundFields and CheckBoxFields have been added and configured.</span></span>


<span data-ttu-id="50794-160">[![将三个 BoundFields 和三个 CheckBoxFields 添加到 GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image8.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="50794-160">[![Add Three BoundFields and Three CheckBoxFields to the GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image8.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image7.png)</span></span>

<span data-ttu-id="50794-161">**图 3**： 添加三个 BoundFields 和三个 CheckBoxFields 到 GridView ([单击以查看实际尺寸的图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="50794-161">**Figure 3**: Add Three BoundFields and Three CheckBoxFields to the GridView  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image9.png))</span></span>


<span data-ttu-id="50794-162">在配置后你 GridView，确保其声明性的标记如下所示：</span><span class="sxs-lookup"><span data-stu-id="50794-162">After configuring your GridView, ensure that its declarative markup resembles the following:</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample4.aspx)]

<span data-ttu-id="50794-163">接下来，我们需要编写代码，将用户帐户绑定到 GridView。</span><span class="sxs-lookup"><span data-stu-id="50794-163">Next, we need to write code that binds the user accounts to the GridView.</span></span> <span data-ttu-id="50794-164">创建一个名为方法`BindUserAccounts`若要执行此任务，然后调用它从`Page_Load`上第一次的页访问的事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="50794-164">Create a method named `BindUserAccounts` to perform this task and then call it from the `Page_Load` event handler on the first page visit.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample5.cs)]

<span data-ttu-id="50794-165">需要一段时间来测试通过浏览器页面。</span><span class="sxs-lookup"><span data-stu-id="50794-165">Take a moment to test the page through a browser.</span></span> <span data-ttu-id="50794-166">如图 4 所示， `UserAccounts` GridView 列出用户名、 电子邮件地址和所有用户的其他相关的帐户信息系统中。</span><span class="sxs-lookup"><span data-stu-id="50794-166">As Figure 4 shows, the `UserAccounts` GridView lists the username, email address, and other pertinent account information for all users in the system.</span></span>


<span data-ttu-id="50794-167">[![在 GridView 中列出的用户帐户](building-an-interface-to-select-one-user-account-from-many-cs/_static/image11.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="50794-167">[![The User Accounts are Listed in the GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image11.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image10.png)</span></span>

<span data-ttu-id="50794-168">**图 4**: GridView 中列出的用户帐户 ([单击以查看实际尺寸的图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="50794-168">**Figure 4**: The User Accounts are Listed in the GridView  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image12.png))</span></span>


## <a name="step-3-filtering-the-results-by-the-first-letter-of-the-username"></a><span data-ttu-id="50794-169">步骤 3： 筛选结果的第一个字母的用户名</span><span class="sxs-lookup"><span data-stu-id="50794-169">Step 3: Filtering the Results by the First Letter of the Username</span></span>

<span data-ttu-id="50794-170">当前`UserAccounts`GridView 显示*所有*的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="50794-170">Currently the `UserAccounts` GridView shows *all* of the user accounts.</span></span> <span data-ttu-id="50794-171">对于具有数百或数千个用户帐户的网站，它是命令性该用户能够快速削减显示的帐户。</span><span class="sxs-lookup"><span data-stu-id="50794-171">For websites with hundreds or thousands of user accounts, it is imperative that user be able to quickly pare down the displayed accounts.</span></span> <span data-ttu-id="50794-172">这可以通过添加到页筛选 LinkButtons 来实现。</span><span class="sxs-lookup"><span data-stu-id="50794-172">This can be accomplished by adding filtering LinkButtons to the page.</span></span> <span data-ttu-id="50794-173">让我们向页面添加 27 LinkButtons： 一个，标题为所有以及一个 LinkButton 字母表中的每个字母的。</span><span class="sxs-lookup"><span data-stu-id="50794-173">Let's add 27 LinkButtons to the page: one titled All along with one LinkButton for each letter of the alphabet.</span></span> <span data-ttu-id="50794-174">如果访问者单击所有 LinkButton，GridView 将显示的所有用户。</span><span class="sxs-lookup"><span data-stu-id="50794-174">If a visitor clicks the All LinkButton, the GridView will show all of the users.</span></span> <span data-ttu-id="50794-175">如果他们单击特定字母，只有其用户名以所选的字母开头的用户将会显示。</span><span class="sxs-lookup"><span data-stu-id="50794-175">If they click a particular letter, only those users whose username starts with the selected letter will be displayed.</span></span>

<span data-ttu-id="50794-176">我们第一项任务是添加 27 LinkButton 控件。</span><span class="sxs-lookup"><span data-stu-id="50794-176">Our first task is to add the 27 LinkButton controls.</span></span> <span data-ttu-id="50794-177">一个选项就是以声明方式，创建 27 LinkButtons 一次一个地。</span><span class="sxs-lookup"><span data-stu-id="50794-177">One option would be to create the 27 LinkButtons declaratively, one at a time.</span></span> <span data-ttu-id="50794-178">更灵活的方法是使用具有的转发器控件`ItemTemplate`，呈现 LinkButton，然后将筛选选项绑定到作为中继器`string`数组。</span><span class="sxs-lookup"><span data-stu-id="50794-178">A more flexible approach is to use a Repeater control with an `ItemTemplate` that renders a LinkButton and then binds the filtering options to the Repeater as a `string` array.</span></span>

<span data-ttu-id="50794-179">通过将重复器控件添加到上述页面中的开始`UserAccounts`GridView。</span><span class="sxs-lookup"><span data-stu-id="50794-179">Start by adding a Repeater control to the page above the `UserAccounts` GridView.</span></span> <span data-ttu-id="50794-180">设置转发器的`ID`属性`FilteringUI`。</span><span class="sxs-lookup"><span data-stu-id="50794-180">Set the Repeater's `ID` property to `FilteringUI`.</span></span> <span data-ttu-id="50794-181">配置转发器的模板，以便其`ItemTemplate`呈现 LinkButton 其`Text`和`CommandName`属性绑定到当前数组元素。</span><span class="sxs-lookup"><span data-stu-id="50794-181">Configure the Repeater's templates so that its `ItemTemplate` renders a LinkButton whose `Text` and `CommandName` properties are bound to the current array element.</span></span> <span data-ttu-id="50794-182">正如我们看到在<a id="_msoanchor_3"> </a> [*向用户分配角色*](../roles/assigning-roles-to-users-cs.md)教程，则可以使用完成这`Container.DataItem`数据绑定语法。</span><span class="sxs-lookup"><span data-stu-id="50794-182">As we saw in the <a id="_msoanchor_3"></a>[*Assigning Roles to Users*](../roles/assigning-roles-to-users-cs.md) tutorial, this can be accomplished using the `Container.DataItem` databinding syntax.</span></span> <span data-ttu-id="50794-183">使用转发器的`SeparatorTemplate`以显示一条竖线之间每个链接。</span><span class="sxs-lookup"><span data-stu-id="50794-183">Use the Repeater's `SeparatorTemplate` to display a vertical line between each link.</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample6.aspx)]

<span data-ttu-id="50794-184">若要填充此转发器与所需的筛选选项，创建一个名为方法`BindFilteringUI`。</span><span class="sxs-lookup"><span data-stu-id="50794-184">To populate this Repeater with the desired filtering options, create a method named `BindFilteringUI`.</span></span> <span data-ttu-id="50794-185">一定要调用此方法从`Page_Load`在第一个页面加载的事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="50794-185">Be sure to call this method from the `Page_Load` event handler on the first page load.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample7.cs)]

<span data-ttu-id="50794-186">此方法作为中的元素中指定的筛选选项`string`数组`filterOptions`。</span><span class="sxs-lookup"><span data-stu-id="50794-186">This method specifies the filtering options as elements in the `string` array `filterOptions`.</span></span> <span data-ttu-id="50794-187">对于数组中每个元素，转发器将呈现与 LinkButton 其`Text`和`CommandName`属性分配给数组元素的值。</span><span class="sxs-lookup"><span data-stu-id="50794-187">For each element in the array, the Repeater will render a LinkButton with its `Text` and `CommandName` properties assigned to the value of the array element.</span></span>

<span data-ttu-id="50794-188">图 5 所示`ManageUsers.aspx`页上查看通过浏览器时。</span><span class="sxs-lookup"><span data-stu-id="50794-188">Figure 5 shows the `ManageUsers.aspx` page when viewed through a browser.</span></span>


<span data-ttu-id="50794-189">[![转发器列出 27 筛选 LinkButtons](building-an-interface-to-select-one-user-account-from-many-cs/_static/image14.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="50794-189">[![The Repeater Lists 27 Filtering LinkButtons](building-an-interface-to-select-one-user-account-from-many-cs/_static/image14.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image13.png)</span></span>

<span data-ttu-id="50794-190">**图 5**: 转发器列出 27 筛选 LinkButtons ([单击以查看实际尺寸的图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="50794-190">**Figure 5**: The Repeater Lists 27 Filtering LinkButtons  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image15.png))</span></span>


> [!NOTE]
> <span data-ttu-id="50794-191">用户名可能会启动任何字符，包括数字和标点。</span><span class="sxs-lookup"><span data-stu-id="50794-191">Usernames may start with any character, including numbers and punctuation.</span></span> <span data-ttu-id="50794-192">若要查看这些帐户，管理员将需要使用所有 LinkButton 选项。</span><span class="sxs-lookup"><span data-stu-id="50794-192">In order to view these accounts, the administrator will have to use the All LinkButton option.</span></span> <span data-ttu-id="50794-193">或者，你可以添加 LinkButton 返回以数字开头的所有用户帐户。</span><span class="sxs-lookup"><span data-stu-id="50794-193">Alternatively, you could add a LinkButton to return all user accounts that start with a number.</span></span> <span data-ttu-id="50794-194">我将此作为练习为读取器。</span><span class="sxs-lookup"><span data-stu-id="50794-194">I leave this as an exercise for the reader.</span></span>


<span data-ttu-id="50794-195">单击任意筛选 LinkButtons 导致回发并引发转发器的`ItemCommand`事件，但不没有在网格中的任何更改因为我们尚未为编写任何代码来筛选结果。</span><span class="sxs-lookup"><span data-stu-id="50794-195">Clicking any of the filtering LinkButtons causes a postback and raises the Repeater's `ItemCommand` event, but there's no change in the grid because we've yet to write any code to filter the results.</span></span> <span data-ttu-id="50794-196">`Membership`类包括[`FindUsersByName`方法](https://technet.microsoft.com/library/system.web.security.membership.findusersbyname.aspx)返回其用户名与指定的搜索模式匹配的那些用户帐户。</span><span class="sxs-lookup"><span data-stu-id="50794-196">The `Membership` class includes a [`FindUsersByName` method](https://technet.microsoft.com/library/system.web.security.membership.findusersbyname.aspx) that returns those user accounts whose username matches a specified search pattern.</span></span> <span data-ttu-id="50794-197">我们可以使用此方法来检索其用户名以指定的字母开头的用户帐户`CommandName`的被单击筛选 LinkButton。</span><span class="sxs-lookup"><span data-stu-id="50794-197">We can use this method to retrieve just those user accounts whose usernames start with the letter specified by the `CommandName` of the filtered LinkButton that was clicked.</span></span>

<span data-ttu-id="50794-198">通过更新开始`ManageUser.aspx`页的代码隐藏类以使其包括一个名为属性`UsernameToMatch`。</span><span class="sxs-lookup"><span data-stu-id="50794-198">Start by updating the `ManageUser.aspx` page's code-behind class so that it includes a property named `UsernameToMatch`.</span></span> <span data-ttu-id="50794-199">此属性在回发期间保持用户名筛选器字符串：</span><span class="sxs-lookup"><span data-stu-id="50794-199">This property persists the username filter string across postbacks:</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample8.cs)]

<span data-ttu-id="50794-200">`UsernameToMatch`属性将分配到其值存储`ViewState`使用集合键用户名。</span><span class="sxs-lookup"><span data-stu-id="50794-200">The `UsernameToMatch` property stores its value it is assigned into the `ViewState` collection using the key UsernameToMatch.</span></span> <span data-ttu-id="50794-201">当读取此属性的值时，它会检查以确定一个值是否存在于`ViewState`集合; 如果不正确，则返回默认值为空字符串。</span><span class="sxs-lookup"><span data-stu-id="50794-201">When this property's value is read, it checks to see if a value exists in the `ViewState` collection; if not, it returns the default value, an empty string.</span></span> <span data-ttu-id="50794-202">`UsernameToMatch`属性表现出一种常见模式，即保留一个值，以查看状态，以便在回发期间会保留对该属性的任何更改。</span><span class="sxs-lookup"><span data-stu-id="50794-202">The `UsernameToMatch` property exhibits a common pattern, namely persisting a value to view state so that any changes to the property are persisted across postbacks.</span></span> <span data-ttu-id="50794-203">此模式的详细信息，请阅读[了解 ASP.NET 视图状态](https://msdn.microsoft.com/library/ms972976.aspx)。</span><span class="sxs-lookup"><span data-stu-id="50794-203">For more information on this pattern, read [Understanding ASP.NET View State](https://msdn.microsoft.com/library/ms972976.aspx).</span></span>

<span data-ttu-id="50794-204">接下来，更新`BindUserAccounts`方法的调用，因此`Membership.GetAllUsers`，它调用`Membership.FindUsersByName`，并传递的值中`UsernameToMatch`属性追加 SQL 通配符字符，%。</span><span class="sxs-lookup"><span data-stu-id="50794-204">Next, update the `BindUserAccounts` method so that instead of calling `Membership.GetAllUsers`, it calls `Membership.FindUsersByName`, passing in the value of the `UsernameToMatch` property appended with the SQL wildcard character, %.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample9.cs)]

<span data-ttu-id="50794-205">若要显示其用户名以字母 A 开头的用户，请设置`UsernameToMatch`到 A 的属性，然后调用`BindUserAccounts`。</span><span class="sxs-lookup"><span data-stu-id="50794-205">To display just those users whose username starts with the letter A, set the `UsernameToMatch` property to A and then call `BindUserAccounts`.</span></span> <span data-ttu-id="50794-206">这将导致调用`Membership.FindUsersByName("A%")`，这样就会返回所有用户其用户名开头 a。 同样，若要都返回*所有*用户，分配到一个空字符串`UsernameToMatch`属性以便`BindUserAccounts`方法将调用`Membership.FindUsersByName("%")`，从而返回所有用户帐户。</span><span class="sxs-lookup"><span data-stu-id="50794-206">This would result in a call to `Membership.FindUsersByName("A%")`, which will return all users whose username starts with A. Likewise, to return *all* users, assign an empty string to the `UsernameToMatch` property so that the `BindUserAccounts` method will invoke `Membership.FindUsersByName("%")`, thereby returning all user accounts.</span></span>

<span data-ttu-id="50794-207">为转发器的创建事件处理程序`ItemCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="50794-207">Create an event handler for the Repeater's `ItemCommand` event.</span></span> <span data-ttu-id="50794-208">单击其中一个筛选器 LinkButtons; 时将引发此事件它传递单击的 LinkButton`CommandName`值通过`RepeaterCommandEventArgs`对象。</span><span class="sxs-lookup"><span data-stu-id="50794-208">This event is raised whenever one of the filter LinkButtons is clicked; it is passed the clicked LinkButton's `CommandName` value through the `RepeaterCommandEventArgs` object.</span></span> <span data-ttu-id="50794-209">我们需要将相应的值赋给`UsernameToMatch`属性，然后调用`BindUserAccounts`方法。</span><span class="sxs-lookup"><span data-stu-id="50794-209">We need to assign the appropriate value to the `UsernameToMatch` property and then call the `BindUserAccounts` method.</span></span> <span data-ttu-id="50794-210">如果`CommandName`为 All，分配到一个空字符串`UsernameToMatch`，以便显示所有用户帐户。</span><span class="sxs-lookup"><span data-stu-id="50794-210">If the `CommandName` is All, assign an empty string to `UsernameToMatch` so that all user accounts are displayed.</span></span> <span data-ttu-id="50794-211">否则，将分配`CommandName`值赋给`UsernameToMatch`。</span><span class="sxs-lookup"><span data-stu-id="50794-211">Otherwise, assign the `CommandName` value to `UsernameToMatch`.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample10.cs)]

<span data-ttu-id="50794-212">此代码中的位置，测试所筛选的功能。</span><span class="sxs-lookup"><span data-stu-id="50794-212">With this code in place, test out the filtering functionality.</span></span> <span data-ttu-id="50794-213">首次访问页，将显示所有用户帐户 （回头参考图 5 中）。</span><span class="sxs-lookup"><span data-stu-id="50794-213">When the page is first visited, all user accounts are displayed (refer back to Figure 5).</span></span> <span data-ttu-id="50794-214">单击 LinkButton 导致回发，并筛选结果，显示以 A 开头的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="50794-214">Clicking the A LinkButton causes a postback and filters the results, displaying only those user accounts that start with A .</span></span>


<span data-ttu-id="50794-215">[![使用筛选 LinkButtons 显示其用户名的某些字母开头的用户](building-an-interface-to-select-one-user-account-from-many-cs/_static/image17.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="50794-215">[![Use the Filtering LinkButtons to Display those Users Whose Username Starts with a Certain Letter](building-an-interface-to-select-one-user-account-from-many-cs/_static/image17.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image16.png)</span></span>

<span data-ttu-id="50794-216">**图 6**： 筛选 LinkButtons 用于显示这些用户其用户名以某些字母开头 ([单击以查看实际尺寸的图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="50794-216">**Figure 6**: Use the Filtering LinkButtons to Display those Users Whose Username Starts with a Certain Letter  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image18.png))</span></span>


## <a name="step-4-updating-the-gridview-to-use-paging"></a><span data-ttu-id="50794-217">步骤 4： 更新 GridView 用于分页</span><span class="sxs-lookup"><span data-stu-id="50794-217">Step 4: Updating the GridView to Use Paging</span></span>

<span data-ttu-id="50794-218">图 5 和 6 中所示 GridView 列出所有从返回的记录`FindUsersByName`方法。</span><span class="sxs-lookup"><span data-stu-id="50794-218">The GridView shown in Figures 5 and 6 lists all of the records returned from the `FindUsersByName` method.</span></span> <span data-ttu-id="50794-219">如果有数百或数千个用户帐户这可能导致信息重载，查看时的所有帐户 （或最初中访问的页面时单击所有 LinkButton 是这种情况）。</span><span class="sxs-lookup"><span data-stu-id="50794-219">If there are hundreds or thousands of user accounts this can lead to information overload when viewing all of the accounts (as is the case when clicking the All LinkButton or when initially visiting the page).</span></span> <span data-ttu-id="50794-220">为了帮助更易于管理的小区块中提供的用户帐户，让我们配置 GridView 以一次显示 10 个用户帐户。</span><span class="sxs-lookup"><span data-stu-id="50794-220">To help present the user accounts in more manageable chunks, let's configure the GridView to display 10 user accounts at a time.</span></span>

<span data-ttu-id="50794-221">GridView 控件提供两种类型的分页：</span><span class="sxs-lookup"><span data-stu-id="50794-221">The GridView control offers two types of paging:</span></span>

- <span data-ttu-id="50794-222">**默认分页**-易于实现，但效率低下。</span><span class="sxs-lookup"><span data-stu-id="50794-222">**Default paging** - easy to implement, but inefficient.</span></span> <span data-ttu-id="50794-223">简而言之，使用默认分页 GridView 需要*所有*从其数据源的记录。</span><span class="sxs-lookup"><span data-stu-id="50794-223">In a nutshell, with default paging the GridView expects *all* of the records from its data source.</span></span> <span data-ttu-id="50794-224">它然后仅显示合适的页面的记录。</span><span class="sxs-lookup"><span data-stu-id="50794-224">It then only displays the appropriate page of records.</span></span>
- <span data-ttu-id="50794-225">**自定义分页**-需要更多的工作，若要实现，但比默认分页因为与将数据分页的自定义源只返回精确集要显示的记录更高效。</span><span class="sxs-lookup"><span data-stu-id="50794-225">**Custom paging** - requires more work to implement, but is more efficient than default paging because with custom paging the data source returns only the precise set of records to display.</span></span>

<span data-ttu-id="50794-226">当数千条记录进行分页时，可以极大地默认和自定义分页之间的性能差异。</span><span class="sxs-lookup"><span data-stu-id="50794-226">The performance difference between default and custom paging can be quite substantial when paging through thousands of records.</span></span> <span data-ttu-id="50794-227">因为我们要生成假定此接口可能是数百或数千个用户帐户，我们将使用自定义分页。</span><span class="sxs-lookup"><span data-stu-id="50794-227">Because we are building this interface assuming that there may be hundreds or thousands of user accounts, let's use custom paging.</span></span>

> [!NOTE]
> <span data-ttu-id="50794-228">有关默认和自定义分页，以及实现自定义分页中涉及的挑战之间的差异的详细讨论，请参阅[高效地分页通过大型金额的数据](https://asp.net/learn/data-access/tutorial-25-cs.aspx)。</span><span class="sxs-lookup"><span data-stu-id="50794-228">For a more thorough discussion on the differences between default and custom paging, as well as the challenges involved in implementing custom paging, refer to [Efficiently Paging Through Large Amounts of Data](https://asp.net/learn/data-access/tutorial-25-cs.aspx).</span></span> <span data-ttu-id="50794-229">默认和自定义分页之间的性能差异一些分析，请参阅[在 ASP.NET 中通过 SQL Server 2005 的自定义分页](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="50794-229">For some analysis of the performance difference between default and custom paging, see [Custom Paging in ASP.NET with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx).</span></span>


<span data-ttu-id="50794-230">若要实现自定义分页我们首先需要某种机制，用于检索 GridView 显示的记录的精确的子集。</span><span class="sxs-lookup"><span data-stu-id="50794-230">To implement custom paging we first need some mechanism by which to retrieve the precise subset of records being displayed by the GridView.</span></span> <span data-ttu-id="50794-231">好消息是`Membership`类的`FindUsersByName`方法的重载，使我们可以指定的页索引和页面大小，并且返回仅记录该范围内的这些用户帐户。</span><span class="sxs-lookup"><span data-stu-id="50794-231">The good news is that the `Membership` class's `FindUsersByName` method has an overload that allows us to specify the page index and page size, and returns only those user accounts that fall within that range of records.</span></span>

<span data-ttu-id="50794-232">具体而言，此重载具有以下签名： [ `FindUsersByName(usernameToMatch, pageIndex, pageSize, totalRecords)` ](https://msdn.microsoft.com/library/fa5st8b2.aspx)。</span><span class="sxs-lookup"><span data-stu-id="50794-232">In particular, this overload has the following signature: [`FindUsersByName(usernameToMatch, pageIndex, pageSize, totalRecords)`](https://msdn.microsoft.com/library/fa5st8b2.aspx).</span></span>

<span data-ttu-id="50794-233">*PageIndex*参数指定要返回; 用户帐户的页*pageSize*指示每页显示的记录数量。</span><span class="sxs-lookup"><span data-stu-id="50794-233">The *pageIndex* parameter specifies the page of user accounts to return; *pageSize* indicates how many records to display per page.</span></span> <span data-ttu-id="50794-234">*TotalRecords*参数是`out`在用户存储区返回的总用户帐户数的参数。</span><span class="sxs-lookup"><span data-stu-id="50794-234">The *totalRecords* parameter is an `out` parameter that returns the number of total user accounts in the user store.</span></span>

> [!NOTE]
> <span data-ttu-id="50794-235">返回的数据`FindUsersByName`按 username; 不能自定义的排序条件。</span><span class="sxs-lookup"><span data-stu-id="50794-235">The data returned by `FindUsersByName` is sorted by username; the sort criteria cannot be customized.</span></span>


<span data-ttu-id="50794-236">GridView 可以配置为使用自定义分页，但仅当绑定到 ObjectDataSource 控件。</span><span class="sxs-lookup"><span data-stu-id="50794-236">The GridView can be configured to utilize custom paging, but only when bound to an ObjectDataSource control.</span></span> <span data-ttu-id="50794-237">要实现自定义分页的 ObjectDataSource 控件，它需要两个方法： 开始行索引和记录，若要显示，最大数量传入一个，并返回文本范围; 内的记录的精确子集和通过返回的记录总数的方法正在通过寻呼发送。</span><span class="sxs-lookup"><span data-stu-id="50794-237">For the ObjectDataSource control to implement custom paging, it requires two methods: one that is passed a start row index and the maximum number of records to display, and returns the precise subset of records that fall within that span; and a method that returns the total number of records being paged through.</span></span> <span data-ttu-id="50794-238">`FindUsersByName`重载接受的页索引和页面大小，并返回通过记录的总数`out`参数。</span><span class="sxs-lookup"><span data-stu-id="50794-238">The `FindUsersByName` overload accepts a page index and page size, and returns the total number of records through an `out` parameter.</span></span> <span data-ttu-id="50794-239">因此，此处接口不匹配。</span><span class="sxs-lookup"><span data-stu-id="50794-239">So there is an interface mismatch here.</span></span>

<span data-ttu-id="50794-240">一个选项就是创建公开对象数据源要求，并且内部调用的接口的代理类`FindUsersByName`方法。</span><span class="sxs-lookup"><span data-stu-id="50794-240">One option would be to create a proxy class that exposes the interface the ObjectDataSource expects, and then internally calls the `FindUsersByName` method.</span></span> <span data-ttu-id="50794-241">另一个选项-，另一个我们将为此项目使用的是创建我们自己分页接口，并使用，而不是 GridView 的内置分页接口。</span><span class="sxs-lookup"><span data-stu-id="50794-241">Another option - and the one we'll use for this article - is to create our own paging interface and use that instead of the GridView's built-in paging interface.</span></span>

### <a name="creating-a-first-previous-next-last-paging-interface"></a><span data-ttu-id="50794-242">创建第一个，以前，接下来，上次分页接口</span><span class="sxs-lookup"><span data-stu-id="50794-242">Creating a First, Previous, Next, Last Paging Interface</span></span>

<span data-ttu-id="50794-243">让我们使用第一个、 上一步、 下一步，和最后一个 LinkButtons 生成分页接口。</span><span class="sxs-lookup"><span data-stu-id="50794-243">Let's build a paging interface with First, Previous, Next, and Last LinkButtons.</span></span> <span data-ttu-id="50794-244">第一个 LinkButton，单击时，将采用用户的第一页数据，而上一步将返回他到以前的页面。</span><span class="sxs-lookup"><span data-stu-id="50794-244">The First LinkButton, when clicked, will take the user to the first page of data, whereas Previous will return him to the previous page.</span></span> <span data-ttu-id="50794-245">同样下, 一步，最后将用户移到下一个和最后一页上，分别。</span><span class="sxs-lookup"><span data-stu-id="50794-245">Likewise, Next and Last will move the user to the next and last page, respectively.</span></span> <span data-ttu-id="50794-246">添加下面四个 LinkButton 控件`UserAccounts`GridView。</span><span class="sxs-lookup"><span data-stu-id="50794-246">Add the four LinkButton controls beneath the `UserAccounts` GridView.</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample11.aspx)]

<span data-ttu-id="50794-247">接下来，为每个 LinkButton 创建事件处理程序`Click`事件。</span><span class="sxs-lookup"><span data-stu-id="50794-247">Next, create an event handler for each of the LinkButton's `Click` events.</span></span>

<span data-ttu-id="50794-248">图 7 显示了四个 LinkButtons 通过 Visual Web Developer 设计视图中查看时。</span><span class="sxs-lookup"><span data-stu-id="50794-248">Figure 7 shows the four LinkButtons when viewed through the Visual Web Developer Design view.</span></span>


<span data-ttu-id="50794-249">[![接下来，添加第一个、 上一个、 和最后一个 LinkButtons 下 GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image20.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="50794-249">[![Add First, Previous, Next, and Last LinkButtons Beneath the GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image20.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image19.png)</span></span>

<span data-ttu-id="50794-250">**图 7**： 添加第一个、 上一步、 下一步，和最后一个 LinkButtons 下 GridView ([单击以查看实际尺寸的图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="50794-250">**Figure 7**: Add First, Previous, Next, and Last LinkButtons Beneath the GridView  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image21.png))</span></span>


### <a name="keeping-track-of-the-current-page-index"></a><span data-ttu-id="50794-251">跟踪的当前页索引</span><span class="sxs-lookup"><span data-stu-id="50794-251">Keeping Track of the Current Page Index</span></span>

<span data-ttu-id="50794-252">当用户第一次访问`ManageUsers.aspx`页或单击任一筛选按钮，我们想要在 GridView 中显示数据的第一页。</span><span class="sxs-lookup"><span data-stu-id="50794-252">When a user first visits the `ManageUsers.aspx` page or clicks one of the filtering buttons, we want to display the first page of data in the GridView.</span></span> <span data-ttu-id="50794-253">当用户单击导航 LinkButtons 之一时，但是，我们需要更新的页索引。</span><span class="sxs-lookup"><span data-stu-id="50794-253">When the user clicks one of the navigation LinkButtons, however, we need to update the page index.</span></span> <span data-ttu-id="50794-254">若要维护的页索引和要每页显示的记录数，添加到页面的代码隐藏类的以下两个属性：</span><span class="sxs-lookup"><span data-stu-id="50794-254">To maintain the page index and the number of records to display per page, add the following two properties to the page's code-behind class:</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample12.cs)]

<span data-ttu-id="50794-255">如`UsernameToMatch`属性，`PageIndex`属性保持其视图状态的值。</span><span class="sxs-lookup"><span data-stu-id="50794-255">Like the `UsernameToMatch` property, the `PageIndex` property persists its value to view state.</span></span> <span data-ttu-id="50794-256">只读`PageSize`属性返回的硬编码值，10。</span><span class="sxs-lookup"><span data-stu-id="50794-256">The read-only `PageSize` property returns a hard-coded value, 10.</span></span> <span data-ttu-id="50794-257">我恳请感读取器中，若要更新此属性，以使用相同模式`PageIndex`，然后增加`ManageUsers.aspx`页上，以便访问的页面的人员可以指定多少个用户帐户以显示每个页上。</span><span class="sxs-lookup"><span data-stu-id="50794-257">I invite the interested reader to update this property to use the same pattern as `PageIndex`, and then to augment the `ManageUsers.aspx` page such that the person visiting the page can specify how many user accounts to display per page.</span></span>

### <a name="retrieving-just-the-current-pages-records-updating-the-page-index-and-enabling-and-disabling-the-paging-interface-linkbuttons"></a><span data-ttu-id="50794-258">检索当前页的记录为止，更新页索引，并启用和禁用分页接口 LinkButtons</span><span class="sxs-lookup"><span data-stu-id="50794-258">Retrieving Just the Current Page's Records, Updating the Page Index, and Enabling and Disabling the Paging Interface LinkButtons</span></span>

<span data-ttu-id="50794-259">使用分页接口可就地和`PageIndex`和`PageSize`添加属性，我们已准备好更新`BindUserAccounts`方法，以便它使用相应`FindUsersByName`重载。</span><span class="sxs-lookup"><span data-stu-id="50794-259">With the paging interface in place and the `PageIndex` and `PageSize` properties added, we are ready to update the `BindUserAccounts` method so that it uses the appropriate `FindUsersByName` overload.</span></span> <span data-ttu-id="50794-260">此外，我们需要将此方法启用或禁用分页接口，具体取决于要显示哪些页。</span><span class="sxs-lookup"><span data-stu-id="50794-260">Additionally, we need to have this method enable or disable the paging interface depending on what page is being displayed.</span></span> <span data-ttu-id="50794-261">在查看数据的第一页时，应禁用第一个和上一步链接;当查看的最后一页时，应禁用下一步和上一次。</span><span class="sxs-lookup"><span data-stu-id="50794-261">When viewing the first page of data, the First and Previous links should be disabled; Next and Last should be disabled when viewing the last page.</span></span>

<span data-ttu-id="50794-262">使用以下代码更新 `BindUserAccounts` 方法：</span><span class="sxs-lookup"><span data-stu-id="50794-262">Update the `BindUserAccounts` method with the following code:</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample13.cs)]

<span data-ttu-id="50794-263">请注意总正在通过寻呼发送到的记录数由的最后一个参数`FindUsersByName`方法。</span><span class="sxs-lookup"><span data-stu-id="50794-263">Note that the total number of records being paged through is determined by the last parameter of the `FindUsersByName` method.</span></span> <span data-ttu-id="50794-264">这是`out`参数，因此我们需要先声明一个变量以保存此值 (`totalRecords`)，然后它前面加`out`关键字。</span><span class="sxs-lookup"><span data-stu-id="50794-264">This is an `out` parameter, so we need to first declare a variable to hold this value (`totalRecords`) and then prefix it with the `out` keyword.</span></span>

<span data-ttu-id="50794-265">返回指定的页面的用户帐户后，四个 LinkButtons 可以启用或禁用，具体取决于是否正在查看数据的第一个或最后一页。</span><span class="sxs-lookup"><span data-stu-id="50794-265">After the specified page of user accounts are returned, the four LinkButtons are either enabled or disabled, depending on whether the first or last page of data is being viewed.</span></span>

<span data-ttu-id="50794-266">最后一步是为四个 LinkButtons 的编写代码`Click`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="50794-266">The last step is to write the code for the four LinkButtons' `Click` event handlers.</span></span> <span data-ttu-id="50794-267">这些事件处理程序需要更新`PageIndex`属性，然后将重新绑定数据到通过调用 GridView `BindUserAccounts`。</span><span class="sxs-lookup"><span data-stu-id="50794-267">These event handlers need to update the `PageIndex` property and then rebind the data to the GridView via a call to `BindUserAccounts`.</span></span> <span data-ttu-id="50794-268">第一个、 上一步和下一步的事件处理程序就非常简单。</span><span class="sxs-lookup"><span data-stu-id="50794-268">The First, Previous, and Next event handlers are very simple.</span></span> <span data-ttu-id="50794-269">`Click`事件处理程序上次 LinkButton，但是，很有点复杂，因为我们需要确定显示多少条记录的以便确定最后一个的页索引。</span><span class="sxs-lookup"><span data-stu-id="50794-269">The `Click` event handler for the Last LinkButton, however, is a bit more complex because we need to determine how many records are being displayed in order to determine the last page index.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample14.cs)]

<span data-ttu-id="50794-270">图 8 和 9 在操作中展示的自定义分页接口。</span><span class="sxs-lookup"><span data-stu-id="50794-270">Figures 8 and 9 show the custom paging interface in action.</span></span> <span data-ttu-id="50794-271">图 8 显示`ManageUsers.aspx`页上查看所有用户帐户的数据的第一页时。</span><span class="sxs-lookup"><span data-stu-id="50794-271">Figure 8 shows the `ManageUsers.aspx` page when viewing the first page of data for all user accounts.</span></span> <span data-ttu-id="50794-272">请注意，只能以 10 为 13 帐户的显示。</span><span class="sxs-lookup"><span data-stu-id="50794-272">Note that only 10 of the 13 accounts are displayed.</span></span> <span data-ttu-id="50794-273">单击下一步或上一次链接导致回发，更新`PageIndex`为 1，而第二页的用户帐户添加到网格的绑定 （请参阅图 9）。</span><span class="sxs-lookup"><span data-stu-id="50794-273">Clicking the Next or Last link causes a postback, updates the `PageIndex` to 1, and binds the second page of user accounts to the grid (see Figure 9).</span></span>


<span data-ttu-id="50794-274">[![显示第一个 10 用户帐户](building-an-interface-to-select-one-user-account-from-many-cs/_static/image23.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="50794-274">[![The First 10 User Accounts are Displayed](building-an-interface-to-select-one-user-account-from-many-cs/_static/image23.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image22.png)</span></span>

<span data-ttu-id="50794-275">**图 8**： 显示第一个 10 用户帐户 ([单击以查看实际尺寸的图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="50794-275">**Figure 8**: The First 10 User Accounts are Displayed  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image24.png))</span></span>


<span data-ttu-id="50794-276">[![单击下一步链接显示用户帐户的第二页](building-an-interface-to-select-one-user-account-from-many-cs/_static/image26.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="50794-276">[![Clicking the Next Link Displays the Second Page of User Accounts](building-an-interface-to-select-one-user-account-from-many-cs/_static/image26.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image25.png)</span></span>

<span data-ttu-id="50794-277">**图 9**： 单击下一步链接将显示第二个页面的用户帐户 ([单击以查看实际尺寸的图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="50794-277">**Figure 9**: Clicking the Next Link Displays the Second Page of User Accounts  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image27.png))</span></span>


## <a name="summary"></a><span data-ttu-id="50794-278">总结</span><span class="sxs-lookup"><span data-stu-id="50794-278">Summary</span></span>

<span data-ttu-id="50794-279">管理员通常需要从帐户列表中选择一个用户。</span><span class="sxs-lookup"><span data-stu-id="50794-279">Administrators often need to select a user from the list of accounts.</span></span> <span data-ttu-id="50794-280">在前面的教程中我们讨论在使用下拉列表填充对于用户，但这种方法可伸缩性差。</span><span class="sxs-lookup"><span data-stu-id="50794-280">In previous tutorials we looked at using a drop-down list populated with the users, but this approach does not scale well.</span></span> <span data-ttu-id="50794-281">在本教程中我们探讨了更好的选择： 其结果显示在分页 GridView 可筛选接口。</span><span class="sxs-lookup"><span data-stu-id="50794-281">In this tutorial we explored a better alternative: a filterable interface whose results are displayed in a paged GridView.</span></span> <span data-ttu-id="50794-282">与此用户界面，管理员可以快速、 高效地查找和选择千位之间的一个用户帐户。</span><span class="sxs-lookup"><span data-stu-id="50794-282">With this user interface, administrators can quickly and efficiently locate and select one user account among thousands.</span></span>

<span data-ttu-id="50794-283">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="50794-283">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="50794-284">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="50794-284">Further Reading</span></span>

<span data-ttu-id="50794-285">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="50794-285">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="50794-286">与 SQL Server 2005 的 ASP.NET 中的自定义分页</span><span class="sxs-lookup"><span data-stu-id="50794-286">Custom Paging in ASP.NET with SQL Server 2005</span></span>](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx)
- [<span data-ttu-id="50794-287">有效地分页的数据量大</span><span class="sxs-lookup"><span data-stu-id="50794-287">Efficiently Paging Through Large Amounts of Data</span></span>](https://asp.net/learn/data-access/tutorial-25-cs.aspx)
- [<span data-ttu-id="50794-288">滚动你自己的网站管理工具</span><span class="sxs-lookup"><span data-stu-id="50794-288">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)

### <a name="about-the-author"></a><span data-ttu-id="50794-289">关于作者</span><span class="sxs-lookup"><span data-stu-id="50794-289">About the Author</span></span>

<span data-ttu-id="50794-290">Scott Mitchell，多个 ASP/ASP.NET 丛书的作者和创始人 4GuysFromRolla.com，具有已使用自 1998 年 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="50794-290">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="50794-291">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="50794-291">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="50794-292">最新书籍是 *[Sam 教授自己 ASP.NET 2.0 24 小时内](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*。</span><span class="sxs-lookup"><span data-stu-id="50794-292">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="50794-293">可以在达到 Scott [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)或通过在其博客地址[ http://ScottOnWriting.NET ](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="50794-293">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="50794-294">特别感谢</span><span class="sxs-lookup"><span data-stu-id="50794-294">Special Thanks To</span></span>

<span data-ttu-id="50794-295">本教程系列已由许多有用的审阅者评审。</span><span class="sxs-lookup"><span data-stu-id="50794-295">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="50794-296">本教程中的前导审阅者已 Alicja Maziarz。</span><span class="sxs-lookup"><span data-stu-id="50794-296">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="50794-297">对感兴趣查看我即将到来的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="50794-297">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="50794-298">如果是这样，删除我一行 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="50794-298">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="50794-299">下一篇</span><span class="sxs-lookup"><span data-stu-id="50794-299">Next</span></span>](recovering-and-changing-passwords-cs.md)
