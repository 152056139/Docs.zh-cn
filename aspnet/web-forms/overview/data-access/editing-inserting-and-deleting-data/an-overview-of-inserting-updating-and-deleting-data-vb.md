---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb
title: 插入、 更新和删除数据 (VB) 的概述 |Microsoft 文档
author: rick-anderson
description: 在本教程中，我们将了解如何映射 ObjectDataSource Insert()，update （)，以及对方法的 BLL delete （） 方法类，以及如何 configu...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/17/2006
ms.topic: article
ms.assetid: 35b40b8f-2ca8-4ab3-9c19-f361a91a3647
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb
msc.type: authoredcontent
ms.openlocfilehash: db77d9ec5b0d4b27259023363e786b26fe736d7b
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/06/2018
---
<a name="an-overview-of-inserting-updating-and-deleting-data-vb"></a><span data-ttu-id="6fa96-103">插入、 更新和删除数据 (VB) 的概述</span><span class="sxs-lookup"><span data-stu-id="6fa96-103">An Overview of Inserting, Updating, and Deleting Data (VB)</span></span>
====================
<span data-ttu-id="6fa96-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="6fa96-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="6fa96-105">[下载示例应用程序](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_16_VB.exe)或[下载 PDF](an-overview-of-inserting-updating-and-deleting-data-vb/_static/datatutorial16vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="6fa96-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_16_VB.exe) or [Download PDF](an-overview-of-inserting-updating-and-deleting-data-vb/_static/datatutorial16vb1.pdf)</span></span>

> <span data-ttu-id="6fa96-106">在本教程中，我们将了解如何映射 ObjectDataSource Insert()，update （)，并于 BLL 的方法的 delete （） 方法的类，以及如何配置提供数据修改功能的 GridView、 说明如何和 FormView 控件。</span><span class="sxs-lookup"><span data-stu-id="6fa96-106">In this tutorial we'll see how to map an ObjectDataSource's Insert(), Update(), and Delete() methods to the methods of BLL classes, as well as how to configure the GridView, DetailsView, and FormView controls to provide data modification capabilities.</span></span>


## <a name="introduction"></a><span data-ttu-id="6fa96-107">介绍</span><span class="sxs-lookup"><span data-stu-id="6fa96-107">Introduction</span></span>

<span data-ttu-id="6fa96-108">通过过去的几个教程，我们探讨了如何在 ASP.NET 页使用 GridView、 说明，和 FormView 控件中显示数据。</span><span class="sxs-lookup"><span data-stu-id="6fa96-108">Over the past several tutorials we've examined how to display data in an ASP.NET page using the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="6fa96-109">这些控件只需处理提供给它们的数据。</span><span class="sxs-lookup"><span data-stu-id="6fa96-109">These controls simply work with data supplied to them.</span></span> <span data-ttu-id="6fa96-110">通常情况下，这些控件访问通过使用数据源控件，如对象数据源的数据。</span><span class="sxs-lookup"><span data-stu-id="6fa96-110">Commonly, these controls access data through the use of a data source control, such as the ObjectDataSource.</span></span> <span data-ttu-id="6fa96-111">我们已了解如何 ObjectDataSource 充当 ASP.NET 页和基础数据之间的代理。</span><span class="sxs-lookup"><span data-stu-id="6fa96-111">We've seen how the ObjectDataSource acts as a proxy between the ASP.NET page and the underlying data.</span></span> <span data-ttu-id="6fa96-112">当一个 GridView 需要显示数据时，将调用其 ObjectDataSource`Select()`方法，反过来调用的方法从我们业务逻辑层 (BLL)，该调用的相应数据访问层的 (DAL) 的方法 TableAdapter，后者反过来将发送`SELECT`包含到 Northwind 数据库的查询。</span><span class="sxs-lookup"><span data-stu-id="6fa96-112">When a GridView needs to display data, it invokes its ObjectDataSource's `Select()` method, which in turn invokes a method from our Business Logic Layer (BLL), which calls a method in the appropriate Data Access Layer's (DAL) TableAdapter, which in turn sends a `SELECT` query to the Northwind database.</span></span>

<span data-ttu-id="6fa96-113">回想一下，我们在 DAL 在中创建 Tableadapter 时[我们第一个教程](../introduction/creating-a-data-access-layer-cs.md)、 Visual Studio 自动添加用于插入，方法更新和删除数据从基础数据库表。</span><span class="sxs-lookup"><span data-stu-id="6fa96-113">Recall that when we created the TableAdapters in the DAL in [our first tutorial](../introduction/creating-a-data-access-layer-cs.md), Visual Studio automatically added methods for inserting, updating, and deleting data from the underlying database table.</span></span> <span data-ttu-id="6fa96-114">此外，在[创建业务逻辑层](../introduction/creating-a-business-logic-layer-vb.md)我们设计调用 BLL 中的方法应用到这些数据修改 DAL 方法。</span><span class="sxs-lookup"><span data-stu-id="6fa96-114">Moreover, in [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) we designed methods in the BLL that called down into these data modification DAL methods.</span></span>

<span data-ttu-id="6fa96-115">除了其`Select()`方法，ObjectDataSource 还有`Insert()`， `Update()`，和`Delete()`方法。</span><span class="sxs-lookup"><span data-stu-id="6fa96-115">In addition to its `Select()` method, the ObjectDataSource also has `Insert()`, `Update()`, and `Delete()` methods.</span></span> <span data-ttu-id="6fa96-116">如`Select()`方法，这三种方法可以映射到基础对象中的方法。</span><span class="sxs-lookup"><span data-stu-id="6fa96-116">Like the `Select()` method, these three methods can be mapped to methods in an underlying object.</span></span> <span data-ttu-id="6fa96-117">配置为插入、 更新或删除数据时，GridView、 说明，和 FormView 控件用于修改基础数据提供一个用户界面。</span><span class="sxs-lookup"><span data-stu-id="6fa96-117">When configured to insert, update, or delete data, the GridView, DetailsView, and FormView controls provide a user interface for modifying the underlying data.</span></span> <span data-ttu-id="6fa96-118">此用户界面调用`Insert()`， `Update()`，和`Delete()`方法的对象数据源，然后调用基础对象的关联的方法 （请参见图 1）。</span><span class="sxs-lookup"><span data-stu-id="6fa96-118">This user interface calls the `Insert()`, `Update()`, and `Delete()` methods of the ObjectDataSource, which then invoke the underlying object's associated methods (see Figure 1).</span></span>


<span data-ttu-id="6fa96-119">[![ObjectDataSource Insert()、 update （） 和 delete （） 方法用作代理到 BLL](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image2.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-119">[![The ObjectDataSource's Insert(), Update(), and Delete() Methods Serve as a Proxy into the BLL](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image2.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image1.png)</span></span>

<span data-ttu-id="6fa96-120">**图 1**: ObjectDataSource `Insert()`， `Update()`，和`Delete()`方法用作代理，BLL ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-120">**Figure 1**: The ObjectDataSource's `Insert()`, `Update()`, and `Delete()` Methods Serve as a Proxy into the BLL ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image3.png))</span></span>


<span data-ttu-id="6fa96-121">在本教程中，我们将了解如何映射 ObjectDataSource `Insert()`， `Update()`，和`Delete()`BLL，以及如何配置 GridView、 说明如何和 FormView 控件，以提供数据修改中类方法的方法功能。</span><span class="sxs-lookup"><span data-stu-id="6fa96-121">In this tutorial we'll see how to map the ObjectDataSource's `Insert()`, `Update()`, and `Delete()` methods to methods of classes in the BLL, as well as how to configure the GridView, DetailsView, and FormView controls to provide data modification capabilities.</span></span>

## <a name="step-1-creating-the-insert-update-and-delete-tutorials-web-pages"></a><span data-ttu-id="6fa96-122">步骤 1： 创建插入、 更新和删除教程网页</span><span class="sxs-lookup"><span data-stu-id="6fa96-122">Step 1: Creating the Insert, Update, and Delete Tutorials Web Pages</span></span>

<span data-ttu-id="6fa96-123">我们开始浏览如何插入、 更新和删除数据之前，让我们先花一些时间，我们需要用于本教程和下一步的几个的网站项目中创建 ASP.NET 页。</span><span class="sxs-lookup"><span data-stu-id="6fa96-123">Before we start exploring how to insert, update, and delete data, let's first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next several ones.</span></span> <span data-ttu-id="6fa96-124">首先，通过添加一个名为的新文件夹`EditInsertDelete`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-124">Start by adding a new folder named `EditInsertDelete`.</span></span> <span data-ttu-id="6fa96-125">接下来，添加到该文件夹，并确保将每个包含网页相关联的以下 ASP.NET 页面`Site.master`母版页：</span><span class="sxs-lookup"><span data-stu-id="6fa96-125">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `Basics.aspx`
- `DataModificationEvents.aspx`
- `ErrorHandling.aspx`
- `UIValidation.aspx`
- `CustomizedUI.aspx`
- `OptimisticConcurrency.aspx`
- `ConfirmationOnDelete.aspx`
- `UserLevelAccess.aspx`


![有关数据修改相关教程添加的 ASP.NET 页面](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image4.png)

<span data-ttu-id="6fa96-127">**图 2**： 添加 ASP.NET 页的数据修改相关教程</span><span class="sxs-lookup"><span data-stu-id="6fa96-127">**Figure 2**: Add the ASP.NET Pages for the Data Modification-Related Tutorials</span></span>


<span data-ttu-id="6fa96-128">在其他文件夹中，如`Default.aspx`中`EditInsertDelete`文件夹将在其部分中列出这些教程。</span><span class="sxs-lookup"><span data-stu-id="6fa96-128">Like in the other folders, `Default.aspx` in the `EditInsertDelete` folder will list the tutorials in its section.</span></span> <span data-ttu-id="6fa96-129">回想一下，`SectionLevelTutorialListing.ascx`用户控件提供此功能。</span><span class="sxs-lookup"><span data-stu-id="6fa96-129">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="6fa96-130">因此，此用户将控件添加到`Default.aspx`通过从解决方案资源管理器拖放到页面的设计视图拖动。</span><span class="sxs-lookup"><span data-stu-id="6fa96-130">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page's Design view.</span></span>


<span data-ttu-id="6fa96-131">[![SectionLevelTutorialListing.ascx 用户控件添加到 Default.aspx](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image6.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-131">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image6.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image5.png)</span></span>

<span data-ttu-id="6fa96-132">**图 3**： 添加`SectionLevelTutorialListing.ascx`用户控件`Default.aspx`([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-132">**Figure 3**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image7.png))</span></span>


<span data-ttu-id="6fa96-133">最后，将页添加到的条目为`Web.sitemap`文件。</span><span class="sxs-lookup"><span data-stu-id="6fa96-133">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="6fa96-134">具体而言，在自定义格式化后添加以下标记`<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="6fa96-134">Specifically, add the following markup after the Customized Formatting `<siteMapNode>`:</span></span>


[!code-xml[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample1.xml)]

<span data-ttu-id="6fa96-135">在更新后`Web.sitemap`，花些时间查看通过浏览器网站的教程。</span><span class="sxs-lookup"><span data-stu-id="6fa96-135">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="6fa96-136">在左侧菜单现在包括用于编辑、 插入和删除教程的项。</span><span class="sxs-lookup"><span data-stu-id="6fa96-136">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>


![站点图现在包括用于编辑、 插入和删除教程项](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image8.png)

<span data-ttu-id="6fa96-138">**图 4**： 站点图现在包括用于编辑、 插入和删除教程项</span><span class="sxs-lookup"><span data-stu-id="6fa96-138">**Figure 4**: The Site Map Now Includes Entries for the Editing, Inserting, and Deleting Tutorials</span></span>


## <a name="step-2-adding-and-configuring-the-objectdatasource-control"></a><span data-ttu-id="6fa96-139">步骤 2： 添加和配置 ObjectDataSource 控件</span><span class="sxs-lookup"><span data-stu-id="6fa96-139">Step 2: Adding and Configuring the ObjectDataSource Control</span></span>

<span data-ttu-id="6fa96-140">由于 GridView，说明如何和在其数据修改功能和布局每个不同的 FormView，让我们分别检查每个。</span><span class="sxs-lookup"><span data-stu-id="6fa96-140">Since the GridView, DetailsView, and FormView each differ in their data modification capabilities and layout, let's examine each one individually.</span></span> <span data-ttu-id="6fa96-141">而不是将每个控件使用其自己的对象数据源，但是，让我们就可以创建所有三个控件示例可以共享单个对象数据源。</span><span class="sxs-lookup"><span data-stu-id="6fa96-141">Rather than have each control using its own ObjectDataSource, however, let's just create a single ObjectDataSource that all three control examples can share.</span></span>

<span data-ttu-id="6fa96-142">打开`Basics.aspx`页上，将 ObjectDataSource 拖动从工具箱中拖动到设计器中，并单击其智能标记中的配置数据源链接。</span><span class="sxs-lookup"><span data-stu-id="6fa96-142">Open the `Basics.aspx` page, drag an ObjectDataSource from the Toolbox onto the Designer, and click the Configure Data Source link from its smart tag.</span></span> <span data-ttu-id="6fa96-143">由于`ProductsBLL`是提供编辑、 插入和删除方法，配置对象数据源以使用此类的唯一 BLL 类。</span><span class="sxs-lookup"><span data-stu-id="6fa96-143">Since the `ProductsBLL` is the only BLL class that provides editing, inserting, and deleting methods, configure the ObjectDataSource to use this class.</span></span>


<span data-ttu-id="6fa96-144">[![配置对象数据源以使用 ProductsBLL 类](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image10.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-144">[![Configure the ObjectDataSource to Use the ProductsBLL Class](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image10.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image9.png)</span></span>

<span data-ttu-id="6fa96-145">**图 5**： 配置使用 ObjectDataSource`ProductsBLL`类 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-145">**Figure 5**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image11.png))</span></span>


<span data-ttu-id="6fa96-146">我们可以在下一个屏幕中指定的哪些方法`ProductsBLL`类映射到 ObjectDataSource `Select()`， `Insert()`， `Update()`，和`Delete()`通过选择相应的选项卡，然后从下拉列表中选择该方法。</span><span class="sxs-lookup"><span data-stu-id="6fa96-146">In the next screen we can specify what methods of the `ProductsBLL` class are mapped to the ObjectDataSource's `Select()`, `Insert()`, `Update()`, and `Delete()` by selecting the appropriate tab and choosing the method from the drop-down list.</span></span> <span data-ttu-id="6fa96-147">图 6 中，应熟悉到目前为止，映射 ObjectDataSource`Select()`方法`ProductsBLL`类的`GetProducts()`方法。</span><span class="sxs-lookup"><span data-stu-id="6fa96-147">Figure 6, which should look familiar by now, maps the ObjectDataSource's `Select()` method to the `ProductsBLL` class's `GetProducts()` method.</span></span> <span data-ttu-id="6fa96-148">`Insert()`， `Update()`，和`Delete()`方法可以通过从顶部列表中选择相应的选项卡来配置。</span><span class="sxs-lookup"><span data-stu-id="6fa96-148">The `Insert()`, `Update()`, and `Delete()` methods can be configured by selecting the appropriate tab from the list along the top.</span></span>


<span data-ttu-id="6fa96-149">[![具有 ObjectDataSource 返回所有产品](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image13.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-149">[![Have the ObjectDataSource Return All of the Products](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image13.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image12.png)</span></span>

<span data-ttu-id="6fa96-150">**图 6**： 具有 ObjectDataSource 返回所有产品的 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-150">**Figure 6**: Have the ObjectDataSource Return All of the Products ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image14.png))</span></span>


<span data-ttu-id="6fa96-151">图 7、 8 和 9 显示对象数据源的更新、 插入和删除选项卡。</span><span class="sxs-lookup"><span data-stu-id="6fa96-151">Figures 7, 8, and 9 show the ObjectDataSource's UPDATE, INSERT, and DELETE tabs.</span></span> <span data-ttu-id="6fa96-152">配置这些选项卡，以便`Insert()`， `Update()`，和`Delete()`方法调用`ProductsBLL`类的`UpdateProduct`， `AddProduct`，和`DeleteProduct`方法，分别。</span><span class="sxs-lookup"><span data-stu-id="6fa96-152">Configure these tabs so that the `Insert()`, `Update()`, and `Delete()` methods invoke the `ProductsBLL` class's `UpdateProduct`, `AddProduct`, and `DeleteProduct` methods, respectively.</span></span>


<span data-ttu-id="6fa96-153">[![将对象数据源的 update （） 方法映射到 ProductBLL 类 UpdateProduct 方法](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image16.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-153">[![Map the ObjectDataSource's Update() Method to the ProductBLL Class's UpdateProduct Method](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image16.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image15.png)</span></span>

<span data-ttu-id="6fa96-154">**图 7**： 映射 ObjectDataSource`Update()`方法`ProductBLL`类的`UpdateProduct`方法 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image17.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-154">**Figure 7**: Map the ObjectDataSource's `Update()` Method to the `ProductBLL` Class's `UpdateProduct` Method ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image17.png))</span></span>


<span data-ttu-id="6fa96-155">[![将对象数据源的 Insert() 方法映射到 ProductBLL 类 AddProduct 方法](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image19.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-155">[![Map the ObjectDataSource's Insert() Method to the ProductBLL Class's AddProduct Method](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image19.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image18.png)</span></span>

<span data-ttu-id="6fa96-156">**图 8**： 映射 ObjectDataSource`Insert()`方法`ProductBLL`类的添加`Product`方法 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-156">**Figure 8**: Map the ObjectDataSource's `Insert()` Method to the `ProductBLL` Class's Add `Product` Method ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image20.png))</span></span>


<span data-ttu-id="6fa96-157">[![将对象数据源的 delete （） 方法映射到 ProductBLL 类 DeleteProduct 方法](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image22.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-157">[![Map the ObjectDataSource's Delete() Method to the ProductBLL Class's DeleteProduct Method](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image22.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image21.png)</span></span>

<span data-ttu-id="6fa96-158">**图 9**： 映射 ObjectDataSource`Delete()`方法`ProductBLL`类的`DeleteProduct`方法 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image23.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-158">**Figure 9**: Map the ObjectDataSource's `Delete()` Method to the `ProductBLL` Class's `DeleteProduct` Method ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image23.png))</span></span>


<span data-ttu-id="6fa96-159">你可能已经注意到的下拉列表中的更新、 INSERT 和删除选项卡已经有选择这些方法。</span><span class="sxs-lookup"><span data-stu-id="6fa96-159">You may have noticed that the drop-down lists in the UPDATE, INSERT, and DELETE tabs already had these methods selected.</span></span> <span data-ttu-id="6fa96-160">这是我们的使用感谢`DataObjectMethodAttribute`修饰的方法`ProducstBLL`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-160">This is thanks to our use of the `DataObjectMethodAttribute` that decorates the methods of `ProducstBLL`.</span></span> <span data-ttu-id="6fa96-161">例如，DeleteProduct 方法具有以下签名：</span><span class="sxs-lookup"><span data-stu-id="6fa96-161">For example, the DeleteProduct method has the following signature:</span></span>


[!code-vb[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample2.vb)]

<span data-ttu-id="6fa96-162">`DataObjectMethodAttribute`属性指示每个方法的目的，它是用于选择、 插入、 更新或删除和它是否是默认值。</span><span class="sxs-lookup"><span data-stu-id="6fa96-162">The `DataObjectMethodAttribute` attribute indicates the purpose of each method whether it is for selecting, inserting, updating, or deleting and whether or not it's the default value.</span></span> <span data-ttu-id="6fa96-163">如果你省略这些属性创建 BLL 类时，你将需要为手动从更新中，选择的方法插入和删除选项卡。</span><span class="sxs-lookup"><span data-stu-id="6fa96-163">If you omitted these attributes when creating your BLL classes, you'll need to manually select the methods from the UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="6fa96-164">后确保相应`ProductsBLL`方法映射到 ObjectDataSource `Insert()`， `Update()`，和`Delete()`方法，单击完成以完成向导。</span><span class="sxs-lookup"><span data-stu-id="6fa96-164">After ensuring that the appropriate `ProductsBLL` methods are mapped to the ObjectDataSource's `Insert()`, `Update()`, and `Delete()` methods, click Finish to complete the wizard.</span></span>

## <a name="examining-the-objectdatasources-markup"></a><span data-ttu-id="6fa96-165">检查对象数据源的标记</span><span class="sxs-lookup"><span data-stu-id="6fa96-165">Examining the ObjectDataSource's Markup</span></span>

<span data-ttu-id="6fa96-166">在配置后通过其向导 ObjectDataSource，转到源视图以检查生成的声明性标记。</span><span class="sxs-lookup"><span data-stu-id="6fa96-166">After configuring the ObjectDataSource through its wizard, go to the Source view to examine the generated declarative markup.</span></span> <span data-ttu-id="6fa96-167">`<asp:ObjectDataSource>`标记指定的基础对象和要调用的方法。</span><span class="sxs-lookup"><span data-stu-id="6fa96-167">The `<asp:ObjectDataSource>` tag specifies the underlying object and the methods to invoke.</span></span> <span data-ttu-id="6fa96-168">此外，还有`DeleteParameters`， `UpdateParameters`，和`InsertParameters`，它将映射到的输入参数`ProductsBLL`类的`AddProduct`， `UpdateProduct`，和`DeleteProduct`方法：</span><span class="sxs-lookup"><span data-stu-id="6fa96-168">Additionally, there are `DeleteParameters`, `UpdateParameters`, and `InsertParameters` that map to the input parameters for the `ProductsBLL` class's `AddProduct`, `UpdateProduct`, and `DeleteProduct` methods:</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample3.aspx)]

<span data-ttu-id="6fa96-169">ObjectDataSource 包含一个参数为每个输入参数的关联方法，就像一份`SelectParameter`s 时的存在时配置 ObjectDataSource 调用要求输入的参数的选择方法 (如`GetProductsByCategoryID(categoryID)`).</span><span class="sxs-lookup"><span data-stu-id="6fa96-169">The ObjectDataSource includes a parameter for each of the input parameters for its associated methods, just like a list of `SelectParameter` s is present when the ObjectDataSource is configured to call a select method that expects an input parameter (such as `GetProductsByCategoryID(categoryID)`).</span></span> <span data-ttu-id="6fa96-170">正如我们将很快，看到这些值`DeleteParameters`， `UpdateParameters`，和`InsertParameters`自动和设置的 GridView，说明如何，FormView 之前调用 ObjectDataSource `Insert()`， `Update()`，或`Delete()`方法。</span><span class="sxs-lookup"><span data-stu-id="6fa96-170">As we'll see shortly, values for these `DeleteParameters`, `UpdateParameters`, and `InsertParameters` are set automatically by the GridView, DetailsView, and FormView prior to invoking the ObjectDataSource's `Insert()`, `Update()`, or `Delete()` method.</span></span> <span data-ttu-id="6fa96-171">这些值在为在将来的教程，我们将讨论还可以根据需要以编程方式设置。</span><span class="sxs-lookup"><span data-stu-id="6fa96-171">These values can also be set programmatically as needed, as we'll discuss in a future tutorial.</span></span>

<span data-ttu-id="6fa96-172">使用向导将配置为对象数据源的一个副作用是 Visual Studio 将设置[OldValuesParameterFormatString 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.oldvaluesparameterformatstring(VS.80).aspx)到`original_{0}`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-172">One side effect of using the wizard to configure to ObjectDataSource is that Visual Studio sets the [OldValuesParameterFormatString property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.oldvaluesparameterformatstring(VS.80).aspx) to `original_{0}`.</span></span> <span data-ttu-id="6fa96-173">此属性的值可用于包括正在编辑的数据的原始值，并在两种方案中非常有用：</span><span class="sxs-lookup"><span data-stu-id="6fa96-173">This property value is used to include the original values of the data being edited and is useful in two scenarios:</span></span>

- <span data-ttu-id="6fa96-174">如果在编辑记录时，用户就能够更改的主键值。</span><span class="sxs-lookup"><span data-stu-id="6fa96-174">If, when editing a record, users are able to change the primary key value.</span></span> <span data-ttu-id="6fa96-175">在这种情况下，新的主键值和原始的主键值必须提供，以便原始主键值的记录可以找到并将相应地更新其值。</span><span class="sxs-lookup"><span data-stu-id="6fa96-175">In this case, both the new primary key value and the original primary key value must be provided so that the record with the original primary key value can be found and have its value updated accordingly.</span></span>
- <span data-ttu-id="6fa96-176">当使用开放式并发。</span><span class="sxs-lookup"><span data-stu-id="6fa96-176">When using optimistic concurrency.</span></span> <span data-ttu-id="6fa96-177">乐观并发是一种技术，以确保两个同时进行的用户不会覆盖彼此的所做更改，并且是将来的教程主题。</span><span class="sxs-lookup"><span data-stu-id="6fa96-177">Optimistic concurrency is a technique to ensure that two simultaneous users don't overwrite one another's changes, and is the topic for a future tutorial.</span></span>

<span data-ttu-id="6fa96-178">`OldValuesParameterFormatString`属性指示的基础对象的更新和删除方法的原始值中的输入参数的名称。</span><span class="sxs-lookup"><span data-stu-id="6fa96-178">The `OldValuesParameterFormatString` property indicates the name of the input parameters in the underlying object's update and delete methods for the original values.</span></span> <span data-ttu-id="6fa96-179">我们探讨乐观并发，我们将讨论此属性，并且更详细介绍其用途。</span><span class="sxs-lookup"><span data-stu-id="6fa96-179">We'll discuss this property and its purpose in greater detail when we explore optimistic concurrency.</span></span> <span data-ttu-id="6fa96-180">我显示它现在，但是，因为我们 BLL 方法不需要原始值，因此很重要，我们删除此属性。</span><span class="sxs-lookup"><span data-stu-id="6fa96-180">I bring it up now, however, because our BLL's methods do not expect the original values and therefore it's important that we remove this property.</span></span> <span data-ttu-id="6fa96-181">离开`OldValuesParameterFormatString`属性设置为默认值之外的任何内容 (`{0}`) 会导致错误，当尝试调用对象数据源的数据 Web 控件`Update()`或`Delete()`方法因为 ObjectDataSource 将尝试同时传入`UpdateParameters`或`DeleteParameters`以及原始值参数指定。</span><span class="sxs-lookup"><span data-stu-id="6fa96-181">Leaving the `OldValuesParameterFormatString` property set to anything other than the default (`{0}`) will cause an error when a data Web control attempts to invoke the ObjectDataSource's `Update()` or `Delete()` methods because the ObjectDataSource will attempt to pass in both the `UpdateParameters` or `DeleteParameters` specified as well as original value parameters.</span></span>

<span data-ttu-id="6fa96-182">如果不是特别清除此时，别担心，我们将在将来的教程中检查此属性和它的实用。</span><span class="sxs-lookup"><span data-stu-id="6fa96-182">If this isn't terribly clear at this juncture, don't worry, we'll examine this property and its utility in a future tutorial.</span></span> <span data-ttu-id="6fa96-183">现在，只是某些声明性语法中完全移除此属性声明或将值设置为默认值 （{0}）。</span><span class="sxs-lookup"><span data-stu-id="6fa96-183">For now, just be certain to either remove this property declaration entirely from the declarative syntax or set the value to the default value ({0}).</span></span>

> [!NOTE]
> <span data-ttu-id="6fa96-184">如果你只需清除`OldValuesParameterFormatString`于在设计视图中，该属性的属性窗口的属性值将仍然存在于声明性语法，但将设置为空字符串。</span><span class="sxs-lookup"><span data-stu-id="6fa96-184">If you simply clear out the `OldValuesParameterFormatString` property value from the Properties window in the Design view, the property will still exist in the declarative syntax, but be set to an empty string.</span></span> <span data-ttu-id="6fa96-185">此操作，请遗憾的是，仍会导致上述相同问题。</span><span class="sxs-lookup"><span data-stu-id="6fa96-185">This, unfortunately, will still result in the same problem discussed above.</span></span> <span data-ttu-id="6fa96-186">因此，删除属性完全声明性语法，或从属性窗口中，将值设置为默认情况下， `{0}`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-186">Therefore, either remove the property altogether from the declarative syntax or, from the Properties window, set the value to the default, `{0}`.</span></span>


## <a name="step-3-adding-a-data-web-control-and-configuring-it-for-data-modification"></a><span data-ttu-id="6fa96-187">步骤 3： 添加数据 Web 控件，并将其配置针对数据修改</span><span class="sxs-lookup"><span data-stu-id="6fa96-187">Step 3: Adding a Data Web Control and Configuring It for Data Modification</span></span>

<span data-ttu-id="6fa96-188">添加到页面并配置对象数据源后，我们已准备好将数据 Web 控件添加到页后，可以同时显示数据，并提供最终用户对其进行修改的一种方法。</span><span class="sxs-lookup"><span data-stu-id="6fa96-188">Once the ObjectDataSource has been added to the page and configured, we're ready to add data Web controls to the page to both display the data and provide a means for the end user to modify it.</span></span> <span data-ttu-id="6fa96-189">我们将考察的 GridView，说明如何和 FormView 单独，因为这些数据 Web 控件在其数据修改功能和配置都不同。</span><span class="sxs-lookup"><span data-stu-id="6fa96-189">We'll look at the GridView, DetailsView, and FormView separately, as these data Web controls differ in their data modification capabilities and configuration.</span></span>

<span data-ttu-id="6fa96-190">我们将看到本文的其余部分中添加非常基本编辑、 插入和删除通过 GridView，说明如何，支持以及 FormView 控制是真正简单，只检查几个复选框。</span><span class="sxs-lookup"><span data-stu-id="6fa96-190">As we'll see in the remainder of this article, adding very basic editing, inserting, and deleting support through the GridView, DetailsView, and FormView controls is really as simple as checking a couple of checkboxes.</span></span> <span data-ttu-id="6fa96-191">有许多细微部分和在现实世界的边缘情况，以提供更多地涉及不是只需点，然后单击此类功能。</span><span class="sxs-lookup"><span data-stu-id="6fa96-191">There are many subtleties and edge cases in the real-world that make providing such functionality more involved than just point and click.</span></span> <span data-ttu-id="6fa96-192">本教程中，但是，着重依赖证明非常简单的数据修改功能。</span><span class="sxs-lookup"><span data-stu-id="6fa96-192">This tutorial, however, focuses solely on proving simplistic data modification capabilities.</span></span> <span data-ttu-id="6fa96-193">将来的教程将检查必定会在实际设置中出现的问题。</span><span class="sxs-lookup"><span data-stu-id="6fa96-193">Future tutorials will examine concerns that will undoubtedly arise in a real-world setting.</span></span>

## <a name="deleting-data-from-the-gridview"></a><span data-ttu-id="6fa96-194">从 GridView 删除数据</span><span class="sxs-lookup"><span data-stu-id="6fa96-194">Deleting Data from the GridView</span></span>

<span data-ttu-id="6fa96-195">通过从工具箱中拖动到设计器中拖动一个 GridView 启动。</span><span class="sxs-lookup"><span data-stu-id="6fa96-195">Start by dragging a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="6fa96-196">接下来，将对象数据源绑定到 GridView，通过从 GridView 的智能标记中的下拉列表中选择它。</span><span class="sxs-lookup"><span data-stu-id="6fa96-196">Next, bind the ObjectDataSource to the GridView by selecting it from the drop-down list in the GridView's smart tag.</span></span> <span data-ttu-id="6fa96-197">此时将为 GridView 的声明性标记：</span><span class="sxs-lookup"><span data-stu-id="6fa96-197">At this point the GridView's declarative markup will be:</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample4.aspx)]

<span data-ttu-id="6fa96-198">绑定到通过其智能标记 ObjectDataSource 的 GridView 有两个好处：</span><span class="sxs-lookup"><span data-stu-id="6fa96-198">Binding the GridView to the ObjectDataSource through its smart tag has two benefits:</span></span>

- <span data-ttu-id="6fa96-199">自动为每个对象数据源返回的字段创建 BoundFields 和 CheckBoxFields。</span><span class="sxs-lookup"><span data-stu-id="6fa96-199">BoundFields and CheckBoxFields are automatically created for each of the fields returned by the ObjectDataSource.</span></span> <span data-ttu-id="6fa96-200">此外，BoundField 和 CheckBoxField 的属性是根据设置的基础字段元数据。</span><span class="sxs-lookup"><span data-stu-id="6fa96-200">Moreover, the BoundField and CheckBoxField's properties are set based on the underlying field's metadata.</span></span> <span data-ttu-id="6fa96-201">例如， `ProductID`， `CategoryName`，和`SupplierName`字段都标记为只读中`ProductsDataTable`，因此不应是可更新在编辑时。</span><span class="sxs-lookup"><span data-stu-id="6fa96-201">For example, the `ProductID`, `CategoryName`, and `SupplierName` fields are marked as read-only in the `ProductsDataTable` and therefore shouldn't be updatable when editing.</span></span> <span data-ttu-id="6fa96-202">若要容纳此，则这些 BoundFields [ReadOnly 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.boundfield.readonly(VS.80).aspx)设置为`True`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-202">To accommodate this, these BoundFields' [ReadOnly properties](https://msdn.microsoft.com/library/system.web.ui.webcontrols.boundfield.readonly(VS.80).aspx) are set to `True`.</span></span>
- <span data-ttu-id="6fa96-203">[将字段名](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.datakeynames(VS.80).aspx)分配给基础对象的主键字段。</span><span class="sxs-lookup"><span data-stu-id="6fa96-203">The [DataKeyNames property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.datakeynames(VS.80).aspx) is assigned to the primary key field(s) of the underlying object.</span></span> <span data-ttu-id="6fa96-204">这是必不可少的时使用 GridView 进行编辑或删除数据，此属性指示的字段 （或集的字段），它唯一标识每个记录。</span><span class="sxs-lookup"><span data-stu-id="6fa96-204">This is essential when using the GridView for editing or deleting data, as this property indicates the field (or set of fields) that unique identifies each record.</span></span> <span data-ttu-id="6fa96-205">有关详细信息`DataKeyNames`属性，回头参考[母版/详细介绍使用详细信息 DetailView 可选择的主 GridView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="6fa96-205">For more information on the `DataKeyNames` property, refer back to the [Master/Detail Using a Selectable Master GridView with a Details DetailView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md) tutorial.</span></span>

<span data-ttu-id="6fa96-206">虽然 GridView 可以绑定到通过属性窗口或声明性语法，ObjectDataSource，执行此操作需要你手动添加相应的 BoundField 和`DataKeyNames`标记。</span><span class="sxs-lookup"><span data-stu-id="6fa96-206">While the GridView can be bound to the ObjectDataSource through the Properties window or declarative syntax, doing so requires you to manually add the appropriate BoundField and `DataKeyNames` markup.</span></span>

<span data-ttu-id="6fa96-207">GridView 控件提供对行级别编辑和删除的内置支持。</span><span class="sxs-lookup"><span data-stu-id="6fa96-207">The GridView control provides built-in support for row-level editing and deleting.</span></span> <span data-ttu-id="6fa96-208">配置以支持删除一个 GridView 添加一列删除按钮。</span><span class="sxs-lookup"><span data-stu-id="6fa96-208">Configuring a GridView to support deleting adds a column of Delete buttons.</span></span> <span data-ttu-id="6fa96-209">当最终用户单击特定行的删除按钮时，回发时，才会和 GridView 执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="6fa96-209">When the end user clicks the Delete button for a particular row, a postback ensues and the GridView performs the following steps:</span></span>

1. <span data-ttu-id="6fa96-210">ObjectDataSource`DeleteParameters`分配值</span><span class="sxs-lookup"><span data-stu-id="6fa96-210">The ObjectDataSource's `DeleteParameters` value(s) are assigned</span></span>
2. <span data-ttu-id="6fa96-211">ObjectDataSource`Delete()`调用方法时，删除指定的记录</span><span class="sxs-lookup"><span data-stu-id="6fa96-211">The ObjectDataSource's `Delete()` method is invoked, deleting the specified record</span></span>
3. <span data-ttu-id="6fa96-212">GridView 重新绑定次数本身 ObjectDataSource 到通过调用其`Select()`方法</span><span class="sxs-lookup"><span data-stu-id="6fa96-212">The GridView rebinds itself to the ObjectDataSource by invoking its `Select()` method</span></span>

<span data-ttu-id="6fa96-213">分配给的值`DeleteParameters`的值`DataKeyNames`其删除按钮被单击的行的字段。</span><span class="sxs-lookup"><span data-stu-id="6fa96-213">The values assigned to the `DeleteParameters` are the values of the `DataKeyNames` field(s) for the row whose Delete button was clicked.</span></span> <span data-ttu-id="6fa96-214">因此，它是重要的 GridView`DataKeyNames`正确设置属性。</span><span class="sxs-lookup"><span data-stu-id="6fa96-214">Therefore it's vital that a GridView's `DataKeyNames` property be correctly set.</span></span> <span data-ttu-id="6fa96-215">如果缺少，`DeleteParameters`将被赋的值`Nothing`在步骤 1 中，这反过来不会导致在步骤 2 中任何已删除的记录。</span><span class="sxs-lookup"><span data-stu-id="6fa96-215">If it's missing, the `DeleteParameters` will be assigned a value of `Nothing` in Step 1, which in turn will not result in any deleted records in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="6fa96-216">`DataKeys`集合存储在 GridView 的控件状态，这意味着，`DataKeys`值将保存在回发，即使已禁用的 GridView 的视图状态。</span><span class="sxs-lookup"><span data-stu-id="6fa96-216">The `DataKeys` collection is stored in the GridView s control state, meaning that the `DataKeys` values will be remembered across postback even if the GridView s view state has been disabled.</span></span> <span data-ttu-id="6fa96-217">但是，它是非常重要的视图状态的支持编辑或删除 （默认行为） 的 GridViews 将保持启用状态。</span><span class="sxs-lookup"><span data-stu-id="6fa96-217">However, it is very important that view state remains enabled for GridViews that support editing or deleting (the default behavior).</span></span> <span data-ttu-id="6fa96-218">如果设置 GridView s`EnableViewState`属性`false`、 编辑和删除行为将效果不错，适用于单个用户，但如果没有删除数据的并发用户，存在这些并发的用户可能意外的可能性删除或编辑记录他们没有 t 想。</span><span class="sxs-lookup"><span data-stu-id="6fa96-218">If you set the GridView s `EnableViewState` property to `false`, the editing and deleting behavior will work fine for a single user, but if there are concurrent users deleting data, there exists the possibility that these concurrent users may accidentally delete or edit records that they didn t intend.</span></span> <span data-ttu-id="6fa96-219">请参阅我博客文章[警告： 禁用并发问题与 ASP.NET 2.0 GridViews/说明/FormViews 该支持编辑和/或删除和其视图状态](http://scottonwriting.net/sowblog/posts/10054.aspx)，有关详细信息。</span><span class="sxs-lookup"><span data-stu-id="6fa96-219">See my blog entry, [WARNING: Concurrency Issue with ASP.NET 2.0 GridViews/DetailsView/FormViews that Support Editing and/or Deleting and Whose View State is Disabled](http://scottonwriting.net/sowblog/posts/10054.aspx), for more information.</span></span>


<span data-ttu-id="6fa96-220">此相同警告也适用于 DetailsViews 和 FormViews。</span><span class="sxs-lookup"><span data-stu-id="6fa96-220">This same warning also applies to DetailsViews and FormViews.</span></span>

<span data-ttu-id="6fa96-221">若要将删除的功能添加到一个 GridView，只需转到其智能标记，并选中启用删除复选框。</span><span class="sxs-lookup"><span data-stu-id="6fa96-221">To add deleting capabilities to a GridView, simply go to its smart tag and check the Enable Deleting checkbox.</span></span>


![检查删除复选框启用](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image24.png)

<span data-ttu-id="6fa96-223">**图 10**： 检查删除复选框启用</span><span class="sxs-lookup"><span data-stu-id="6fa96-223">**Figure 10**: Check the Enable Deleting Checkbox</span></span>


<span data-ttu-id="6fa96-224">检查从智能标记启用删除复选框将 CommandField 添加到 GridView。</span><span class="sxs-lookup"><span data-stu-id="6fa96-224">Checking the Enable Deleting checkbox from the smart tag adds a CommandField to the GridView.</span></span> <span data-ttu-id="6fa96-225">CommandField 呈现其中包括用于执行一个或多个以下任务按钮 GridView 中的列： 选择记录，编辑记录，并删除一条记录。</span><span class="sxs-lookup"><span data-stu-id="6fa96-225">The CommandField renders a column in the GridView with buttons for performing one or more of the following tasks: selecting a record, editing a record, and deleting a record.</span></span> <span data-ttu-id="6fa96-226">我们以前看到的那样操作选择中的记录中 CommandField[母版/详细介绍使用详细信息 DetailView 可选择的主 GridView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="6fa96-226">We previously saw the CommandField in action with selecting records in the [Master/Detail Using a Selectable Master GridView with a Details DetailView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md) tutorial.</span></span>

<span data-ttu-id="6fa96-227">CommandField 包含大量`ShowXButton`指示哪些系列按钮显示 CommandField 中的属性。</span><span class="sxs-lookup"><span data-stu-id="6fa96-227">The CommandField contains a number of `ShowXButton` properties that indicate what series of buttons are displayed in the CommandField.</span></span> <span data-ttu-id="6fa96-228">通过检查启用删除复选框 CommandField 其`ShowDeleteButton`属性是`True`已添加到 GridView 的列集合。</span><span class="sxs-lookup"><span data-stu-id="6fa96-228">By checking the Enable Deleting checkbox a CommandField whose `ShowDeleteButton` property is `True` has been added to the GridView's Columns collection.</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample5.aspx)]

<span data-ttu-id="6fa96-229">此时，无论您相信与否，我们已经完成了将删除的支持添加到 GridView ！</span><span class="sxs-lookup"><span data-stu-id="6fa96-229">At this point, believe it or not, we're done with adding deleting support to the GridView!</span></span> <span data-ttu-id="6fa96-230">如图 11 所示，当访问此页通过浏览器的删除按钮列不存在。</span><span class="sxs-lookup"><span data-stu-id="6fa96-230">As Figure 11 shows, when visiting this page through a browser a column of Delete buttons is present.</span></span>


<span data-ttu-id="6fa96-231">[![CommandField 添加一列删除按钮](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image26.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-231">[![The CommandField Adds a Column of Delete Buttons](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image26.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image25.png)</span></span>

<span data-ttu-id="6fa96-232">**图 11**: CommandField 添加了列的删除按钮 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-232">**Figure 11**: The CommandField Adds a Column of Delete Buttons ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image27.png))</span></span>


<span data-ttu-id="6fa96-233">如果您生成此教程组成的基本组件上你自己，测试单击此页时删除按钮将引发异常。</span><span class="sxs-lookup"><span data-stu-id="6fa96-233">If you've been building this tutorial from the ground up on your own, when testing this page clicking the Delete button will raise an exception.</span></span> <span data-ttu-id="6fa96-234">继续阅读以了解有关为什么引发这些异常以及如何修复它们。</span><span class="sxs-lookup"><span data-stu-id="6fa96-234">Continue reading to learn as to why these exceptions were raised and how to fix them.</span></span>

> [!NOTE]
> <span data-ttu-id="6fa96-235">如果您一直使用下载随附本教程中，具有已说明这些问题。</span><span class="sxs-lookup"><span data-stu-id="6fa96-235">If you're following along using the download accompanying this tutorial, these problems have already been accounted for.</span></span> <span data-ttu-id="6fa96-236">但是，我建议你通读下面列出以帮助识别可能出现的问题和合适的解决方法的详细信息。</span><span class="sxs-lookup"><span data-stu-id="6fa96-236">However, I encourage you to read through the details listed below to help identify problems that may arise and suitable workarounds.</span></span>


<span data-ttu-id="6fa96-237">如果尝试删除产品时, 获取的异常的消息是类似于"*ObjectDataSource ObjectDataSource1 找不到非泛型方法 DeleteProduct 具有参数： productID，原始\_ProductID*，"你可能忘记删除`OldValuesParameterFormatString`从 ObjectDataSource 的属性。</span><span class="sxs-lookup"><span data-stu-id="6fa96-237">If, when attempting to delete a product, you get an exception whose message is similar to "*ObjectDataSource 'ObjectDataSource1' could not find a non-generic method 'DeleteProduct' that has parameters: productID, original\_ProductID*," you likely forgot to remove the `OldValuesParameterFormatString` property from the ObjectDataSource.</span></span> <span data-ttu-id="6fa96-238">与`OldValuesParameterFormatString`指定属性，ObjectDataSource 尝试传递中都`productID`和`original_ProductID`输入参数为`DeleteProduct`方法。</span><span class="sxs-lookup"><span data-stu-id="6fa96-238">With the `OldValuesParameterFormatString` property specified, the ObjectDataSource attempts to pass in both `productID` and `original_ProductID` input parameters to the `DeleteProduct` method.</span></span> <span data-ttu-id="6fa96-239">`DeleteProduct`但是，仅接受一个输入的参数，因此异常。</span><span class="sxs-lookup"><span data-stu-id="6fa96-239">`DeleteProduct`, however, only accepts a single input parameter, hence the exception.</span></span> <span data-ttu-id="6fa96-240">删除`OldValuesParameterFormatString`属性 (或将它设置为`{0}`) 指示 ObjectDataSource 不要尝试在原始的输入参数中传递。</span><span class="sxs-lookup"><span data-stu-id="6fa96-240">Removing the `OldValuesParameterFormatString` property (or setting it to `{0}`) instructs the ObjectDataSource to not attempt to pass in the original input parameter.</span></span>


<span data-ttu-id="6fa96-241">[![确保 OldValuesParameterFormatString 属性已被清除](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image29.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-241">[![Ensure That the OldValuesParameterFormatString Property Has Been Cleared Out](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image29.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image28.png)</span></span>

<span data-ttu-id="6fa96-242">**图 12**： 确保`OldValuesParameterFormatString`属性已被清除出 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-242">**Figure 12**: Ensure That the `OldValuesParameterFormatString` Property Has Been Cleared Out ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image30.png))</span></span>


<span data-ttu-id="6fa96-243">即使您已经删除`OldValuesParameterFormatString`属性，你仍将发生异常时尝试删除具有消息的产品:"*DELETE 语句与的引用约束冲突 FK\_顺序\_详细信息\_产品的*。"Northwind 数据库包含之间的外键约束`Order Details`和`Products`表，这意味着在有一个或多个记录中为其无法从系统删除一种产品`Order Details`表。</span><span class="sxs-lookup"><span data-stu-id="6fa96-243">Even if you had removed the `OldValuesParameterFormatString` property, you still will get an exception when trying to delete a product with the message: "*The DELETE statement conflicted with the REFERENCE constraint 'FK\_Order\_Details\_Products'*." The Northwind database contains a foreign key constraint between the `Order Details` and `Products` table, meaning that a product cannot be deleted from the system if there are one or more records for it in the `Order Details` table.</span></span> <span data-ttu-id="6fa96-244">由于 Northwind 数据库中的每个产品具有至少一个记录`Order Details`，我们首先删除该产品的关联的订单详细信息记录之前，我们无法删除任何产品。</span><span class="sxs-lookup"><span data-stu-id="6fa96-244">Since every product in the Northwind database has at least one record in `Order Details`, we cannot delete any products until we first delete the product's associated order details records.</span></span>


<span data-ttu-id="6fa96-245">[![外键约束禁止将删除产品](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image32.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-245">[![A Foreign Key Constraint Prohibits the Deletion of Products](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image32.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image31.png)</span></span>

<span data-ttu-id="6fa96-246">**图 13**： 外键约束禁止删除的产品 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-246">**Figure 13**: A Foreign Key Constraint Prohibits the Deletion of Products ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image33.png))</span></span>


<span data-ttu-id="6fa96-247">我们的教程，让我们只需删除所有从记录`Order Details`表。</span><span class="sxs-lookup"><span data-stu-id="6fa96-247">For our tutorial, let's just delete all of the records from the `Order Details` table.</span></span> <span data-ttu-id="6fa96-248">在实际应用程序中，我们将需要为：</span><span class="sxs-lookup"><span data-stu-id="6fa96-248">In a real-world application we'd need to either:</span></span>

- <span data-ttu-id="6fa96-249">具有管理订单详细信息信息的另一个屏幕</span><span class="sxs-lookup"><span data-stu-id="6fa96-249">Have another screen to manage order details information</span></span>
- <span data-ttu-id="6fa96-250">增加`DeleteProduct`方法以包括逻辑来删除指定的产品的订单详细信息</span><span class="sxs-lookup"><span data-stu-id="6fa96-250">Augment the `DeleteProduct` method to include logic to delete the specified product's order details</span></span>
- <span data-ttu-id="6fa96-251">修改 TableAdapter 用于包括删除指定的产品的订单详细信息的 SQL 查询</span><span class="sxs-lookup"><span data-stu-id="6fa96-251">Modify the SQL query used by the TableAdapter to include deletion of the specified product's order details</span></span>

<span data-ttu-id="6fa96-252">让我们只需删除所有从记录`Order Details`若要避免的外键约束的表。</span><span class="sxs-lookup"><span data-stu-id="6fa96-252">Let's just delete all of the records from the `Order Details` table to circumvent the foreign key constraint.</span></span> <span data-ttu-id="6fa96-253">请转到 Visual Studio 中的服务器资源管理器，右键单击`NORTHWND.MDF`节点，然后选择新查询。</span><span class="sxs-lookup"><span data-stu-id="6fa96-253">Go to the Server Explorer in Visual Studio, right-click on the `NORTHWND.MDF` node, and choose New Query.</span></span> <span data-ttu-id="6fa96-254">然后，在查询窗口中，运行以下 SQL 语句： `DELETE FROM [Order Details]`</span><span class="sxs-lookup"><span data-stu-id="6fa96-254">Then, in the query window, run the following SQL statement: `DELETE FROM [Order Details]`</span></span>


<span data-ttu-id="6fa96-255">[![从详细信息表中删除所有记录](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image35.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-255">[![Delete All Records from the Order Details Table](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image35.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image34.png)</span></span>

<span data-ttu-id="6fa96-256">**图 14**： 删除所有记录`Order Details`表 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-256">**Figure 14**: Delete All Records from the `Order Details` Table ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image36.png))</span></span>


<span data-ttu-id="6fa96-257">后清除`Order Details`表，单击删除按钮将删除产品而未出现错误。</span><span class="sxs-lookup"><span data-stu-id="6fa96-257">After clearing out the `Order Details` table clicking on the Delete button will delete the product without error.</span></span> <span data-ttu-id="6fa96-258">如果单击删除按钮不会删除该产品，请检查以确保 GridView`DataKeyNames`属性设置为的主键字段 (`ProductID`)。</span><span class="sxs-lookup"><span data-stu-id="6fa96-258">If clicking on the Delete button does not delete the product, check to ensure that the GridView's `DataKeyNames` property is set to the primary key field (`ProductID`).</span></span>

> [!NOTE]
> <span data-ttu-id="6fa96-259">单击删除按钮时回发时，才会并删除该记录。</span><span class="sxs-lookup"><span data-stu-id="6fa96-259">When clicking on the Delete button a postback ensues and the record is deleted.</span></span> <span data-ttu-id="6fa96-260">这可能会十分危险，因为很容易意外单击错误行删除按钮。</span><span class="sxs-lookup"><span data-stu-id="6fa96-260">This can be dangerous since it is easy to accidentally click on the wrong row's Delete button.</span></span> <span data-ttu-id="6fa96-261">在将来的教程中我们将了解如何添加客户端确认删除一条记录时。</span><span class="sxs-lookup"><span data-stu-id="6fa96-261">In a future tutorial we'll see how to add a client-side confirmation when deleting a record.</span></span>


## <a name="editing-data-with-the-gridview"></a><span data-ttu-id="6fa96-262">编辑数据与 GridView</span><span class="sxs-lookup"><span data-stu-id="6fa96-262">Editing Data with the GridView</span></span>

<span data-ttu-id="6fa96-263">以及删除 GridView 控件还提供内置的行级编辑支持。</span><span class="sxs-lookup"><span data-stu-id="6fa96-263">Along with deleting, the GridView control also provides built-in row-level editing support.</span></span> <span data-ttu-id="6fa96-264">配置一个 GridView，若要支持编辑添加编辑按钮的列。</span><span class="sxs-lookup"><span data-stu-id="6fa96-264">Configuring a GridView to support editing adds a column of Edit buttons.</span></span> <span data-ttu-id="6fa96-265">从最终用户的角度来看，单击某一行的编辑按钮，将使该行成为可编辑，到文本框中包含的现有值并将与更新的编辑按钮和取消按钮启用单元格。</span><span class="sxs-lookup"><span data-stu-id="6fa96-265">From the end user's perspective, clicking a row's Edit button causes that row to become editable, turning the cells into textboxes containing the existing values and replacing the Edit button with Update and Cancel buttons.</span></span> <span data-ttu-id="6fa96-266">进行其所需的更改后，最终用户可以单击更新按钮以提交更改或丢弃这些取消按钮。</span><span class="sxs-lookup"><span data-stu-id="6fa96-266">After making their desired changes, the end user can click the Update button to commit the changes or the Cancel button to discard them.</span></span> <span data-ttu-id="6fa96-267">在任一情况下，单击更新或取消按钮后 GridView 恢复为其预编辑状态。</span><span class="sxs-lookup"><span data-stu-id="6fa96-267">In either case, after clicking Update or Cancel the GridView returns to its pre-editing state.</span></span>

<span data-ttu-id="6fa96-268">从作为页开发人员，我们透视时最终用户单击特定行的编辑按钮时，回发时，才会和 GridView 执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="6fa96-268">From our perspective as the page developer, when the end user clicks the Edit button for a particular row, a postback ensues and the GridView performs the following steps:</span></span>

1. <span data-ttu-id="6fa96-269">GridView`EditItemIndex`属性分配给其编辑按钮被单击的行的索引</span><span class="sxs-lookup"><span data-stu-id="6fa96-269">The GridView's `EditItemIndex` property is assigned to the index of the row whose Edit button was clicked</span></span>
2. <span data-ttu-id="6fa96-270">GridView 重新绑定次数本身 ObjectDataSource 到通过调用其`Select()`方法</span><span class="sxs-lookup"><span data-stu-id="6fa96-270">The GridView rebinds itself to the ObjectDataSource by invoking its `Select()` method</span></span>
3. <span data-ttu-id="6fa96-271">与匹配的行索引`EditItemIndex`呈现在"编辑模式。</span><span class="sxs-lookup"><span data-stu-id="6fa96-271">The row index that matches the `EditItemIndex` is rendered in "edit mode."</span></span> <span data-ttu-id="6fa96-272">在此模式下，编辑按钮替换为更新和取消按钮和 BoundFields 其`ReadOnly`属性为 False （默认值） 作为文本框中 Web 控件的呈现`Text`属性分配给数据字段的值。</span><span class="sxs-lookup"><span data-stu-id="6fa96-272">In this mode, the Edit button is replaced by Update and Cancel buttons and BoundFields whose `ReadOnly` properties are False (the default) are rendered as TextBox Web controls whose `Text` properties are assigned to the data fields' values.</span></span>

<span data-ttu-id="6fa96-273">在此点标记返回到浏览器中，这样就允许最终用户对行的数据进行任何更改。</span><span class="sxs-lookup"><span data-stu-id="6fa96-273">At this point the markup is returned to the browser, allowing the end user to make any changes to the row's data.</span></span> <span data-ttu-id="6fa96-274">当用户单击更新按钮时，产生的回发，GridView 执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="6fa96-274">When the user clicks the Update button, a postback occurs and the GridView performs the following steps:</span></span>

1. <span data-ttu-id="6fa96-275">ObjectDataSource`UpdateParameters`值分配到 GridView 的编辑界面的最终用户输入的值</span><span class="sxs-lookup"><span data-stu-id="6fa96-275">The ObjectDataSource's `UpdateParameters` value(s) are assigned the values entered by the end user into the GridView's editing interface</span></span>
2. <span data-ttu-id="6fa96-276">ObjectDataSource`Update()`调用方法时，更新指定的记录</span><span class="sxs-lookup"><span data-stu-id="6fa96-276">The ObjectDataSource's `Update()` method is invoked, updating the specified record</span></span>
3. <span data-ttu-id="6fa96-277">GridView 重新绑定次数本身 ObjectDataSource 到通过调用其`Select()`方法</span><span class="sxs-lookup"><span data-stu-id="6fa96-277">The GridView rebinds itself to the ObjectDataSource by invoking its `Select()` method</span></span>

<span data-ttu-id="6fa96-278">分配给主键值`UpdateParameters`在步骤 1 中来自中指定的值`DataKeyNames`属性，而非主键值来自中编辑过的行的文本框中 Web 控件的文本。</span><span class="sxs-lookup"><span data-stu-id="6fa96-278">The primary key values assigned to the `UpdateParameters` in Step 1 come from the values specified in the `DataKeyNames` property, whereas the non-primary key values come from the text in the TextBox Web controls for the edited row.</span></span> <span data-ttu-id="6fa96-279">如与删除，它是至关重要的 GridView`DataKeyNames`正确设置属性。</span><span class="sxs-lookup"><span data-stu-id="6fa96-279">As with deleting, it is vital that a GridView's `DataKeyNames` property be correctly set.</span></span> <span data-ttu-id="6fa96-280">如果缺少，`UpdateParameters`主键值将为其赋值的`Nothing`在步骤 1 中，这反过来不会导致在步骤 2 中的任何更新的记录。</span><span class="sxs-lookup"><span data-stu-id="6fa96-280">If it's missing, the `UpdateParameters` primary key value will be assigned a value of `Nothing` in Step 1, which in turn will not result in any updated records in Step 2.</span></span>

<span data-ttu-id="6fa96-281">可以通过只需检查 GridView 的智能标记中的启用编辑复选框激活编辑功能。</span><span class="sxs-lookup"><span data-stu-id="6fa96-281">Editing functionality can be activated by simply checking the Enable Editing checkbox in the GridView's smart tag.</span></span>


![检查编辑复选框启用](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image37.png)

<span data-ttu-id="6fa96-283">**图 15**： 检查编辑复选框启用</span><span class="sxs-lookup"><span data-stu-id="6fa96-283">**Figure 15**: Check the Enable Editing Checkbox</span></span>


<span data-ttu-id="6fa96-284">检查启用编辑复选框将添加 CommandField （是否需要） 并设置其`ShowEditButton`属性`True`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-284">Checking the Enable Editing checkbox will add a CommandField (if needed) and set its `ShowEditButton` property to `True`.</span></span> <span data-ttu-id="6fa96-285">CommandField 前面看到的如包含大量的`ShowXButton`指示哪些系列按钮显示 CommandField 中的属性。</span><span class="sxs-lookup"><span data-stu-id="6fa96-285">As we saw earlier, the CommandField contains a number of `ShowXButton` properties that indicate what series of buttons are displayed in the CommandField.</span></span> <span data-ttu-id="6fa96-286">检查启用编辑复选框添加`ShowEditButton`现有 CommandField 属性：</span><span class="sxs-lookup"><span data-stu-id="6fa96-286">Checking the Enable Editing checkbox adds the `ShowEditButton` property to the existing CommandField:</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample6.aspx)]

<span data-ttu-id="6fa96-287">这就是所有到添加基本的编辑支持。</span><span class="sxs-lookup"><span data-stu-id="6fa96-287">That's all there is to adding rudimentary editing support.</span></span> <span data-ttu-id="6fa96-288">编辑接口是相当不成熟如 Figure16 所示，每个 BoundField 其`ReadOnly`属性设置为`False`（默认值） 呈现为文本框。</span><span class="sxs-lookup"><span data-stu-id="6fa96-288">As Figure16 shows, the editing interface is rather crude each BoundField whose `ReadOnly` property is set to `False` (the default) is rendered as a TextBox.</span></span> <span data-ttu-id="6fa96-289">这包括字段如`CategoryID`和`SupplierID`，这是与其他表的键。</span><span class="sxs-lookup"><span data-stu-id="6fa96-289">This includes fields like `CategoryID` and `SupplierID`, which are keys to other tables.</span></span>


<span data-ttu-id="6fa96-290">[![单击牛奶的编辑按钮以编辑模式显示该行](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image39.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-290">[![Clicking Chai s Edit Button Displays the Row in Edit Mode](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image39.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image38.png)</span></span>

<span data-ttu-id="6fa96-291">**图 16**： 单击牛奶 s 编辑按钮以编辑模式显示该行 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image40.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-291">**Figure 16**: Clicking Chai s Edit Button Displays the Row in Edit Mode ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image40.png))</span></span>


<span data-ttu-id="6fa96-292">除了要求用户直接编辑的外键值，通过以下方式缺少编辑接口的接口：</span><span class="sxs-lookup"><span data-stu-id="6fa96-292">In addition to asking users to edit foreign key values directly, the editing interface's interface is lacking in the following ways:</span></span>

- <span data-ttu-id="6fa96-293">如果用户输入`CategoryID`或`SupplierID`不在数据库中，存在`UPDATE`将违反外键约束，会导致异常引发。</span><span class="sxs-lookup"><span data-stu-id="6fa96-293">If the user enters a `CategoryID` or `SupplierID` that does not exist in the database, the `UPDATE` will violate a foreign key constraint, causing an exception to be raised.</span></span>
- <span data-ttu-id="6fa96-294">编辑接口不包括任何验证。</span><span class="sxs-lookup"><span data-stu-id="6fa96-294">The editing interface doesn't include any validation.</span></span> <span data-ttu-id="6fa96-295">如果你未提供所需的值 (如`ProductName`)，或输入一个字符串值的数字值 （例如，输入"过多 ！"的地方</span><span class="sxs-lookup"><span data-stu-id="6fa96-295">If you don't provide a required value (such as `ProductName`), or enter a string value where a numeric value is expected (such as entering "Too much!"</span></span> <span data-ttu-id="6fa96-296">到`UnitPrice`文本框中)，将引发异常。</span><span class="sxs-lookup"><span data-stu-id="6fa96-296">into the `UnitPrice` textbox), an exception will be thrown.</span></span> <span data-ttu-id="6fa96-297">将来的教程将说明如何将验证控件添加到编辑的用户界面。</span><span class="sxs-lookup"><span data-stu-id="6fa96-297">A future tutorial will examine how to add validation controls to the editing user interface.</span></span>
- <span data-ttu-id="6fa96-298">目前，*所有*不是只读的产品字段必须包含在 GridView。</span><span class="sxs-lookup"><span data-stu-id="6fa96-298">Currently, *all* product fields that are not read-only must be included in the GridView.</span></span> <span data-ttu-id="6fa96-299">如果我们 GridView 从中删除字段，说`UnitPrice`，当更新数据 GridView 将未设置`UnitPrice``UpdateParameters`值，该值更改的数据库记录`UnitPrice`到`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="6fa96-299">If we were to remove a field from the GridView, say `UnitPrice`, when updating the data the GridView would not set the `UnitPrice` `UpdateParameters` value, which would change the database record's `UnitPrice` to a `NULL` value.</span></span> <span data-ttu-id="6fa96-300">同样，如果必填字段，如`ProductName`，删除从 GridView，更新将具有相同失败"*列 ProductName 不允许使用 null*"上面提到的异常。</span><span class="sxs-lookup"><span data-stu-id="6fa96-300">Similarly, if a required field, such as `ProductName`, is removed from the GridView, the update will fail with the same "*Column 'ProductName' does not allow nulls*" exception mentioned above.</span></span>
- <span data-ttu-id="6fa96-301">编辑接口格式使许多需要改进。</span><span class="sxs-lookup"><span data-stu-id="6fa96-301">The editing interface formatting leaves a lot to be desired.</span></span> <span data-ttu-id="6fa96-302">`UnitPrice`具有四个十进制点所示。</span><span class="sxs-lookup"><span data-stu-id="6fa96-302">The `UnitPrice` is shown with four decimal points.</span></span> <span data-ttu-id="6fa96-303">理想情况下`CategoryID`和`SupplierID`值将包含在系统中列出的类别和供应商的 DropDownLists。</span><span class="sxs-lookup"><span data-stu-id="6fa96-303">Ideally the `CategoryID` and `SupplierID` values would contain DropDownLists that list the categories and suppliers in the system.</span></span>

<span data-ttu-id="6fa96-304">这些是所有的不足之处，我们将需要进行实时现在，但将在将来的教程中得以解决。</span><span class="sxs-lookup"><span data-stu-id="6fa96-304">These are all shortcomings that we'll have to live with for now, but will be addressed in future tutorials.</span></span>

## <a name="inserting-editing-and-deleting-data-with-the-detailsview"></a><span data-ttu-id="6fa96-305">插入、 编辑和删除说明如何使用数据</span><span class="sxs-lookup"><span data-stu-id="6fa96-305">Inserting, Editing, and Deleting Data with the DetailsView</span></span>

<span data-ttu-id="6fa96-306">如我们所见在早期教程中，控件一次显示一条记录，并如 GridView，允许用于编辑和删除当前所显示的记录的说明。</span><span class="sxs-lookup"><span data-stu-id="6fa96-306">As we've seen in earlier tutorials, the DetailsView control displays one record at a time and, like the GridView, allows for editing and deleting of the currently displayed record.</span></span> <span data-ttu-id="6fa96-307">进行编辑和删除说明和从 ASP.NET 端工作流中的项目的这两个最终用户的体验都是相同的 GridView。</span><span class="sxs-lookup"><span data-stu-id="6fa96-307">Both the end user's experience with editing and deleting items from a DetailsView and the workflow from the ASP.NET side is identical to that of the GridView.</span></span> <span data-ttu-id="6fa96-308">说明如何 GridView 与不同的是它还提供了内置插入支持。</span><span class="sxs-lookup"><span data-stu-id="6fa96-308">Where the DetailsView differs from the GridView is that it also provides built-in inserting support.</span></span>

<span data-ttu-id="6fa96-309">若要演示数据修改功能的 GridView，首先要添加到说明`Basics.aspx`上方现有 GridView 页上，并将其绑定到现有 ObjectDataSource 通过说明的智能标记。</span><span class="sxs-lookup"><span data-stu-id="6fa96-309">To demonstrate the data modification capabilities of the GridView, start by adding a DetailsView to the `Basics.aspx` page above the existing GridView and bind it to the existing ObjectDataSource through the DetailsView's smart tag.</span></span> <span data-ttu-id="6fa96-310">下一步，清理说明的`Height`和`Width`属性，并检查通过智能标记启用分页选项。</span><span class="sxs-lookup"><span data-stu-id="6fa96-310">Next, clear out the DetailsView's `Height` and `Width` properties, and check the Enable Paging option from the smart tag.</span></span> <span data-ttu-id="6fa96-311">若要启用编辑，插入和删除的支持，只需选中的智能标记中的启用编辑、 启用插入和启用删除复选框。</span><span class="sxs-lookup"><span data-stu-id="6fa96-311">To enable editing, inserting, and deleting support, simply check the Enable Editing, Enable Inserting, and Enable Deleting checkboxes in the smart tag.</span></span>


![配置为支持编辑、 插入和删除说明](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image41.png)

<span data-ttu-id="6fa96-313">**图 17**： 配置为支持编辑、 插入和删除说明</span><span class="sxs-lookup"><span data-stu-id="6fa96-313">**Figure 17**: Configure the DetailsView to Support Editing, Inserting, and Deleting</span></span>


<span data-ttu-id="6fa96-314">作为 GridView，添加编辑，插入或删除操作支持将添加 CommandField 到说明，如下面的声明性语法所示：</span><span class="sxs-lookup"><span data-stu-id="6fa96-314">As with the GridView, adding editing, inserting, or deleting support adds a CommandField to the DetailsView, as the following declarative syntax shows:</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample7.aspx)]

<span data-ttu-id="6fa96-315">请注意，对于说明 CommandField 默认情况下，将显示在列集合的末尾。</span><span class="sxs-lookup"><span data-stu-id="6fa96-315">Note that for the DetailsView the CommandField appears at the end of the Columns collection by default.</span></span> <span data-ttu-id="6fa96-316">由于说明的字段将呈现为行，CommandField 显示为行与 Insert、 编辑和删除说明底部的按钮。</span><span class="sxs-lookup"><span data-stu-id="6fa96-316">Since the DetailsView's fields are rendered as rows, the CommandField appears as a row with Insert, Edit, and Delete buttons at the bottom of the DetailsView.</span></span>


<span data-ttu-id="6fa96-317">[![配置为支持编辑、 插入和删除说明](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image43.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-317">[![Configure the DetailsView to Support Editing, Inserting, and Deleting](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image43.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image42.png)</span></span>

<span data-ttu-id="6fa96-318">**图 18**： 配置为支持编辑，插入和删除说明 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image44.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-318">**Figure 18**: Configure the DetailsView to Support Editing, Inserting, and Deleting ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image44.png))</span></span>


<span data-ttu-id="6fa96-319">单击删除按钮启动与 GridView 相同的事件序列： 的回发，则跟填充其 ObjectDataSource 说明`DeleteParameters`基于`DataKeyNames`值; 并已完成，但调用其 ObjectDataSource`Delete()`方法，实际上从数据库中删除产品。</span><span class="sxs-lookup"><span data-stu-id="6fa96-319">Clicking on the Delete button starts the same sequence of events as with the GridView: a postback; followed by the DetailsView populating its ObjectDataSource's `DeleteParameters` based on the `DataKeyNames` values; and completed with a call its ObjectDataSource's `Delete()` method, which actually removes the product from the database.</span></span> <span data-ttu-id="6fa96-320">说明如何在编辑还在以与 GridView 相同的方式工作。</span><span class="sxs-lookup"><span data-stu-id="6fa96-320">Editing in the DetailsView also works in a fashion identical to that of the GridView.</span></span>

<span data-ttu-id="6fa96-321">用于插入，最终用户会看到其中新建按钮，单击时，呈现在"插入模式。 说明</span><span class="sxs-lookup"><span data-stu-id="6fa96-321">For inserting, the end user is presented with a New button that, when clicked, renders the DetailsView in "insert mode."</span></span> <span data-ttu-id="6fa96-322">"插入模式"与新建按钮替换为 Insert 和取消按钮和仅这些 BoundFields 其`InsertVisible`属性设置为`True`（默认值） 显示。</span><span class="sxs-lookup"><span data-stu-id="6fa96-322">With "insert mode" the New button is replaced by Insert and Cancel buttons and only those BoundFields whose `InsertVisible` property is set to `True` (the default) are displayed.</span></span> <span data-ttu-id="6fa96-323">如标识为自动递增字段，这些数据字段`ProductID`，具有其[InsertVisible 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datacontrolfield.insertvisible(VS.80).aspx)设置为`False`时将说明如何绑定到数据源通过智能标记。</span><span class="sxs-lookup"><span data-stu-id="6fa96-323">Those data fields identified as auto-increment fields, such as `ProductID`, have their [InsertVisible property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datacontrolfield.insertvisible(VS.80).aspx) set to `False` when binding the DetailsView to the data source through the smart tag.</span></span>

<span data-ttu-id="6fa96-324">Visual Studio 时将数据源绑定到说明如何通过智能标记，将设置`InsertVisible`属性`False`仅用于自动递增字段。</span><span class="sxs-lookup"><span data-stu-id="6fa96-324">When binding a data source to a DetailsView through the smart tag, Visual Studio sets the `InsertVisible` property to `False` only for auto-increment fields.</span></span> <span data-ttu-id="6fa96-325">只读字段，如`CategoryName`和`SupplierName`，除非将在"插入模式"用户界面中显示其`InsertVisible`属性显式设置为`False`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-325">Read-only fields, like `CategoryName` and `SupplierName`, will be displayed in the "insert mode" user interface unless their `InsertVisible` property is explicitly set to `False`.</span></span> <span data-ttu-id="6fa96-326">花些时间设置这两个字段的`InsertVisible`属性设置为`False`，通过说明的声明性语法，或者通过编辑字段中的智能标记链接。</span><span class="sxs-lookup"><span data-stu-id="6fa96-326">Take a moment to set these two fields' `InsertVisible` properties to `False`, either through the DetailsView's declarative syntax or through the Edit Fields link in the smart tag.</span></span> <span data-ttu-id="6fa96-327">图 19 显示设置`InsertVisible`属性设置为`False`编辑字段上单击链接。</span><span class="sxs-lookup"><span data-stu-id="6fa96-327">Figure 19 shows setting the `InsertVisible` properties to `False` by clicking on the Edit Fields link.</span></span>


<span data-ttu-id="6fa96-328">[![Northwind Traders 现在提供 acme 开发 Tea](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image46.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-328">[![Northwind Traders Now Offers Acme Tea](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image46.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image45.png)</span></span>

<span data-ttu-id="6fa96-329">**图 19**: Northwind Traders 现在提供 acme 开发 Tea ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image47.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-329">**Figure 19**: Northwind Traders Now Offers Acme Tea ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image47.png))</span></span>


<span data-ttu-id="6fa96-330">设置后`InsertVisible`属性、 视图`Basics.aspx`页在浏览器，然后单击新建按钮。</span><span class="sxs-lookup"><span data-stu-id="6fa96-330">After setting the `InsertVisible` properties, view the `Basics.aspx` page in a browser and click the New button.</span></span> <span data-ttu-id="6fa96-331">图 20 显示说明如何添加新饮料时, acme 开发 Tea，到我们的产品线。</span><span class="sxs-lookup"><span data-stu-id="6fa96-331">Figure 20 shows the DetailsView when adding a new beverage, Acme Tea, to our product line.</span></span>


<span data-ttu-id="6fa96-332">[![Northwind Traders 现在提供 acme 开发 Tea](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image49.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image48.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-332">[![Northwind Traders Now Offers Acme Tea](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image49.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image48.png)</span></span>

<span data-ttu-id="6fa96-333">**图 20**: Northwind Traders 现在提供 acme 开发 Tea ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image50.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-333">**Figure 20**: Northwind Traders Now Offers Acme Tea ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image50.png))</span></span>


<span data-ttu-id="6fa96-334">为 acme 开发 Tea 输入详细信息，并单击插入按钮后, 回发时，才会和新的记录添加到`Products`数据库表。</span><span class="sxs-lookup"><span data-stu-id="6fa96-334">After entering the details for Acme Tea and clicking the Insert button, a postback ensues and the new record is added to the `Products` database table.</span></span> <span data-ttu-id="6fa96-335">由于此说明如何列出的顺序与它们存在于数据库表中的产品，我们必须页上的最后一个产品才能看到新的产品。</span><span class="sxs-lookup"><span data-stu-id="6fa96-335">Since this DetailsView lists the products in order with which they exist in the database table, we must page to the last product in order to see the new product.</span></span>


<span data-ttu-id="6fa96-336">[![Acme 开发 Tea 的详细信息](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image52.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image51.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-336">[![Details for Acme Tea](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image52.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image51.png)</span></span>

<span data-ttu-id="6fa96-337">**图 21**: acme 开发 Tea 的详细信息 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image53.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-337">**Figure 21**: Details for Acme Tea ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image53.png))</span></span>


> [!NOTE]
> <span data-ttu-id="6fa96-338">说明如何的[CurrentMode 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.currentmode(VS.80).aspx)表示正在显示的界面，可以是以下值之一： `Edit`， `Insert`，或`ReadOnly`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-338">The DetailsView's [CurrentMode property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.currentmode(VS.80).aspx) indicates the interface being displayed and can be one of the following values: `Edit`, `Insert`, or `ReadOnly`.</span></span> <span data-ttu-id="6fa96-339">[DefaultMode 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode(VS.80).aspx)指示的模式说明如何在编辑后返回到或插入已完成并且对显示说明的永久处于编辑模式或插入模式很有用。</span><span class="sxs-lookup"><span data-stu-id="6fa96-339">The [DefaultMode property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode(VS.80).aspx) indicates the mode the DetailsView returns to after an edit or insert has been completed and is useful for displaying a DetailsView that is permanently in edit or insert mode.</span></span>


<span data-ttu-id="6fa96-340">该点并单击插入和编辑功能的说明会受到与 GridView 相同的限制： 用户必须输入现有`CategoryID`和`SupplierID`通过文本框中的值; 接口缺少任何验证逻辑; 它的所有不允许的产品字段`NULL`值或不具有默认值在数据库级别指定的值必须包括在插入的接口，依次类推。</span><span class="sxs-lookup"><span data-stu-id="6fa96-340">The point and click inserting and editing capabilities of the DetailsView suffer from the same limitations as the GridView: the user must enter existing `CategoryID` and `SupplierID` values through a textbox; the interface lacks any validation logic; all product fields that do not allow `NULL` values or don't have a default value specified at the database level must be included in the inserting interface, and so on.</span></span>

<span data-ttu-id="6fa96-341">技术我们将检查扩展和增强 GridView 的编辑界面在将来的文章可应用于说明控件的编辑和插入以及接口。</span><span class="sxs-lookup"><span data-stu-id="6fa96-341">The techniques we will examine for extending and enhancing the GridView's editing interface in future articles can be applied to the DetailsView control's editing and inserting interfaces as well.</span></span>

## <a name="using-the-formview-for-a-more-flexible-data-modification-user-interface"></a><span data-ttu-id="6fa96-342">FormView 用于更灵活的数据修改用户界面</span><span class="sxs-lookup"><span data-stu-id="6fa96-342">Using the FormView for a More Flexible Data Modification User Interface</span></span>

<span data-ttu-id="6fa96-343">FormView 提供内置支持用于插入、 编辑和删除数据，因为它使用模板而不是字段，但添加 BoundFields 或 CommandField GridView 和说明控件用于提供数据的位置修改接口。</span><span class="sxs-lookup"><span data-stu-id="6fa96-343">The FormView offers built-in support for inserting, editing, and deleting data, but because it uses templates instead of fields there's no place to add the BoundFields or the CommandField used by the GridView and DetailsView controls to provide the data modification interface.</span></span> <span data-ttu-id="6fa96-344">相反，此接口用于收集用户的 Web 控件添加新项时输入或编辑一个现有新建，以及编辑、 删除、 插入、 更新和取消按钮必须手动添加到适当的模板。</span><span class="sxs-lookup"><span data-stu-id="6fa96-344">Instead, this interface the Web controls for collecting user input when adding a new item or editing an existing one along with the New, Edit, Delete, Insert, Update, and Cancel buttons must be added manually to the appropriate templates.</span></span> <span data-ttu-id="6fa96-345">幸运的是，Visual Studio 将自动创建所需的接口绑定到数据源通过其智能标记中的下拉列表 FormView 时。</span><span class="sxs-lookup"><span data-stu-id="6fa96-345">Fortunately, Visual Studio will automatically create the needed interface when binding the FormView to a data source through the drop-down list in its smart tag.</span></span>

<span data-ttu-id="6fa96-346">若要演示了这些技术，首先要添加到 FormView`Basics.aspx`页上，并从 FormView 的智能标记，请将其绑定到已创建对象数据源。</span><span class="sxs-lookup"><span data-stu-id="6fa96-346">To illustrate these techniques, start by adding a FormView to the `Basics.aspx` page and, from the FormView's smart tag, bind it to the ObjectDataSource already created.</span></span> <span data-ttu-id="6fa96-347">这将生成`EditItemTemplate`， `InsertItemTemplate`，和`ItemTemplate`为包含用于收集用户的输入和按钮 Web 控件新建文本框中 Web 控件 FormView，编辑、 删除、 插入、 更新和取消按钮。</span><span class="sxs-lookup"><span data-stu-id="6fa96-347">This will generate an `EditItemTemplate`, `InsertItemTemplate`, and `ItemTemplate` for the FormView with TextBox Web controls for collecting the user's input and Button Web controls for the New, Edit, Delete, Insert, Update, and Cancel buttons.</span></span> <span data-ttu-id="6fa96-348">此外，FormView 的`DataKeyNames`属性设置为的主键字段 (`ProductID`) 的对象数据源返回的对象。</span><span class="sxs-lookup"><span data-stu-id="6fa96-348">Additionally, the FormView's `DataKeyNames` property is set to the primary key field (`ProductID`) of the object returned by the ObjectDataSource.</span></span> <span data-ttu-id="6fa96-349">最后，检查 FormView 的智能标记中的启用分页选项。</span><span class="sxs-lookup"><span data-stu-id="6fa96-349">Lastly, check the Enable Paging option in the FormView's smart tag.</span></span>

<span data-ttu-id="6fa96-350">下面显示了声明性标记为 FormView `ItemTemplate` FormView 已绑定到 ObjectDataSource 后。</span><span class="sxs-lookup"><span data-stu-id="6fa96-350">The following shows the declarative markup for the FormView's `ItemTemplate` after the FormView has been bound to the ObjectDataSource.</span></span> <span data-ttu-id="6fa96-351">默认情况下，每个非布尔值产品字段绑定到`Text`时每个布尔值字段标签 Web 控件的属性 (`Discontinued`) 绑定到`Checked`已禁用的复选框 Web 控件的属性。</span><span class="sxs-lookup"><span data-stu-id="6fa96-351">By default, each non-Boolean value product field is bound to the `Text` property of a Label Web control while each Boolean value field (`Discontinued`) is bound to the `Checked` property of a disabled CheckBox Web control.</span></span> <span data-ttu-id="6fa96-352">为了使新建、 编辑和删除按钮，以触发某些 FormView 行为单击时，它是命令性，其`CommandName`值设置为`New`， `Edit`，和`Delete`分别。</span><span class="sxs-lookup"><span data-stu-id="6fa96-352">In order for the New, Edit, and Delete buttons to trigger certain FormView behavior when clicked, it is imperative that their `CommandName` values be set to `New`, `Edit`, and `Delete`, respectively.</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample8.aspx)]

<span data-ttu-id="6fa96-353">图 22 显示 FormView`ItemTemplate`通过浏览器查看时。</span><span class="sxs-lookup"><span data-stu-id="6fa96-353">Figure 22 shows the FormView's `ItemTemplate` when viewed through a browser.</span></span> <span data-ttu-id="6fa96-354">每个产品字段列在一起在底部的新建、 编辑和删除按钮。</span><span class="sxs-lookup"><span data-stu-id="6fa96-354">Each product field is listed with the New, Edit, and Delete buttons at the bottom.</span></span>


<span data-ttu-id="6fa96-355">[![情况下 FormView ItemTemplate 列出每个产品字段以及新、 编辑和删除按钮](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image55.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image54.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-355">[![The Defaut FormView ItemTemplate Lists Each Product Field Along with New, Edit, and Delete Buttons](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image55.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image54.png)</span></span>

<span data-ttu-id="6fa96-356">**图 22**: 的情况下 FormView`ItemTemplate`列出每个产品字段沿具有新建、 编辑和删除按钮 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image56.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-356">**Figure 22**: The Defaut FormView `ItemTemplate` Lists Each Product Field Along with New, Edit, and Delete Buttons ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image56.png))</span></span>


<span data-ttu-id="6fa96-357">与的 GridView 和说明，单击删除按钮或任何按钮、 LinkButton 或 ImageButton 类似其`CommandName`属性设置为删除会导致回发，填充 ObjectDataSource`DeleteParameters`根据 FormView 的`DataKeyNames`值，并调用 ObjectDataSource`Delete()`方法。</span><span class="sxs-lookup"><span data-stu-id="6fa96-357">Like with the GridView and DetailsView, clicking the Delete button or any Button, LinkButton, or ImageButton whose `CommandName` property is set to Delete causes a postback, populates the ObjectDataSource's `DeleteParameters` based on the FormView's `DataKeyNames` value, and invokes the ObjectDataSource's `Delete()` method.</span></span>

<span data-ttu-id="6fa96-358">单击编辑按钮时回发时，才会和数据重新绑定到`EditItemTemplate`，即负责呈现编辑界面。</span><span class="sxs-lookup"><span data-stu-id="6fa96-358">When the Edit button is clicked a postback ensues and the data is rebound to the `EditItemTemplate`, which is responsible for rendering the editing interface.</span></span> <span data-ttu-id="6fa96-359">此接口包括编辑的更新和取消按钮以及数据的 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="6fa96-359">This interface includes the Web controls for editing data along with the Update and Cancel buttons.</span></span> <span data-ttu-id="6fa96-360">默认值`EditItemTemplate`生成的 Visual Studio 包含的任何自动递增字段的标签 (`ProductID`)、 一个文本框中的每个非布尔值字段，以及一为每个布尔值字段的复选框。</span><span class="sxs-lookup"><span data-stu-id="6fa96-360">The default `EditItemTemplate` generated by Visual Studio contains a Label for any auto-increment fields (`ProductID`), a TextBox for each non-Boolean value field, and a CheckBox for each Boolean value field.</span></span> <span data-ttu-id="6fa96-361">此行为是非常类似于 GridView 和说明控件中的自动生成 BoundFields。</span><span class="sxs-lookup"><span data-stu-id="6fa96-361">This behavior is very similar to the auto-generated BoundFields in the GridView and DetailsView controls.</span></span>

> [!NOTE]
> <span data-ttu-id="6fa96-362">FormView 的自动生成的一个小问题`EditItemTemplate`是，它会呈现文本框中 Web 控件是只读的如这些字段`CategoryName`和`SupplierName`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-362">One small issue with the FormView's auto-generation of the `EditItemTemplate` is that it renders TextBox Web controls for those fields that are read-only, such as `CategoryName` and `SupplierName`.</span></span> <span data-ttu-id="6fa96-363">我们将了解如何考虑到这一点很快。</span><span class="sxs-lookup"><span data-stu-id="6fa96-363">We'll see how to account for this shortly.</span></span>


<span data-ttu-id="6fa96-364">控制中的文本框中`EditItemTemplate`具有其`Text`属性绑定到其相应的数据字段使用的值*双向数据绑定*。</span><span class="sxs-lookup"><span data-stu-id="6fa96-364">The TextBox controls in the `EditItemTemplate` have their `Text` property bound to the value of their corresponding data field using *two-way databinding*.</span></span> <span data-ttu-id="6fa96-365">双向数据绑定，由表示`<%# Bind("dataField") %>`，数据绑定到该模板时和填充插入或编辑记录的对象数据源的参数时执行这两个数据绑定。</span><span class="sxs-lookup"><span data-stu-id="6fa96-365">Two-way databinding, denoted by `<%# Bind("dataField") %>`, performs databinding both when binding data to the template and when populating the ObjectDataSource's parameters for inserting or editing records.</span></span> <span data-ttu-id="6fa96-366">也就是说，当用户单击编辑按钮从`ItemTemplate`、`Bind()`方法返回指定的数据字段值。</span><span class="sxs-lookup"><span data-stu-id="6fa96-366">That is, when the user clicks the Edit button from the `ItemTemplate`, the `Bind()` method returns the specified data field value.</span></span> <span data-ttu-id="6fa96-367">用户进行相应更改，并单击更新后，值将对应的回发到使用指定的数据字段`Bind()`应用于 ObjectDataSource `UpdateParameters`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-367">After the user makes their changes and clicks Update, the values posted back that correspond to the data fields specified using `Bind()` are applied to the ObjectDataSource's `UpdateParameters`.</span></span> <span data-ttu-id="6fa96-368">单向数据绑定，或者，由表示`<%# Eval("dataField") %>`，仅当数据绑定到模板中检索数据字段值并未*不*上回发到数据源的参数返回的用户输入的值。</span><span class="sxs-lookup"><span data-stu-id="6fa96-368">Alternatively, one-way databinding, denoted by `<%# Eval("dataField") %>`, only retrieves the data field values when binding data to the template and does *not* return the user-entered values to the data source's parameters on postback.</span></span>

<span data-ttu-id="6fa96-369">下面的声明性标记显示 FormView `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-369">The following declarative markup shows the FormView's `EditItemTemplate`.</span></span> <span data-ttu-id="6fa96-370">请注意，`Bind()`方法可在数据绑定的语法，并更新和取消按钮 Web 控件具有其`CommandName`相应地进行设置的属性。</span><span class="sxs-lookup"><span data-stu-id="6fa96-370">Note that the `Bind()` method is used in the databinding syntax here and that the Update and Cancel Button Web controls have their `CommandName` properties set accordingly.</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample9.aspx)]

<span data-ttu-id="6fa96-371">我们`EditItemTemplate`，在这点，将导致如果我们尝试使用它引发异常。</span><span class="sxs-lookup"><span data-stu-id="6fa96-371">Our `EditItemTemplate`, at this point, will cause an exception to be thrown if we attempt to use it.</span></span> <span data-ttu-id="6fa96-372">问题在于`CategoryName`和`SupplierName`作为文本框中 Web 控件中呈现字段`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-372">The problem is that the `CategoryName` and `SupplierName` fields are rendered as TextBox Web controls in the `EditItemTemplate`.</span></span> <span data-ttu-id="6fa96-373">我们需要将这些文本框中更改为标签或删除它们。</span><span class="sxs-lookup"><span data-stu-id="6fa96-373">We either need to change these TextBoxes to Labels or remove them altogether.</span></span> <span data-ttu-id="6fa96-374">让我们只需将其从完全删除`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-374">Let's simply delete them entirely from the `EditItemTemplate`.</span></span>

<span data-ttu-id="6fa96-375">图 23 在浏览器中显示 FormView 后单击编辑按钮后牛奶。</span><span class="sxs-lookup"><span data-stu-id="6fa96-375">Figure 23 shows the FormView in a browser after the Edit button has been clicked for Chai.</span></span> <span data-ttu-id="6fa96-376">请注意，`SupplierName`和`CategoryName`中所示的字段`ItemTemplate`不再存在，我们只需删除从`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-376">Note that the `SupplierName` and `CategoryName` fields shown in the `ItemTemplate` are no longer present, as we just removed them from the `EditItemTemplate`.</span></span> <span data-ttu-id="6fa96-377">单击更新按钮时 FormView 继续通过 GridView 和说明控件相同的步骤序列。</span><span class="sxs-lookup"><span data-stu-id="6fa96-377">When the Update button is clicked the FormView proceeds through the same sequence of steps as the GridView and DetailsView controls.</span></span>


<span data-ttu-id="6fa96-378">[![默认情况下 EditItemTemplate 显示文本框中或复选框为每个可编辑产品字段](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image58.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image57.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-378">[![By Default the EditItemTemplate Shows Each Editable Product Field as a TextBox or CheckBox](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image58.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image57.png)</span></span>

<span data-ttu-id="6fa96-379">**图 23**： 默认情况下`EditItemTemplate`显示每个可编辑产品字段为文本框中或复选框 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image59.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-379">**Figure 23**: By Default the `EditItemTemplate` Shows Each Editable Product Field as a TextBox or CheckBox ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image59.png))</span></span>


<span data-ttu-id="6fa96-380">插入按钮时单击 FormView`ItemTemplate`回发时，才会。</span><span class="sxs-lookup"><span data-stu-id="6fa96-380">When the Insert button is clicked the FormView's `ItemTemplate` a postback ensues.</span></span> <span data-ttu-id="6fa96-381">但是，任何数据不绑定到 FormView 因为一条新记录将被添加。</span><span class="sxs-lookup"><span data-stu-id="6fa96-381">However, no data is bound to the FormView because a new record is being added.</span></span> <span data-ttu-id="6fa96-382">`InsertItemTemplate`接口包含 Web 控件以添加新记录以及插入和取消按钮。</span><span class="sxs-lookup"><span data-stu-id="6fa96-382">The `InsertItemTemplate` interface includes the Web controls for adding a new record along with the Insert and Cancel buttons.</span></span> <span data-ttu-id="6fa96-383">默认值`InsertItemTemplate`生成的 Visual Studio 包含每个非布尔值字段一个文本框和一个用于每个布尔值字段，类似于自动生成的复选框`EditItemTemplate`的接口。</span><span class="sxs-lookup"><span data-stu-id="6fa96-383">The default `InsertItemTemplate` generated by Visual Studio contains a TextBox for each non-Boolean value field and a CheckBox for each Boolean value field, similar to the auto-generated `EditItemTemplate`'s interface.</span></span> <span data-ttu-id="6fa96-384">TextBox 控件具有其`Text`属性绑定到其使用双向数据绑定的相应数据字段的值。</span><span class="sxs-lookup"><span data-stu-id="6fa96-384">The TextBox controls have their `Text` property bound to the value of their corresponding data field using two-way databinding.</span></span>

<span data-ttu-id="6fa96-385">下面的声明性标记显示 FormView `InsertItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-385">The following declarative markup shows the FormView's `InsertItemTemplate`.</span></span> <span data-ttu-id="6fa96-386">请注意，`Bind()`方法使用在数据绑定的语法，插入和取消按钮 Web 控件需要其`CommandName`相应地进行设置的属性。</span><span class="sxs-lookup"><span data-stu-id="6fa96-386">Note that the `Bind()` method is used in the databinding syntax here and that the Insert and Cancel Button Web controls have their `CommandName` properties set accordingly.</span></span>


[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample10.aspx)]

<span data-ttu-id="6fa96-387">没有与 FormView 的自动生成的种微妙`InsertItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-387">There's a subtlety with the FormView's auto-generation of the `InsertItemTemplate`.</span></span> <span data-ttu-id="6fa96-388">具体而言，即使为是只读的如这些字段创建文本框中 Web 控件`CategoryName`和`SupplierName`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-388">Specifically, the TextBox Web controls are created even for those fields that are read-only, such as `CategoryName` and `SupplierName`.</span></span> <span data-ttu-id="6fa96-389">与类似`EditItemTemplate`，我们需要先删除这些文本框中，从`InsertItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="6fa96-389">Like with the `EditItemTemplate`, we need to remove these TextBoxes from the `InsertItemTemplate`.</span></span>

<span data-ttu-id="6fa96-390">图 24 显示 FormView 浏览器中，添加一个新的产品，acme 开发 Coffee 时。</span><span class="sxs-lookup"><span data-stu-id="6fa96-390">Figure 24 shows the FormView in a browser when adding a new product, Acme Coffee.</span></span> <span data-ttu-id="6fa96-391">请注意，`SupplierName`和`CategoryName`中所示的字段`ItemTemplate`不再存在，我们只需删除它们。</span><span class="sxs-lookup"><span data-stu-id="6fa96-391">Note that the `SupplierName` and `CategoryName` fields shown in the `ItemTemplate` are no longer present, as we just removed them.</span></span> <span data-ttu-id="6fa96-392">插入按钮单击后通过说明相同的步骤序列 FormView 继续进行，添加一条新记录到`Products`表。</span><span class="sxs-lookup"><span data-stu-id="6fa96-392">When the Insert button is clicked the FormView proceeds through the same sequence of steps as the DetailsView control, adding a new record to the `Products` table.</span></span> <span data-ttu-id="6fa96-393">插入它后，图 25 FormView 中显示 acme 开发 Coffee 产品的详细信息。</span><span class="sxs-lookup"><span data-stu-id="6fa96-393">Figure 25 shows Acme Coffee product's details in the FormView after it has been inserted.</span></span>


<span data-ttu-id="6fa96-394">[![InsertItemTemplate 指示 FormView 插入接口](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image61.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image60.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-394">[![The InsertItemTemplate Dictates the FormView's Inserting Interface](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image61.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image60.png)</span></span>

<span data-ttu-id="6fa96-395">**图 24**:`InsertItemTemplate`指示 FormView 插入接口 ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image62.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-395">**Figure 24**: The `InsertItemTemplate` Dictates the FormView's Inserting Interface ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image62.png))</span></span>


<span data-ttu-id="6fa96-396">[![对于新的产品，acme 开发 Coffee 细节将显示在 FormView](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image64.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image63.png)</span><span class="sxs-lookup"><span data-stu-id="6fa96-396">[![The Details for New Product, Acme Coffee, are Displayed in the FormView](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image64.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image63.png)</span></span>

<span data-ttu-id="6fa96-397">**图 25**： 新产品，acme 开发 Coffee 的详细信息显示在 FormView ([单击以查看实际尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image65.png))</span><span class="sxs-lookup"><span data-stu-id="6fa96-397">**Figure 25**: The Details for New Product, Acme Coffee, are Displayed in the FormView ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image65.png))</span></span>


<span data-ttu-id="6fa96-398">通过将分离出只读的编辑，并插入三个单独的模板，接口 FormView 允许比的说明和 GridView 更精细的控制这些接口。</span><span class="sxs-lookup"><span data-stu-id="6fa96-398">By separating out the read-only, editing, and inserting interfaces into three separate templates, the FormView allows for a finer degree of control over these interfaces than the DetailsView and GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="6fa96-399">如说明如何，FormView 的`CurrentMode`属性指示要显示的接口并将其`DefaultMode`属性指示的模式 FormView 将返回到在编辑后，要么已完成插入。</span><span class="sxs-lookup"><span data-stu-id="6fa96-399">Like the DetailsView, the FormView's `CurrentMode` property indicates the interface being displayed and its `DefaultMode` property indicates the mode the FormView returns to after an edit or insert has been completed.</span></span>


## <a name="summary"></a><span data-ttu-id="6fa96-400">总结</span><span class="sxs-lookup"><span data-stu-id="6fa96-400">Summary</span></span>

<span data-ttu-id="6fa96-401">在本教程中，我们将探讨插入、 编辑和删除使用 GridView，说明如何和 FormView 数据的基础知识。</span><span class="sxs-lookup"><span data-stu-id="6fa96-401">In this tutorial we examined the basics of inserting, editing, and deleting data using the GridView, DetailsView, and FormView.</span></span> <span data-ttu-id="6fa96-402">这些控件的所有三个提供一定程度的可以利用而无需编写一行代码感谢数据 Web 控件和 ObjectDataSource ASP.NET 页中的内置数据修改功能。</span><span class="sxs-lookup"><span data-stu-id="6fa96-402">All three of these controls provide some level of built-in data modification capabilities that can be utilized without writing a single line of code in the ASP.NET page thanks to the data Web controls and the ObjectDataSource.</span></span> <span data-ttu-id="6fa96-403">但是，简单点，然后单击技术呈现相当 frail 和 naïve 数据修改用户界面。</span><span class="sxs-lookup"><span data-stu-id="6fa96-403">However, the simple point and click techniques render a fairly frail and naïve data modification user interface.</span></span> <span data-ttu-id="6fa96-404">若要提供验证，注入编程值、 适当地处理异常、 自定义用户界面中，和依此类推，我们将需要依赖于将在下一步的几个教程讨论的技术 bevy。</span><span class="sxs-lookup"><span data-stu-id="6fa96-404">To provide validation, inject programmatic values, gracefully handle exceptions, customize the user interface, and so on, we'll need to rely on a bevy of techniques that will be discussed over the next several tutorials.</span></span>

<span data-ttu-id="6fa96-405">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="6fa96-405">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="6fa96-406">关于作者</span><span class="sxs-lookup"><span data-stu-id="6fa96-406">About the Author</span></span>

<span data-ttu-id="6fa96-407">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七个 ASP/ASP.NET 书籍和的创始人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年使用与 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="6fa96-407">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="6fa96-408">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="6fa96-408">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="6fa96-409">最新书籍是[ *Sam 教授自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="6fa96-409">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="6fa96-410">他可以达到在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或通过他的博客，其中可以找到在[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="6fa96-410">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6fa96-411">[上一页](limiting-data-modification-functionality-based-on-the-user-cs.md)
> [下一页](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)</span><span class="sxs-lookup"><span data-stu-id="6fa96-411">[Previous](limiting-data-modification-functionality-based-on-the-user-cs.md)
[Next](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)</span></span>
