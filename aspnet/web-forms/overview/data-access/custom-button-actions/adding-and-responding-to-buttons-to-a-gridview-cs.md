---
uid: web-forms/overview/data-access/custom-button-actions/adding-and-responding-to-buttons-to-a-gridview-cs
title: 添加和响应的按钮添加到 GridView (C#) |Microsoft 文档
author: rick-anderson
description: 在本教程中我们将查看如何添加自定义按钮，同时向模板和 GridView 或说明控件的字段。 具体而言，我们将标示...
ms.author: aspnetcontent
manager: wpickett
ms.date: 09/13/2006
ms.topic: article
ms.assetid: 128fdb5f-4c5e-42b5-b485-f3aee90a8e38
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/custom-button-actions/adding-and-responding-to-buttons-to-a-gridview-cs
msc.type: authoredcontent
ms.openlocfilehash: 90648e10d5d058ea2e4aa5b3d8c4ed7448ea7166
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/06/2018
ms.locfileid: "30878290"
---
<a name="adding-and-responding-to-buttons-to-a-gridview-c"></a><span data-ttu-id="8bfb0-104">添加和响应的按钮添加到 GridView (C#)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-104">Adding and Responding to Buttons to a GridView (C#)</span></span>
====================
<span data-ttu-id="8bfb0-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8bfb0-106">[下载示例应用程序](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_28_CS.exe)或[下载 PDF](adding-and-responding-to-buttons-to-a-gridview-cs/_static/datatutorial28cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-106">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_28_CS.exe) or [Download PDF](adding-and-responding-to-buttons-to-a-gridview-cs/_static/datatutorial28cs1.pdf)</span></span>

> <span data-ttu-id="8bfb0-107">在本教程中我们将查看如何添加自定义按钮，同时向模板和 GridView 或说明控件的字段。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-107">In this tutorial we'll look at how to add custom buttons, both to a template and to the fields of a GridView or DetailsView control.</span></span> <span data-ttu-id="8bfb0-108">具体而言，我们将生成具有允许用户翻阅供应商 FormView 的接口。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-108">In particular, we'll build an interface that has a FormView that allows the user to page through the suppliers.</span></span>


## <a name="introduction"></a><span data-ttu-id="8bfb0-109">介绍</span><span class="sxs-lookup"><span data-stu-id="8bfb0-109">Introduction</span></span>

<span data-ttu-id="8bfb0-110">虽然许多报告方案涉及到报表数据的只读访问，这不常见的报告，以包括执行操作取决于显示的数据的能力。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-110">While many reporting scenarios involve read-only access to the report data, it's not uncommon for reports to include the ability to perform actions based upon the data displayed.</span></span> <span data-ttu-id="8bfb0-111">这通常涉及与报表中显示每个记录中添加按钮、 LinkButton 或 ImageButton Web 控件，单击时，会导致回发，并调用某些服务器端代码。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-111">Typically this involved adding a Button, LinkButton, or ImageButton Web control with each record displayed in the report that, when clicked, causes a postback and invokes some server-side code.</span></span> <span data-ttu-id="8bfb0-112">编辑和删除的记录的基础上的数据是最常见的示例。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-112">Editing and deleting the data on a record-by-record basis is the most common example.</span></span> <span data-ttu-id="8bfb0-113">实际上，正如我们所看到开头[概述的插入、 更新和删除数据](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)教程中，编辑和删除非常常见的 GridView、 说明如何和 FormView 控件可以支持而无需此类功能需要编写任何代码。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-113">In fact, as we saw starting with the [Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial, editing and deleting is so common that the GridView, DetailsView, and FormView controls can support such functionality without the need for writing a single line of code.</span></span>

<span data-ttu-id="8bfb0-114">此外进行编辑和删除按钮、 GridView，说明如何和 FormView 控件还可以包括按钮、 LinkButtons 或 ImageButtons，单击时，执行某些自定义服务器端逻辑。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-114">In addition to Edit and Delete buttons, the GridView, DetailsView, and FormView controls can also include Buttons, LinkButtons, or ImageButtons that, when clicked, perform some custom server-side logic.</span></span> <span data-ttu-id="8bfb0-115">在本教程中我们将查看如何添加自定义按钮，同时向模板和 GridView 或说明控件的字段。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-115">In this tutorial we'll look at how to add custom buttons, both to a template and to the fields of a GridView or DetailsView control.</span></span> <span data-ttu-id="8bfb0-116">具体而言，我们将生成具有允许用户翻阅供应商 FormView 的接口。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-116">In particular, we'll build an interface that has a FormView that allows the user to page through the suppliers.</span></span> <span data-ttu-id="8bfb0-117">对于给定的供应商，FormView 将显示有关以及如果单击，会将标记所有其关联的产品为停止使用的按钮 Web 控件供应商的信息。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-117">For a given supplier, the FormView will show information about the supplier along with a Button Web control that, if clicked, will mark all of their associated products as discontinued.</span></span> <span data-ttu-id="8bfb0-118">此外，一个 GridView 列出所选供应商提供的其中每一行包含增加价格和折扣价格的按钮，如果单击，引发或减少该产品的这些产品`UnitPrice`（请参见图 1） 的 10%。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-118">Additionally, a GridView lists those products provided by the selected supplier, with each row containing Increase Price and Discount Price Buttons that, if clicked, raise or reduce the product's `UnitPrice` by 10% (see Figure 1).</span></span>


<span data-ttu-id="8bfb0-119">[![FormView 和 GridView 包含执行自定义操作的按钮](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image2.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-119">[![Both the FormView and GridView Contain Buttons That Perform Custom Actions](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image2.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image1.png)</span></span>

<span data-ttu-id="8bfb0-120">**图 1**： 这两个 FormView 和 GridView 包含按钮，执行自定义操作 ([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-120">**Figure 1**: Both the FormView and GridView Contain Buttons That Perform Custom Actions ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image3.png))</span></span>


## <a name="step-1-adding-the-button-tutorial-web-pages"></a><span data-ttu-id="8bfb0-121">步骤 1： 添加按钮教程 Web 页</span><span class="sxs-lookup"><span data-stu-id="8bfb0-121">Step 1: Adding the Button Tutorial Web Pages</span></span>

<span data-ttu-id="8bfb0-122">之前我们看看如何添加自定义按钮，让我们先花点时间在本教程中我们将需要我们网站项目中创建 ASP.NET 页。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-122">Before we look at how to add a custom buttons, let's first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial.</span></span> <span data-ttu-id="8bfb0-123">首先，通过添加一个名为的新文件夹`CustomButtons`。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-123">Start by adding a new folder named `CustomButtons`.</span></span> <span data-ttu-id="8bfb0-124">接下来，将以下两个 ASP.NET 页添加到该文件夹，并确保将每个包含网页相关联`Site.master`母版页：</span><span class="sxs-lookup"><span data-stu-id="8bfb0-124">Next, add the following two ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `CustomButtons.aspx`


![有关自定义的按钮相关教程添加的 ASP.NET 页面](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image4.png)

<span data-ttu-id="8bfb0-126">**图 2**： 添加 ASP.NET 页的自定义按钮相关教程</span><span class="sxs-lookup"><span data-stu-id="8bfb0-126">**Figure 2**: Add the ASP.NET Pages for the Custom Buttons-Related Tutorials</span></span>


<span data-ttu-id="8bfb0-127">在其他文件夹中，如`Default.aspx`中`CustomButtons`文件夹将在其部分中列出这些教程。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-127">Like in the other folders, `Default.aspx` in the `CustomButtons` folder will list the tutorials in its section.</span></span> <span data-ttu-id="8bfb0-128">回想一下，`SectionLevelTutorialListing.ascx`用户控件提供此功能。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-128">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="8bfb0-129">因此，此用户将控件添加到`Default.aspx`通过从解决方案资源管理器拖放到页面的设计视图拖动。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-129">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page's Design view.</span></span>


<span data-ttu-id="8bfb0-130">[![SectionLevelTutorialListing.ascx 用户控件添加到 Default.aspx](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image6.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-130">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image6.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image5.png)</span></span>

<span data-ttu-id="8bfb0-131">**图 3**： 添加`SectionLevelTutorialListing.ascx`用户控件`Default.aspx`([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-131">**Figure 3**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image7.png))</span></span>


<span data-ttu-id="8bfb0-132">最后，将页添加到的条目为`Web.sitemap`文件。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-132">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="8bfb0-133">具体而言，在分页和排序后添加以下标记`<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="8bfb0-133">Specifically, add the following markup after the Paging and Sorting `<siteMapNode>`:</span></span>

[!code-xml[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample1.xml)]

<span data-ttu-id="8bfb0-134">在更新后`Web.sitemap`，花些时间查看通过浏览器网站的教程。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-134">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="8bfb0-135">在左侧菜单现在包括用于编辑、 插入和删除教程的项。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-135">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>


![站点图现在包括自定义按钮教程的条目](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image8.png)

<span data-ttu-id="8bfb0-137">**图 4**： 站点图现在包括自定义按钮教程的条目</span><span class="sxs-lookup"><span data-stu-id="8bfb0-137">**Figure 4**: The Site Map Now Includes the Entry for the Custom Buttons Tutorial</span></span>


## <a name="step-2-adding-a-formview-that-lists-the-suppliers"></a><span data-ttu-id="8bfb0-138">步骤 2： 添加列出供应商 FormView</span><span class="sxs-lookup"><span data-stu-id="8bfb0-138">Step 2: Adding a FormView that Lists the Suppliers</span></span>

<span data-ttu-id="8bfb0-139">让我们开始使用本教程通过添加列出供应商 FormView。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-139">Let's get started with this tutorial by adding the FormView that lists the suppliers.</span></span> <span data-ttu-id="8bfb0-140">如简介中所述，此 FormView 将允许用户逐页浏览供应商，显示在一个 GridView 供应商提供的产品。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-140">As discussed in the Introduction, this FormView will allow the user to page through the suppliers, showing the products provided by the supplier in a GridView.</span></span> <span data-ttu-id="8bfb0-141">此外，此 FormView 将包括一个按钮，单击时，会将标记所有供应商的产品为停止使用。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-141">Additionally, this FormView will include a Button that, when clicked, will mark all of the supplier's products as discontinued.</span></span> <span data-ttu-id="8bfb0-142">我们考虑自行向 FormView 添加自定义按钮之前，让我们第一次只需创建 FormView，使它显示供应商信息。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-142">Before we concern ourselves with adding the custom button to the FormView, let's first just create the FormView so that it displays the supplier information.</span></span>

<span data-ttu-id="8bfb0-143">首先打开`CustomButtons.aspx`页面`CustomButtons`文件夹。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-143">Start by opening the `CustomButtons.aspx` page in the `CustomButtons` folder.</span></span> <span data-ttu-id="8bfb0-144">通过从工具箱中拖动到设计器和组拖动到页面添加 FormView 其`ID`属性`Suppliers`。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-144">Add a FormView to the page by dragging it from the Toolbox onto the Designer and set its `ID` property to `Suppliers`.</span></span> <span data-ttu-id="8bfb0-145">从 FormView 的智能标记，选择创建名为新 ObjectDataSource `SuppliersDataSource`。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-145">From the FormView's smart tag, opt to create a new ObjectDataSource named `SuppliersDataSource`.</span></span>


<span data-ttu-id="8bfb0-146">[![创建名为 SuppliersDataSource 新对象数据源](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image10.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-146">[![Create a New ObjectDataSource Named SuppliersDataSource](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image10.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image9.png)</span></span>

<span data-ttu-id="8bfb0-147">**图 5**： 创建新对象数据源命名`SuppliersDataSource`([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-147">**Figure 5**: Create a New ObjectDataSource Named `SuppliersDataSource` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image11.png))</span></span>


<span data-ttu-id="8bfb0-148">配置此新对象数据源，以便它从查询`SuppliersBLL`类的`GetSuppliers()`方法 （请参阅图 6）。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-148">Configure this new ObjectDataSource such that it queries from the `SuppliersBLL` class's `GetSuppliers()` method (see Figure 6).</span></span> <span data-ttu-id="8bfb0-149">由于此 FormView 不提供用于更新供应商信息，请选择 (None) 选项从下拉列表中的更新选项卡中的接口。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-149">Since this FormView does not provide an interface for updating the supplier information, select the (None) option from the drop-down list in the UPDATE tab.</span></span>


<span data-ttu-id="8bfb0-150">[![配置数据源以使用 SuppliersBLL 类的 GetSuppliers() 方法](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image13.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-150">[![Configure the Data Source to use the SuppliersBLL Class s GetSuppliers() Method](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image13.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image12.png)</span></span>

<span data-ttu-id="8bfb0-151">**图 6**： 配置数据源以使用`SuppliersBLL`类的`GetSuppliers()`方法 ([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-151">**Figure 6**: Configure the Data Source to use the `SuppliersBLL` Class's `GetSuppliers()` Method ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image14.png))</span></span>


<span data-ttu-id="8bfb0-152">配置之后 ObjectDataSource，Visual Studio 将生成`InsertItemTemplate`， `EditItemTemplate`，和`ItemTemplate`FormView 有关。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-152">After configuring the ObjectDataSource, Visual Studio will generate an `InsertItemTemplate`, `EditItemTemplate`, and `ItemTemplate` for the FormView.</span></span> <span data-ttu-id="8bfb0-153">删除`InsertItemTemplate`和`EditItemTemplate`和修改`ItemTemplate`，使其显示仅供应商的公司名称和电话号码。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-153">Remove the `InsertItemTemplate` and `EditItemTemplate` and modify the `ItemTemplate` so that it displays just the supplier's company name and phone number.</span></span> <span data-ttu-id="8bfb0-154">最后，通过检查从其智能标记启用分页复选框开启 FormView 的分页支持 (或通过设置其`AllowPaging`属性`True`)。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-154">Finally, turn on paging support for the FormView by checking the Enable Paging checkbox from its smart tag (or by setting its `AllowPaging` property to `True`).</span></span> <span data-ttu-id="8bfb0-155">这些更改后页面的声明性标记应看起来类似于以下：</span><span class="sxs-lookup"><span data-stu-id="8bfb0-155">After these changes your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample2.aspx)]

<span data-ttu-id="8bfb0-156">图 7 显示 CustomButtons.aspx 页查看通过浏览器时。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-156">Figure 7 shows the CustomButtons.aspx page when viewed through a browser.</span></span>


<span data-ttu-id="8bfb0-157">[![FormView 列出 CompanyName 和从当前所选供应商的电话号码字段](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image16.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-157">[![The FormView Lists the CompanyName and Phone Fields from the Currently Selected Supplier](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image16.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image15.png)</span></span>

<span data-ttu-id="8bfb0-158">**图 7**: FormView 列出`CompanyName`和`Phone`中当前选定供应商的字段 ([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image17.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-158">**Figure 7**: The FormView Lists the `CompanyName` and `Phone` Fields from the Currently Selected Supplier ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image17.png))</span></span>


## <a name="step-3-adding-a-gridview-that-lists-the-selected-suppliers-products"></a><span data-ttu-id="8bfb0-159">步骤 3： 添加一个 GridView，列出所选供应商的产品</span><span class="sxs-lookup"><span data-stu-id="8bfb0-159">Step 3: Adding a GridView that Lists the Selected Supplier's Products</span></span>

<span data-ttu-id="8bfb0-160">我们将停止所有产品的按钮都添加到 FormView 的模板之前，让我们首先都添加下方列出的所选供应商提供的产品 FormView GridView。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-160">Before we add the Discontinue All Products Button to the FormView's template, let's first add a GridView beneath the FormView that lists the products provided by the selected supplier.</span></span> <span data-ttu-id="8bfb0-161">若要实现此目的，向页面添加一个 GridView，设置其`ID`属性`SuppliersProducts`，并添加名为新 ObjectDataSource `SuppliersProductsDataSource`。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-161">To accomplish this, add a GridView to the page, set its `ID` property to `SuppliersProducts`, and add a new ObjectDataSource named `SuppliersProductsDataSource`.</span></span>


<span data-ttu-id="8bfb0-162">[![创建名为 SuppliersProductsDataSource 新对象数据源](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image19.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-162">[![Create a New ObjectDataSource Named SuppliersProductsDataSource](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image19.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image18.png)</span></span>

<span data-ttu-id="8bfb0-163">**图 8**： 创建新对象数据源命名`SuppliersProductsDataSource`([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-163">**Figure 8**: Create a New ObjectDataSource Named `SuppliersProductsDataSource` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image20.png))</span></span>


<span data-ttu-id="8bfb0-164">配置为使用 ProductsBLL 类的此 ObjectDataSource`GetProductsBySupplierID(supplierID)`方法 （请参阅图 9）。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-164">Configure this ObjectDataSource to use the ProductsBLL class's `GetProductsBySupplierID(supplierID)` method (see Figure 9).</span></span> <span data-ttu-id="8bfb0-165">虽然产品的价格，以便可以调整将允许此 GridView，它将不使用内置编辑或删除从 GridView 的功能。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-165">While this GridView will allow for a product's price to be adjusted, it won't be using the built-in editing or deleting features from the GridView.</span></span> <span data-ttu-id="8bfb0-166">因此，我们可以设置为 (None) 下拉列表，ObjectDataSource 的插入、 更新和删除选项卡。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-166">Therefore, we can set the drop-down list to (None) for the ObjectDataSource's UPDATE, INSERT, and DELETE tabs.</span></span>


<span data-ttu-id="8bfb0-167">[![配置数据源以使用 ProductsBLL 类的 GetProductsBySupplierID(supplierID) 方法](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image22.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-167">[![Configure the Data Source to use the ProductsBLL Class s GetProductsBySupplierID(supplierID) Method](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image22.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image21.png)</span></span>

<span data-ttu-id="8bfb0-168">**图 9**： 配置数据源以使用`ProductsBLL`类的`GetProductsBySupplierID(supplierID)`方法 ([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image23.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-168">**Figure 9**: Configure the Data Source to use the `ProductsBLL` Class's `GetProductsBySupplierID(supplierID)` Method ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image23.png))</span></span>


<span data-ttu-id="8bfb0-169">由于`GetProductsBySupplierID(supplierID)`方法接受一个输入的参数，ObjectDataSource 向导将提示我们为此参数值的源。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-169">Since the `GetProductsBySupplierID(supplierID)` method accepts an input parameter, the ObjectDataSource wizard prompts us for the source of this parameter value.</span></span> <span data-ttu-id="8bfb0-170">若要传入`SupplierID`从 FormView 值时，请将参数源下拉列表设置为控制和到 ControlID 下拉列表`Suppliers`（在步骤 2 中创建的 FormView ID）。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-170">To pass in the `SupplierID` value from the FormView, set the Parameter source drop-down list to Control and the ControlID drop-down list to `Suppliers` (the ID of the FormView created in Step 2).</span></span>


<span data-ttu-id="8bfb0-171">[![指示，供应商 Id 参数应来自供应商 FormView 控件](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image25.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image24.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-171">[![Indicate that the supplierID Parameter Should Come from the Suppliers FormView Control](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image25.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image24.png)</span></span>

<span data-ttu-id="8bfb0-172">**图 10**： 指示*`supplierID`* 参数应来自`Suppliers`FormView 控件 ([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image26.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-172">**Figure 10**: Indicate that the *`supplierID`* Parameter Should Come from the `Suppliers` FormView Control ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image26.png))</span></span>


<span data-ttu-id="8bfb0-173">完成对象数据源向导后，命令将 BoundField 或 CheckBoxField 为每个产品的数据字段包含 GridView。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-173">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product's data fields.</span></span> <span data-ttu-id="8bfb0-174">让我们削减这以显示仅`ProductName`和`UnitPrice`连同 BoundFields `Discontinued` CheckBoxField; 此外，让我们格式`UnitPrice`BoundField 以便其文本设置为货币的格式。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-174">Let's trim this down to show just the `ProductName` and `UnitPrice` BoundFields along with the `Discontinued` CheckBoxField; furthermore, let's format the `UnitPrice` BoundField such that its text is formatted as a currency.</span></span> <span data-ttu-id="8bfb0-175">你 GridView 和`SuppliersProductsDataSource`ObjectDataSource 的声明性标记应类似于以下标记：</span><span class="sxs-lookup"><span data-stu-id="8bfb0-175">Your GridView and `SuppliersProductsDataSource` ObjectDataSource's declarative markup should look similar to the following markup:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample3.aspx)]

<span data-ttu-id="8bfb0-176">此时我们的教程中显示一个主/详细信息报告，允许用户从顶部 FormView 选取供应商，并查看通过底部 GridView 该供应商提供的产品。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-176">At this point our tutorial displays a master/details report, allowing the user to pick a supplier from the FormView at the top and to view the products provided by that supplier through the GridView at the bottom.</span></span> <span data-ttu-id="8bfb0-177">图 11 显示此页的屏幕截图时从 FormView 选择东京 Traders 供应商。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-177">Figure 11 shows a screen shot of this page when selecting the Tokyo Traders supplier from the FormView.</span></span>


<span data-ttu-id="8bfb0-178">[![选择供应商的产品将显示在 GridView](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image28.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-178">[![The Selected Supplier s Products are Displayed in the GridView](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image28.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image27.png)</span></span>

<span data-ttu-id="8bfb0-179">**图 11**: 选择供应商的产品显示在 GridView ([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image29.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-179">**Figure 11**: The Selected Supplier's Products are Displayed in the GridView ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image29.png))</span></span>


## <a name="step-4-creating-dal-and-bll-methods-to-discontinue-all-products-for-a-supplier"></a><span data-ttu-id="8bfb0-180">步骤 4： 创建 DAL 和 BLL 方法停止所有产品的供应商</span><span class="sxs-lookup"><span data-stu-id="8bfb0-180">Step 4: Creating DAL and BLL Methods to Discontinue All Products for a Supplier</span></span>

<span data-ttu-id="8bfb0-181">我们可以将按钮添加到 FormView 之前，单击时，终止所有的供应商的产品，我们首先需要将方法添加到的 DAL 和执行此操作的 BLL。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-181">Before we can add a Button to the FormView that, when clicked, discontinues all of the supplier's products, we first need to add a method to both the DAL and BLL that performs this action.</span></span> <span data-ttu-id="8bfb0-182">具体而言，此方法将被命名为`DiscontinueAllProductsForSupplier(supplierID)`。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-182">In particular, this method will be named `DiscontinueAllProductsForSupplier(supplierID)`.</span></span> <span data-ttu-id="8bfb0-183">单击 FormView 的按钮时，我们将调用此方法在业务逻辑层，传递在所选供应商的`SupplierID`; BLL 将然后向下调用到相应的数据访问层方法，将发出`UPDATE`语句终止指定供应商的产品的数据库。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-183">When the FormView's Button is clicked, we'll invoke this method in the Business Logic Layer, passing in the selected supplier's `SupplierID`; the BLL will then call down to the corresponding Data Access Layer method, which will issue an `UPDATE` statement to the database that discontinues the specified supplier's products.</span></span>

<span data-ttu-id="8bfb0-184">与我们在我们前面的教程，我们将使用自下而上的方法，启动与创建 DAL 方法，然后 BLL 方法，最后在 ASP.NET 页中实现功能。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-184">As we have done in our previous tutorials, we'll use a bottom-up approach, starting with creating the DAL method, then the BLL method, and finally implementing the functionality in the ASP.NET page.</span></span> <span data-ttu-id="8bfb0-185">打开`Northwind.xsd`中的类型化数据集`App_Code/DAL`文件夹并添加一个新方法`ProductsTableAdapter`(右键单击`ProductsTableAdapter`，然后选择添加查询)。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-185">Open the `Northwind.xsd` Typed DataSet in the `App_Code/DAL` folder and add a new method to the `ProductsTableAdapter` (right-click on the `ProductsTableAdapter` and choose Add Query).</span></span> <span data-ttu-id="8bfb0-186">这样将显示 TableAdapter 查询配置向导中，我们将指导完成添加新方法的过程。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-186">Doing so will bring up the TableAdapter Query Configuration wizard, which walks us through the process of adding the new method.</span></span> <span data-ttu-id="8bfb0-187">首先，该值指示我们 DAL 方法将使用的临时 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-187">Start by indicating that our DAL method will use an ad-hoc SQL statement.</span></span>


<span data-ttu-id="8bfb0-188">[![创建使用临时 SQL 语句的 DAL 方法](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image31.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image30.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-188">[![Create the DAL Method Using an Ad-Hoc SQL Statement](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image31.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image30.png)</span></span>

<span data-ttu-id="8bfb0-189">**图 12**： 创建 DAL 方法使用临时 SQL 语句 ([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image32.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-189">**Figure 12**: Create the DAL Method Using an Ad-Hoc SQL Statement ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image32.png))</span></span>


<span data-ttu-id="8bfb0-190">接下来，向导会提示有关哪种类型的查询以创建我们。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-190">Next, the wizard prompts us as to what type of query to create.</span></span> <span data-ttu-id="8bfb0-191">由于`DiscontinueAllProductsForSupplier(supplierID)`方法将需要更新`Products`数据库表，设置`Discontinued`字段为 1。 对于指定提供的所有产品*`supplierID`*，我们需要创建更新数据的查询。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-191">Since the `DiscontinueAllProductsForSupplier(supplierID)` method will need to update the `Products` database table, setting the `Discontinued` field to 1 for all products provided by the specified *`supplierID`*, we need to create a query that updates data.</span></span>


<span data-ttu-id="8bfb0-192">[![选择更新的查询类型](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image34.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-192">[![Choose the UPDATE Query Type](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image34.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image33.png)</span></span>

<span data-ttu-id="8bfb0-193">**图 13**： 选择更新的查询类型 ([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image35.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-193">**Figure 13**: Choose the UPDATE Query Type ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image35.png))</span></span>


<span data-ttu-id="8bfb0-194">下一步的向导屏幕提供现有 TableAdapter 的`UPDATE`语句，这将更新每个定义中的字段`Products`DataTable。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-194">The next wizard screen provides the TableAdapter's existing `UPDATE` statement, which updates each of the fields defined in the `Products` DataTable.</span></span> <span data-ttu-id="8bfb0-195">此查询文本替换为以下语句：</span><span class="sxs-lookup"><span data-stu-id="8bfb0-195">Replace this query text with the following statement:</span></span>

[!code-sql[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample4.sql)]

<span data-ttu-id="8bfb0-196">输入此查询，并单击下一步后, 的最后一个向导屏幕要求提供新方法的名称使用`DiscontinueAllProductsForSupplier`。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-196">After entering this query and clicking Next, the last wizard screen asks for the new method's name use `DiscontinueAllProductsForSupplier`.</span></span> <span data-ttu-id="8bfb0-197">通过单击完成按钮完成向导。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-197">Complete the wizard by clicking the Finish button.</span></span> <span data-ttu-id="8bfb0-198">返回到数据集设计器时，您应看到中的新方法`ProductsTableAdapter`名为`DiscontinueAllProductsForSupplier(@SupplierID)`。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-198">Upon returning to the DataSet Designer you should see a new method in the `ProductsTableAdapter` named `DiscontinueAllProductsForSupplier(@SupplierID)`.</span></span>


<span data-ttu-id="8bfb0-199">[![新的 DAL 方法 DiscontinueAllProductsForSupplier 名称](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image37.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image36.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-199">[![Name the New DAL Method DiscontinueAllProductsForSupplier](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image37.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image36.png)</span></span>

<span data-ttu-id="8bfb0-200">**图 14**： 将新的 DAL 方法`DiscontinueAllProductsForSupplier`([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image38.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-200">**Figure 14**: Name the New DAL Method `DiscontinueAllProductsForSupplier` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image38.png))</span></span>


<span data-ttu-id="8bfb0-201">与`DiscontinueAllProductsForSupplier(supplierID)`在数据访问层中创建的方法，我们的下一个任务是创建`DiscontinueAllProductsForSupplier(supplierID)`业务逻辑层中的方法。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-201">With the `DiscontinueAllProductsForSupplier(supplierID)` method created in the Data Access Layer, our next task is to create the `DiscontinueAllProductsForSupplier(supplierID)` method in the Business Logic Layer.</span></span> <span data-ttu-id="8bfb0-202">若要完成此操作，打开`ProductsBLL`类文件并添加以下：</span><span class="sxs-lookup"><span data-stu-id="8bfb0-202">To accomplish this, open the `ProductsBLL` class file and add the following:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample5.cs)]

<span data-ttu-id="8bfb0-203">此方法只需调用直至`DiscontinueAllProductsForSupplier(supplierID)`中 DAL，沿提供传递方法*`supplierID`* 参数值。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-203">This method simply calls down to the `DiscontinueAllProductsForSupplier(supplierID)` method in the DAL, passing along the provided *`supplierID`* parameter value.</span></span> <span data-ttu-id="8bfb0-204">如果没有要在某些情况下停用的供应商的产品，只允许任何业务规则，这些规则应 BLL 在此处，实现。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-204">If there were any business rules that only allowed a supplier's products to be discontinued under certain circumstances, those rules should be implemented here, in the BLL.</span></span>

> [!NOTE]
> <span data-ttu-id="8bfb0-205">与不同`UpdateProduct`重载以`ProductsBLL`类，`DiscontinueAllProductsForSupplier(supplierID)`方法签名不包括`DataObjectMethodAttribute`属性 (`<System.ComponentModel.DataObjectMethodAttribute(System.ComponentModel.DataObjectMethodType.Update, Boolean)>`)。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-205">Unlike the `UpdateProduct` overloads in the `ProductsBLL` class, the `DiscontinueAllProductsForSupplier(supplierID)` method signature does not include the `DataObjectMethodAttribute` attribute (`<System.ComponentModel.DataObjectMethodAttribute(System.ComponentModel.DataObjectMethodType.Update, Boolean)>`).</span></span> <span data-ttu-id="8bfb0-206">这将阻止`DiscontinueAllProductsForSupplier(supplierID)`从 ObjectDataSource 的配置数据源向导的下拉列表中更新选项卡的方法。我已省略此属性，因为我们将调用`DiscontinueAllProductsForSupplier(supplierID)`直接从我们 ASP.NET 页中的事件处理方法。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-206">This precludes the `DiscontinueAllProductsForSupplier(supplierID)` method from the ObjectDataSource's Configure Data Source wizard's drop-down list in the UPDATE tab. I ve omitted this attribute because we'll be calling the `DiscontinueAllProductsForSupplier(supplierID)` method directly from an event handler in our ASP.NET page.</span></span>


## <a name="step-5-adding-a-discontinue-all-products-button-to-the-formview"></a><span data-ttu-id="8bfb0-207">步骤 5： 添加停止 FormView 到的所有产品按钮</span><span class="sxs-lookup"><span data-stu-id="8bfb0-207">Step 5: Adding a Discontinue All Products Button to the FormView</span></span>

<span data-ttu-id="8bfb0-208">与`DiscontinueAllProductsForSupplier(supplierID)`方法中的 BLL 和 DAL 完成，最后一个步骤添加为所选供应商停止所有产品的功能是将按钮 Web 控件添加到 FormView `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-208">With the `DiscontinueAllProductsForSupplier(supplierID)` method in the BLL and DAL complete, the final step for adding the ability to discontinue all products for the selected supplier is to add a Button Web control to the FormView's `ItemTemplate`.</span></span> <span data-ttu-id="8bfb0-209">让我们添加与按钮文本，停止所有产品的供应商的电话号码下面这样的按钮和`ID`属性值`DiscontinueAllProductsForSupplier`。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-209">Let's add such a Button below the supplier's phone number with the button text, Discontinue All Products and an `ID` property value of `DiscontinueAllProductsForSupplier`.</span></span> <span data-ttu-id="8bfb0-210">你可以通过单击 FormView 的智能标记中的编辑模板链接来添加此按钮 Web 控件通过设计器 （请参阅图 15），或直接通过声明性语法。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-210">You can add this Button Web control through the Designer by clicking on the Edit Templates link in the FormView's smart tag (see Figure 15), or directly through the declarative syntax.</span></span>


<span data-ttu-id="8bfb0-211">[![添加停止所有产品按钮 Web 控件到 FormView 的 ItemTemplate](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image40.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-211">[![Add a Discontinue All Products Button Web Control to the FormView s ItemTemplate](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image40.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image39.png)</span></span>

<span data-ttu-id="8bfb0-212">**图 15**： 将停止所有产品按钮 Web 控件都添加到 FormView `ItemTemplate` ([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image41.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-212">**Figure 15**: Add a Discontinue All Products Button Web Control to the FormView's `ItemTemplate` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image41.png))</span></span>


<span data-ttu-id="8bfb0-213">当通过页上，回发时，才会用户访问和 FormView 单击该按钮[`ItemCommand`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.itemcommand.aspx)激发。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-213">When the Button is clicked by a user visiting the page, a postback ensues and the FormView's [`ItemCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.itemcommand.aspx) fires.</span></span> <span data-ttu-id="8bfb0-214">若要执行自定义代码以响应单击此按钮，我们可以创建的事件处理程序此事件。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-214">To execute custom code in response to this Button being clicked, we can create an event handler for this event.</span></span> <span data-ttu-id="8bfb0-215">理解，不过，这`ItemCommand`事件时将触发*任何*FormView 内单击按钮、 LinkButton 或 ImageButton Web 控件。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-215">Understand, though, that the `ItemCommand` event fires whenever *any* Button, LinkButton, or ImageButton Web control is clicked within the FormView.</span></span> <span data-ttu-id="8bfb0-216">这意味着，当用户从一页移到另一种 FormView，`ItemCommand`事件激发; 当用户单击新建，编辑，或删除支持插入、 更新或删除 FormView 中的内容相同。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-216">That means that when the user moves from one page to another in the FormView, the `ItemCommand` event fires; same thing when the user clicks New, Edit, or Delete in a FormView that supports inserting, updating, or deleting.</span></span>

<span data-ttu-id="8bfb0-217">由于`ItemCommand`激发而不考虑哪些按钮后，事件处理程序我们需要一种方法，以确定被单击了停止所有的产品按钮，或者如果它已某些其他按钮。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-217">Since the `ItemCommand` fires regardless of what button is clicked, in the event handler we need a way to determine if the Discontinue All Products Button was clicked or if it was some other button.</span></span> <span data-ttu-id="8bfb0-218">若要实现此目的，我们可以设置按钮 Web 控件的`CommandName`为某个标识值的属性。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-218">To accomplish this, we can set the Button Web control's `CommandName` property to some identifying value.</span></span> <span data-ttu-id="8bfb0-219">单击按钮时，这`CommandName`值传递给`ItemCommand`事件处理程序，使我们能够确定是否停止所有的产品按钮所单击的按钮。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-219">When the Button is clicked, this `CommandName` value is passed into the `ItemCommand` event handler, enabling us to determine whether the Discontinue All Products Button was the button clicked.</span></span> <span data-ttu-id="8bfb0-220">设置停止所有产品按钮的`CommandName`DiscontinueProducts 属性。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-220">Set the Discontinue All Products Button's `CommandName` property to DiscontinueProducts .</span></span>

<span data-ttu-id="8bfb0-221">最后，让我们使用客户端确认对话框中以确保用户确实想要停止所选供应商的产品。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-221">Finally, let's use a client-side confirm dialog box to ensure that the user really wants to discontinue the selected supplier's products.</span></span> <span data-ttu-id="8bfb0-222">正如我们看到在[删除时添加客户端确认](../editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-cs.md)教程，则此操作可以稍加 JavaScript 完成。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-222">As we saw in the [Adding Client-Side Confirmation When Deleting](../editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-cs.md) tutorial, this can be accomplished with a bit of JavaScript.</span></span> <span data-ttu-id="8bfb0-223">具体而言，将按钮 Web 控件的 OnClientClick 属性设置为 `return confirm('This will mark _all_ of this supplier\'s products as discontinued. Are you certain you want to do this?');`</span><span class="sxs-lookup"><span data-stu-id="8bfb0-223">In particular, set the Button Web control's OnClientClick property to `return confirm('This will mark _all_ of this supplier\'s products as discontinued. Are you certain you want to do this?');`</span></span>

<span data-ttu-id="8bfb0-224">进行这些更改后，FormView 的声明性语法，应如下所示：</span><span class="sxs-lookup"><span data-stu-id="8bfb0-224">After making these changes, the FormView's declarative syntax should look like the following:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample6.aspx)]

<span data-ttu-id="8bfb0-225">接下来，为 FormView 创建事件处理程序`ItemCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-225">Next, create an event handler for the FormView's `ItemCommand` event.</span></span> <span data-ttu-id="8bfb0-226">在此事件处理程序，我们需要首先确定是否已单击停止所有的产品按钮。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-226">In this event handler we need to first determine whether the Discontinue All Products Button was clicked.</span></span> <span data-ttu-id="8bfb0-227">如果这样，我们想要创建的实例`ProductsBLL`类并调用其`DiscontinueAllProductsForSupplier(supplierID)`方法，同时传入`SupplierID`的所选 FormView:</span><span class="sxs-lookup"><span data-stu-id="8bfb0-227">If so, we want to create an instance of the `ProductsBLL` class and invoke its `DiscontinueAllProductsForSupplier(supplierID)` method, passing in the `SupplierID` of the selected FormView:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample7.cs)]

<span data-ttu-id="8bfb0-228">请注意， `SupplierID` FormView 中当前选定的供应商可以使用访问 FormView [ `SelectedValue`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.selectedvalue.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-228">Note that the `SupplierID` of the current selected supplier in the FormView can be accessed using the FormView's [`SelectedValue` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.selectedvalue.aspx).</span></span> <span data-ttu-id="8bfb0-229">`SelectedValue`属性返回的第一个数据键显示在 FormView 该记录的值。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-229">The `SelectedValue` property returns the first data key value for the record being displayed in the FormView.</span></span> <span data-ttu-id="8bfb0-230">FormView [ `DataKeyNames`属性](https://msdn.microsoft.com/system.web.ui.webcontrols.formview.datakeynames.aspx)，指示的数据字段的数据从其键值值来自，已自动设置为`SupplierID`由 Visual Studio 时将对象数据源绑定到 FormView返回在步骤 2 中。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-230">The FormView's [`DataKeyNames` property](https://msdn.microsoft.com/system.web.ui.webcontrols.formview.datakeynames.aspx), which indicates the data fields from which the data key values are pulled from, was automatically set to `SupplierID` by Visual Studio when binding the ObjectDataSource to the FormView back in Step 2.</span></span>

<span data-ttu-id="8bfb0-231">与`ItemCommand`事件处理程序创建，花些时间测试的页。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-231">With the `ItemCommand` event handler created, take a moment to test out the page.</span></span> <span data-ttu-id="8bfb0-232">浏览到 Cooperativa de Quesos 的 Cabras 供应商 （它是第五个供应商为我 FormView 中的）。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-232">Browse to the Cooperativa de Quesos 'Las Cabras' supplier (it's the fifth supplier in the FormView for me).</span></span> <span data-ttu-id="8bfb0-233">此供应商可提供两种产品，Queso Cabrales 和 Queso Manchego La Pastora，二者都是*不*停止使用。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-233">This supplier provides two products, Queso Cabrales and Queso Manchego La Pastora, both of which are *not* discontinued.</span></span>

<span data-ttu-id="8bfb0-234">假设 Cooperativa de Quesos 的 Cabras 已超出业务，因此要停用其产品。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-234">Imagine that Cooperativa de Quesos 'Las Cabras' has gone out of business and therefore its products are to be discontinued.</span></span> <span data-ttu-id="8bfb0-235">单击停止所有产品按钮。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-235">Click the Discontinue All Products Button.</span></span> <span data-ttu-id="8bfb0-236">这将显示客户端确认对话框框中 （请参阅图 16）。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-236">This will display the client-side confirm dialog box (see Figure 16).</span></span>


<span data-ttu-id="8bfb0-237">[![Cooperativa de Quesos 的 Cabras 提供两个活动产品](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image43.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-237">[![Cooperativa de Quesos Las Cabras Supplies Two Active Products](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image43.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image42.png)</span></span>

<span data-ttu-id="8bfb0-238">**图 16**: Cooperativa de Quesos 的 Cabras 提供两个活动产品 ([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image44.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-238">**Figure 16**: Cooperativa de Quesos Las Cabras Supplies Two Active Products ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image44.png))</span></span>


<span data-ttu-id="8bfb0-239">如果单击确定在客户端确认对话框中，表单提交将继续，在其中导致回发 FormView`ItemCommand`事件将激发。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-239">If you click OK in the client-side confirm dialog box, the form submission will proceed, causing a postback in which the FormView's `ItemCommand` event will fire.</span></span> <span data-ttu-id="8bfb0-240">我们创建的事件处理程序然后执行调用`DiscontinueAllProductsForSupplier(supplierID)`方法和中止 Queso Cabrales 和 Queso Manchego La Pastora 产品。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-240">The event handler we created will then execute, invoking the `DiscontinueAllProductsForSupplier(supplierID)` method and discontinuing both the Queso Cabrales and Queso Manchego La Pastora products.</span></span>

<span data-ttu-id="8bfb0-241">如果你已禁用 GridView 的视图状态，GridView 是正在重新绑定的到基础数据存储在每个回发时，并因此将立即更新以反映，这两个产品现在不再 （请参阅图 17）。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-241">If you have disabled the GridView's view state, the GridView is being rebound to the underlying data store on every postback, and therefore will immediately be updated to reflect that these two products are now discontinued (see Figure 17).</span></span> <span data-ttu-id="8bfb0-242">如果，但是，不具有已禁用 GridView 中的视图状态，你将需要手动进行此更改后重新绑定到 GridView 的数据。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-242">If, however, you have not disabled view state in the GridView, you will need to manually rebind the data to the GridView after making this change.</span></span> <span data-ttu-id="8bfb0-243">要完成此操作，只需进行到 GridView 的调用`DataBind()`方法调用后立即`DiscontinueAllProductsForSupplier(supplierID)`方法。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-243">To accomplish this, simply make a call to the GridView's `DataBind()` method immediately after invoking the `DiscontinueAllProductsForSupplier(supplierID)` method.</span></span>


<span data-ttu-id="8bfb0-244">[![单击停止所有的产品按钮后，供应商的产品更新相应地受到](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image46.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-244">[![After Clicking the Discontinue All Products Button, the Supplier s Products are Updated Accordingly](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image46.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image45.png)</span></span>

<span data-ttu-id="8bfb0-245">**图 17**： 单击停止所有的产品按钮后，供应商的产品更新相应地受到 ([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image47.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-245">**Figure 17**: After Clicking the Discontinue All Products Button, the Supplier's Products are Updated Accordingly ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image47.png))</span></span>


## <a name="step-6-creating-an-updateproduct-overload-in-the-business-logic-layer-for-adjusting-a-products-price"></a><span data-ttu-id="8bfb0-246">步骤 6： 在调整产品的价格的业务逻辑层中创建的 UpdateProduct 重载</span><span class="sxs-lookup"><span data-stu-id="8bfb0-246">Step 6: Creating an UpdateProduct Overload in the Business Logic Layer for Adjusting a Product's Price</span></span>

<span data-ttu-id="8bfb0-247">如与停止所有产品中的按钮 FormView，以添加用于增加和减少 GridView 中的产品的价格按钮我们需要先添加适当的数据访问层和业务逻辑层方法。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-247">Like with the Discontinue All Products Button in the FormView, in order to add buttons for increasing and decreasing the price for a product in the GridView we need to first add the appropriate Data Access Layer and Business Logic Layer methods.</span></span> <span data-ttu-id="8bfb0-248">由于我们已有更新 DAL 中的单个产品行的方法，我们可以通过创建新的重载，以提供此类功能`UpdateProduct`BLL 中的方法。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-248">Since we already have a method that updates a single product row in the DAL, we can provide such functionality by creating a new overload for the `UpdateProduct` method in the BLL.</span></span>

<span data-ttu-id="8bfb0-249">我们过去`UpdateProduct`重载取得产品字段的某种组合为标量的输入值，然后更新了指定的产品仅对这些字段。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-249">Our past `UpdateProduct` overloads have taken in some combination of product fields as scalar input values and have then updated just those fields for the specified product.</span></span> <span data-ttu-id="8bfb0-250">此重载中，我们将略有不同于此标准并改为传入的产品的`ProductID`和用来调整百分比`UnitPrice`(而不是在新的传递，调整`UnitPrice`本身)。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-250">For this overload we'll vary slightly from this standard and instead pass in the product's `ProductID` and the percentage by which to adjust the `UnitPrice` (as opposed to passing in the new, adjusted `UnitPrice` itself).</span></span> <span data-ttu-id="8bfb0-251">此方法将简化我们需要编写在 ASP.NET 页的代码隐藏类中，由于我们没有向确定当前产品的两个代码`UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-251">This approach will simplify the code we need to write in the ASP.NET page code-behind class, since we don't have to bother with determining the current product's `UnitPrice`.</span></span>

<span data-ttu-id="8bfb0-252">`UpdateProduct`重载为本教程中所示：</span><span class="sxs-lookup"><span data-stu-id="8bfb0-252">The `UpdateProduct` overload for this tutorial is shown below:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample8.cs)]

<span data-ttu-id="8bfb0-253">此重载检索有关 DAL 的通过指定的产品信息`GetProductByProductID(productID)`方法。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-253">This overload retrieves information about the specified product through the DAL's `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="8bfb0-254">然后，它将检查以确定是否该产品的`UnitPrice`分配数据库`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-254">It then checks to see whether the product's `UnitPrice` is assigned a database `NULL` value.</span></span> <span data-ttu-id="8bfb0-255">如果是，价格将保持不变。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-255">If it is, the price is left unaltered.</span></span> <span data-ttu-id="8bfb0-256">如果，但是，没有非`NULL``UnitPrice`值，该方法更新该产品的`UnitPrice`由指定的百分比 (`unitPriceAdjustmentPercent`)。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-256">If, however, there is a non-`NULL` `UnitPrice` value, the method updates the product's `UnitPrice` by the specified percent (`unitPriceAdjustmentPercent`).</span></span>

## <a name="step-7-adding-the-increase-and-decrease-buttons-to-the-gridview"></a><span data-ttu-id="8bfb0-257">步骤 7： 将增加和减少按钮添加到 GridView</span><span class="sxs-lookup"><span data-stu-id="8bfb0-257">Step 7: Adding the Increase and Decrease Buttons to the GridView</span></span>

<span data-ttu-id="8bfb0-258">GridView （和说明如何） 都组成的字段的集合。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-258">The GridView (and DetailsView) are both made up of a collection of fields.</span></span> <span data-ttu-id="8bfb0-259">除了 BoundFields、 CheckBoxFields 和 TemplateFields，ASP.NET 还包括 ButtonField，来顾名思义，呈现为带有按钮、 LinkButton 或 ImageButton 每一行的列。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-259">In addition to BoundFields, CheckBoxFields, and TemplateFields, ASP.NET includes the ButtonField, which, as its name implies, renders as a column with a Button, LinkButton, or ImageButton for each row.</span></span> <span data-ttu-id="8bfb0-260">类似于 FormView，单击*任何*GridView 分页按钮、 编辑或删除按钮、 排序按钮等中的按钮导致回发，并引发 GridView [ `RowCommand`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowcommand.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-260">Similar to the FormView, clicking *any* button within the GridView paging buttons, Edit or Delete buttons, sorting buttons, and so on causes a postback and raises the GridView's [`RowCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowcommand.aspx).</span></span>

<span data-ttu-id="8bfb0-261">ButtonField 具有`CommandName`属性，将指定的值分配给每个其按钮`CommandName`属性。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-261">The ButtonField has a `CommandName` property that assigns the specified value to each of its Buttons `CommandName` properties.</span></span> <span data-ttu-id="8bfb0-262">FormView，与类似`CommandName`值由`RowCommand`事件处理程序来确定被单击的按钮。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-262">Like with the FormView, the `CommandName` value is used by the `RowCommand` event handler to determine which button was clicked.</span></span>

<span data-ttu-id="8bfb0-263">让我们将两个新 ButtonFields 添加到 GridView，一个按钮文本价格 + 10%和另一种具有文本价格-10%。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-263">Let's add two new ButtonFields to the GridView, one with a button text Price +10% and the other with the text Price -10%.</span></span> <span data-ttu-id="8bfb0-264">若要添加这些 ButtonFields，单击从 GridView 的智能标记的编辑列链接，从左上方列表中选择 ButtonField 字段类型，然后单击添加按钮。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-264">To add these ButtonFields, click on the Edit Columns link from the GridView's smart tag, select the ButtonField field type from the list in the upper left and click the Add button.</span></span>


![将两个 ButtonFields 添加到 GridView](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image48.png)

<span data-ttu-id="8bfb0-266">**图 18**： 将两个 ButtonFields 添加到 GridView</span><span class="sxs-lookup"><span data-stu-id="8bfb0-266">**Figure 18**: Add Two ButtonFields to the GridView</span></span>


<span data-ttu-id="8bfb0-267">移动两个 ButtonFields，以便它们显示为前两个 GridView 字段。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-267">Move the two ButtonFields so that they appear as the first two GridView fields.</span></span> <span data-ttu-id="8bfb0-268">接下来，设置`Text`这些以价格 + 10%的两个 ButtonFields 和价格-10 的属性 %和`CommandName`为 IncreasePrice 和 DecreasePrice，属性分别。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-268">Next, set the `Text` properties of these two ButtonFields to Price +10% and Price -10% and the `CommandName` properties to IncreasePrice and DecreasePrice, respectively.</span></span> <span data-ttu-id="8bfb0-269">默认情况下，ButtonField 呈现 LinkButtons 按钮其列。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-269">By default, a ButtonField renders its column of buttons as LinkButtons.</span></span> <span data-ttu-id="8bfb0-270">可进行更改，但是，通过 ButtonField [ `ButtonType`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.buttonfieldbase.buttontype.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-270">This can be changed, however, through the ButtonField's [`ButtonType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.buttonfieldbase.buttontype.aspx).</span></span> <span data-ttu-id="8bfb0-271">让我们来看呈现为常规下压按钮; 这些两个 ButtonFields因此，设置`ButtonType`属性`Button`。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-271">Let's have these two ButtonFields rendered as regular push buttons; therefore, set the `ButtonType` property to `Button`.</span></span> <span data-ttu-id="8bfb0-272">图 19 显示的字段对话框中进行这些更改; 之后以下的是 GridView 的声明性标记。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-272">Figure 19 shows the Fields dialog box after these changes have been made; following that is the GridView's declarative markup.</span></span>


![配置 ButtonFields 文本、 CommandName 和 ButtonType 属性](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image49.png)

<span data-ttu-id="8bfb0-274">**图 19**： 配置 ButtonFields `Text`， `CommandName`，和`ButtonType`属性</span><span class="sxs-lookup"><span data-stu-id="8bfb0-274">**Figure 19**: Configure the ButtonFields `Text`, `CommandName`, and `ButtonType` Properties</span></span>


[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample9.aspx)]

<span data-ttu-id="8bfb0-275">创建这些 ButtonFields，最后一步是创建事件处理程序为 GridView 的`RowCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-275">With these ButtonFields created, the final step is to create an event handler for the GridView's `RowCommand` event.</span></span> <span data-ttu-id="8bfb0-276">此事件处理程序，如果引发因为任一价格 + 10%或价格-10%按钮已单击，需要确定`ProductID`行其按钮被单击，然后调用`ProductsBLL`类的`UpdateProduct`传递在相应的方法`UnitPrice`连同百分比调整`ProductID`。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-276">This event handler, if fired because either the Price +10% or Price -10% buttons were clicked, needs to determine the `ProductID` for the row whose button was clicked and then invoke the `ProductsBLL` class's `UpdateProduct` method, passing in the appropriate `UnitPrice` percentage adjustment along with the `ProductID`.</span></span> <span data-ttu-id="8bfb0-277">下面的代码执行这些任务：</span><span class="sxs-lookup"><span data-stu-id="8bfb0-277">The following code performs these tasks:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample10.cs)]

<span data-ttu-id="8bfb0-278">若要确定`ProductID`行其价格 + 10%或价格-10%按钮被单击，我们需要参考 GridView`DataKeys`集合。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-278">In order to determine the `ProductID` for the row whose Price +10% or Price -10% button was clicked, we need to consult the GridView's `DataKeys` collection.</span></span> <span data-ttu-id="8bfb0-279">此集合保存中指定的字段的值`DataKeyNames`为每个 GridView 行的属性。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-279">This collection holds the values of the fields specified in the `DataKeyNames` property for each GridView row.</span></span> <span data-ttu-id="8bfb0-280">由于 GridView`DataKeyNames`属性设置为 ProductID 由 Visual Studio 时，绑定到 GridView，ObjectDataSource`DataKeys(rowIndex).Value`提供`ProductID`指定*rowIndex*。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-280">Since the GridView's `DataKeyNames` property was set to ProductID by Visual Studio when binding the ObjectDataSource to the GridView, `DataKeys(rowIndex).Value` provides the `ProductID` for the specified *rowIndex*.</span></span>

<span data-ttu-id="8bfb0-281">中会自动将传递 ButtonField *rowIndex*通过其按钮的行`e.CommandArgument`参数。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-281">The ButtonField automatically passes in the *rowIndex* of the row whose button was clicked through the `e.CommandArgument` parameter.</span></span> <span data-ttu-id="8bfb0-282">因此，若要确定`ProductID`行其价格 + 10%或价格-10%按钮被单击，我们使用： `Convert.ToInt32(SuppliersProducts.DataKeys(Convert.ToInt32(e.CommandArgument)).Value)`。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-282">Therefore, to determine the `ProductID` for the row whose Price +10% or Price -10% button was clicked, we use: `Convert.ToInt32(SuppliersProducts.DataKeys(Convert.ToInt32(e.CommandArgument)).Value)`.</span></span>

<span data-ttu-id="8bfb0-283">使用停止所有产品按钮，如果你已禁用 GridView 的视图状态，GridView 是正在重新绑定的到基础数据存储在每个回发时，以及因此将立即更新以反映，从单击发生的价格更改任一按钮。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-283">As with the Discontinue All Products button, if you have disabled the GridView's view state, the GridView is being rebound to the underlying data store on every postback, and therefore will immediately be updated to reflect a price change that occurs from clicking either of the buttons.</span></span> <span data-ttu-id="8bfb0-284">如果，但是，不具有已禁用 GridView 中的视图状态，你将需要手动进行此更改后重新绑定到 GridView 的数据。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-284">If, however, you have not disabled view state in the GridView, you will need to manually rebind the data to the GridView after making this change.</span></span> <span data-ttu-id="8bfb0-285">要完成此操作，只需进行到 GridView 的调用`DataBind()`方法调用后立即`UpdateProduct`方法。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-285">To accomplish this, simply make a call to the GridView's `DataBind()` method immediately after invoking the `UpdateProduct` method.</span></span>

<span data-ttu-id="8bfb0-286">图 20 查看祖母 Kelly 家居所提供的产品时显示的页。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-286">Figure 20 shows the page when viewing the products provided by Grandma Kelly's Homestead.</span></span> <span data-ttu-id="8bfb0-287">图 21 显示结果后价格 + 10%按钮单击后两次以祖母梅分布和价格-10%按钮一次为 Cranberry 胡椒粉。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-287">Figure 21 shows the results after the Price +10% button has been clicked twice for Grandma's Boysenberry Spread and the Price -10% button once for Northwoods Cranberry Sauce.</span></span>


<span data-ttu-id="8bfb0-288">[![GridView 包括价格 + 10%和价格-10%按钮](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image51.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image50.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-288">[![The GridView Includes Price +10% and Price -10% Buttons](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image51.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image50.png)</span></span>

<span data-ttu-id="8bfb0-289">**图 20**: GridView 包括价格 + 10%和价格-10%按钮 ([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image52.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-289">**Figure 20**: The GridView Includes Price +10% and Price -10% Buttons ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image52.png))</span></span>


<span data-ttu-id="8bfb0-290">[![第一个和第三个产品的价格已更新通过价格 + 10%和价格-10%按钮](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image54.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image53.png)</span><span class="sxs-lookup"><span data-stu-id="8bfb0-290">[![The Prices for the First and Third Product Have Been Updated via the Price +10% and Price -10% Buttons](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image54.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image53.png)</span></span>

<span data-ttu-id="8bfb0-291">**图 21**: 价格的第一个和第三个产品已更新通过价格 + 10%和价格-10%按钮 ([单击以查看实际尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image55.png))</span><span class="sxs-lookup"><span data-stu-id="8bfb0-291">**Figure 21**: The Prices for the First and Third Product Have Been Updated via the Price +10% and Price -10% Buttons ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image55.png))</span></span>


> [!NOTE]
> <span data-ttu-id="8bfb0-292">按钮、 LinkButtons 或添加到其 TemplateFields ImageButtons 还可以具有的 GridView （和说明）。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-292">The GridView (and DetailsView) can also have Buttons, LinkButtons, or ImageButtons added to their TemplateFields.</span></span> <span data-ttu-id="8bfb0-293">如与 BoundField 这些按钮，单击时，将引入回发，则引发 GridView`RowCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-293">As with the BoundField, these Buttons, when clicked, will induce a postback, raising the GridView's `RowCommand` event.</span></span> <span data-ttu-id="8bfb0-294">当添加中的按钮为 TemplateField，但是，该按钮的`CommandArgument`未自动设置为行的索引按原样使用 ButtonFields 时。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-294">When adding buttons in a TemplateField, however, the Button's `CommandArgument` is not automatically set to the index of the row as it is when using ButtonFields.</span></span> <span data-ttu-id="8bfb0-295">如果你需要确定被单击中的按钮的行索引`RowCommand`事件处理程序，你将需要手动设置按钮的`CommandArgument`TemplateField，使用如下代码在其声明性语法中的属性：</span><span class="sxs-lookup"><span data-stu-id="8bfb0-295">If you need to determine the row index of the button that was clicked within the `RowCommand` event handler, you'll need to manually set the Button's `CommandArgument` property in its declarative syntax within the TemplateField, using code like:</span></span>  
> <span data-ttu-id="8bfb0-296">`<asp:Button runat="server" ... CommandArgument='<%# ((GridViewRow) Container).RowIndex %>'`。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-296">`<asp:Button runat="server" ... CommandArgument='<%# ((GridViewRow) Container).RowIndex %>'`.</span></span>


## <a name="summary"></a><span data-ttu-id="8bfb0-297">总结</span><span class="sxs-lookup"><span data-stu-id="8bfb0-297">Summary</span></span>

<span data-ttu-id="8bfb0-298">所有的 GridView、 说明如何和 FormView 控制可以包括按钮、 LinkButtons 或 ImageButtons。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-298">The GridView, DetailsView, and FormView controls all can include Buttons, LinkButtons, or ImageButtons.</span></span> <span data-ttu-id="8bfb0-299">此类按钮，单击时，会导致回发和引发`ItemCommand`FormView 和说明如何控件中的事件和`RowCommand`GridView 中的事件。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-299">Such buttons, when clicked, cause a postback and raise the `ItemCommand` event in the FormView and DetailsView controls and the `RowCommand` event in the GridView.</span></span> <span data-ttu-id="8bfb0-300">这些数据 Web 控件具有内置功能来处理常见的命令相关的操作，如删除或编辑记录。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-300">These data Web controls have built-in functionality to handle common command-related actions, such as deleting or editing records.</span></span> <span data-ttu-id="8bfb0-301">但是，我们可以还使用按钮，单击时，使用执行自己的自定义代码进行响应。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-301">However, we can also use buttons that, when clicked, respond with executing our own custom code.</span></span>

<span data-ttu-id="8bfb0-302">若要实现此目的，我们需要创建的事件处理程序`ItemCommand`或`RowCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-302">To accomplish this, we need to create an event handler for the `ItemCommand` or `RowCommand` event.</span></span> <span data-ttu-id="8bfb0-303">此事件处理程序中我们首先检查传入`CommandName`值以确定被单击的按钮，然后采取相应的自定义操作。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-303">In this event handler we first check the incoming `CommandName` value to determine which button was clicked and then take appropriate custom action.</span></span> <span data-ttu-id="8bfb0-304">在本教程中，我们将了解如何使用按钮和 ButtonFields 停止指定的供应商的所有产品或用于增加或减少 10%的特定产品的价格。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-304">In this tutorial we saw how to use buttons and ButtonFields to discontinue all products for a specified supplier or to increase or decrease the price of a particular product by 10%.</span></span>

<span data-ttu-id="8bfb0-305">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="8bfb0-305">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="8bfb0-306">关于作者</span><span class="sxs-lookup"><span data-stu-id="8bfb0-306">About the Author</span></span>

<span data-ttu-id="8bfb0-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七个 ASP/ASP.NET 书籍和的创始人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年使用与 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="8bfb0-308">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-308">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="8bfb0-309">最新书籍是[ *Sam 教授自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-309">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="8bfb0-310">他可以达到在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或通过他的博客，其中可以找到在[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="8bfb0-310">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="8bfb0-311">下一篇</span><span class="sxs-lookup"><span data-stu-id="8bfb0-311">Next</span></span>](adding-and-responding-to-buttons-to-a-gridview-vb.md)
