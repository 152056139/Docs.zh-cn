---
uid: web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
title: "创建业务逻辑层 (C#) |Microsoft 文档"
author: rick-anderson
description: "在本教程中我们将了解如何集中到业务逻辑层 (BLL) 充当一个中介以便 t 之间交换数据的业务规则..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/31/2010
ms.topic: article
ms.assetid: 85554606-47cb-4e4f-9848-eed9da579056
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: 7518ddd11a05a9e3d5df85e3cf6ceffa09a25060
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/24/2018
---
<a name="creating-a-business-logic-layer-c"></a><span data-ttu-id="49ebf-103">创建业务逻辑层 (C#)</span><span class="sxs-lookup"><span data-stu-id="49ebf-103">Creating a Business Logic Layer (C#)</span></span>
====================
<span data-ttu-id="49ebf-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="49ebf-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="49ebf-105">[下载示例应用程序](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe)或[下载 PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="49ebf-105">[Download Sample App](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) or [Download PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span></span>

> <span data-ttu-id="49ebf-106">在本教程中我们将了解如何集中用作表示层和 DAL 之间的数据交换的中介业务逻辑层 (BLL) 到您的业务规则。</span><span class="sxs-lookup"><span data-stu-id="49ebf-106">In this tutorial we'll see how to centralize your business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span>


## <a name="introduction"></a><span data-ttu-id="49ebf-107">介绍</span><span class="sxs-lookup"><span data-stu-id="49ebf-107">Introduction</span></span>

<span data-ttu-id="49ebf-108">在中创建数据访问层 (DAL)[第一个教程](creating-a-data-access-layer-cs.md)完全离职数据访问逻辑与表示逻辑。</span><span class="sxs-lookup"><span data-stu-id="49ebf-108">The Data Access Layer (DAL) created in the [first tutorial](creating-a-data-access-layer-cs.md) cleanly separates the data access logic from the presentation logic.</span></span> <span data-ttu-id="49ebf-109">但是，尽管 DAL 能完全分隔与表示层的数据访问的详细信息，它不会强制任何业务规则可能适用。</span><span class="sxs-lookup"><span data-stu-id="49ebf-109">However, while the DAL cleanly separates the data access details from the presentation layer, it does not enforce any business rules that may apply.</span></span> <span data-ttu-id="49ebf-110">例如，对于我们的应用程序我们可能希望禁止`CategoryID`或`SupplierID`字段`Products`表要修改时`Discontinued`字段设置为 1，或者我们可能想要强制实施高低规则禁止的情况员工的人受雇后它们进行管理。</span><span class="sxs-lookup"><span data-stu-id="49ebf-110">For example, for our application we may want to disallow the `CategoryID` or `SupplierID` fields of the `Products` table to be modified when the `Discontinued` field is set to 1, or we might want to enforce seniority rules, prohibiting situations in which an employee is managed by someone who was hired after them.</span></span> <span data-ttu-id="49ebf-111">另一个常见的方案是对特定角色中的授权可能只有用户可以删除产品，或者可以更改`UnitPrice`值。</span><span class="sxs-lookup"><span data-stu-id="49ebf-111">Another common scenario is authorization perhaps only users in a particular role can delete products or can change the `UnitPrice` value.</span></span>

<span data-ttu-id="49ebf-112">在本教程中我们将了解如何集中到业务逻辑层 (BLL) 充当一个中介以便在表示层和 DAL 之间交换数据的这些业务规则。</span><span class="sxs-lookup"><span data-stu-id="49ebf-112">In this tutorial we'll see how to centralize these business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span> <span data-ttu-id="49ebf-113">在实际应用中，应作为一个单独的类库项目; 实现 BLL但是，这些教程我们将实现 BLL 为一系列中的类我们`App_Code`来简化的项目结构的文件夹。</span><span class="sxs-lookup"><span data-stu-id="49ebf-113">In a real-world application, the BLL should be implemented as a separate Class Library project; however, for these tutorials we'll implement the BLL as a series of classes in our `App_Code` folder in order to simplify the project structure.</span></span> <span data-ttu-id="49ebf-114">图 1 说明之间的表示层、 BLL 和 DAL 的体系结构关系。</span><span class="sxs-lookup"><span data-stu-id="49ebf-114">Figure 1 illustrates the architectural relationships among the presentation layer, BLL, and DAL.</span></span>


![BLL 将与数据访问层分隔的表示层和实施业务规则](creating-a-business-logic-layer-cs/_static/image1.png)

<span data-ttu-id="49ebf-116">**图 1**: BLL 将与数据访问层分隔的表示层和实施业务规则</span><span class="sxs-lookup"><span data-stu-id="49ebf-116">**Figure 1**: The BLL Separates the Presentation Layer from the Data Access Layer and Imposes Business Rules</span></span>


## <a name="step-1-creating-the-bll-classes"></a><span data-ttu-id="49ebf-117">步骤 1： 创建 BLL 类</span><span class="sxs-lookup"><span data-stu-id="49ebf-117">Step 1: Creating the BLL Classes</span></span>

<span data-ttu-id="49ebf-118">我们 BLL 将组成四个类，一个用于在 DAL; 每个 TableAdapter其中每个 BLL 类将通过方法来检索、 插入、 更新和删除从 DAL，应用适当的业务规则在各自的 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="49ebf-118">Our BLL will be composed of four classes, one for each TableAdapter in the DAL; each of these BLL classes will have methods for retrieving, inserting, updating, and deleting from the respective TableAdapter in the DAL, applying the appropriate business rules.</span></span>

<span data-ttu-id="49ebf-119">到更完全分隔与 DAL 和 BLL 相关的类，让我们创建中的两个子文件夹`App_Code`文件夹，`DAL`和`BLL`。</span><span class="sxs-lookup"><span data-stu-id="49ebf-119">To more cleanly separate the DAL- and BLL-related classes, let's create two subfolders in the `App_Code` folder, `DAL` and `BLL`.</span></span> <span data-ttu-id="49ebf-120">只需右键单击`App_Code`在解决方案资源管理器的文件夹，然后选择新文件夹。</span><span class="sxs-lookup"><span data-stu-id="49ebf-120">Simply right-click on the `App_Code` folder in the Solution Explorer and choose New Folder.</span></span> <span data-ttu-id="49ebf-121">创建以下两个文件夹之后, 移动到第一个教程中创建的类型化的数据集`DAL`子文件夹。</span><span class="sxs-lookup"><span data-stu-id="49ebf-121">After creating these two folders, move the Typed DataSet created in the first tutorial into the `DAL` subfolder.</span></span>

<span data-ttu-id="49ebf-122">接下来，创建中的四个 BLL 类文件`BLL`子文件夹。</span><span class="sxs-lookup"><span data-stu-id="49ebf-122">Next, create the four BLL class files in the `BLL` subfolder.</span></span> <span data-ttu-id="49ebf-123">若要完成此操作，右键单击`BLL`子文件夹，选择添加新项，然后选择类模板。</span><span class="sxs-lookup"><span data-stu-id="49ebf-123">To accomplish this, right-click on the `BLL` subfolder, choose Add a New Item, and choose the Class template.</span></span> <span data-ttu-id="49ebf-124">命名的四个类`ProductsBLL`， `CategoriesBLL`， `SuppliersBLL`，和`EmployeesBLL`。</span><span class="sxs-lookup"><span data-stu-id="49ebf-124">Name the four classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, and `EmployeesBLL`.</span></span>


![将四个新类添加到 App_Code 文件夹](creating-a-business-logic-layer-cs/_static/image2.png)

<span data-ttu-id="49ebf-126">**图 2**： 添加到的四个新类`App_Code`文件夹</span><span class="sxs-lookup"><span data-stu-id="49ebf-126">**Figure 2**: Add Four New Classes to the `App_Code` Folder</span></span>


<span data-ttu-id="49ebf-127">接下来，让我们将方法添加到每个类以只包装在第一个教程 Tableadapter 为定义的方法。</span><span class="sxs-lookup"><span data-stu-id="49ebf-127">Next, let's add methods to each of the classes to simply wrap the methods defined for the TableAdapters from the first tutorial.</span></span> <span data-ttu-id="49ebf-128">现在，这些方法将只是直接调入 DAL;我们会返回更高版本，以添加任何必要的业务逻辑。</span><span class="sxs-lookup"><span data-stu-id="49ebf-128">For now, these methods will just call directly into the DAL; we'll return later to add any needed business logic.</span></span>

> [!NOTE]
> <span data-ttu-id="49ebf-129">如果你使用的 Visual Studio Standard Edition 或更高版本 (即你*不*使用 Visual Web Developer)，你可以根据需要设计您以可视方式使用的类[类设计器](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp)。</span><span class="sxs-lookup"><span data-stu-id="49ebf-129">If you are using Visual Studio Standard Edition or above (that is, you're *not* using Visual Web Developer), you can optionally design your classes visually using the [Class Designer](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span></span> <span data-ttu-id="49ebf-130">请参阅[类设计器博客](https://blogs.msdn.com/classdesigner/default.aspx)有关 Visual Studio 中的此新功能的详细信息。</span><span class="sxs-lookup"><span data-stu-id="49ebf-130">Refer to the [Class Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) for more information on this new feature in Visual Studio.</span></span>


<span data-ttu-id="49ebf-131">有关`ProductsBLL`我们需要添加总计的七种方法的类：</span><span class="sxs-lookup"><span data-stu-id="49ebf-131">For the `ProductsBLL` class we need to add a total of seven methods:</span></span>

- <span data-ttu-id="49ebf-132">`GetProducts()`返回所有产品</span><span class="sxs-lookup"><span data-stu-id="49ebf-132">`GetProducts()` returns all products</span></span>
- <span data-ttu-id="49ebf-133">`GetProductByProductID(productID)`返回具有指定的产品 ID 的产品</span><span class="sxs-lookup"><span data-stu-id="49ebf-133">`GetProductByProductID(productID)` returns the product with the specified product ID</span></span>
- <span data-ttu-id="49ebf-134">`GetProductsByCategoryID(categoryID)`返回从指定的类别的所有产品</span><span class="sxs-lookup"><span data-stu-id="49ebf-134">`GetProductsByCategoryID(categoryID)` returns all products from the specified category</span></span>
- <span data-ttu-id="49ebf-135">`GetProductsBySupplier(supplierID)`返回指定供应商提供的所有产品</span><span class="sxs-lookup"><span data-stu-id="49ebf-135">`GetProductsBySupplier(supplierID)` returns all products from the specified supplier</span></span>
- <span data-ttu-id="49ebf-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)`将新产品插入到数据库中使用的值传入的程序;返回`ProductID`新插入的记录的值</span><span class="sxs-lookup"><span data-stu-id="49ebf-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserts a new product into the database using the values passed-in; returns the `ProductID` value of the newly inserted record</span></span>
- <span data-ttu-id="49ebf-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)`更新现有产品在数据库中使用的传入的值;返回`true`精确一行已更新，如果`false`否则为</span><span class="sxs-lookup"><span data-stu-id="49ebf-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` updates an existing product in the database using the passed-in values; returns `true` if precisely one row was updated, `false` otherwise</span></span>
- <span data-ttu-id="49ebf-138">`DeleteProduct(productID)`从数据库中删除指定的产品</span><span class="sxs-lookup"><span data-stu-id="49ebf-138">`DeleteProduct(productID)` deletes the specified product from the database</span></span>

<span data-ttu-id="49ebf-139">ProductsBLL.cs</span><span class="sxs-lookup"><span data-stu-id="49ebf-139">ProductsBLL.cs</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample1.cs)]

<span data-ttu-id="49ebf-140">只需返回数据的方法的`GetProducts`， `GetProductByProductID`， `GetProductsByCategoryID`，和`GetProductBySuppliersID`它们只需调用到 DAL 是非常简单。</span><span class="sxs-lookup"><span data-stu-id="49ebf-140">The methods that simply return data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, and `GetProductBySuppliersID` are fairly straightforward as they simply call down into the DAL.</span></span> <span data-ttu-id="49ebf-141">尽管在某些情况下可能需要实现的业务规则在此级别 （例如基于当前登录的用户或用户所属的角色的授权规则），我们将只是将这些方法作为-是。</span><span class="sxs-lookup"><span data-stu-id="49ebf-141">While in some scenarios there may be business rules that need to be implemented at this level (such as authorization rules based on the currently logged on user or the role to which the user belongs), we'll simply leave these methods as-is.</span></span> <span data-ttu-id="49ebf-142">有关这些方法，然后，BLL 仅仅是作为服务通过该表示层访问基础数据从数据访问层的代理。</span><span class="sxs-lookup"><span data-stu-id="49ebf-142">For these methods, then, the BLL serves merely as a proxy through which the presentation layer accesses the underlying data from the Data Access Layer.</span></span>

<span data-ttu-id="49ebf-143">`AddProduct`和`UpdateProduct`方法同时作为参数采用各种产品字段的值和添加新的产品或更新现有，分别。</span><span class="sxs-lookup"><span data-stu-id="49ebf-143">The `AddProduct` and `UpdateProduct` methods both take in as parameters the values for the various product fields and add a new product or update an existing one, respectively.</span></span> <span data-ttu-id="49ebf-144">由于许多`Product`表的列可以接受`NULL`值 (`CategoryID`， `SupplierID`，和`UnitPrice`，仅举几例)，这些输入参数`AddProduct`和`UpdateProduct`映射到此类列使用[可以为 null 类型](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx)。</span><span class="sxs-lookup"><span data-stu-id="49ebf-144">Since many of the `Product` table's columns can accept `NULL` values (`CategoryID`, `SupplierID`, and `UnitPrice`, to name a few), those input parameters for `AddProduct` and `UpdateProduct` that map to such columns use [nullable types](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span></span> <span data-ttu-id="49ebf-145">可以为 null 的类型不熟悉.NET 2.0 和提供一种技术，该值指示是否为值类型应，相反，应由`null`。</span><span class="sxs-lookup"><span data-stu-id="49ebf-145">Nullable types are new to .NET 2.0 and provide a technique for indicating whether a value type should, instead, be `null`.</span></span> <span data-ttu-id="49ebf-146">在 C# 中可以值类型为 null 的类型进行标记添加`?`后类型 (如`int? x;`)。</span><span class="sxs-lookup"><span data-stu-id="49ebf-146">In C# you can flag a value type as a nullable type by adding `?` after the type (like `int? x;`).</span></span> <span data-ttu-id="49ebf-147">请参阅[可以为 Null 类型](https://msdn.microsoft.com/library/1t3y8s4s.aspx)主题中[C# 编程指南](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx)有关详细信息。</span><span class="sxs-lookup"><span data-stu-id="49ebf-147">Refer to the [Nullable Types](https://msdn.microsoft.com/library/1t3y8s4s.aspx) section in the [C# Programming Guide](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) for more information.</span></span>

<span data-ttu-id="49ebf-148">所有三个方法返回布尔值，该值指示行是否已插入、 更新或删除，因为该操作不可能会导致受影响的行。</span><span class="sxs-lookup"><span data-stu-id="49ebf-148">All three methods return a Boolean value indicating whether a row was inserted, updated, or deleted since the operation may not result in an affected row.</span></span> <span data-ttu-id="49ebf-149">例如，如果页开发人员调用`DeleteProduct`传入`ProductID`不存在产品，`DELETE`语句向数据库发出会有任何影响，因此`DeleteProduct`方法将返回`false`。</span><span class="sxs-lookup"><span data-stu-id="49ebf-149">For example, if the page developer calls `DeleteProduct` passing in a `ProductID` for a non-existent product, the `DELETE` statement issued to the database will have no affect and therefore the `DeleteProduct` method will return `false`.</span></span>

<span data-ttu-id="49ebf-150">请注意，当添加新的产品或更新现有我们需要在新的或修改产品的字段值中为列表而不是接受的标量`ProductsRow`实例。</span><span class="sxs-lookup"><span data-stu-id="49ebf-150">Note that when adding a new product or updating an existing one we take in the new or modified product's field values as a list of scalars as opposed to accepting a `ProductsRow` instance.</span></span> <span data-ttu-id="49ebf-151">此方法已选择原因`ProductsRow`类派生自 ADO.NET`DataRow`类，该类没有默认的无参数构造函数。</span><span class="sxs-lookup"><span data-stu-id="49ebf-151">This approach was chosen because the `ProductsRow` class derives from the ADO.NET `DataRow` class, which doesn't have a default parameterless constructor.</span></span> <span data-ttu-id="49ebf-152">若要创建一个新`ProductsRow`实例，我们必须先创建`ProductsDataTable`实例，然后调用其`NewProductRow()`方法 (中执行的操作`AddProduct`)。</span><span class="sxs-lookup"><span data-stu-id="49ebf-152">In order to create a new `ProductsRow` instance, we must first create a `ProductsDataTable` instance and then invoke its `NewProductRow()` method (which we do in `AddProduct`).</span></span> <span data-ttu-id="49ebf-153">我们对插入和更新产品使用 ObjectDataSource 打开时，这种不足 rears 其头。</span><span class="sxs-lookup"><span data-stu-id="49ebf-153">This shortcoming rears its head when we turn to inserting and updating products using the ObjectDataSource.</span></span> <span data-ttu-id="49ebf-154">简单地说，ObjectDataSource 将尝试创建的输入参数的实例。</span><span class="sxs-lookup"><span data-stu-id="49ebf-154">In short, the ObjectDataSource will try to create an instance of the input parameters.</span></span> <span data-ttu-id="49ebf-155">如果 BLL 方法需要`ProductsRow`实例，ObjectDataSource 将尝试创建一个，但由于缺少默认的无参数构造函数的问题而失败。</span><span class="sxs-lookup"><span data-stu-id="49ebf-155">If the BLL method expects a `ProductsRow` instance, the ObjectDataSource will try to create one, but fail due to the lack of a default parameterless constructor.</span></span> <span data-ttu-id="49ebf-156">有关此问题的详细信息，请参阅下列两个 ASP.NET 论坛帖子： [Strongly-Typed 数据集更新 ObjectDataSources](https://forums.asp.net/1098630/ShowPost.aspx)，和[问题与 ObjectDataSource 和 Strongly-Typed 数据集](https://forums.asp.net/1048212/ShowPost.aspx).</span><span class="sxs-lookup"><span data-stu-id="49ebf-156">For more information on this problem, refer to the following two ASP.NET Forums posts: [Updating ObjectDataSources with Strongly-Typed DataSets](https://forums.asp.net/1098630/ShowPost.aspx), and [Problem With ObjectDataSource and Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span></span>

<span data-ttu-id="49ebf-157">接下来，在同时`AddProduct`和`UpdateProduct`，该代码创建`ProductsRow`实例并使用刚刚中传递的值填充它。</span><span class="sxs-lookup"><span data-stu-id="49ebf-157">Next, in both `AddProduct` and `UpdateProduct`, the code creates a `ProductsRow` instance and populates it with the values just passed in.</span></span> <span data-ttu-id="49ebf-158">当将值分配到 Datacolumn DataRow 的可能会发生各种字段级别验证检查。</span><span class="sxs-lookup"><span data-stu-id="49ebf-158">When assigning values to DataColumns of a DataRow various field-level validation checks can occur.</span></span> <span data-ttu-id="49ebf-159">因此，手动将传入的值返回放入 DataRow 有助于确保传递给 BLL 方法的数据的有效性。</span><span class="sxs-lookup"><span data-stu-id="49ebf-159">Therefore, manually putting the passed in values back into a DataRow helps ensure the validity of the data being passed to the BLL method.</span></span> <span data-ttu-id="49ebf-160">遗憾的是 Visual Studio 生成的强类型 DataRow 类请不要使用可以为 null 的类型。</span><span class="sxs-lookup"><span data-stu-id="49ebf-160">Unfortunately the strongly-typed DataRow classes generated by Visual Studio do not use nullable types.</span></span> <span data-ttu-id="49ebf-161">相反，以指示在 DataRow 特定 DataColumn 应对应于`NULL`数据库的值我们必须使用`SetColumnNameNull()`方法。</span><span class="sxs-lookup"><span data-stu-id="49ebf-161">Rather, to indicate that a particular DataColumn in a DataRow should correspond to a `NULL` database value we must use the `SetColumnNameNull()` method.</span></span>

<span data-ttu-id="49ebf-162">在`UpdateProduct`我们首先在要更新使用的产品中加载`GetProductByProductID(productID)`。</span><span class="sxs-lookup"><span data-stu-id="49ebf-162">In `UpdateProduct` we first load in the product to update using `GetProductByProductID(productID)`.</span></span> <span data-ttu-id="49ebf-163">虽然这可能看上去到数据库的不必要行程，此额外经历一次将证明值得在将来浏览开放式并发的教程。</span><span class="sxs-lookup"><span data-stu-id="49ebf-163">While this may seem like an unnecessary trip to the database, this extra trip will prove worthwhile in future tutorials that explore optimistic concurrency.</span></span> <span data-ttu-id="49ebf-164">乐观并发是一种技术，若要确保两个工作的用户可以同时对同一数据不会意外地覆盖彼此的所做更改。</span><span class="sxs-lookup"><span data-stu-id="49ebf-164">Optimistic concurrency is a technique to ensure that two users who are simultaneously working on the same data don't accidentally overwrite one another's changes.</span></span> <span data-ttu-id="49ebf-165">抓取整个记录还可以更轻松地在仅修改的数据行的列的子集 BLL 中创建更新方法。</span><span class="sxs-lookup"><span data-stu-id="49ebf-165">Grabbing the entire record also makes it easier to create update methods in the BLL that only modify a subset of the DataRow's columns.</span></span> <span data-ttu-id="49ebf-166">当我们探讨`SuppliersBLL`我们将看到此类示例的类。</span><span class="sxs-lookup"><span data-stu-id="49ebf-166">When we explore the `SuppliersBLL` class we'll see such an example.</span></span>

<span data-ttu-id="49ebf-167">最后，请注意，`ProductsBLL`类具有[DataObject 属性](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx)应用于它 (`[System.ComponentModel.DataObject]`之前的文件的顶部附近的类语句的语法) 并且方法具有[DataObjectMethodAttribute 属性](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx)。</span><span class="sxs-lookup"><span data-stu-id="49ebf-167">Finally, note that the `ProductsBLL` class has the [DataObject attribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) applied to it (the `[System.ComponentModel.DataObject]` syntax right before the class statement near the top of the file) and the methods have [DataObjectMethodAttribute attributes](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span></span> <span data-ttu-id="49ebf-168">`DataObject`属性标记为适用于绑定到的对象类[ObjectDataSource 控件](https://msdn.microsoft.com/library/9a4kyhcx.aspx)，而`DataObjectMethodAttribute`指示方法的用途。</span><span class="sxs-lookup"><span data-stu-id="49ebf-168">The `DataObject` attribute marks the class as being an object suitable for binding to an [ObjectDataSource control](https://msdn.microsoft.com/library/9a4kyhcx.aspx), whereas the `DataObjectMethodAttribute` indicates the purpose of the method.</span></span> <span data-ttu-id="49ebf-169">正如我们将看到在将来的教程，ASP.NET 2.0 ObjectDataSource 轻松地从类中以声明方式访问数据。</span><span class="sxs-lookup"><span data-stu-id="49ebf-169">As we'll see in future tutorials, ASP.NET 2.0's ObjectDataSource makes it easy to declaratively access data from a class.</span></span> <span data-ttu-id="49ebf-170">若要帮助筛选可能的类，将绑定到对象数据源的向导中的列表，通过默认标记为这些类`DataObjects`都显示在向导的下拉列表。</span><span class="sxs-lookup"><span data-stu-id="49ebf-170">To help filter the list of possible classes to bind to in the ObjectDataSource's wizard, by default only those classes marked as `DataObjects` are shown in the wizard's drop-down list.</span></span> <span data-ttu-id="49ebf-171">`ProductsBLL`类使用将同样效果而无需这些属性，但将其添加可更轻松地使用对象数据源的向导中。</span><span class="sxs-lookup"><span data-stu-id="49ebf-171">The `ProductsBLL` class will work just as well without these attributes, but adding them makes it easier to work with in the ObjectDataSource's wizard.</span></span>

## <a name="adding-the-other-classes"></a><span data-ttu-id="49ebf-172">添加其他类</span><span class="sxs-lookup"><span data-stu-id="49ebf-172">Adding the Other Classes</span></span>

<span data-ttu-id="49ebf-173">与`ProductsBLL`类完成，我们仍需要添加用于处理类别、 供应商和员工的类。</span><span class="sxs-lookup"><span data-stu-id="49ebf-173">With the `ProductsBLL` class complete, we still need to add the classes for working with categories, suppliers, and employees.</span></span> <span data-ttu-id="49ebf-174">花一些时间创建的以下类和方法使用从上面的示例中的概念：</span><span class="sxs-lookup"><span data-stu-id="49ebf-174">Take a moment to create the following classes and methods using the concepts from the example above:</span></span>

- <span data-ttu-id="49ebf-175">**CategoriesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="49ebf-175">**CategoriesBLL.cs**</span></span>

    - `GetCategories()`
    - `GetCategoryByCategoryID(categoryID)`
- <span data-ttu-id="49ebf-176">**SuppliersBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="49ebf-176">**SuppliersBLL.cs**</span></span>

    - `GetSuppliers()`
    - `GetSupplierBySupplierID(supplierID)`
    - `GetSuppliersByCountry(country)`
    - `UpdateSupplierAddress(supplierID, address, city, country)`
- <span data-ttu-id="49ebf-177">**EmployeesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="49ebf-177">**EmployeesBLL.cs**</span></span>

    - `GetEmployees()`
    - `GetEmployeeByEmployeeID(employeeID)`
    - `GetEmployeesByManager(managerID)`

<span data-ttu-id="49ebf-178">值得注意的一个方法是`SuppliersBLL`类的`UpdateSupplierAddress`方法。</span><span class="sxs-lookup"><span data-stu-id="49ebf-178">The one method worth noting is the `SuppliersBLL` class's `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="49ebf-179">此方法提供用于更新只需供应商的地址信息的接口。</span><span class="sxs-lookup"><span data-stu-id="49ebf-179">This method provides an interface for updating just the supplier's address information.</span></span> <span data-ttu-id="49ebf-180">此方法在内部，以读取`SupplierDataRow`的指定对象的`supplierID`(使用`GetSupplierBySupplierID`)、 设置其与地址相关的属性，然后调入`SupplierDataTable`的`Update`方法。</span><span class="sxs-lookup"><span data-stu-id="49ebf-180">Internally, this method reads in the `SupplierDataRow` object for the specified `supplierID` (using `GetSupplierBySupplierID`), sets its address-related properties, and then calls down into the `SupplierDataTable`'s `Update` method.</span></span> <span data-ttu-id="49ebf-181">`UpdateSupplierAddress`方法如下所示：</span><span class="sxs-lookup"><span data-stu-id="49ebf-181">The `UpdateSupplierAddress` method follows:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample2.cs)]

<span data-ttu-id="49ebf-182">请参阅本文中的下载 BLL 类我完整实现。</span><span class="sxs-lookup"><span data-stu-id="49ebf-182">Refer to this article's download for my complete implementation of the BLL classes.</span></span>

## <a name="step-2-accessing-the-typed-datasets-through-the-bll-classes"></a><span data-ttu-id="49ebf-183">步骤 2： 通过 BLL 类访问类型化数据集</span><span class="sxs-lookup"><span data-stu-id="49ebf-183">Step 2: Accessing the Typed DataSets Through the BLL Classes</span></span>

<span data-ttu-id="49ebf-184">第一个教程中我们已了解以编程方式，直接与类型化数据集处理的示例，但我们 BLL 类添加，表示层应针对工作 BLL 改为。</span><span class="sxs-lookup"><span data-stu-id="49ebf-184">In the first tutorial we saw examples of working directly with the Typed DataSet programmatically, but with the addition of our BLL classes, the presentation tier should work against the BLL instead.</span></span> <span data-ttu-id="49ebf-185">在`AllProducts.aspx`中第一个教程中，示例`ProductsTableAdapter`用于将产品的列表绑定到 GridView，如下面的代码中所示：</span><span class="sxs-lookup"><span data-stu-id="49ebf-185">In the `AllProducts.aspx` example from the first tutorial, the `ProductsTableAdapter` was used to bind the list of products to a GridView, as shown in the following code:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample3.cs)]

<span data-ttu-id="49ebf-186">若要使用新 BLL 来说，需要更改的类是第一行代码只需将`ProductsTableAdapter`对象`ProductBLL`对象：</span><span class="sxs-lookup"><span data-stu-id="49ebf-186">To use the new BLL classes, all that needs to be changed is the first line of code simply replace the `ProductsTableAdapter` object with a `ProductBLL` object:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample4.cs)]

<span data-ttu-id="49ebf-187">也可以通过使用对象数据源 （如可能是类型化数据集） 以声明方式访问 BLL 类。</span><span class="sxs-lookup"><span data-stu-id="49ebf-187">The BLL classes can also be accessed declaratively (as can the Typed DataSet) by using the ObjectDataSource.</span></span> <span data-ttu-id="49ebf-188">我们将会讨论中更详细地 ObjectDataSource 在以下教程。</span><span class="sxs-lookup"><span data-stu-id="49ebf-188">We'll be discussing the ObjectDataSource in greater detail in the following tutorials.</span></span>


<span data-ttu-id="49ebf-189">[![产品列表将显示在一个 GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="49ebf-189">[![The List of Products is Displayed in a GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span></span>

<span data-ttu-id="49ebf-190">**图 3**： 的产品的列表显示在一个 GridView ([单击以查看实际尺寸的图像](creating-a-business-logic-layer-cs/_static/image5.png))</span><span class="sxs-lookup"><span data-stu-id="49ebf-190">**Figure 3**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image5.png))</span></span>


## <a name="step-3-adding-field-level-validation-to-the-datarow-classes"></a><span data-ttu-id="49ebf-191">步骤 3： 向 DataRow 类添加字段级别验证</span><span class="sxs-lookup"><span data-stu-id="49ebf-191">Step 3: Adding Field-Level Validation to the DataRow Classes</span></span>

<span data-ttu-id="49ebf-192">字段级别验证是与插入或更新时的业务对象的属性值的检查。</span><span class="sxs-lookup"><span data-stu-id="49ebf-192">Field-level validation are checks that pertains to the property values of the business objects when inserting or updating.</span></span> <span data-ttu-id="49ebf-193">产品的一些字段级验证规则包括：</span><span class="sxs-lookup"><span data-stu-id="49ebf-193">Some field-level validation rules for products include:</span></span>

- <span data-ttu-id="49ebf-194">`ProductName`字段必须是长度不超过 40 个字符</span><span class="sxs-lookup"><span data-stu-id="49ebf-194">The `ProductName` field must be 40 characters or less in length</span></span>
- <span data-ttu-id="49ebf-195">`QuantityPerUnit`字段必须是长度不超过 20 个字符</span><span class="sxs-lookup"><span data-stu-id="49ebf-195">The `QuantityPerUnit` field must be 20 characters or less in length</span></span>
- <span data-ttu-id="49ebf-196">`ProductID`， `ProductName`，和`Discontinued`字段是必需的但所有其他字段为可选</span><span class="sxs-lookup"><span data-stu-id="49ebf-196">The `ProductID`, `ProductName`, and `Discontinued` fields are required, but all other fields are optional</span></span>
- <span data-ttu-id="49ebf-197">`UnitPrice`， `UnitsInStock`， `UnitsOnOrder`，和`ReorderLevel`字段必须为大于或等于零</span><span class="sxs-lookup"><span data-stu-id="49ebf-197">The `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields must be greater than or equal to zero</span></span>

<span data-ttu-id="49ebf-198">这些规则可以和应表示在数据库级别。</span><span class="sxs-lookup"><span data-stu-id="49ebf-198">These rules can and should be expressed at the database level.</span></span> <span data-ttu-id="49ebf-199">上的字符数限制`ProductName`和`QuantityPerUnit`中列的数据类型，将捕获字段`Products`表 (`nvarchar(40)`和`nvarchar(20)`分别)。</span><span class="sxs-lookup"><span data-stu-id="49ebf-199">The character limit on the `ProductName` and `QuantityPerUnit` fields are captured by the data types of those columns in the `Products` table (`nvarchar(40)` and `nvarchar(20)`, respectively).</span></span> <span data-ttu-id="49ebf-200">如果数据库表列允许字段必选和可选所用`NULL`s。</span><span class="sxs-lookup"><span data-stu-id="49ebf-200">Whether fields are required and optional are expressed by if the database table column allows `NULL` s.</span></span> <span data-ttu-id="49ebf-201">四个[check 约束](https://msdn.microsoft.com/library/ms188258.aspx)存在，确保的唯一值大于或等于零可以建立到`UnitPrice`， `UnitsInStock`， `UnitsOnOrder`，或`ReorderLevel`列。</span><span class="sxs-lookup"><span data-stu-id="49ebf-201">Four [check constraints](https://msdn.microsoft.com/library/ms188258.aspx) exist that ensure that only values greater than or equal to zero can make it into the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` columns.</span></span>

<span data-ttu-id="49ebf-202">除了强制实施这些规则应用于数据库它们应也会强制执行的数据集级别。</span><span class="sxs-lookup"><span data-stu-id="49ebf-202">In addition to enforcing these rules at the database they should also be enforced at the DataSet level.</span></span> <span data-ttu-id="49ebf-203">事实上，字段长度和一个值是必需还是可选已捕获的 Datacolumn 的每个 DataTable 的组。</span><span class="sxs-lookup"><span data-stu-id="49ebf-203">In fact, the field length and whether a value is required or optional are already captured for each DataTable's set of DataColumns.</span></span> <span data-ttu-id="49ebf-204">若要查看现有字段级别验证自动提供，请转到数据集设计器，从一个数据表选择一个字段，然后转到属性窗口。</span><span class="sxs-lookup"><span data-stu-id="49ebf-204">To see the existing field-level validation automatically provided, go to the DataSet Designer, select a field from one of the DataTables and then go to the Properties window.</span></span> <span data-ttu-id="49ebf-205">如图 4 所示，`QuantityPerUnit`中的 DataColumn `ProductsDataTable` 20 个字符的最大长度和允许`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="49ebf-205">As Figure 4 shows, the `QuantityPerUnit` DataColumn in the `ProductsDataTable` has a maximum length of 20 characters and does allow `NULL` values.</span></span> <span data-ttu-id="49ebf-206">如果我们尝试设置`ProductsDataRow`的`QuantityPerUnit`属性超过 20 个字符的字符串值`ArgumentException`将引发。</span><span class="sxs-lookup"><span data-stu-id="49ebf-206">If we attempt to set the `ProductsDataRow`'s `QuantityPerUnit` property to a string value longer than 20 characters an `ArgumentException` will be thrown.</span></span>


<span data-ttu-id="49ebf-207">[![DataColumn 进行基本的字段级别验证](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="49ebf-207">[![The DataColumn Provides Basic Field-Level Validation](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span></span>

<span data-ttu-id="49ebf-208">**图 4**: DataColumn 提供基本级别字段验证 ([单击以查看实际尺寸的图像](creating-a-business-logic-layer-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="49ebf-208">**Figure 4**: The DataColumn Provides Basic Field-Level Validation ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image8.png))</span></span>


<span data-ttu-id="49ebf-209">遗憾的是，我们不能指定边界检查，如`UnitPrice`值必须大于或等于零，通过属性窗口。</span><span class="sxs-lookup"><span data-stu-id="49ebf-209">Unfortunately, we can't specify bounds checks, such as the `UnitPrice` value must be greater than or equal to zero, through the Properties window.</span></span> <span data-ttu-id="49ebf-210">为了提供此类型的字段级别验证我们需要创建 DataTable 的事件处理程序[ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx)事件。</span><span class="sxs-lookup"><span data-stu-id="49ebf-210">In order to provide this type of field-level validation we need to create an event handler for the DataTable's [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) event.</span></span> <span data-ttu-id="49ebf-211">中所述[前面教程](creating-a-data-access-layer-cs.md)，可以通过使用分部类扩展由类型化数据集创建的数据集、 数据表和 DataRow 对象。</span><span class="sxs-lookup"><span data-stu-id="49ebf-211">As mentioned in the [preceding tutorial](creating-a-data-access-layer-cs.md), the DataSet, DataTables, and DataRow objects created by the Typed DataSet can be extended through the use of partial classes.</span></span> <span data-ttu-id="49ebf-212">使用这种方法，我们可以创建`ColumnChanging`事件处理程序`ProductsDataTable`类。</span><span class="sxs-lookup"><span data-stu-id="49ebf-212">Using this technique we can create a `ColumnChanging` event handler for the `ProductsDataTable` class.</span></span> <span data-ttu-id="49ebf-213">首先创建中的类`App_Code`文件夹名为`ProductsDataTable.ColumnChanging.cs`。</span><span class="sxs-lookup"><span data-stu-id="49ebf-213">Start by creating a class in the `App_Code` folder named `ProductsDataTable.ColumnChanging.cs`.</span></span>


<span data-ttu-id="49ebf-214">[![将新类添加到 App_Code 文件夹](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="49ebf-214">[![Add a New Class to the App_Code Folder](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span></span>

<span data-ttu-id="49ebf-215">**图 5**： 添加新类中，以便`App_Code`文件夹 ([单击以查看实际尺寸的图像](creating-a-business-logic-layer-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="49ebf-215">**Figure 5**: Add a New Class to the `App_Code` Folder ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image11.png))</span></span>


<span data-ttu-id="49ebf-216">接下来，创建的事件处理程序`ColumnChanging`事件，它可确保`UnitPrice`， `UnitsInStock`， `UnitsOnOrder`，和`ReorderLevel`列的值 (如果不是`NULL`) 大于或等于零。</span><span class="sxs-lookup"><span data-stu-id="49ebf-216">Next, create an event handler for the `ColumnChanging` event that ensures that the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` column values (if not `NULL`) are greater than or equal to zero.</span></span> <span data-ttu-id="49ebf-217">如果任何此类列超出范围时，引发`ArgumentException`。</span><span class="sxs-lookup"><span data-stu-id="49ebf-217">If any such column is out of range, throw an `ArgumentException`.</span></span>

<span data-ttu-id="49ebf-218">ProductsDataTable.ColumnChanging.cs</span><span class="sxs-lookup"><span data-stu-id="49ebf-218">ProductsDataTable.ColumnChanging.cs</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample5.cs)]

## <a name="step-4-adding-custom-business-rules-to-the-blls-classes"></a><span data-ttu-id="49ebf-219">步骤 4： 将自定义业务规则添加到 BLL 的类</span><span class="sxs-lookup"><span data-stu-id="49ebf-219">Step 4: Adding Custom Business Rules to the BLL's Classes</span></span>

<span data-ttu-id="49ebf-220">除了字段级别验证可能需要高级自定义业务规则来涉及不同实体或级别的单个列不可表示的概念，如：</span><span class="sxs-lookup"><span data-stu-id="49ebf-220">In addition to field-level validation, there may be high-level custom business rules that involve different entities or concepts not expressible at the single column level, such as:</span></span>

- <span data-ttu-id="49ebf-221">如果产品已停止使用，其`UnitPrice`无法更新</span><span class="sxs-lookup"><span data-stu-id="49ebf-221">If a product is discontinued, its `UnitPrice` cannot be updated</span></span>
- <span data-ttu-id="49ebf-222">员工的国家/地区居住区域必须是其经理的国家/地区的居住地相同</span><span class="sxs-lookup"><span data-stu-id="49ebf-222">An employee's country of residence must be the same as their manager's country of residence</span></span>
- <span data-ttu-id="49ebf-223">无法停用一种产品，如果它是仅由供应商提供的产品</span><span class="sxs-lookup"><span data-stu-id="49ebf-223">A product cannot be discontinued if it is the only product provided by the supplier</span></span>

<span data-ttu-id="49ebf-224">BLL 类应包含检查，以确保遵守应用程序的业务规则。</span><span class="sxs-lookup"><span data-stu-id="49ebf-224">The BLL classes should contain checks to ensure adherence to the application's business rules.</span></span> <span data-ttu-id="49ebf-225">这些检查可以直接添加到应用到的方法。</span><span class="sxs-lookup"><span data-stu-id="49ebf-225">These checks can be added directly to the methods to which they apply.</span></span>

<span data-ttu-id="49ebf-226">假设我们业务规则规定，产品无法将标记不再使用是否它已从给定的供应商唯一的产品。</span><span class="sxs-lookup"><span data-stu-id="49ebf-226">Imagine that our business rules dictate that a product could not be marked discontinued if it was the only product from a given supplier.</span></span> <span data-ttu-id="49ebf-227">也就是说，如果产品*X*是我们从供应商处购买的唯一产品*Y*，我们无法将标记*X*如弃用; 如果有，但是，供应商*Y*我们附带三种产品， *A*， *B*，和*C*，我们无法任何标记，并且所有这些为停止使用。</span><span class="sxs-lookup"><span data-stu-id="49ebf-227">That is, if product *X* was the only product we purchased from supplier *Y*, we could not mark *X* as discontinued; if, however, supplier *Y* supplied us with three products, *A*, *B*, and *C*, then we could mark any and all of these as discontinued.</span></span> <span data-ttu-id="49ebf-228">始终未对齐的奇数的业务规则，但业务规则和常识 ！</span><span class="sxs-lookup"><span data-stu-id="49ebf-228">An odd business rule, but business rules and common sense aren't always aligned!</span></span>

<span data-ttu-id="49ebf-229">若要执行此业务规则在`UpdateProducts`方法，我们将首先检查如果`Discontinued`已设置为`true`并且因此，我们将调用`GetProductsBySupplierID`以确定多少产品我们从购买此产品的供应商。</span><span class="sxs-lookup"><span data-stu-id="49ebf-229">To enforce this business rule in the `UpdateProducts` method we'd start by checking if `Discontinued` was set to `true` and, if so, we'd call `GetProductsBySupplierID` to determine how many products we purchased from this product's supplier.</span></span> <span data-ttu-id="49ebf-230">如果只有一个产品从此供应商处购买的我们引发`ApplicationException`。</span><span class="sxs-lookup"><span data-stu-id="49ebf-230">If only one product is purchased from this supplier, we throw an `ApplicationException`.</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample6.cs)]

## <a name="responding-to-validation-errors-in-the-presentation-tier"></a><span data-ttu-id="49ebf-231">响应表示层中的验证错误</span><span class="sxs-lookup"><span data-stu-id="49ebf-231">Responding to Validation Errors in the Presentation Tier</span></span>

<span data-ttu-id="49ebf-232">从表示层调用 BLL 时我们可以决定是否尝试处理可能会引发或让他们向上冒泡到 ASP.NET 的任何异常 (它将引发`HttpApplication`的`Error`事件)。</span><span class="sxs-lookup"><span data-stu-id="49ebf-232">When calling the BLL from the presentation tier we can decide whether to attempt to handle any exceptions that might be raised or let them bubble up to ASP.NET (which will raise the `HttpApplication`'s `Error` event).</span></span> <span data-ttu-id="49ebf-233">若要以编程方式使用 BLL 时处理异常，我们可以使用[try … catch](https://msdn.microsoft.com/library/0yd65esw.aspx)块，如以下示例所示：</span><span class="sxs-lookup"><span data-stu-id="49ebf-233">To handle an exception when working with the BLL programmatically, we can use a [try...catch](https://msdn.microsoft.com/library/0yd65esw.aspx) block, as the following example shows:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample7.cs)]

<span data-ttu-id="49ebf-234">我们会在将来的教程、 处理异常向上冒泡从 BLL 使用数据时，Web 控件的插入、 更新，或删除数据可以直接在而不是无需代码包装在一个事件处理程序中处理`try...catch`块。</span><span class="sxs-lookup"><span data-stu-id="49ebf-234">As we'll see in future tutorials, handling exceptions that bubble up from the BLL when using a data Web control for inserting, updating, or deleting data can be handled directly in an event handler as opposed to having to wrap code in `try...catch` blocks.</span></span>

## <a name="summary"></a><span data-ttu-id="49ebf-235">摘要</span><span class="sxs-lookup"><span data-stu-id="49ebf-235">Summary</span></span>

<span data-ttu-id="49ebf-236">设计良好的应用程序制作成不同的层，其中每个封装特定角色中。</span><span class="sxs-lookup"><span data-stu-id="49ebf-236">A well architected application is crafted into distinct layers, each of which encapsulates a particular role.</span></span> <span data-ttu-id="49ebf-237">在本系列文章的第一个教程中，我们将创建使用类型化数据集; 数据访问层在本教程中我们构建业务逻辑层为一系列的类在我们的应用程序`App_Code`调入我们 DAL 的文件夹。</span><span class="sxs-lookup"><span data-stu-id="49ebf-237">In the first tutorial of this article series we created a Data Access Layer using Typed DataSets; in this tutorial we built a Business Logic Layer as a series of classes in our application's `App_Code` folder that call down into our DAL.</span></span> <span data-ttu-id="49ebf-238">BLL 实现我们的应用程序的字段级别和业务级逻辑。</span><span class="sxs-lookup"><span data-stu-id="49ebf-238">The BLL implements the field-level and business-level logic for our application.</span></span> <span data-ttu-id="49ebf-239">除了创建单独的 BLL，正如我们在本教程中，做另一个选项是扩展 Tableadapter 的方法，通过使用分部类。</span><span class="sxs-lookup"><span data-stu-id="49ebf-239">In addition to creating a separate BLL, as we did in this tutorial, another option is to extend the TableAdapters' methods through the use of partial classes.</span></span> <span data-ttu-id="49ebf-240">但是，使用此方法不允许我们可以重写现有方法也不它分离我们 DAL 和我们 BLL 完全作为我们已经在本文中的方法。</span><span class="sxs-lookup"><span data-stu-id="49ebf-240">However, using this technique does not allow us to override existing methods nor does it separate our DAL and our BLL as cleanly as the approach we've taken in this article.</span></span>

<span data-ttu-id="49ebf-241">DAL 和 BLL 完成后，我们已准备好在我们的表示层上启动。</span><span class="sxs-lookup"><span data-stu-id="49ebf-241">With the DAL and BLL complete, we're ready to start on our presentation layer.</span></span> <span data-ttu-id="49ebf-242">在[下一教程](master-pages-and-site-navigation-cs.md)我们将会从数据访问主题简要 detour，并定义以在整个教程使用一致的页面布局。</span><span class="sxs-lookup"><span data-stu-id="49ebf-242">In the [next tutorial](master-pages-and-site-navigation-cs.md) we'll take a brief detour from data access topics and define a consistent page layout for use throughout the tutorials.</span></span>

<span data-ttu-id="49ebf-243">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="49ebf-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="49ebf-244">关于作者</span><span class="sxs-lookup"><span data-stu-id="49ebf-244">About the Author</span></span>

<span data-ttu-id="49ebf-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七个 ASP/ASP.NET 书籍和的创始人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年使用与 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="49ebf-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="49ebf-246">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="49ebf-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="49ebf-247">最新书籍是[ *Sam 教授自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="49ebf-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="49ebf-248">他可以达到在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或通过他的博客，其中可以找到在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="49ebf-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="49ebf-249">特别感谢</span><span class="sxs-lookup"><span data-stu-id="49ebf-249">Special Thanks To</span></span>

<span data-ttu-id="49ebf-250">本教程系列已由许多有用的审阅者评审。</span><span class="sxs-lookup"><span data-stu-id="49ebf-250">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="49ebf-251">本教程中的前导审阅者已沈 Shulok、 Dennis Patterson、 Carlos Santos 和希尔顿 Giesenow。</span><span class="sxs-lookup"><span data-stu-id="49ebf-251">Lead reviewers for this tutorial were Liz Shulok, Dennis Patterson, Carlos Santos, and Hilton Giesenow.</span></span> <span data-ttu-id="49ebf-252">对感兴趣查看我即将到来的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="49ebf-252">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="49ebf-253">如果是这样，删除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="49ebf-253">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="49ebf-254">[上一页](creating-a-data-access-layer-cs.md)
[下一页](master-pages-and-site-navigation-cs.md)</span><span class="sxs-lookup"><span data-stu-id="49ebf-254">[Previous](creating-a-data-access-layer-cs.md)
[Next](master-pages-and-site-navigation-cs.md)</span></span>
