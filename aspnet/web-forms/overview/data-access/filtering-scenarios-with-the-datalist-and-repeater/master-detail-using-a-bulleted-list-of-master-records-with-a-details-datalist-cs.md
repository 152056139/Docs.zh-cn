---
uid: web-forms/overview/data-access/filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs
title: "主/详细信息使用详细信息 DataList (C#) 的主机记录的项目符号列表 |Microsoft 文档"
author: rick-anderson
description: "在本教程中我们将压缩以前一教程两页主/详细信息的报表到单个页中，t 上显示的类别名称的项目符号列表..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/17/2006
ms.topic: article
ms.assetid: c727bb73-7b59-41a1-8dc3-623c6d69e7c2
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs
msc.type: authoredcontent
ms.openlocfilehash: cb943941ea4dbfbdc9230df4598ad406d4dee0b6
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/24/2018
---
<a name="masterdetail-using-a-bulleted-list-of-master-records-with-a-details-datalist-c"></a><span data-ttu-id="ea8d6-103">主/从 Master 记录的项目符号列表中使用的详细信息 DataList (C#)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-103">Master/Detail Using a Bulleted List of Master Records with a Details DataList (C#)</span></span>
====================
<span data-ttu-id="ea8d6-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ea8d6-105">[下载示例应用程序](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_35_CS.exe)或[下载 PDF](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/datatutorial35cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_35_CS.exe) or [Download PDF](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/datatutorial35cs1.pdf)</span></span>

> <span data-ttu-id="ea8d6-106">在本教程中我们将压缩以前一教程两页主/详细信息的报表到单个页中，屏幕和屏幕右侧的所选的类别的产品的左侧显示的类别名称的项目符号列表。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-106">In this tutorial we'll compress the two-page master/detail report of the previous tutorial into a single page, showing a bulleted list of category names on the left side of the screen and the selected category's products on the right of the screen.</span></span>


## <a name="introduction"></a><span data-ttu-id="ea8d6-107">介绍</span><span class="sxs-lookup"><span data-stu-id="ea8d6-107">Introduction</span></span>

<span data-ttu-id="ea8d6-108">在[前面教程](master-detail-filtering-acess-two-pages-datalist-cs.md)我们介绍了如何在两个页上分隔母版/详细信息报告。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-108">In the [preceding tutorial](master-detail-filtering-acess-two-pages-datalist-cs.md) we looked at how to separate a master/detail report across two pages.</span></span> <span data-ttu-id="ea8d6-109">在母版页中我们将使用重复器控件来呈现类别的项目符号列表。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-109">In the master page we used a Repeater control to render a bulleted list of categories.</span></span> <span data-ttu-id="ea8d6-110">每个类别名称为超链接，单击时，将采用指向详细信息页，其中两个列 DataList 介绍了这些产品用户属于所选类别。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-110">Each category name was a hyperlink that, when clicked, would take the user to the details page, where a two-column DataList showed those products belonging to the selected category.</span></span>

<span data-ttu-id="ea8d6-111">在本教程中我们将压缩两页教程到单个页中，呈现为 LinkButton 每个类别名称显示在屏幕左侧的类别名称的项目符号列表。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-111">In this tutorial we'll compress the two-page tutorial into a single page, showing a bulleted list of category names on the left side of the screen with each category name rendered as a LinkButton.</span></span> <span data-ttu-id="ea8d6-112">单击某个类别名称 LinkButtons 引发回发，并绑定到屏幕的右侧两列 DataList 的所选的类别的产品。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-112">Clicking one of the category name LinkButtons induces a postback and binds the selected category s products to a two-column DataList on the right of the screen.</span></span> <span data-ttu-id="ea8d6-113">除了显示每个类别的名称，在左侧中继器显示有多少总产品适用于给定类别 （请参见图 1）。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-113">In addition to displaying each category s name, the Repeater on the left shows how many total products there are for a given category (see Figure 1).</span></span>


<span data-ttu-id="ea8d6-114">[![在左侧显示的类别名称和产品的总数量](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image2.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-114">[![The Category s Name and Total Number of Products are Displayed on the Left](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image2.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image1.png)</span></span>

<span data-ttu-id="ea8d6-115">**图 1**： 左侧显示类别的名称和产品的总数量 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="ea8d6-115">**Figure 1**: The Category s Name and Total Number of Products are Displayed on the Left ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image3.png))</span></span>


## <a name="step-1-displaying-a-repeater-in-the-left-portion-of-the-screen"></a><span data-ttu-id="ea8d6-116">步骤 1： 在屏幕的左部分中显示中继器</span><span class="sxs-lookup"><span data-stu-id="ea8d6-116">Step 1: Displaying a Repeater in the Left Portion of the Screen</span></span>

<span data-ttu-id="ea8d6-117">对于本教程，我们需要将显示所选的类别的产品的左侧的类别的项目符号列表。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-117">For this tutorial we need to have the bulleted list of categories appear to the left of the selected category s products.</span></span> <span data-ttu-id="ea8d6-118">可以使用标准的 HTML 元素段落标记，非换行空格定位网页中的内容`<table>`s，依次类推或通过级联样式表 (CSS) 技术。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-118">Content within a web page can be positioned using standard HTML elements paragraph tags, non-breaking spaces, `<table>` s, and so on or through cascading stylesheet (CSS) techniques.</span></span> <span data-ttu-id="ea8d6-119">所有的我们的教程到目前为止已用于 CSS 技术定位。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-119">All of our tutorials thus far have used CSS techniques for positioning.</span></span> <span data-ttu-id="ea8d6-120">当我们在我们母版页中构建导航用户界面[母版页和网站的导航](../introduction/master-pages-and-site-navigation-cs.md)教程，我们使用了*绝对定位*，，该值指示导航的精确像素偏移量列表和主要内容。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-120">When we built the navigation user interface in our master page in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we used *absolute positioning*, indicating the precise pixel offset for the navigation list and the main content.</span></span> <span data-ttu-id="ea8d6-121">或者，使用 CSS 来定位到另一个通过左右的一个元素*浮点*。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-121">Alternatively, CSS can be used to position one element to the right or left of another through *floating*.</span></span> <span data-ttu-id="ea8d6-122">我们可以具有类别表中所选的类别的产品的左侧出现由浮点 DataList 左侧转发器的项目符号列表</span><span class="sxs-lookup"><span data-stu-id="ea8d6-122">We can have the bulleted list of categories appear to the left of the selected category s products by floating the Repeater to the left of the DataList</span></span>

<span data-ttu-id="ea8d6-123">打开`CategoriesAndProducts.aspx`来自页`DataListRepeaterFiltering`文件夹和中继器和 DataList 向页面添加。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-123">Open the `CategoriesAndProducts.aspx` page from the `DataListRepeaterFiltering` folder and add to the page a Repeater and a DataList.</span></span> <span data-ttu-id="ea8d6-124">设置中继器 s`ID`到`Categories`和 DataList s 到`CategoryProducts`。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-124">Set the Repeater s `ID` to `Categories` and the DataList s to `CategoryProducts`.</span></span> <span data-ttu-id="ea8d6-125">转到源视图并将其自身的转发器和 DataList 控件放`<div>`元素。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-125">Go to the Source view and put the Repeater and DataList controls within their own `<div>` elements.</span></span> <span data-ttu-id="ea8d6-126">也就是说，将括在转发器`<div>`元素第一个，然后在自己 DataList`<div>`中继器之后紧邻的元素。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-126">That is, enclose the Repeater within a `<div>` element first and then the DataList in its own `<div>` element directly after the Repeater.</span></span> <span data-ttu-id="ea8d6-127">你标记此时应类似于以下：</span><span class="sxs-lookup"><span data-stu-id="ea8d6-127">Your markup at this point should look similar to the following:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample1.aspx)]

<span data-ttu-id="ea8d6-128">若要 float DataList 左侧转发器，我们需要使用`float`CSS 样式属性，如下所示：</span><span class="sxs-lookup"><span data-stu-id="ea8d6-128">To float the Repeater to the left of the DataList, we need to use the `float` CSS style attribute, like so:</span></span>


[!code-html[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample2.html)]

<span data-ttu-id="ea8d6-129">`float: left;`浮动第一个`<div>`左侧的第二个元素。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-129">The `float: left;` floats the first `<div>` element to the left of the second one.</span></span> <span data-ttu-id="ea8d6-130">`width`和`padding-right`设置指示第一个`<div>`s`width`和之间添加填充量`<div>`元素的内容和其右边距。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-130">The `width` and `padding-right` settings indicate the first `<div>` s `width` and how much padding is added between the `<div>` element s content and its right margin.</span></span> <span data-ttu-id="ea8d6-131">有关详细信息中 CSS 的浮点元素签出[Floatutorial](http://css.maxdesign.com.au/floatutorial/)。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-131">For more information on floating elements in CSS check out the [Floatutorial](http://css.maxdesign.com.au/floatutorial/).</span></span>

<span data-ttu-id="ea8d6-132">而不是指定的样式设置直接通过第一个`<p>`元素 s`style`属性，但让改为创建新的 CSS 类中的 s`Styles.css`名为`FloatLeft`:</span><span class="sxs-lookup"><span data-stu-id="ea8d6-132">Rather than specify the style setting directly through the first `<p>` element s `style` attribute, let s instead create a new CSS class in `Styles.css` named `FloatLeft`:</span></span>


[!code-css[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample3.css)]

<span data-ttu-id="ea8d6-133">然后我们可以将`<div>`与`<div class="FloatLeft">`。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-133">Then we can replace the `<div>` with `<div class="FloatLeft">`.</span></span>

<span data-ttu-id="ea8d6-134">在添加 CSS 类和配置中的标记后`CategoriesAndProducts.aspx`页上，转到设计器。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-134">After adding the CSS class and configuring the markup in the `CategoriesAndProducts.aspx` page, go to the Designer.</span></span> <span data-ttu-id="ea8d6-135">你应看到浮点 DataList 左侧 （尽管右现在这两项仅出现如以来我们遇到有待配置其数据源或模板灰框） 转发器。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-135">You should see the Repeater floating to the left of the DataList (although right now both just appear as gray boxes since we ve yet to configure their data sources or templates).</span></span>


<span data-ttu-id="ea8d6-136">[![DataList 左侧浮动转发器](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image5.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-136">[![The Repeater is Floated to the Left of the DataList](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image5.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image4.png)</span></span>

<span data-ttu-id="ea8d6-137">**图 2**: 中继器浮动 DataList 左侧 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="ea8d6-137">**Figure 2**: The Repeater is Floated to the Left of the DataList ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image6.png))</span></span>


## <a name="step-2-determining-the-number-of-products-for-each-category"></a><span data-ttu-id="ea8d6-138">步骤 2： 确定每个类别的产品数</span><span class="sxs-lookup"><span data-stu-id="ea8d6-138">Step 2: Determining the Number of Products for Each Category</span></span>

<span data-ttu-id="ea8d6-139">使用转发器和 DataList s 周围标记完成，我们已准备好将类别数据绑定到中继器重新控制。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-139">With the Repeater and DataList s surrounding markup complete, we re ready to bind the category data to the Repeater control.</span></span> <span data-ttu-id="ea8d6-140">但是，如图 1 中的类别的项目符号列表所示，除了每个类别的名称我们还需要显示的与类别关联的产品数目。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-140">However, as the bulleted list of categories in Figure 1 shows, in addition to each category s name we also need to display the number of products associated with the category.</span></span> <span data-ttu-id="ea8d6-141">若要访问此信息，我们可以：</span><span class="sxs-lookup"><span data-stu-id="ea8d6-141">To access this information we can either:</span></span>

- <span data-ttu-id="ea8d6-142">**确定此信息从 ASP.NET 页的代码隐藏类。**</span><span class="sxs-lookup"><span data-stu-id="ea8d6-142">**Determine this information from the ASP.NET page s code-behind class.**</span></span> <span data-ttu-id="ea8d6-143">给定特定 *`categoryID`* 我们可以通过调用确定关联的产品数`ProductsBLL`类的`GetProductsByCategoryID(categoryID)`方法。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-143">Given a particular *`categoryID`* we can determine the number of associated products by calling the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="ea8d6-144">此方法返回`ProductsDataTable`对象，其`Count`属性指示多少`ProductsRow`s 存在，即指定的产品数 *`categoryID`* 。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-144">This method returns a `ProductsDataTable` object whose `Count` property indicates how many `ProductsRow` s exists, which is the number of products for the specified *`categoryID`*.</span></span> <span data-ttu-id="ea8d6-145">我们可以创建`ItemDataBound`事件处理程序，对于绑定到中继器，每个类别调用中继器`ProductsBLL`类的`GetProductsByCategoryID(categoryID)`方法并在输出中包含其计数。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-145">We can create an `ItemDataBound` event handler for the Repeater that, for each category bound to the Repeater, calls the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and includes its count in the output.</span></span>
- <span data-ttu-id="ea8d6-146">**更新`CategoriesDataTable`要包括的类型化数据集中`NumberOfProducts`列。**</span><span class="sxs-lookup"><span data-stu-id="ea8d6-146">**Update the `CategoriesDataTable` in the Typed DataSet to include a `NumberOfProducts` column.**</span></span> <span data-ttu-id="ea8d6-147">然后，我们可以更新`GetCategories()`中的方法`CategoriesDataTable`若要包括此信息或，或者，将保留`GetCategories()`作为-并创建一个新`CategoriesDataTable`调用方法`GetCategoriesAndNumberOfProducts()`。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-147">We can then update the `GetCategories()` method in the `CategoriesDataTable` to include this information or, alternatively, leave `GetCategories()` as-is and create a new `CategoriesDataTable` method called `GetCategoriesAndNumberOfProducts()`.</span></span>

<span data-ttu-id="ea8d6-148">让我们来浏览这两种技术。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-148">Let s explore both of these techniques.</span></span> <span data-ttu-id="ea8d6-149">第一种方法会更易于实现的因为我们不需要更新数据访问层;但是，它需要与数据库的多个通信。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-149">The first approach is simpler to implement since we don t need to update the Data Access Layer; however, it requires more communications with the database.</span></span> <span data-ttu-id="ea8d6-150">调用`ProductsBLL`类 s`GetProductsByCategoryID(categoryID)`中的方法`ItemDataBound`事件处理程序添加的额外数据库调用的转发器中显示每个类别。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-150">The call to the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method in the `ItemDataBound` event handler adds an extra database call for each category displayed in the Repeater.</span></span> <span data-ttu-id="ea8d6-151">凭借此技术有*N* + 1 个数据库调用其中*N*是显示在转发器的类别的数目。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-151">With this technique there are *N* + 1 database calls, where *N* is the number of categories displayed in the Repeater.</span></span> <span data-ttu-id="ea8d6-152">使用第二个方法中，产品计数返回有关从每个类别的信息`CategoriesBLL`类 s `GetCategories()` (或`GetCategoriesAndNumberOfProducts()`) 方法，从而导致检索只需一次到数据库。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-152">With the second approach, the product count is returned with information about each category from the `CategoriesBLL` class s `GetCategories()` (or `GetCategoriesAndNumberOfProducts()`) method, thereby resulting in just one trip to the database.</span></span>

## <a name="determining-the-number-of-products-in-the-itemdatabound-event-handler"></a><span data-ttu-id="ea8d6-153">确定 ItemDataBound 事件处理程序中的产品数</span><span class="sxs-lookup"><span data-stu-id="ea8d6-153">Determining the Number of Products in the ItemDataBound Event Handler</span></span>

<span data-ttu-id="ea8d6-154">确定转发器 s 中每种类别的产品数`ItemDataBound`事件处理程序不需要对我们现有的数据访问层进行任何修改。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-154">Determining the number of products for each category in the Repeater s `ItemDataBound` event handler does not require any modifications to our existing Data Access Layer.</span></span> <span data-ttu-id="ea8d6-155">可直接在内进行所有修改`CategoriesAndProducts.aspx`页。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-155">All modifications can be made directly within the `CategoriesAndProducts.aspx` page.</span></span> <span data-ttu-id="ea8d6-156">首先，通过添加名为新 ObjectDataSource`CategoriesDataSource`通过中继器 s 智能标记。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-156">Start by adding a new ObjectDataSource named `CategoriesDataSource` via the Repeater s smart tag.</span></span> <span data-ttu-id="ea8d6-157">接下来，配置`CategoriesDataSource`ObjectDataSource 以便它检索从其数据`CategoriesBLL`类的`GetCategories()`方法。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-157">Next, configure the `CategoriesDataSource` ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories()` method.</span></span>


<span data-ttu-id="ea8d6-158">[![配置对象数据源以使用 CategoriesBLL 类的 GetCategories() 方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image8.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-158">[![Configure the ObjectDataSource to Use the CategoriesBLL class s GetCategories() Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image8.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image7.png)</span></span>

<span data-ttu-id="ea8d6-159">**图 3**： 配置使用 ObjectDataSource`CategoriesBLL`类 s`GetCategories()`方法 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="ea8d6-159">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` class s `GetCategories()` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image9.png))</span></span>


<span data-ttu-id="ea8d6-160">在每个项`Categories`中继器需要能可单击，，单击时，会导致`CategoryProducts`DataList 以显示所选类别这些产品。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-160">Each item in the `Categories` Repeater needs to be clickable and, when clicked, cause the `CategoryProducts` DataList to display those products for the selected category.</span></span> <span data-ttu-id="ea8d6-161">这可以通过使每个类别的超链接，链接回此相同的页 (`CategoriesAndProducts.aspx`)，但传入`CategoryID`通过查询字符串，我们在前面的教程中看到一样。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-161">This can be accomplished by making each category a hyperlink, linking back to this same page (`CategoriesAndProducts.aspx`), but passing the `CategoryID` through the querystring, much like we saw in the previous tutorial.</span></span> <span data-ttu-id="ea8d6-162">此方法的优点是可以标有书签并由搜索引擎编制索引页，其中显示特定类别的产品。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-162">The advantage of this approach is that a page displaying a particular category s products can be bookmarked and indexed by a search engine.</span></span>

<span data-ttu-id="ea8d6-163">或者，我们可以让每个类别 LinkButton，这是我们将使用本教程中的方法。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-163">Alternatively, we can make each category a LinkButton, which is the approach we'll use for this tutorial.</span></span> <span data-ttu-id="ea8d6-164">LinkButton 呈现为超链接用户 s 浏览器中，但单击时，引发的回发;在回发时，DataList 的 ObjectDataSource 需要刷新以显示属于所选类别这些产品。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-164">The LinkButton renders in the user s browser as a hyperlink but, when clicked, induces a postback; on postback, the DataList s ObjectDataSource needs to be refreshed to display those products belonging to the selected category.</span></span> <span data-ttu-id="ea8d6-165">对于本教程，使用超链接更有意义比使用 LinkButton;但是，可能有其他场景中，使用 LinkButton 是更有利。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-165">For this tutorial, using a hyperlink makes more sense than using a LinkButton; however, there may be other scenarios where using a LinkButton is more advantageous.</span></span> <span data-ttu-id="ea8d6-166">超链接的方法是将适合于此示例的而让改为尝试使用 LinkButton 的 s。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-166">While the hyperlink approach would be ideal for this example, let s instead explore using the LinkButton.</span></span> <span data-ttu-id="ea8d6-167">如我们所见，使用 LinkButton 引入了一些难题，否则不会出现与超链接。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-167">As we'll see, using a LinkButton introduces some challenges that would not otherwise arise with a hyperlink.</span></span> <span data-ttu-id="ea8d6-168">因此，在本教程使用 LinkButton 将突出显示这些难题并帮助提供有关我们可能想要使用而不是超链接 LinkButton 这些方案的解决方案。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-168">Therefore, using a LinkButton in this tutorial will highlight these challenges and help provide solutions for those scenarios where we may want to use a LinkButton instead of a hyperlink.</span></span>

> [!NOTE]
> <span data-ttu-id="ea8d6-169">建议重复本教程中使用超链接控件或`<a>`LinkButton 替代的元素。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-169">You are encouraged to repeat this tutorial using a HyperLink control or `<a>` element in lieu of the LinkButton.</span></span>


<span data-ttu-id="ea8d6-170">以下标记显示中继器和 ObjectDataSource 声明性语法。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-170">The following markup shows the declarative syntax for the Repeater and the ObjectDataSource.</span></span> <span data-ttu-id="ea8d6-171">请注意中继器的模板呈现 LinkButton 作为每个项的项目符号列表：</span><span class="sxs-lookup"><span data-stu-id="ea8d6-171">Note that the Repeater s templates render a bulleted list with each item as a LinkButton:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample4.aspx)]

> [!NOTE]
> <span data-ttu-id="ea8d6-172">对于本教程的转发器必须具有启用其视图状态 (请注意省略`EnableViewState="False"`从转发器 s 声明性语法)。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-172">For this tutorial the Repeater must have its view state enabled (note the omission of the `EnableViewState="False"` from the Repeater s declarative syntax).</span></span> <span data-ttu-id="ea8d6-173">在步骤 3 中我们将创建一个事件处理程序为转发器 s`ItemCommand`事件在其中我们将更新 DataList 的 ObjectDataSource 的`SelectParameters`集合。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-173">In step 3 we'll be creating an event handler for the Repeater s `ItemCommand` event in which we'll be updating the DataList s ObjectDataSource s `SelectParameters` collection.</span></span> <span data-ttu-id="ea8d6-174">转发器的`ItemCommand`，但是，如果禁用了视图状态获胜 t 激发。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-174">The Repeater s `ItemCommand`, however, won t fire if view state is disabled.</span></span> <span data-ttu-id="ea8d6-175">请参阅[ASP.NET 问题的问题贴](http://scottonwriting.net/sowblog/posts/1263.aspx)和[其解决方案](http://scottonwriting.net/sowBlog/posts/1268.aspx)原因的详细信息。 必须为中继器 s 启用视图状态`ItemCommand`事件激发。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-175">See [A Stumper of an ASP.NET Question](http://scottonwriting.net/sowblog/posts/1263.aspx) and [its solution](http://scottonwriting.net/sowBlog/posts/1268.aspx) for more information on why view state must be enabled for a Repeater s `ItemCommand` event to fire.</span></span>


<span data-ttu-id="ea8d6-176">与 LinkButton`ID`属性值`ViewCategory`不具有其`Text`属性集。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-176">The LinkButton with the `ID` property value of `ViewCategory` does not have its `Text` property set.</span></span> <span data-ttu-id="ea8d6-177">如果我们必须只是想要显示的类别名称，我们将具有文本属性以声明方式，通过设置数据绑定语法，如下所示：</span><span class="sxs-lookup"><span data-stu-id="ea8d6-177">If we had just wanted to display the category name, we would have set the Text property declaratively, through databinding syntax, like so:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample5.aspx)]

<span data-ttu-id="ea8d6-178">但是，我们希望能够显示这两个类别的名称*和*属于该类别的产品数。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-178">However, we want to show both the category s name *and* the number of products belonging to that category.</span></span> <span data-ttu-id="ea8d6-179">可以从转发器 s 检索此信息`ItemDataBound`通过到调用的事件处理程序`ProductBLL`类 s`GetCategoriesByProductID(categoryID)`方法，并确定多少条记录返回在产生`ProductsDataTable`，如以下代码演示：</span><span class="sxs-lookup"><span data-stu-id="ea8d6-179">This information can be retrieved from the Repeater s `ItemDataBound` event handler by making a call to the `ProductBLL` class s `GetCategoriesByProductID(categoryID)` method and determining how many records are returned in the resulting `ProductsDataTable`, as the following code illustrates:</span></span>


[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample6.cs)]

<span data-ttu-id="ea8d6-180">首先，我们确保我们重新使用数据项 (一个其`ItemType`是`Item`或`AlternatingItem`)，然后引用`CategoriesRow`刚刚已绑定到当前的实例`RepeaterItem`。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-180">We start out by ensuring that we re working with a data item (one whose `ItemType` is `Item` or `AlternatingItem`) and then reference the `CategoriesRow` instance that has just been bound to the current `RepeaterItem`.</span></span> <span data-ttu-id="ea8d6-181">接下来，我们通过创建的实例确定此类别的产品数`ProductsBLL`类，调用其`GetCategoriesByProductID(categoryID)`方法，并确定使用返回的记录数`Count`属性。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-181">Next, we determine the number of products for this category by creating an instance of the `ProductsBLL` class, calling its `GetCategoriesByProductID(categoryID)` method, and determining the number of records returned using the `Count` property.</span></span> <span data-ttu-id="ea8d6-182">最后，`ViewCategory`中 ItemTemplate LinkButton 是引用并将其`Text`属性设置为*CategoryName* (*NumberOfProductsInCategory*)，其中*NumberOfProductsInCategory*设置为带有零个小数位数的数字的格式。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-182">Finally, the `ViewCategory` LinkButton in the ItemTemplate is references and its `Text` property is set to *CategoryName* (*NumberOfProductsInCategory*), where *NumberOfProductsInCategory* is formatted as a number with zero decimal places.</span></span>

> [!NOTE]
> <span data-ttu-id="ea8d6-183">或者，我们无法添加了*格式设置函数*到 ASP.NET 页的代码隐藏类接受类别 s 的`CategoryName`和`CategoryID`值，并返回`CategoryName`加上的数字类别中的产品 (通过调用确定`GetCategoriesByProductID(categoryID)`方法)。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-183">Alternatively, we could have added a *formatting function* to the ASP.NET page s code-behind class that accepts a category s `CategoryName` and `CategoryID` values and returns the `CategoryName` concatenated with the number of products in the category (as determined by calling the `GetCategoriesByProductID(categoryID)` method).</span></span> <span data-ttu-id="ea8d6-184">此类格式设置的函数的结果无法以声明方式分配给 LinkButton 的文本属性将需`ItemDataBound`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-184">The results of such a formatting function could be declaratively assigned to the LinkButton s Text property replacing the need for the `ItemDataBound` event handler.</span></span> <span data-ttu-id="ea8d6-185">请参阅[GridView 控件中使用 TemplateFields](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md)或[格式设置的 DataList 和数据后转发器基于](../displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs.md)使用格式设置的函数的详细信息的教程。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-185">Refer to the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) or [Formatting the DataList and Repeater Based Upon Data](../displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs.md) tutorials for more information on using formatting functions.</span></span>


<span data-ttu-id="ea8d6-186">添加此事件处理程序后, 需要一段时间来测试通过浏览器页面。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-186">After adding this event handler, take a moment to test the page through a browser.</span></span> <span data-ttu-id="ea8d6-187">请注意如何在项目符号列表中，显示类别的名称和与类别关联的产品数列出每个类别 （请参见图 4）。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-187">Note how each category is listed in a bulleted list, displaying the category s name and the number of products associated with the category (see Figure 4).</span></span>


<span data-ttu-id="ea8d6-188">[![显示每个类别名称和产品数](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image11.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-188">[![Each Category s Name and Number of Products are Displayed](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image11.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image10.png)</span></span>

<span data-ttu-id="ea8d6-189">**图 4**： 显示每个类别的名称和数量的产品 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="ea8d6-189">**Figure 4**: Each Category s Name and Number of Products are Displayed ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image12.png))</span></span>


## <a name="updating-thecategoriesdatatableandcategoriestableadapterto-include-the-number-of-products-for-each-category"></a><span data-ttu-id="ea8d6-190">更新`CategoriesDataTable`和`CategoriesTableAdapter`以针对每个类别包括的产品数目</span><span class="sxs-lookup"><span data-stu-id="ea8d6-190">Updating the`CategoriesDataTable`and`CategoriesTableAdapter`to Include the Number of Products for Each Category</span></span>

<span data-ttu-id="ea8d6-191">而不是确定它与每个类别的产品数目 s 绑定到转发器，我们可以通过调整简化此过程`CategoriesDataTable`和`CategoriesTableAdapter`数据访问层，将此信息包括本机中。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-191">Rather than determining the number of products for each category as it s bound to the Repeater, we can streamline this process by adjusting the `CategoriesDataTable` and `CategoriesTableAdapter` in the Data Access Layer to include this information natively.</span></span> <span data-ttu-id="ea8d6-192">若要实现此目的，我们必须添加到新列`CategoriesDataTable`以容纳的相关联的产品数。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-192">To achieve this, we must add a new column to `CategoriesDataTable` to hold the number of associated products.</span></span> <span data-ttu-id="ea8d6-193">若要将新列添加到数据表中，打开类型化数据集 (`App_Code\DAL\Northwind.xsd`)，右键单击 DataTable 若要修改，然后选择添加 / 列。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-193">To add a new column to a DataTable, open the Typed DataSet (`App_Code\DAL\Northwind.xsd`), right-click on the DataTable to modify, and choose Add / Column.</span></span> <span data-ttu-id="ea8d6-194">添加到一个新列`CategoriesDataTable`（请参见图 5）。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-194">Add a new column to the `CategoriesDataTable` (see Figure 5).</span></span>


<span data-ttu-id="ea8d6-195">[![将新列添加到 CategoriesDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image14.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-195">[![Add a New Column to the CategoriesDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image14.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image13.png)</span></span>

<span data-ttu-id="ea8d6-196">**图 5**： 添加到一个新列`CategoriesDataSource`([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="ea8d6-196">**Figure 5**: Add a New Column to the `CategoriesDataSource` ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image15.png))</span></span>


<span data-ttu-id="ea8d6-197">这将添加一个名为的新列`Column1`，这可以更改通过只需键入其他名称。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-197">This will add a new column named `Column1`, which you can change by simply typing in a different name.</span></span> <span data-ttu-id="ea8d6-198">重命名此新列`NumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-198">Rename this new column to `NumberOfProducts`.</span></span> <span data-ttu-id="ea8d6-199">接下来，我们需要配置此列的属性。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-199">Next, we need to configure this column s properties.</span></span> <span data-ttu-id="ea8d6-200">单击新列，转到属性窗口。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-200">Click on the new column and go to the Properties window.</span></span> <span data-ttu-id="ea8d6-201">更改列 s`DataType`属性从`System.String`到`System.Int32`并设置`ReadOnly`属性`True`，如图 6 中所示。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-201">Change the column s `DataType` property from `System.String` to `System.Int32` and set the `ReadOnly` property to `True`, as shown in Figure 6.</span></span>


![设置数据类型和新的列的 ReadOnly 属性](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image16.png)

<span data-ttu-id="ea8d6-203">**图 6**： 设置`DataType`和`ReadOnly`新列的属性</span><span class="sxs-lookup"><span data-stu-id="ea8d6-203">**Figure 6**: Set the `DataType` and `ReadOnly` Properties of the New Column</span></span>


<span data-ttu-id="ea8d6-204">虽然`CategoriesDataTable`现在具有`NumberOfProducts`列中，按任何相应的 TableAdapter 的查询未设置其值。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-204">While the `CategoriesDataTable` now has a `NumberOfProducts` column, its value is not set by any of the corresponding TableAdapter s queries.</span></span> <span data-ttu-id="ea8d6-205">我们可以更新`GetCategories()`方法来返回此信息，如果我们想要此类信息返回每次检索类别信息。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-205">We can update the `GetCategories()` method to return this information if we want such information returned every time category information is retrieved.</span></span> <span data-ttu-id="ea8d6-206">如果，但是，我们只需要获取关联产品的极少数情况下 （例如，仅对于本教程中） 中的类别数，则我们可以保留`GetCategories()`作为-并创建新的方法，返回此信息。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-206">If, however, we only need to grab the number of associated products for the categories in rare instances (such as just for this tutorial), then we can leave `GetCategories()` as-is and create a new method that returns this information.</span></span> <span data-ttu-id="ea8d6-207">允许 s 使用此后一种方法，创建一个名为的新方法`GetCategoriesAndNumberOfProducts()`。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-207">Let s use this latter approach, creating a new method named `GetCategoriesAndNumberOfProducts()`.</span></span>

<span data-ttu-id="ea8d6-208">若要添加此新`GetCategoriesAndNumberOfProducts()`方法中，右键单击`CategoriesTableAdapter`，然后选择新查询。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-208">To add this new `GetCategoriesAndNumberOfProducts()` method, right-click on the `CategoriesTableAdapter` and choose New Query.</span></span> <span data-ttu-id="ea8d6-209">这将显示的向上 TableAdapter 查询配置向导中，哪些我们已在前面的教程中多次使用。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-209">This brings up the TableAdapter Query Configuration Wizard, which we ve used numerous times in previous tutorials.</span></span> <span data-ttu-id="ea8d6-210">对于此方法，通过指示，此查询使用返回行的临时 SQL 语句中启动向导。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-210">For this method, start the wizard by indicating that the query uses an ad-hoc SQL statement that returns rows.</span></span>


<span data-ttu-id="ea8d6-211">[![创建使用临时 SQL 语句的方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image18.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-211">[![Create the Method Using an Ad-Hoc SQL Statement](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image18.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image17.png)</span></span>

<span data-ttu-id="ea8d6-212">**图 7**： 创建方法使用临时 SQL 语句 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image19.png))</span><span class="sxs-lookup"><span data-stu-id="ea8d6-212">**Figure 7**: Create the Method Using an Ad-Hoc SQL Statement ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image19.png))</span></span>


<span data-ttu-id="ea8d6-213">[![SQL 语句返回的行](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image21.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-213">[![The SQL Statement Returns Rows](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image21.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image20.png)</span></span>

<span data-ttu-id="ea8d6-214">**图 8**: SQL 语句返回行 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="ea8d6-214">**Figure 8**: The SQL Statement Returns Rows ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image22.png))</span></span>


<span data-ttu-id="ea8d6-215">下一步的向导屏幕提示 us 代表要使用的查询。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-215">The next wizard screen prompts us for the query to use.</span></span> <span data-ttu-id="ea8d6-216">若要返回每个类别 s `CategoryID`， `CategoryName`，和`Description`字段，以及与该类别关联的产品数目使用以下`SELECT`语句：</span><span class="sxs-lookup"><span data-stu-id="ea8d6-216">To return each category s `CategoryID`, `CategoryName`, and `Description` fields, along with the number of products associated with the category, use the following `SELECT` statement:</span></span>


[!code-sql[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample7.sql)]


<span data-ttu-id="ea8d6-217">[![指定使用的查询](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image24.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-217">[![Specify the Query to Use](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image24.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image23.png)</span></span>

<span data-ttu-id="ea8d6-218">**图 9**： 指定使用的查询 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="ea8d6-218">**Figure 9**: Specify the Query to Use ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image25.png))</span></span>


<span data-ttu-id="ea8d6-219">请注意，子查询计算与类别关联的产品数斐波那是别名为`NumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-219">Note that the subquery that computes the number of products associated with the category is aliased as `NumberOfProducts`.</span></span> <span data-ttu-id="ea8d6-220">此命名的匹配项将导致返回此子查询，以与关联的值`CategoriesDataTable`s`NumberOfProducts`列。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-220">This naming match causes the value returned by this subquery to be associated with the `CategoriesDataTable` s `NumberOfProducts` column.</span></span>

<span data-ttu-id="ea8d6-221">在输入此查询后，最后一步是选择新的方法的名称。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-221">After entering this query, the last step is to choose the name for the new method.</span></span> <span data-ttu-id="ea8d6-222">使用`FillWithNumberOfProducts`和`GetCategoriesAndNumberOfProducts`填充 DataTable 并返回数据表模式，分别。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-222">Use `FillWithNumberOfProducts` and `GetCategoriesAndNumberOfProducts` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span>


<span data-ttu-id="ea8d6-223">[![新的 TableAdapter 的方法 FillWithNumberOfProducts 名称和 GetCategoriesAndNumberOfProducts](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image27.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-223">[![Name the New TableAdapter s Methods FillWithNumberOfProducts and GetCategoriesAndNumberOfProducts](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image27.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image26.png)</span></span>

<span data-ttu-id="ea8d6-224">**图 10**： 命名新的 TableAdapter s 方法`FillWithNumberOfProducts`和`GetCategoriesAndNumberOfProducts`([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="ea8d6-224">**Figure 10**: Name the New TableAdapter s Methods `FillWithNumberOfProducts` and `GetCategoriesAndNumberOfProducts` ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image28.png))</span></span>


<span data-ttu-id="ea8d6-225">此时数据访问层已扩展为包含的每个类别的产品数目。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-225">At this point the Data Access Layer has been extended to include the number of products per category.</span></span> <span data-ttu-id="ea8d6-226">由于所有我们表示层将路由到通过单独的业务逻辑层 DAL 的所有调用我们需要添加相应`GetCategoriesAndNumberOfProducts`方法`CategoriesBLL`类：</span><span class="sxs-lookup"><span data-stu-id="ea8d6-226">Since all our presentation layer routes all calls to the DAL through a separate Business Logic Layer we need to add a corresponding `GetCategoriesAndNumberOfProducts` method to the `CategoriesBLL` class:</span></span>


[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample8.cs)]

<span data-ttu-id="ea8d6-227">DAL 和 BLL 完成后，我们重新准备好将绑定到此数据`Categories`中的转发器`CategoriesAndProducts.aspx`！</span><span class="sxs-lookup"><span data-stu-id="ea8d6-227">With the DAL and BLL complete, we re ready to bind this data to the `Categories` Repeater in `CategoriesAndProducts.aspx`!</span></span> <span data-ttu-id="ea8d6-228">如果以前已为从确定转发器中创建对象数据源中的产品数`ItemDataBound`事件处理程序部分中，删除此对象数据源并删除转发器的`DataSourceID`属性设置; 还无线免缠绕转发器 s`ItemDataBound`通过删除的事件处理的事件`Handles Categories.OnItemDataBound`ASP.NET 代码隐藏类中的语法。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-228">If you ve already created an ObjectDataSource for the Repeater from the Determining the Number of Products in the `ItemDataBound` Event Handler section, delete this ObjectDataSource and remove the Repeater s `DataSourceID` property setting; also unwire the Repeater s `ItemDataBound` event from the event handler by removing the `Handles Categories.OnItemDataBound` syntax in the ASP.NET code-behind class.</span></span>

<span data-ttu-id="ea8d6-229">返回在其原始状态中继器，添加名为新 ObjectDataSource`CategoriesDataSource`通过中继器 s 智能标记。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-229">With the Repeater back in its original state, add a new ObjectDataSource named `CategoriesDataSource` via the Repeater s smart tag.</span></span> <span data-ttu-id="ea8d6-230">配置对象数据源以使用`CategoriesBLL`类，但而不是让它使用`GetCategories()`方法，具有它使用`GetCategoriesAndNumberOfProducts()`改为 （请参阅图 11）。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-230">Configure the ObjectDataSource to use the `CategoriesBLL` class, but instead of having it use the `GetCategories()` method, have it use `GetCategoriesAndNumberOfProducts()` instead (see Figure 11).</span></span>


<span data-ttu-id="ea8d6-231">[![配置对象数据源以使用 GetCategoriesAndNumberOfProducts 方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image30.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-231">[![Configure the ObjectDataSource to Use the GetCategoriesAndNumberOfProducts Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image30.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image29.png)</span></span>

<span data-ttu-id="ea8d6-232">**图 11**： 配置使用 ObjectDataSource`GetCategoriesAndNumberOfProducts`方法 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="ea8d6-232">**Figure 11**: Configure the ObjectDataSource to Use the `GetCategoriesAndNumberOfProducts` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image31.png))</span></span>


<span data-ttu-id="ea8d6-233">接下来，更新`ItemTemplate`以便 LinkButton s`Text`属性以声明方式分配使用数据绑定的语法，并且同时包含`CategoryName`和`NumberOfProducts`数据字段。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-233">Next, update the `ItemTemplate` so that the LinkButton s `Text` property is declaratively assigned using databinding syntax and includes both the `CategoryName` and `NumberOfProducts` data fields.</span></span> <span data-ttu-id="ea8d6-234">转发器的完整声明性标记和`CategoriesDataSource`ObjectDataSource 按照：</span><span class="sxs-lookup"><span data-stu-id="ea8d6-234">The complete declarative markup for the Repeater and the `CategoriesDataSource` ObjectDataSource follow:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample9.aspx)]

<span data-ttu-id="ea8d6-235">通过更新以包括 DAL 呈现的输出`NumberOfProducts`列是不同于使用`ItemDataBound`事件处理程序方法 (回头参考图 4，以查看屏幕截图显示的类别名称和产品数转发器)。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-235">The output rendered by updating the DAL to include a `NumberOfProducts` column is the same as using the `ItemDataBound` event handler approach (refer back to Figure 4 to see a screen shot of the Repeater showing the category names and number of products).</span></span>

## <a name="step-3-displaying-the-selected-category-s-products"></a><span data-ttu-id="ea8d6-236">步骤 3： 显示所选的类别的产品</span><span class="sxs-lookup"><span data-stu-id="ea8d6-236">Step 3: Displaying the Selected Category s Products</span></span>

<span data-ttu-id="ea8d6-237">现在我们有`Categories`以及数量的产品类别列表中显示每个类别中的转发器。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-237">At this point we have the `Categories` Repeater displaying the list of categories along with the number of products in each category.</span></span> <span data-ttu-id="ea8d6-238">转发器的每个类别，单击时，会回发时，在该点我们使用 LinkButton 需要显示在所选类别这些产品`CategoryProducts`DataList。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-238">The Repeater uses a LinkButton for each category that, when clicked, causes a postback, at which point we need to display those products for the selected category in the `CategoryProducts` DataList.</span></span>

<span data-ttu-id="ea8d6-239">我们面临的挑战之一是： 如何让 DataList 显示只需为所选类别这些产品。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-239">One challenge facing us is how to have the DataList display just those products for the selected category.</span></span> <span data-ttu-id="ea8d6-240">在[母版/详细介绍与详细信息说明如何使用可选择的主 GridView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md)可以选择的教程，我们已了解如何生成一个 GridView 其行、 与所选行 s 的详细信息显示在同一页面上的说明。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-240">In the [Master/Detail Using a Selectable Master GridView with a Details DetailsView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md) tutorial we saw how to build a GridView whose rows could be selected, with the selected row s details being displayed in a DetailsView on the same page.</span></span> <span data-ttu-id="ea8d6-241">GridView 的 ObjectDataSource 返回有关使用的所有产品的信息`ProductsBLL`s`GetProducts()`方法，同时说明的 ObjectDataSource 检索有关所选的产品使用信息`GetProductsByProductID(productID)`方法。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-241">The GridView s ObjectDataSource returned information about all products using the `ProductsBLL` s `GetProducts()` method while the DetailsView s ObjectDataSource retrieved information about the selected product using the `GetProductsByProductID(productID)` method.</span></span> <span data-ttu-id="ea8d6-242">*`productID`* 参数值以声明方式由 GridView s 的值与关联`SelectedValue`属性。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-242">The *`productID`* parameter value was provided declaratively by associating it with the value of the GridView s `SelectedValue` property.</span></span> <span data-ttu-id="ea8d6-243">遗憾的是，中继器没有`SelectedValue`属性和不能用作参数源。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-243">Unfortunately, the Repeater does not have a `SelectedValue` property and cannot serve as a parameter source.</span></span>

> [!NOTE]
> <span data-ttu-id="ea8d6-244">这是显示在中继器中使用 LinkButton 时这些挑战之一。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-244">This is one of those challenges that appear when using the LinkButton in a Repeater.</span></span> <span data-ttu-id="ea8d6-245">我们已使用超链接传入`CategoryID`通过查询字符串相反，我们无法将该查询字符串字段用作源参数的值。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-245">Had we used a hyperlink to pass in the `CategoryID` through the querystring instead, we could use that QueryString field as the source for the parameter s value.</span></span>


<span data-ttu-id="ea8d6-246">我们担心在缺乏之前`SelectedValue`属性中继器，不过，让我们来首先将 DataList 绑定到对象数据源，并指定其`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-246">Before we worry about the lack of a `SelectedValue` property for the Repeater, though, let s first bind the DataList to an ObjectDataSource and specify its `ItemTemplate`.</span></span>

<span data-ttu-id="ea8d6-247">从 DataList s 智能标记中，选择要添加名为新 ObjectDataSource`CategoryProductsDataSource`和将其配置为使用`ProductsBLL`类的`GetProductsByCategoryID(categoryID)`方法。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-247">From the DataList s smart tag, opt to add a new ObjectDataSource named `CategoryProductsDataSource` and configure it to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="ea8d6-248">由于在本教程中 DataList 提供了一个只读接口，随意中插入、 更新、 设置的下拉列表，删除选项卡添加到 （无）。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-248">Since the DataList in this tutorial offers a read-only interface, feel free to set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>


<span data-ttu-id="ea8d6-249">[![配置对象数据源以使用 ProductsBLL 类的 GetProductsByCategoryID(categoryID) 方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image33.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-249">[![Configure the ObjectDataSource to Use ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image33.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image32.png)</span></span>

<span data-ttu-id="ea8d6-250">**图 12**： 配置使用 ObjectDataSource`ProductsBLL`类 s`GetProductsByCategoryID(categoryID)`方法 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="ea8d6-250">**Figure 12**: Configure the ObjectDataSource to Use `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image34.png))</span></span>


<span data-ttu-id="ea8d6-251">由于`GetProductsByCategoryID(categoryID)`方法需要输入的参数 (*`categoryID`*)，配置数据源向导允许我们需要指定参数的源。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-251">Since the `GetProductsByCategoryID(categoryID)` method expects an input parameter (*`categoryID`*), the Configure Data Source wizard allows us to specify the parameter s source.</span></span> <span data-ttu-id="ea8d6-252">已在一个 GridView 或 DataList 预置类别，我们 d 将参数源下拉列表设置为控件和到 ControlID `ID` Web 控件的数据。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-252">Had the categories been listed in a GridView or a DataList, we d set the Parameter source drop-down list to Control and the ControlID to the `ID` of the data Web control.</span></span> <span data-ttu-id="ea8d6-253">但是，由于中继器缺少`SelectedValue`不能用作参数源属性。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-253">However, since the Repeater lacks a `SelectedValue` property it cannot be used as a parameter source.</span></span> <span data-ttu-id="ea8d6-254">如果选中，你将找到 ControlID 下拉列表仅包含一个控件`ID``CategoryProducts`、 `ID` DataList。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-254">If you check, you'll find that the ControlID drop-down list only contains one control `ID``CategoryProducts`, the `ID` of the DataList.</span></span>

<span data-ttu-id="ea8d6-255">现在，将参数源下拉列表设置为 None。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-255">For now, set the Parameter source drop-down list to None.</span></span> <span data-ttu-id="ea8d6-256">我们将得到以编程方式指定此参数值时在转发器中单击 LinkButton 的类别。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-256">We'll end up programmatically assigning this parameter value when a category LinkButton is clicked in the Repeater.</span></span>


<span data-ttu-id="ea8d6-257">[![执行不指定 categoryID 参数参数源](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image36.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-257">[![Do Not Specify a Parameter Source for the categoryID Parameter](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image36.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image35.png)</span></span>

<span data-ttu-id="ea8d6-258">**图 13**： 未指定参数源 *`categoryID`* 参数 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image37.png))</span><span class="sxs-lookup"><span data-stu-id="ea8d6-258">**Figure 13**: Do Not Specify a Parameter Source for the *`categoryID`* Parameter ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image37.png))</span></span>


<span data-ttu-id="ea8d6-259">完成配置数据源向导后，Visual Studio 自动生成 DataList 的`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-259">After completing the Configure Data Source wizard, Visual Studio auto-generates the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="ea8d6-260">替换此默认设置`ItemTemplate`该模板后，我们前面教程中使用; 此外，还要设置 DataList 的`RepeatColumns`属性设置为 2。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-260">Replace this default `ItemTemplate` with the template we used in the preceding tutorial; also, set the DataList s `RepeatColumns` property to 2.</span></span> <span data-ttu-id="ea8d6-261">进行这些更改后你 DataList 和其关联的对象数据源的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="ea8d6-261">After making these changes the declarative markup for your DataList and its associated ObjectDataSource should look like the following:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample10.aspx)]

<span data-ttu-id="ea8d6-262">目前， `CategoryProductsDataSource` ObjectDataSource s  *`categoryID`* 永远不会设置参数，以便查看网页时，将显示安装的产品。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-262">Currently, the `CategoryProductsDataSource` ObjectDataSource s *`categoryID`* parameter is never set, so no products are displayed when viewing the page.</span></span> <span data-ttu-id="ea8d6-263">我们需要做什么是将此参数值设置基于`CategoryID`的转发器中的被单击类别。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-263">What we need to do is have this parameter value set based on the `CategoryID` of the clicked category in the Repeater.</span></span> <span data-ttu-id="ea8d6-264">它引入了两个难题： 首先，如何执行我们确定何时在转发器的 LinkButton`ItemTemplate`已单击; 和第二个，我们可以如何确定`CategoryID`其 LinkButton 被单击相应的类别的？</span><span class="sxs-lookup"><span data-stu-id="ea8d6-264">This introduces two challenges: first, how do we determine when a LinkButton in the Repeater s `ItemTemplate` has been clicked; and second, how can we determine the `CategoryID` of the corresponding category whose LinkButton was clicked?</span></span>

<span data-ttu-id="ea8d6-265">与按钮和 ImageButton 控件一样 LinkButton 具有`Click`事件和一个[`Command`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.command.aspx)。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-265">The LinkButton like the Button and ImageButton controls has a `Click` event and a [`Command` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.command.aspx).</span></span> <span data-ttu-id="ea8d6-266">`Click`事件旨在已单击 LinkButton 则只需注意。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-266">The `Click` event is designed to simply note that the LinkButton has been clicked.</span></span> <span data-ttu-id="ea8d6-267">有时，但是，除了指出已单击 LinkButton 我们还需要将一些额外信息传递给事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-267">At times, however, in addition to noting that the LinkButton has been clicked we also need to pass some extra information to the event handler.</span></span> <span data-ttu-id="ea8d6-268">如果出现这种情况，LinkButton s [ `CommandName` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandname.aspx)和[ `CommandArgument` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx)属性可以分配此额外信息。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-268">If this is the case, the LinkButton s [`CommandName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandname.aspx) and [`CommandArgument`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx) properties can be assigned this extra information.</span></span> <span data-ttu-id="ea8d6-269">然后，当单击 LinkButton 后，其`Command`事件将触发 (而不是其`Click`事件) 和事件处理程序传递的值`CommandName`和`CommandArgument`属性。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-269">Then, when the LinkButton is clicked, its `Command` event fires (instead of its `Click` event) and the event handler is passed the values of the `CommandName` and `CommandArgument` properties.</span></span>

<span data-ttu-id="ea8d6-270">当`Command`中继器中继器 s 中的模板内从引发事件[`ItemCommand`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeater.itemcommand.aspx)触发并传递`CommandName`和`CommandArgument`单击 LinkButton 值 (或按钮或ImageButton)。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-270">When a `Command` event is raised from within a template in the Repeater, the Repeater s [`ItemCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeater.itemcommand.aspx) fires and is passed the `CommandName` and `CommandArgument` values of the clicked LinkButton (or Button or ImageButton).</span></span> <span data-ttu-id="ea8d6-271">因此，若要确定类别中中继器 LinkButton 单击时，我们需要执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="ea8d6-271">Therefore, to determine when a category LinkButton in the Repeater has been clicked, we need to do the following:</span></span>

1. <span data-ttu-id="ea8d6-272">设置`CommandName`属性在转发器的 LinkButton`ItemTemplate`为某个值 (我以前使用 ListProducts)。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-272">Set the `CommandName` property of the LinkButton in the Repeater s `ItemTemplate` to some value (I ve used ListProducts ).</span></span> <span data-ttu-id="ea8d6-273">通过将此值设置`CommandName`值，LinkButton 的`Command`LinkButton 单击时，事件将激发。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-273">By setting this `CommandName` value, the LinkButton s `Command` event fires when the LinkButton is clicked.</span></span>
2. <span data-ttu-id="ea8d6-274">设置 LinkButton s`CommandArgument`属性的当前项的值`CategoryID`。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-274">Set the LinkButton s `CommandArgument` property to the value of the current item s `CategoryID`.</span></span>
3. <span data-ttu-id="ea8d6-275">为转发器 s 创建事件处理程序`ItemCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-275">Create an event handler for the Repeater s `ItemCommand` event.</span></span> <span data-ttu-id="ea8d6-276">在事件处理程序中，集中`CategoryProductsDataSource`ObjectDataSource s`CategoryID`为传入的值的参数`CommandArgument`。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-276">In the event handler, set the `CategoryProductsDataSource` ObjectDataSource s `CategoryID` parameter to the value of the passed-in `CommandArgument`.</span></span>

<span data-ttu-id="ea8d6-277">以下`ItemTemplate`标记类别中继器实现步骤 1 和 2。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-277">The following `ItemTemplate` markup for the Categories Repeater implements steps 1 and 2.</span></span> <span data-ttu-id="ea8d6-278">请注意如何`CommandArgument`值分配数据项的`CategoryID`使用数据绑定的语法：</span><span class="sxs-lookup"><span data-stu-id="ea8d6-278">Note how the `CommandArgument` value is assigned the data item s `CategoryID` using databinding syntax:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample11.aspx)]

<span data-ttu-id="ea8d6-279">每当创建`ItemCommand`是明智始终首先检查传入的事件处理程序`CommandName`值因为*任何*`Command`引发事件*任何*按钮、 LinkButton，或将导致在转发器 ImageButton`ItemCommand`事件激发。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-279">Whenever creating an `ItemCommand` event handler it is prudent to always first check the incoming `CommandName` value because *any* `Command` event raised by *any* Button, LinkButton, or ImageButton within the Repeater will cause the `ItemCommand` event to fire.</span></span> <span data-ttu-id="ea8d6-280">虽然我们当前仅有一个此类 LinkButton 现在，在将来我们 （或我们的团队的其他开发人员） 可能其他按钮 Web 将控件添加到转发器，单击时，引发相同`ItemCommand`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-280">While we currently only have one such LinkButton now, in the future we (or another developer on our team) might add additional button Web controls to the Repeater that, when clicked, raises the same `ItemCommand` event handler.</span></span> <span data-ttu-id="ea8d6-281">因此，它 s 最好请始终确保你检查`CommandName`属性然后如果到预期的值的它匹配仅进行编程逻辑。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-281">Therefore, it s best to always make sure you check the `CommandName` property and only proceed with your programmatic logic if it matches up to the value expected.</span></span>

<span data-ttu-id="ea8d6-282">后确保传入的`CommandName`值等于 ListProducts，事件处理程序然后将分配`CategoryProductsDataSource`ObjectDataSource s`CategoryID`为传入的值的参数`CommandArgument`。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-282">After ensuring that the passed-in `CommandName` value equals ListProducts, the event handler then assigns the `CategoryProductsDataSource` ObjectDataSource s `CategoryID` parameter to the value of the passed-in `CommandArgument`.</span></span> <span data-ttu-id="ea8d6-283">此修改 ObjectDataSource 的`SelectParameters`会自动导致 DataList 重新本身绑定到数据源，显示新选择的类别的产品。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-283">This modification to the ObjectDataSource s `SelectParameters` automatically causes the DataList to rebind itself to the data source, showing the products for the newly selected category.</span></span>


[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample12.cs)]

<span data-ttu-id="ea8d6-284">其中这些添加的内容，我们的教程中已完成 ！</span><span class="sxs-lookup"><span data-stu-id="ea8d6-284">With these additions, our tutorial is complete!</span></span> <span data-ttu-id="ea8d6-285">需要一段时间来在浏览器中对它进行测试。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-285">Take a moment to test it out in a browser.</span></span> <span data-ttu-id="ea8d6-286">图 14 首先访问页时显示的屏幕。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-286">Figure 14 shows the screen when first visiting the page.</span></span> <span data-ttu-id="ea8d6-287">由于某一类别中尚未选择，则会不显示任何产品。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-287">Since a category has yet to be selected, no products are displayed.</span></span> <span data-ttu-id="ea8d6-288">单击类别，如生成，显示这些产品的产品类别中的两列视图 （请参阅图 15）。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-288">Clicking on a category, such as Produce, displays those products in the Product category in a two-column view (see Figure 15).</span></span>


<span data-ttu-id="ea8d6-289">[![要安装的产品是显示在第一个中访问的页面](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image39.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-289">[![No Products are Displayed When First Visiting the Page](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image39.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image38.png)</span></span>

<span data-ttu-id="ea8d6-290">**图 14**： 否产品不显示在第一个中访问的页面 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image40.png))</span><span class="sxs-lookup"><span data-stu-id="ea8d6-290">**Figure 14**: No Products are Displayed When First Visiting the Page ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image40.png))</span></span>


<span data-ttu-id="ea8d6-291">[![单击右侧的匹配产品的生成类别列表](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image42.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-291">[![Clicking the Produce Category Lists the Matching Products to the Right](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image42.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image41.png)</span></span>

<span data-ttu-id="ea8d6-292">**图 15**： 单击生成类别列出右侧的匹配产品 ([单击以查看实际尺寸的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image43.png))</span><span class="sxs-lookup"><span data-stu-id="ea8d6-292">**Figure 15**: Clicking the Produce Category Lists the Matching Products to the Right ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image43.png))</span></span>


## <a name="summary"></a><span data-ttu-id="ea8d6-293">摘要</span><span class="sxs-lookup"><span data-stu-id="ea8d6-293">Summary</span></span>

<span data-ttu-id="ea8d6-294">正如我们看到在本教程和前一次，主/详细信息报表可以分散在两个页，或其中一个上合并。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-294">As we saw in this tutorial and the preceding one, master/detail reports can be spread out across two pages, or consolidated on one.</span></span> <span data-ttu-id="ea8d6-295">在单个页面上显示母版/详细信息报告，但是，引入了一些难题如何最布局 master 和此页上的详细信息记录到。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-295">Displaying a master/details report on a single page, however, introduces some challenges on how best to layout the master and details records on the page.</span></span> <span data-ttu-id="ea8d6-296">在*母版/详细介绍与详细信息说明如何使用可选择的主 GridView*教程，我们必须出现上方的主记录的详细信息记录; 在本教程中我们用于 CSS 技术具有到的主记录 float左侧的详细信息。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-296">In the *Master/Detail Using a Selectable Master GridView with a Details DetailsView* tutorial we had the details records appear above the master records; in this tutorial we used CSS techniques to have the master records float to the left of the details.</span></span>

<span data-ttu-id="ea8d6-297">以及显示主/详细信息报表，我们还具有我们来探讨如何检索与每个类别以及如何以 LinkButton （或按钮或 ImageButton） 时执行服务器端逻辑单击内的产品数转发器。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-297">Along with displaying master/details reports, we also had the opportunity to explore how to retrieve the number of products associated with each category as well as how to perform server-side logic when a LinkButton (or Button or ImageButton) is clicked from within a Repeater.</span></span>

<span data-ttu-id="ea8d6-298">本教程中完成主/详细信息报表的 DataList 和转发器与我们的检查。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-298">This tutorial completes our examination of master/detail reports with the DataList and Repeater.</span></span> <span data-ttu-id="ea8d6-299">我们接下来的教程将说明如何添加编辑和删除 DataList 控件的功能。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-299">Our next set of tutorials will illustrate how to add editing and deleting capabilities to the DataList control.</span></span>

<span data-ttu-id="ea8d6-300">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="ea8d6-300">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="ea8d6-301">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="ea8d6-301">Further Reading</span></span>

<span data-ttu-id="ea8d6-302">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="ea8d6-302">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="ea8d6-303">[Floatutorial](http://css.maxdesign.com.au/floatutorial/)浮点 CSS 元素使用 CSS 的教程</span><span class="sxs-lookup"><span data-stu-id="ea8d6-303">[Floatutorial](http://css.maxdesign.com.au/floatutorial/) a tutorial on floating CSS elements with CSS</span></span>
- <span data-ttu-id="ea8d6-304">[CSS 定位](http://www.brainjar.com/css/positioning/)定位使用 CSS 的元素的详细信息</span><span class="sxs-lookup"><span data-stu-id="ea8d6-304">[CSS Positioning](http://www.brainjar.com/css/positioning/) more information on positioning elements with CSS</span></span>
- <span data-ttu-id="ea8d6-305">[对出内容替换 HTML](http://www.w3schools.com/html/html_layout.asp)使用`<table>`s 的和其他 HTML 元素定位</span><span class="sxs-lookup"><span data-stu-id="ea8d6-305">[Laying Out Content with HTML](http://www.w3schools.com/html/html_layout.asp) using `<table>` s and other HTML elements for positioning</span></span>

## <a name="about-the-author"></a><span data-ttu-id="ea8d6-306">关于作者</span><span class="sxs-lookup"><span data-stu-id="ea8d6-306">About the Author</span></span>

<span data-ttu-id="ea8d6-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七个 ASP/ASP.NET 书籍和的创始人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年使用与 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="ea8d6-308">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-308">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="ea8d6-309">最新书籍是[ *Sam 教授自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-309">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="ea8d6-310">他可以达到在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或通过他的博客，其中可以找到在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-310">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="ea8d6-311">特别感谢</span><span class="sxs-lookup"><span data-stu-id="ea8d6-311">Special Thanks To</span></span>

<span data-ttu-id="ea8d6-312">本教程系列已由许多有用的审阅者评审。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-312">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="ea8d6-313">本教程中的前导审阅者已 Zack Jones。</span><span class="sxs-lookup"><span data-stu-id="ea8d6-313">Lead reviewer for this tutorial was Zack Jones.</span></span> <span data-ttu-id="ea8d6-314">对感兴趣查看我即将到来的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="ea8d6-314">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="ea8d6-315">如果是这样，删除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-315">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="ea8d6-316">[上一页](master-detail-filtering-acess-two-pages-datalist-cs.md)
[下一页](master-detail-filtering-with-a-dropdownlist-datalist-vb.md)</span><span class="sxs-lookup"><span data-stu-id="ea8d6-316">[Previous](master-detail-filtering-acess-two-pages-datalist-cs.md)
[Next](master-detail-filtering-with-a-dropdownlist-datalist-vb.md)</span></span>
