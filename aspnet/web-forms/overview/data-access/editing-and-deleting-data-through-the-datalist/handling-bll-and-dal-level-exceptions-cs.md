---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
title: 处理 BLL 和 DAL 级别异常 (C#) |Microsoft 文档
author: rick-anderson
description: 在本教程中，我们将了解如何巧妙地处理可编辑 DataList 更新工作流过程中引发的异常。
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/30/2006
ms.topic: article
ms.assetid: f8fd58e2-f932-4f08-ab3d-fbf8ff3295d2
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
msc.type: authoredcontent
ms.openlocfilehash: fd88260e1ac941b053aae8b4e500a7ab5f3091a1
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/06/2018
ms.locfileid: "30892330"
---
<a name="handling-bll--and-dal-level-exceptions-c"></a><span data-ttu-id="091cd-103">处理 BLL 和 DAL 级别异常 (C#)</span><span class="sxs-lookup"><span data-stu-id="091cd-103">Handling BLL- and DAL-Level Exceptions (C#)</span></span>
====================
<span data-ttu-id="091cd-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="091cd-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="091cd-105">[下载示例应用程序](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe)或[下载 PDF](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="091cd-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)</span></span>

> <span data-ttu-id="091cd-106">在本教程中，我们将了解如何巧妙地处理可编辑 DataList 更新工作流过程中引发的异常。</span><span class="sxs-lookup"><span data-stu-id="091cd-106">In this tutorial, we'll see how to tactfully handle exceptions raised during an editable DataList's updating workflow.</span></span>


## <a name="introduction"></a><span data-ttu-id="091cd-107">介绍</span><span class="sxs-lookup"><span data-stu-id="091cd-107">Introduction</span></span>

<span data-ttu-id="091cd-108">在[概述的编辑和删除数据中 DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md)教程中，我们创建 DataList 提供简单的编辑和删除功能。</span><span class="sxs-lookup"><span data-stu-id="091cd-108">In the [Overview of Editing and Deleting Data in the DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, we created a DataList that offered simple editing and deleting capabilities.</span></span> <span data-ttu-id="091cd-109">当完全正常运行时，很难用户友好，为编辑过程中发生任何错误，或删除过程导致未经处理的异常。</span><span class="sxs-lookup"><span data-stu-id="091cd-109">While fully functional, it was hardly user-friendly, as any error that occurred during the editing or deleting process resulted in an unhandled exception.</span></span> <span data-ttu-id="091cd-110">例如，省略产品的名称或，在编辑产品时，输入价格值的十分合理 ！，将引发异常。</span><span class="sxs-lookup"><span data-stu-id="091cd-110">For example, omitting the product s name or, when editing a product, entering a price value of Very affordable!, throws an exception.</span></span> <span data-ttu-id="091cd-111">在代码中没有捕获此异常，因为它将冒泡到 ASP.NET 运行，然后在网页中显示的异常 s 详细信息。</span><span class="sxs-lookup"><span data-stu-id="091cd-111">Since this exception is not caught in code, it bubbles up to the ASP.NET runtime, which then displays the exception s details in the web page.</span></span>

<span data-ttu-id="091cd-112">正如我们看到在[处理 BLL-和 ASP.NET 页中的 DAL 级别异常](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md)教程中，如果从深度的业务逻辑或数据访问层，将引发异常的异常详细信息将返回到 ObjectDataSource 和然后到 GridView。</span><span class="sxs-lookup"><span data-stu-id="091cd-112">As we saw in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, if an exception is raised from the depths of the Business Logic or Data Access Layers, the exception details are returned to the ObjectDataSource and then to the GridView.</span></span> <span data-ttu-id="091cd-113">我们已了解如何适当地处理这些异常，通过创建`Updated`或`RowUpdated`ObjectDataSource 或 GridView，检查异常，然后指示处理了该异常的事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="091cd-113">We saw how to gracefully handle these exceptions by creating `Updated` or `RowUpdated` event handlers for the ObjectDataSource or GridView, checking for an exception, and then indicating that the exception was handled.</span></span>

<span data-ttu-id="091cd-114">我们 DataList 的教程，但是，不 t ObjectDataSource 用于更新和删除数据。</span><span class="sxs-lookup"><span data-stu-id="091cd-114">Our DataList tutorials, however, aren t using the ObjectDataSource for updating and deleting data.</span></span> <span data-ttu-id="091cd-115">相反，我们正在直接针对 BLL。</span><span class="sxs-lookup"><span data-stu-id="091cd-115">Instead, we are working directly against the BLL.</span></span> <span data-ttu-id="091cd-116">为了检测源自 BLL 或 DAL 的异常，我们需要实现异常处理代码中我们 ASP.NET 页的代码隐藏。</span><span class="sxs-lookup"><span data-stu-id="091cd-116">In order to detect exceptions originating from the BLL or DAL, we need to implement exception handling code within the code-behind of our ASP.NET page.</span></span> <span data-ttu-id="091cd-117">在本教程中，我们将了解如何更巧妙地处理期间更新工作流可编辑 DataList s 引发的异常。</span><span class="sxs-lookup"><span data-stu-id="091cd-117">In this tutorial, we'll see how to more tactfully handle exceptions raised during an editable DataList s updating workflow.</span></span>

> [!NOTE]
> <span data-ttu-id="091cd-118">在*概述的编辑和删除数据中 DataList*教程中我们讨论了不同的技术来编辑和删除数据从 DataList，一些技术涉及更新使用 ObjectDataSource 和正在删除。</span><span class="sxs-lookup"><span data-stu-id="091cd-118">In the *An Overview of Editing and Deleting Data in the DataList* tutorial we discussed different techniques for editing and deleting data from the DataList, Some techniques involved using an ObjectDataSource for updating and deleting.</span></span> <span data-ttu-id="091cd-119">如果你使用这些技术，你可以处理从 BLL 或 DAL 异常通过 ObjectDataSource s`Updated`或`Deleted`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="091cd-119">If you employ these techniques, you can handle exceptions from the BLL or DAL through the ObjectDataSource s `Updated` or `Deleted` event handlers.</span></span>


## <a name="step-1-creating-an-editable-datalist"></a><span data-ttu-id="091cd-120">步骤 1： 创建可编辑 DataList</span><span class="sxs-lookup"><span data-stu-id="091cd-120">Step 1: Creating an Editable DataList</span></span>

<span data-ttu-id="091cd-121">我们担心如何处理在更新的工作流过程中发生的异常之前，让我们来首先创建可编辑 DataList。</span><span class="sxs-lookup"><span data-stu-id="091cd-121">Before we worry about handling exceptions that occur during the updating workflow, let s first create an editable DataList.</span></span> <span data-ttu-id="091cd-122">打开`ErrorHandling.aspx`页面`EditDeleteDataList`文件夹中，将 DataList 添加到设计器中，设置其`ID`属性`Products`，并添加名为新 ObjectDataSource `ProductsDataSource`。</span><span class="sxs-lookup"><span data-stu-id="091cd-122">Open the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder, add a DataList to the Designer, set its `ID` property to `Products`, and add a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="091cd-123">配置对象数据源以使用`ProductsBLL`类的`GetProducts()`选择方法记录; 在 INSERT、 UPDATE、 中设置的下拉列表并删除选项卡添加到 （无）。</span><span class="sxs-lookup"><span data-stu-id="091cd-123">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method for selecting records; set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>


<span data-ttu-id="091cd-124">[![返回使用 GetProducts() 方法的产品信息](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="091cd-124">[![Return the Product Information Using the GetProducts() Method](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)</span></span>

<span data-ttu-id="091cd-125">**图 1**： 返回产品信息使用`GetProducts()`方法 ([单击以查看实际尺寸的图像](handling-bll-and-dal-level-exceptions-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="091cd-125">**Figure 1**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image3.png))</span></span>


<span data-ttu-id="091cd-126">完成对象数据源向导后，Visual Studio 自动创建`ItemTemplate`DataList 有关。</span><span class="sxs-lookup"><span data-stu-id="091cd-126">After completing the ObjectDataSource wizard, Visual Studio will automatically create an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="091cd-127">将此与替换`ItemTemplate`，显示每个产品 s name 和价格，并包括一个编辑按钮。</span><span class="sxs-lookup"><span data-stu-id="091cd-127">Replace this with an `ItemTemplate` that displays each product s name and price and includes an Edit button.</span></span> <span data-ttu-id="091cd-128">接下来，创建`EditItemTemplate`与名称和价格和更新和取消按钮的文本框中 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="091cd-128">Next, create an `EditItemTemplate` with a TextBox Web control for name and price and Update and Cancel buttons.</span></span> <span data-ttu-id="091cd-129">最后，设置 DataList 的`RepeatColumns`属性设置为 2。</span><span class="sxs-lookup"><span data-stu-id="091cd-129">Finally, set the DataList s `RepeatColumns` property to 2.</span></span>

<span data-ttu-id="091cd-130">这些更改后你页面 s 声明性标记应类似于以下。</span><span class="sxs-lookup"><span data-stu-id="091cd-130">After these changes, your page s declarative markup should look similar to the following.</span></span> <span data-ttu-id="091cd-131">编辑、 取消，请确保仔细检查和更新按钮具有其`CommandName`属性设置为编辑，请取消，并更新，分别。</span><span class="sxs-lookup"><span data-stu-id="091cd-131">Double-check to make certain that the Edit, Cancel, and Update buttons have their `CommandName` properties set to Edit, Cancel, and Update, respectively.</span></span>


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="091cd-132">对于本教程 DataList 必须启用 s 视图状态。</span><span class="sxs-lookup"><span data-stu-id="091cd-132">For this tutorial the DataList s view state must be enabled.</span></span>


<span data-ttu-id="091cd-133">花些时间查看我们通过浏览器的进度 （请参见图 2）。</span><span class="sxs-lookup"><span data-stu-id="091cd-133">Take a moment to view our progress through a browser (see Figure 2).</span></span>


<span data-ttu-id="091cd-134">[![每个产品包括一个编辑按钮](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="091cd-134">[![Each Product Includes an Edit Button](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)</span></span>

<span data-ttu-id="091cd-135">**图 2**： 每个产品包括一个编辑按钮 ([单击以查看实际尺寸的图像](handling-bll-and-dal-level-exceptions-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="091cd-135">**Figure 2**: Each Product Includes an Edit Button ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image6.png))</span></span>


<span data-ttu-id="091cd-136">目前，编辑按钮仅导致回发它没有 t 尚未使产品可编辑。</span><span class="sxs-lookup"><span data-stu-id="091cd-136">Currently, the Edit button only causes a postback it doesn t yet make the product editable.</span></span> <span data-ttu-id="091cd-137">若要启用编辑，我们需要创建的事件处理程序 DataList s `EditCommand`， `CancelCommand`，和`UpdateCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="091cd-137">To enable editing, we need to create event handlers for the DataList s `EditCommand`, `CancelCommand`, and `UpdateCommand` events.</span></span> <span data-ttu-id="091cd-138">`EditCommand`和`CancelCommand`事件只需更新 DataList 的`EditItemIndex`属性和重新绑定数据到 DataList:</span><span class="sxs-lookup"><span data-stu-id="091cd-138">The `EditCommand` and `CancelCommand` events simply update the DataList s `EditItemIndex` property and rebind the data to the DataList:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample2.cs)]

<span data-ttu-id="091cd-139">`UpdateCommand`事件处理程序是有些复杂。</span><span class="sxs-lookup"><span data-stu-id="091cd-139">The `UpdateCommand` event handler is a bit more involved.</span></span> <span data-ttu-id="091cd-140">它需要编辑产品 s 中读取`ProductID`从`DataKeys`以及产品的名称和价格与中的文本框集合`EditItemTemplate`，然后调用`ProductsBLL`类的`UpdateProduct`之前返回 DataList 方法为其预编辑状态。</span><span class="sxs-lookup"><span data-stu-id="091cd-140">It needs to read in the edited product s `ProductID` from the `DataKeys` collection along with the product s name and price from the TextBoxes in the `EditItemTemplate`, and then call the `ProductsBLL` class s `UpdateProduct` method before returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="091cd-141">现在，让 s 只需使用完全相同的代码从`UpdateCommand`中的事件处理程序*概述的编辑和删除数据中 DataList*教程。</span><span class="sxs-lookup"><span data-stu-id="091cd-141">For now, let s just use the exact same code from the `UpdateCommand` event handler in the *Overview of Editing and Deleting Data in the DataList* tutorial.</span></span> <span data-ttu-id="091cd-142">我们将添加代码以正常处理步骤 2 中的异常。</span><span class="sxs-lookup"><span data-stu-id="091cd-142">We'll add the code to gracefully handle exceptions in step 2.</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample3.cs)]

<span data-ttu-id="091cd-143">遇到无效的输入可以是名称的形式的格式不正确的单位价格、 类似 5.00 美元，非法的单位价格值或省略产品，将引发异常。</span><span class="sxs-lookup"><span data-stu-id="091cd-143">In the face of invalid input which can be in the form of an improperly formatted unit price, an illegal unit price value like -$5.00, or the omission of the product s name an exception will be raised.</span></span> <span data-ttu-id="091cd-144">由于`UpdateCommand`事件处理程序不包括在此时处理代码的任何异常，异常将向上冒泡到 ASP.NET 运行时，将在其中它显示给最终用户 （请参见图 3）。</span><span class="sxs-lookup"><span data-stu-id="091cd-144">Since the `UpdateCommand` event handler does not include any exception handling code at this point, the exception will bubble up to the ASP.NET runtime, where it will be displayed to the end user (see Figure 3).</span></span>


![当未经处理的异常发生时，最终用户看到的错误页](handling-bll-and-dal-level-exceptions-cs/_static/image7.png)

<span data-ttu-id="091cd-146">**图 3**： 未经处理的异常时，最终用户将看到一个错误页面</span><span class="sxs-lookup"><span data-stu-id="091cd-146">**Figure 3**: When an Unhandled Exception Occurs, the End User Sees an Error Page</span></span>


## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a><span data-ttu-id="091cd-147">步骤 2： 正常处理 UpdateCommand 事件处理程序中的异常</span><span class="sxs-lookup"><span data-stu-id="091cd-147">Step 2: Gracefully Handling Exceptions in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="091cd-148">在更新工作流，异常可以会出现在`UpdateCommand`事件处理程序、 BLL 或 DAL。</span><span class="sxs-lookup"><span data-stu-id="091cd-148">During the updating workflow, exceptions can occur in the `UpdateCommand` event handler, the BLL, or the DAL.</span></span> <span data-ttu-id="091cd-149">例如，如果用户输入指价格为太占用大量资源，`Decimal.Parse`中的语句`UpdateCommand`事件处理程序将引发`FormatException`异常。</span><span class="sxs-lookup"><span data-stu-id="091cd-149">For example, if a user enters a price of Too expensive, the `Decimal.Parse` statement in the `UpdateCommand` event handler will throw a `FormatException` exception.</span></span> <span data-ttu-id="091cd-150">如果用户省略产品的名称或 DAL 如果价格具有负值，将引发的异常。</span><span class="sxs-lookup"><span data-stu-id="091cd-150">If the user omits the product s name or if the price has a negative value, the DAL will raise an exception.</span></span>

<span data-ttu-id="091cd-151">当发生异常时，我们想要显示一条信息性消息页本身中。</span><span class="sxs-lookup"><span data-stu-id="091cd-151">When an exception occurs, we want to display an informative message within the page itself.</span></span> <span data-ttu-id="091cd-152">添加标签 Web 控件到页`ID`设置为`ExceptionDetails`。</span><span class="sxs-lookup"><span data-stu-id="091cd-152">Add a Label Web control to the page whose `ID` is set to `ExceptionDetails`.</span></span> <span data-ttu-id="091cd-153">配置要显示为红色，超大型，通过分配加粗和倾斜字体的标签的文本其`CssClass`属性`Warning`中定义的 CSS 类`Styles.css`文件。</span><span class="sxs-lookup"><span data-stu-id="091cd-153">Configure the Label s text to display in a red, extra-large, bold and italic font by assigning its `CssClass` property to the `Warning` CSS class, which is defined in the `Styles.css` file.</span></span>

<span data-ttu-id="091cd-154">发生错误时，我们只想要一次显示的标签。</span><span class="sxs-lookup"><span data-stu-id="091cd-154">When an error occurs, we only want the Label to be displayed once.</span></span> <span data-ttu-id="091cd-155">也就是说，在后续回发上, 标签的警告消息将会消失。</span><span class="sxs-lookup"><span data-stu-id="091cd-155">That is, on subsequent postbacks, the Label s warning message should disappear.</span></span> <span data-ttu-id="091cd-156">这可以通过标签 s 任一清除`Text`属性或设置其`Visible`属性`False`中`Page_Load`事件处理程序 (正如我们做进来[处理 BLL-和 ASP DAL 级异常.NET 页](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md)教程) 或通过禁用标签的视图状态支持。</span><span class="sxs-lookup"><span data-stu-id="091cd-156">This can be accomplished by either clearing out the Label s `Text` property or settings its `Visible` property to `False` in the `Page_Load` event handler (as we did back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial) or by disabling the Label s view state support.</span></span> <span data-ttu-id="091cd-157">让我们来使用后一个选项。</span><span class="sxs-lookup"><span data-stu-id="091cd-157">Let s use the latter option.</span></span>


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample4.aspx)]

<span data-ttu-id="091cd-158">当引发异常时，我们将分配到异常的详细信息`ExceptionDetails`标签控件的`Text`属性。</span><span class="sxs-lookup"><span data-stu-id="091cd-158">When an exception is raised, we'll assign the details of the exception to the `ExceptionDetails` Label control s `Text` property.</span></span> <span data-ttu-id="091cd-159">由于其视图状态禁用的可以在后续回发`Text`属性 s 以编程方式更改都将丢失，恢复为默认文本 （空字符串），从而隐藏警告消息。</span><span class="sxs-lookup"><span data-stu-id="091cd-159">Since its view state is disabled, on subsequent postbacks the `Text` property s programmatic changes will be lost, reverting back to the default text (an empty string), thereby hiding the warning message.</span></span>

<span data-ttu-id="091cd-160">若要确定在已以有用的消息显示在页面上引发错误时，我们需要添加`Try ... Catch`阻止`UpdateCommand`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="091cd-160">To determine when an error has been raised in order to display a helpful message on the page, we need to add a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="091cd-161">`Try`部分包含代码，它可能会导致异常，而`Catch`块包含面临异常执行的代码。</span><span class="sxs-lookup"><span data-stu-id="091cd-161">The `Try` portion contains code that may lead to an exception, while the `Catch` block contains code that is executed in the face of an exception.</span></span> <span data-ttu-id="091cd-162">签出[异常处理基础知识](https://msdn.microsoft.com/library/2w8f0bss.aspx)主题中的详细信息的.NET Framework 文档上`Try ... Catch`块。</span><span class="sxs-lookup"><span data-stu-id="091cd-162">Check out the [Exception Handling Fundamentals](https://msdn.microsoft.com/library/2w8f0bss.aspx) section in the .NET Framework documentation for more information on the `Try ... Catch` block.</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample5.cs)]

<span data-ttu-id="091cd-163">通过中的代码引发的任何类型异常`Try`块，`Catch`块的代码将开始执行。</span><span class="sxs-lookup"><span data-stu-id="091cd-163">When an exception of any type is thrown by code within the `Try` block, the `Catch` block s code will begin executing.</span></span> <span data-ttu-id="091cd-164">引发异常的类型`DbException`， `NoNullAllowedException`， `ArgumentException`，并在完全匹配，依赖于什么，首先引发错误。</span><span class="sxs-lookup"><span data-stu-id="091cd-164">The type of exception that is thrown `DbException`, `NoNullAllowedException`, `ArgumentException`, and so on depends on what, exactly, precipitated the error in the first place.</span></span> <span data-ttu-id="091cd-165">如果在数据库级别，那里的问题`DbException`将引发。</span><span class="sxs-lookup"><span data-stu-id="091cd-165">If there s a problem at the database level, a `DbException` will be thrown.</span></span> <span data-ttu-id="091cd-166">如果输入非法值`UnitPrice`， `UnitsInStock`， `UnitsOnOrder`，或`ReorderLevel`字段，`ArgumentException`会不引发，随着我们添加代码，以验证这些字段值`ProductsDataTable`类 (请参阅[创建业务逻辑层](../introduction/creating-a-business-logic-layer-cs.md)教程)。</span><span class="sxs-lookup"><span data-stu-id="091cd-166">If an illegal value is entered for the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` fields, an `ArgumentException` will be thrown, as we added code to validate these field values in the `ProductsDataTable` class (see the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial).</span></span>

<span data-ttu-id="091cd-167">我们可以通过使基于捕获到异常的类型的消息文本对最终用户提供的更有帮助的说明。</span><span class="sxs-lookup"><span data-stu-id="091cd-167">We can provide a more helpful explanation to the end user by basing the message text on the type of exception caught.</span></span> <span data-ttu-id="091cd-168">下面的代码时使用几乎完全相同的形式返回[处理 BLL-和 ASP.NET 页中的 DAL 级别异常](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md)教程提供此级别的详细信息：</span><span class="sxs-lookup"><span data-stu-id="091cd-168">The following code which was used in a nearly identical form back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial provides this level of detail:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample6.cs)]

<span data-ttu-id="091cd-169">若要完成本教程，只需调用`DisplayExceptionDetails`方法从`Catch`块已捕获传入`Exception`实例 (`ex`)。</span><span class="sxs-lookup"><span data-stu-id="091cd-169">To complete this tutorial, simply call the `DisplayExceptionDetails` method from the `Catch` block passing in the caught `Exception` instance (`ex`).</span></span>

<span data-ttu-id="091cd-170">与`Try ... Catch`就地块中，用户提供更详细的错误消息，显示为图 4 和 5 的显示。</span><span class="sxs-lookup"><span data-stu-id="091cd-170">With the `Try ... Catch` block in place, users are presented with a more informative error message, as Figures 4 and 5 show.</span></span> <span data-ttu-id="091cd-171">请注意，在遇到异常 DataList 处于编辑模式。</span><span class="sxs-lookup"><span data-stu-id="091cd-171">Note that in the face of an exception the DataList remains in edit mode.</span></span> <span data-ttu-id="091cd-172">这是因为一旦出现异常，控制流将立即重定向到`Catch`块，绕过 DataList 返回其预编辑状态代码。</span><span class="sxs-lookup"><span data-stu-id="091cd-172">This is because once the exception occurs, the control flow is immediately redirected to the `Catch` block, bypassing the code that returns the DataList to its pre-editing state.</span></span>


<span data-ttu-id="091cd-173">[![如果用户省略必需的字段，显示错误消息](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="091cd-173">[![An Error Message is Displayed if a User Omits a Required Field](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)</span></span>

<span data-ttu-id="091cd-174">**图 4**： 如果用户省略必需的字段，将显示错误消息 ([单击以查看实际尺寸的图像](handling-bll-and-dal-level-exceptions-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="091cd-174">**Figure 4**: An Error Message is Displayed if a User Omits a Required Field ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image10.png))</span></span>


<span data-ttu-id="091cd-175">[![一条错误消息是显示时输入负价格](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="091cd-175">[![An Error Message is Displayed When Entering a Negative Price](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)</span></span>

<span data-ttu-id="091cd-176">**图 5**: 错误消息是显示时输入负的价格 ([单击以查看实际尺寸的图像](handling-bll-and-dal-level-exceptions-cs/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="091cd-176">**Figure 5**: An Error Message is Displayed When Entering a Negative Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image13.png))</span></span>


## <a name="summary"></a><span data-ttu-id="091cd-177">总结</span><span class="sxs-lookup"><span data-stu-id="091cd-177">Summary</span></span>

<span data-ttu-id="091cd-178">GridView 和 ObjectDataSource 提供后级别事件处理程序，包括有关任何更新和删除工作流期间引发的异常以及可以设置，以指示已被异常的属性信息处理。</span><span class="sxs-lookup"><span data-stu-id="091cd-178">The GridView and ObjectDataSource provide post-level event handlers that include information about any exceptions that were raised during the updating and deleting workflow, as well as properties that can be set to indicate whether or not the exception has been handled.</span></span> <span data-ttu-id="091cd-179">这些功能，但是，不可用时将使用 DataList 和直接使用 BLL。</span><span class="sxs-lookup"><span data-stu-id="091cd-179">These features, however, are unavailable when working with the DataList and using the BLL directly.</span></span> <span data-ttu-id="091cd-180">相反，我们是负责实现异常处理。</span><span class="sxs-lookup"><span data-stu-id="091cd-180">Instead, we are responsible for implementing exception handling.</span></span>

<span data-ttu-id="091cd-181">在本教程中我们已了解如何添加异常处理程序来更新工作流通过添加一个可编辑 DataList s`Try ... Catch`阻止`UpdateCommand`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="091cd-181">In this tutorial we saw how to add exception handling to an editable DataList s updating workflow by adding a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="091cd-182">如果在更新工作流，将引发异常`Catch`块的代码的执行，显示中的有用信息`ExceptionDetails`标签。</span><span class="sxs-lookup"><span data-stu-id="091cd-182">If an exception is raised during the updating workflow, the `Catch` block s code executes, displaying helpful information in the `ExceptionDetails` Label.</span></span>

<span data-ttu-id="091cd-183">此时，DataList 不会尝试防止从第一个位置发生的异常。</span><span class="sxs-lookup"><span data-stu-id="091cd-183">At this point, the DataList makes no effort to prevent exceptions from happening in the first place.</span></span> <span data-ttu-id="091cd-184">即使我们知道，负价格将导致异常，我们还 t 尚未添加任何功能，以主动防止用户输入此类无效输入。</span><span class="sxs-lookup"><span data-stu-id="091cd-184">Even though we know that a negative price will result in an exception, we haven t yet added any functionality to proactively prevent a user from entering such invalid input.</span></span> <span data-ttu-id="091cd-185">在我们的下一步教程中，我们将了解如何帮助减少通过添加验证控件中的导致无效的用户输入的异常`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="091cd-185">In our next tutorial we'll see how to help reduce the exceptions caused by invalid user input by adding validation controls in the `EditItemTemplate`.</span></span>

<span data-ttu-id="091cd-186">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="091cd-186">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="091cd-187">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="091cd-187">Further Reading</span></span>

<span data-ttu-id="091cd-188">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="091cd-188">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="091cd-189">异常的设计准则</span><span class="sxs-lookup"><span data-stu-id="091cd-189">Design Guidelines for Exceptions</span></span>](https://msdn.microsoft.com/library/ms298399.aspx)
- <span data-ttu-id="091cd-190">[错误日志记录模块和处理程序 (ELMAH)](http://workspaces.gotdotnet.com/elmah) （记录错误的开放源代码库）</span><span class="sxs-lookup"><span data-stu-id="091cd-190">[Error Logging Modules and Handlers (ELMAH)](http://workspaces.gotdotnet.com/elmah) (an open-source library for logging errors)</span></span>
- <span data-ttu-id="091cd-191">[.NET Framework 2.0 的 Enterprise Library](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) （包括异常管理应用程序块）</span><span class="sxs-lookup"><span data-stu-id="091cd-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (includes the Exception Management Application Block)</span></span>

## <a name="about-the-author"></a><span data-ttu-id="091cd-192">关于作者</span><span class="sxs-lookup"><span data-stu-id="091cd-192">About the Author</span></span>

<span data-ttu-id="091cd-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七个 ASP/ASP.NET 书籍和的创始人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年使用与 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="091cd-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="091cd-194">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="091cd-194">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="091cd-195">最新书籍是[ *Sam 教授自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="091cd-195">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="091cd-196">他可以达到在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或通过他的博客，其中可以找到在[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="091cd-196">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="091cd-197">特别感谢</span><span class="sxs-lookup"><span data-stu-id="091cd-197">Special Thanks To</span></span>

<span data-ttu-id="091cd-198">本教程系列已由许多有用的审阅者评审。</span><span class="sxs-lookup"><span data-stu-id="091cd-198">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="091cd-199">本教程中的前导审阅者已 Ken Pespisa。</span><span class="sxs-lookup"><span data-stu-id="091cd-199">Lead reviewer for this tutorial was Ken Pespisa.</span></span> <span data-ttu-id="091cd-200">对感兴趣查看我即将到来的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="091cd-200">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="091cd-201">如果是这样，删除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="091cd-201">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="091cd-202">[上一页](performing-batch-updates-cs.md)
> [下一页](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)</span><span class="sxs-lookup"><span data-stu-id="091cd-202">[Previous](performing-batch-updates-cs.md)
[Next](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)</span></span>
