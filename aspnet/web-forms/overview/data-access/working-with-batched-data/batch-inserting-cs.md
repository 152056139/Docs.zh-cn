---
uid: web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
title: "批处理插入 (C#) |Microsoft 文档"
author: rick-anderson
description: "了解如何在单个操作中插入多个数据库记录。 在用户界面层中，我们将扩展以允许用户输入多个 n GridView..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/26/2007
ms.topic: article
ms.assetid: cf025e08-48fc-4385-b176-8610aa7b5565
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
msc.type: authoredcontent
ms.openlocfilehash: 9eb65b99a955770c72b28713d8daa66bcd1d5344
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2017
---
<a name="batch-inserting-c"></a><span data-ttu-id="9e12f-104">批处理插入 (C#)</span><span class="sxs-lookup"><span data-stu-id="9e12f-104">Batch Inserting (C#)</span></span>
====================
<span data-ttu-id="9e12f-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9e12f-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9e12f-106">[下载代码](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip)或[下载 PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="9e12f-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) or [Download PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span></span>

> <span data-ttu-id="9e12f-107">了解如何在单个操作中插入多个数据库记录。</span><span class="sxs-lookup"><span data-stu-id="9e12f-107">Learn how to insert multiple database records in a single operation.</span></span> <span data-ttu-id="9e12f-108">在用户界面层我们扩展 GridView 以允许用户输入多个新记录。</span><span class="sxs-lookup"><span data-stu-id="9e12f-108">In the User Interface Layer we extend the GridView to allow the user to enter multiple new records.</span></span> <span data-ttu-id="9e12f-109">在数据访问层中我们将包装在事务以确保所有插入都成功或回滚所有的插入中的多个插入操作。</span><span class="sxs-lookup"><span data-stu-id="9e12f-109">In the Data Access Layer we wrap the multiple Insert operations within a transaction to ensure that all insertions succeed or all insertions are rolled back.</span></span>


## <a name="introduction"></a><span data-ttu-id="9e12f-110">介绍</span><span class="sxs-lookup"><span data-stu-id="9e12f-110">Introduction</span></span>

<span data-ttu-id="9e12f-111">在[批处理更新](batch-updating-cs.md)我们查看自定义要提供多个记录中可编辑的接口的 GridView 控件的教程。</span><span class="sxs-lookup"><span data-stu-id="9e12f-111">In the [Batch Updating](batch-updating-cs.md) tutorial we looked at customizing the GridView control to present an interface where multiple records were editable.</span></span> <span data-ttu-id="9e12f-112">用户访问的页面无法进行的一系列更改，然后，使用一次按钮单击，执行批处理更新。</span><span class="sxs-lookup"><span data-stu-id="9e12f-112">The user visiting the page could make a series of changes and then, with a single button click, perform a batch update.</span></span> <span data-ttu-id="9e12f-113">对于用户通常更新一个定位中的多个记录的情况下，此类接口可以保存无数下鼠标和键盘鼠标上下文切换到默认值进行比较时每行都首先返回进行了研究的编辑功能[插入、 更新和删除数据的概述](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="9e12f-113">For situations where users commonly update many records in one go, such an interface can save countless clicks and keyboard-to-mouse context switches when compared to the default per-row editing features that were first explored back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial.</span></span>

<span data-ttu-id="9e12f-114">添加记录时，还可以应用这一概念。</span><span class="sxs-lookup"><span data-stu-id="9e12f-114">This concept can also be applied when adding records.</span></span> <span data-ttu-id="9e12f-115">假设，此处 Northwind traders 公司我们通常会收到货运从供应商所包含的一种特定类别的产品数量。</span><span class="sxs-lookup"><span data-stu-id="9e12f-115">Imagine that here at Northwind Traders we commonly receive shipments from suppliers that contain a number of products for a particular category.</span></span> <span data-ttu-id="9e12f-116">例如，我们可能会从东京 Traders 收到一批的六个不同 tea 和 coffee 产品。</span><span class="sxs-lookup"><span data-stu-id="9e12f-116">As an example, we might receive a shipment of six different tea and coffee products from Tokyo Traders.</span></span> <span data-ttu-id="9e12f-117">如果用户输入说明如何控制通过一次一个的六个产品，他们将需要反复选择相同的值的许多： 它们将需要选择的相同类别 （饮料），同一个供应商 (东京 Traders)、 相同废止的值 （False)，并对顺序的值 (0) 相同的单位。</span><span class="sxs-lookup"><span data-stu-id="9e12f-117">If a user enters the six products one at a time through a DetailsView control, they will have to choose many of the same values over and over again: they will need to choose the same category (Beverages), the same supplier (Tokyo Traders), the same discontinued value (False), and the same units on order value (0).</span></span> <span data-ttu-id="9e12f-118">重复数据该项不是仅耗时，但很容易导致错误。</span><span class="sxs-lookup"><span data-stu-id="9e12f-118">This repetitive data entry is not only time consuming, but is prone to errors.</span></span>

<span data-ttu-id="9e12f-119">我们可以轻而易举地创建批处理插入的界面，让用户选择的供应商和类别一次，输入一系列产品名称和单位价格，然后单击一个按钮以向数据库添加新的产品 （请参见图 1）。</span><span class="sxs-lookup"><span data-stu-id="9e12f-119">With a little work we can create a batch inserting interface that enables the user to choose the supplier and category once, enter a series of product names and unit prices, and then click a button to add the new products to the database (see Figure 1).</span></span> <span data-ttu-id="9e12f-120">添加每个产品时，其`ProductName`和`UnitPrice`数据字段被分配的文本框中输入的值时其`CategoryID`和`SupplierID`值从顶部 fo 窗体在 DropDownLists 分配值。</span><span class="sxs-lookup"><span data-stu-id="9e12f-120">As each product is added, its `ProductName` and `UnitPrice` data fields are assigned the values entered in the TextBoxes, while its `CategoryID` and `SupplierID` values are assigned the values from the DropDownLists at the top fo the form.</span></span> <span data-ttu-id="9e12f-121">`Discontinued`和`UnitsOnOrder`值设置为的硬编码值`false`和 0 分别。</span><span class="sxs-lookup"><span data-stu-id="9e12f-121">The `Discontinued` and `UnitsOnOrder` values are set to the hard-coded values of `false` and 0, respectively.</span></span>


<span data-ttu-id="9e12f-122">[![批处理插入接口](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-122">[![The Batch Inserting Interface](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span></span>

<span data-ttu-id="9e12f-123">**图 1**: 批处理插入接口 ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-123">**Figure 1**: The Batch Inserting Interface ([Click to view full-size image](batch-inserting-cs/_static/image3.png))</span></span>


<span data-ttu-id="9e12f-124">在本教程中我们将创建实现批处理插入接口中图 1 所示的页。</span><span class="sxs-lookup"><span data-stu-id="9e12f-124">In this tutorial we will create a page that implements the batch inserting interface shown in Figure 1.</span></span> <span data-ttu-id="9e12f-125">作为与前面的两个教程，我们将自动换行插入事务以确保原子性的作用域内。</span><span class="sxs-lookup"><span data-stu-id="9e12f-125">As with the previous two tutorials, we will wrap the insertions within the scope of a transaction to ensure atomicity.</span></span> <span data-ttu-id="9e12f-126">让我们来开始 ！</span><span class="sxs-lookup"><span data-stu-id="9e12f-126">Let s get started!</span></span>

## <a name="step-1-creating-the-display-interface"></a><span data-ttu-id="9e12f-127">步骤 1： 创建显示接口</span><span class="sxs-lookup"><span data-stu-id="9e12f-127">Step 1: Creating the Display Interface</span></span>

<span data-ttu-id="9e12f-128">本教程将包含的是单个页面中划分为两个区域： 一个显示区域和插入的区域。</span><span class="sxs-lookup"><span data-stu-id="9e12f-128">This tutorial will consist of a single page that is divided into two regions: a display region and an inserting region.</span></span> <span data-ttu-id="9e12f-129">显示接口，我们将创建在此步骤中，在一个 GridView 显示产品，其中包括标题为进程，产品交付的按钮。</span><span class="sxs-lookup"><span data-stu-id="9e12f-129">The display interface, which we'll create in this step, shows the products in a GridView and includes a button titled Process Product Shipment.</span></span> <span data-ttu-id="9e12f-130">单击此按钮时，显示接口将被替换为插入界面、 中图 1 所示。</span><span class="sxs-lookup"><span data-stu-id="9e12f-130">When this button is clicked, the display interface is replaced with the inserting interface, which is shown in Figure 1.</span></span> <span data-ttu-id="9e12f-131">在添加产品后返回从装运的显示界面或单击取消按钮。</span><span class="sxs-lookup"><span data-stu-id="9e12f-131">The display interface returns after the Add Products from Shipment or Cancel buttons are clicked.</span></span> <span data-ttu-id="9e12f-132">我们将在步骤 2 中创建插入接口。</span><span class="sxs-lookup"><span data-stu-id="9e12f-132">We'll create the inserting interface in Step 2.</span></span>

<span data-ttu-id="9e12f-133">当创建页有两个接口，一次只有其中一个是可见的每个接口通常放在[面板 Web 控件](http://www.w3schools.com/aspnet/control_panel.asp)，它用作其他控件的容器。</span><span class="sxs-lookup"><span data-stu-id="9e12f-133">When creating a page that has two interfaces, only one of which is visible at a time, each interface typically is placed within a [Panel Web control](http://www.w3schools.com/aspnet/control_panel.asp), which serves as a container for other controls.</span></span> <span data-ttu-id="9e12f-134">因此，我们的页面有两个面板控件一个，每个接口。</span><span class="sxs-lookup"><span data-stu-id="9e12f-134">Therefore, our page will have two Panel controls one for each interface.</span></span>

<span data-ttu-id="9e12f-135">首先打开`BatchInsert.aspx`页面`BatchData`文件夹，然后拖动一个面板从工具箱中拖动到设计器 （请参见图 2）。</span><span class="sxs-lookup"><span data-stu-id="9e12f-135">Start by opening the `BatchInsert.aspx` page in the `BatchData` folder and drag a Panel from the Toolbox onto the Designer (see Figure 2).</span></span> <span data-ttu-id="9e12f-136">设置面板 s`ID`属性`DisplayInterface`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-136">Set the Panel s `ID` property to `DisplayInterface`.</span></span> <span data-ttu-id="9e12f-137">当将面板添加到设计器中，其`Height`和`Width`属性设置为 50px 和 125px，分别。</span><span class="sxs-lookup"><span data-stu-id="9e12f-137">When adding the Panel to the Designer, its `Height` and `Width` properties are set to 50px and 125px, respectively.</span></span> <span data-ttu-id="9e12f-138">清理这些属性值从属性窗口。</span><span class="sxs-lookup"><span data-stu-id="9e12f-138">Clear out these property values from the Properties window.</span></span>


<span data-ttu-id="9e12f-139">[![从工具箱中拖动到设计器中拖动面板](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-139">[![Drag a Panel from the Toolbox onto the Designer](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span></span>

<span data-ttu-id="9e12f-140">**图 2**： 从工具箱中拖动到设计器中拖动面板 ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-140">**Figure 2**: Drag a Panel from the Toolbox onto the Designer ([Click to view full-size image](batch-inserting-cs/_static/image6.png))</span></span>


<span data-ttu-id="9e12f-141">接下来，将按钮和 GridView 控件拖动到面板。</span><span class="sxs-lookup"><span data-stu-id="9e12f-141">Next, drag a Button and GridView control into the Panel.</span></span> <span data-ttu-id="9e12f-142">设置按钮 s`ID`属性`ProcessShipment`及其`Text`处理产品装运到的属性。</span><span class="sxs-lookup"><span data-stu-id="9e12f-142">Set the Button s `ID` property to `ProcessShipment` and its `Text` property to Process Product Shipment.</span></span> <span data-ttu-id="9e12f-143">设置 GridView s`ID`属性`ProductsGrid`和从其智能标记，请将其绑定到名为新 ObjectDataSource `ProductsDataSource`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-143">Set the GridView s `ID` property to `ProductsGrid` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="9e12f-144">配置对象数据源将从其数据拉`ProductsBLL`类的`GetProducts`方法。</span><span class="sxs-lookup"><span data-stu-id="9e12f-144">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="9e12f-145">由于此 GridView 仅用于显示数据，在更新中，INSERT、 设置的下拉列表，删除选项卡添加到 （无）。</span><span class="sxs-lookup"><span data-stu-id="9e12f-145">Since this GridView is used only to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="9e12f-146">单击完成以完成配置数据源向导。</span><span class="sxs-lookup"><span data-stu-id="9e12f-146">Click Finish to complete the Configure Data Source wizard.</span></span>


<span data-ttu-id="9e12f-147">[![显示从 ProductsBLL 类的 GetProducts 方法返回的数据](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-147">[![Display the Data Returned from the ProductsBLL Class s GetProducts Method](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span></span>

<span data-ttu-id="9e12f-148">**图 3**： 显示从数据返回`ProductsBLL`类 s`GetProducts`方法 ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-148">**Figure 3**: Display the Data Returned from the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](batch-inserting-cs/_static/image9.png))</span></span>


<span data-ttu-id="9e12f-149">[![在更新中，INSERT、 设置的下拉列表和删除选项卡到 （无）](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-149">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span></span>

<span data-ttu-id="9e12f-150">**图 4**： 设置的下拉列表中更新、 插入和删除选项卡为 （无） ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-150">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-inserting-cs/_static/image12.png))</span></span>


<span data-ttu-id="9e12f-151">完成对象数据源向导后，Visual Studio 将添加 BoundFields 和产品数据字段 CheckBoxField。</span><span class="sxs-lookup"><span data-stu-id="9e12f-151">After completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="9e12f-152">删除所有但`ProductName`， `CategoryName`， `SupplierName`， `UnitPrice`，和`Discontinued`字段。</span><span class="sxs-lookup"><span data-stu-id="9e12f-152">Remove all but the `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, and `Discontinued` fields.</span></span> <span data-ttu-id="9e12f-153">随意调整美观的任何自定义。</span><span class="sxs-lookup"><span data-stu-id="9e12f-153">Feel free to make any aesthetic customizations.</span></span> <span data-ttu-id="9e12f-154">我决定要设置格式`UnitPrice`作为货币值的字段重新排序字段，并且重命名的某些字段`HeaderText`值。</span><span class="sxs-lookup"><span data-stu-id="9e12f-154">I decided to format the `UnitPrice` field as a currency value, reordered the fields, and renamed several of the fields `HeaderText` values.</span></span> <span data-ttu-id="9e12f-155">此外配置 GridView 包括分页和排序支持通过检查 GridView s 智能标记中的启用分页和启用排序复选框。</span><span class="sxs-lookup"><span data-stu-id="9e12f-155">Also configure the GridView to include paging and sorting support by checking the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="9e12f-156">后添加面板、 按钮、 GridView 和 ObjectDataSource 控件和自定义的 GridView 的字段，你页面 s 声明性标记应看起来类似于以下：</span><span class="sxs-lookup"><span data-stu-id="9e12f-156">After adding the Panel, Button, GridView, and ObjectDataSource controls and customizing the GridView s fields, your page s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](batch-inserting-cs/samples/sample1.aspx)]

<span data-ttu-id="9e12f-157">请注意，在开始和结束中显示的标记的按钮和 GridView`<asp:Panel>`标记。</span><span class="sxs-lookup"><span data-stu-id="9e12f-157">Note that the markup for the Button and GridView appear within the opening and closing `<asp:Panel>` tags.</span></span> <span data-ttu-id="9e12f-158">由于这些控件是在`DisplayInterface`面板中，我们可以隐藏起来，方法只需设置面板 s`Visible`属性`false`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-158">Since these controls are within the `DisplayInterface` Panel, we can hide them by simply setting the Panel s `Visible` property to `false`.</span></span> <span data-ttu-id="9e12f-159">步骤 3 考察以编程方式更改面板的`Visible`至一个按钮的响应中的属性单击以显示同时隐藏了另一个接口。</span><span class="sxs-lookup"><span data-stu-id="9e12f-159">Step 3 looks at programmatically changing the Panel s `Visible` property in response to a button click to show one interface while hiding the other.</span></span>

<span data-ttu-id="9e12f-160">花些时间查看我们通过浏览器的进度。</span><span class="sxs-lookup"><span data-stu-id="9e12f-160">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="9e12f-161">如图 5 所示，你应看到一个 GridView，一次列出的产品十个以上的进程，产品交付按钮。</span><span class="sxs-lookup"><span data-stu-id="9e12f-161">As Figure 5 shows, you should see a Process Product Shipment button above a GridView that lists the products ten at a time.</span></span>


<span data-ttu-id="9e12f-162">[![GridView 列出的产品，并提供对进行排序和分页功能](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-162">[![The GridView Lists the Products and Offers Sorting and Paging Capabilities](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span></span>

<span data-ttu-id="9e12f-163">**图 5**: GridView 列出的产品和提供排序和分页功能 ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-163">**Figure 5**: The GridView Lists the Products and Offers Sorting and Paging Capabilities ([Click to view full-size image](batch-inserting-cs/_static/image15.png))</span></span>


## <a name="step-2-creating-the-inserting-interface"></a><span data-ttu-id="9e12f-164">步骤 2： 创建插入接口</span><span class="sxs-lookup"><span data-stu-id="9e12f-164">Step 2: Creating the Inserting Interface</span></span>

<span data-ttu-id="9e12f-165">使用显示界面完成时，我们已准备好创建插入重新接口。</span><span class="sxs-lookup"><span data-stu-id="9e12f-165">With the display interface complete, we re ready to create the inserting interface.</span></span> <span data-ttu-id="9e12f-166">对于本教程，让我们来创建一个插入的接口来提示的单个的供应商和类别值，然后使用户输入最多五个产品名称和单位价格值。</span><span class="sxs-lookup"><span data-stu-id="9e12f-166">For this tutorial, let s create an inserting interface that prompts for a single supplier and category value and then allows the user to enter up to five product names and unit price values.</span></span> <span data-ttu-id="9e12f-167">通过此接口，用户可以添加一到五个新产品的所有共享相同的类别和供应商，但具有唯一的产品名称和产品价格。</span><span class="sxs-lookup"><span data-stu-id="9e12f-167">With this interface, the user can add one to five new products that all share the same category and supplier, but have unique product names and prices.</span></span>

<span data-ttu-id="9e12f-168">通过从工具箱中拖动到设计器中，将其放在现有下面拖动面板`DisplayInterface`面板。</span><span class="sxs-lookup"><span data-stu-id="9e12f-168">Start by dragging a Panel from the Toolbox onto the Designer, placing it beneath the existing `DisplayInterface` Panel.</span></span> <span data-ttu-id="9e12f-169">设置`ID`属性的新添加到面板`InsertingInterface`并设置其`Visible`属性`false`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-169">Set the `ID` property of this newly added Panel to `InsertingInterface` and set its `Visible` property to `false`.</span></span> <span data-ttu-id="9e12f-170">我们将添加代码设置`InsertingInterface`面板 s`Visible`属性`true`在步骤 3 中。</span><span class="sxs-lookup"><span data-stu-id="9e12f-170">We'll add code that sets the `InsertingInterface` Panel s `Visible` property to `true` in Step 3.</span></span> <span data-ttu-id="9e12f-171">此外清除面板 s`Height`和`Width`属性值。</span><span class="sxs-lookup"><span data-stu-id="9e12f-171">Also clear out the Panel s `Height` and `Width` property values.</span></span>

<span data-ttu-id="9e12f-172">接下来，我们需要创建插入界面进来图 1 所示。</span><span class="sxs-lookup"><span data-stu-id="9e12f-172">Next, we need to create the inserting interface that was shown back in Figure 1.</span></span> <span data-ttu-id="9e12f-173">此接口可创建通过各种 HTML 的方法，但我们将使用一个非常简单： 一个四列七行的表。</span><span class="sxs-lookup"><span data-stu-id="9e12f-173">This interface can be created through a variety of HTML techniques, but we will use a fairly straightforward one: a four-column, seven-row table.</span></span>

> [!NOTE]
> <span data-ttu-id="9e12f-174">当输入 HTML 标记时，`<table>`元素，但我更喜欢使用的源视图。</span><span class="sxs-lookup"><span data-stu-id="9e12f-174">When entering markup for HTML `<table>` elements, I prefer to use the Source view.</span></span> <span data-ttu-id="9e12f-175">Visual Studio 具有用于添加的工具时`<table>`通过设计器的元素，设计器似乎所有太愿意注入的未经请求`style`向的标记的设置。</span><span class="sxs-lookup"><span data-stu-id="9e12f-175">While Visual Studio does have tools for adding `<table>` elements through the Designer, the Designer seems all too willing to inject unasked for `style` settings into the markup.</span></span> <span data-ttu-id="9e12f-176">一旦我已创建`<table>`标记中，我通常返回到设计器添加 Web 控件并设置其属性。</span><span class="sxs-lookup"><span data-stu-id="9e12f-176">Once I have created the `<table>` markup, I usually return to the Designer to add the Web controls and set their properties.</span></span> <span data-ttu-id="9e12f-177">创建包含预先确定的列和行的表时我更喜欢使用静态 HTML 而不是[表 Web 控件](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.table.aspx)因为任何放置表 Web 控件内的 Web 控件仅可以使用`FindControl("controlID")`模式。</span><span class="sxs-lookup"><span data-stu-id="9e12f-177">When creating tables with pre-determined columns and rows I prefer using static HTML rather than the [Table Web control](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.table.aspx) because any Web controls placed within a Table Web control can only be accessed using the `FindControl("controlID")` pattern.</span></span> <span data-ttu-id="9e12f-178">我，但是，使用表 Web 控件动态调整大小的表 （其行或列基于某些数据库或用户指定的条件的），因为表 Web 控件可以以编程方式构造。</span><span class="sxs-lookup"><span data-stu-id="9e12f-178">I do, however, use Table Web controls for dynamically-sized tables (ones whose rows or columns are based on some database or user-specified criteria), since the Table Web control can be constructed programmatically.</span></span>


<span data-ttu-id="9e12f-179">输入中的以下标记`<asp:Panel>`标记`InsertingInterface`面板：</span><span class="sxs-lookup"><span data-stu-id="9e12f-179">Enter the following markup within the `<asp:Panel>` tags of the `InsertingInterface` Panel:</span></span>


[!code-html[Main](batch-inserting-cs/samples/sample2.html)]

<span data-ttu-id="9e12f-180">这`<table>`标记不包含任何 Web 控件，但我们将稍后添加它们。</span><span class="sxs-lookup"><span data-stu-id="9e12f-180">This `<table>` markup does not include any Web controls yet, we'll add those momentarily.</span></span> <span data-ttu-id="9e12f-181">请注意，每个`<tr>`元素包含特定的 CSS 类设置：`BatchInsertHeaderRow`标头行的供应商和类别 DropDownLists 的目的地;`BatchInsertFooterRow`的目的地装运和取消按钮中的添加产品; 的页脚行和交替`BatchInsertRow`和`BatchInsertAlternatingRow`的产品和单元将包含行的值价格 TextBox 控件。</span><span class="sxs-lookup"><span data-stu-id="9e12f-181">Note that each `<tr>` element contains a particular CSS class setting: `BatchInsertHeaderRow` for the header row where the supplier and category DropDownLists will go; `BatchInsertFooterRow` for the footer row where the Add Products from Shipment and Cancel Buttons will go; and alternating `BatchInsertRow` and `BatchInsertAlternatingRow` values for the rows that will contain the product and unit price TextBox controls.</span></span> <span data-ttu-id="9e12f-182">我已创建中的相应 CSS 类`Styles.css`文件以便插入接口外观的外观类似于 GridView 和说明如何控制我们已在这些教程中使用。</span><span class="sxs-lookup"><span data-stu-id="9e12f-182">I ve created corresponding CSS classes in the `Styles.css` file to give the inserting interface an appearance similar to the GridView and DetailsView controls we ve used throughout these tutorials.</span></span> <span data-ttu-id="9e12f-183">下面显示了这些 CSS 类。</span><span class="sxs-lookup"><span data-stu-id="9e12f-183">These CSS classes are shown below.</span></span>


[!code-css[Main](batch-inserting-cs/samples/sample3.css)]

<span data-ttu-id="9e12f-184">输入此标记，返回到设计视图。</span><span class="sxs-lookup"><span data-stu-id="9e12f-184">With this markup entered, return to the Design view.</span></span> <span data-ttu-id="9e12f-185">这`<table>`应显示为一个四列七行的表在设计器中，如图 6 所示。</span><span class="sxs-lookup"><span data-stu-id="9e12f-185">This `<table>` should show as a four-column, seven-row table in the Designer, as Figure 6 illustrates.</span></span>


<span data-ttu-id="9e12f-186">[![插入接口由四个列七行表的](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-186">[![The Inserting Interface is Composed of a Four-Column, Seven-Row Table](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span></span>

<span data-ttu-id="9e12f-187">**图 6**: 插入接口由四个列七行表的 ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-187">**Figure 6**: The Inserting Interface is Composed of a Four-Column, Seven-Row Table ([Click to view full-size image](batch-inserting-cs/_static/image18.png))</span></span>


<span data-ttu-id="9e12f-188">我们现在重新准备好向插入接口添加 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="9e12f-188">We re now ready to add the Web controls to the inserting interface.</span></span> <span data-ttu-id="9e12f-189">将两个 DropDownLists 从工具箱拖到相应的单元格中的表中其中一个供应商，另一个用于类别。</span><span class="sxs-lookup"><span data-stu-id="9e12f-189">Drag two DropDownLists from the Toolbox into the appropriate cells in the table one for the supplier and one for the category.</span></span>

<span data-ttu-id="9e12f-190">设置供应商的 DropDownList s`ID`属性`Suppliers`并将其绑定到名为新 ObjectDataSource `SuppliersDataSource`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-190">Set the supplier DropDownList s `ID` property to `Suppliers` and bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="9e12f-191">配置新的对象数据源，以检索从其数据`SuppliersBLL`类的`GetSuppliers`方法和组更新选项卡上为 (None) s 下拉列表。</span><span class="sxs-lookup"><span data-stu-id="9e12f-191">Configure the new ObjectDataSource to retrieve its data from the `SuppliersBLL` class s `GetSuppliers` method and set the UPDATE tab s drop-down list to (None).</span></span> <span data-ttu-id="9e12f-192">单击完成以完成向导。</span><span class="sxs-lookup"><span data-stu-id="9e12f-192">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="9e12f-193">[![配置对象数据源以使用 SuppliersBLL 类的 GetSuppliers 方法](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-193">[![Configure the ObjectDataSource to Use the SuppliersBLL Class s GetSuppliers Method](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span></span>

<span data-ttu-id="9e12f-194">**图 7**： 配置使用 ObjectDataSource`SuppliersBLL`类 s`GetSuppliers`方法 ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-194">**Figure 7**: Configure the ObjectDataSource to Use the `SuppliersBLL` Class s `GetSuppliers` Method ([Click to view full-size image](batch-inserting-cs/_static/image21.png))</span></span>


<span data-ttu-id="9e12f-195">具有`Suppliers`DropDownList 显示`CompanyName`数据字段并使用`SupplierID`数据字段作为其`ListItem`的值。</span><span class="sxs-lookup"><span data-stu-id="9e12f-195">Have the `Suppliers` DropDownList display the `CompanyName` data field and use the `SupplierID` data field as its `ListItem` s values.</span></span>


<span data-ttu-id="9e12f-196">[![显示 CompanyName 数据字段并使用供应商 Id 作为值](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-196">[![Display the CompanyName Data Field and Use SupplierID as the Value](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span></span>

<span data-ttu-id="9e12f-197">**图 8**： 显示`CompanyName`数据字段并使用`SupplierID`作为值 ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-197">**Figure 8**: Display the `CompanyName` Data Field and Use `SupplierID` as the Value ([Click to view full-size image](batch-inserting-cs/_static/image24.png))</span></span>


<span data-ttu-id="9e12f-198">将第二个 DropDownList`Categories`并将其绑定到名为新 ObjectDataSource `CategoriesDataSource`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-198">Name the second DropDownList `Categories` and bind it to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="9e12f-199">配置`CategoriesDataSource`ObjectDataSource 使用`CategoriesBLL`类的`GetCategories`方法; 设置下拉列表中的更新和删除选项卡添加到 （无） 然后单击完成以完成向导。</span><span class="sxs-lookup"><span data-stu-id="9e12f-199">Configure the `CategoriesDataSource` ObjectDataSource to use the `CategoriesBLL` class s `GetCategories` method; set the drop-down lists in the UPDATE and DELETE tabs to (None) and click Finish to complete the wizard.</span></span> <span data-ttu-id="9e12f-200">最后，具有 DropDownList 显示`CategoryName`数据字段并使用`CategoryID`作为值。</span><span class="sxs-lookup"><span data-stu-id="9e12f-200">Finally, have the DropDownList display the `CategoryName` data field and use the `CategoryID` as the value.</span></span>

<span data-ttu-id="9e12f-201">已添加并绑定到适当配置 ObjectDataSources 这些两个 DropDownLists 后，你的屏幕应类似于图 9。</span><span class="sxs-lookup"><span data-stu-id="9e12f-201">After these two DropDownLists have been added and bound to appropriately configured ObjectDataSources, your screen should look similar to Figure 9.</span></span>


<span data-ttu-id="9e12f-202">[![标头行现在包含的供应商和类别 DropDownLists](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-202">[![The Header Row Now Contains the Suppliers and Categories DropDownLists](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span></span>

<span data-ttu-id="9e12f-203">**图 9**: 标头行现在包含`Suppliers`和`Categories`DropDownLists ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-203">**Figure 9**: The Header Row Now Contains the `Suppliers` and `Categories` DropDownLists ([Click to view full-size image](batch-inserting-cs/_static/image27.png))</span></span>


<span data-ttu-id="9e12f-204">现在，我们需要创建文本框中，若要收集的名称和每个新产品的价格。</span><span class="sxs-lookup"><span data-stu-id="9e12f-204">We now need to create the TextBoxes to collect the name and price for each new product.</span></span> <span data-ttu-id="9e12f-205">将 TextBox 控件从工具箱中拖动到设计器为每个五个产品名称和价格行。</span><span class="sxs-lookup"><span data-stu-id="9e12f-205">Drag a TextBox control from the Toolbox onto the Designer for each of the five product name and price rows.</span></span> <span data-ttu-id="9e12f-206">设置`ID`到文本框中的属性`ProductName1`， `UnitPrice1`， `ProductName2`， `UnitPrice2`， `ProductName3`， `UnitPrice3`，依次类推。</span><span class="sxs-lookup"><span data-stu-id="9e12f-206">Set the `ID` properties of the TextBoxes to `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, and so on.</span></span>

<span data-ttu-id="9e12f-207">在每个单位价格文本框中，设置后添加 CompareValidator`ControlToValidate`到适当的属性`ID`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-207">Add a CompareValidator after each of the unit price TextBoxes, setting the `ControlToValidate` property to the appropriate `ID`.</span></span> <span data-ttu-id="9e12f-208">此外设置`Operator`属性`GreaterThanEqual`，`ValueToCompare`为 0，和`Type`到`Currency`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-208">Also set the `Operator` property to `GreaterThanEqual`, `ValueToCompare` to 0, and `Type` to `Currency`.</span></span> <span data-ttu-id="9e12f-209">这些设置指示 CompareValidator 以确保价格，如果输入，将有效的货币值大于或等于零。</span><span class="sxs-lookup"><span data-stu-id="9e12f-209">These settings instruct the CompareValidator to ensure that the price, if entered, is a valid currency value that is greater than or equal to zero.</span></span> <span data-ttu-id="9e12f-210">设置`Text`属性\*，和`ErrorMessage`价格必须是大于或等于零。</span><span class="sxs-lookup"><span data-stu-id="9e12f-210">Set the `Text` property to \*, and `ErrorMessage` to The price must be greater than or equal to zero.</span></span> <span data-ttu-id="9e12f-211">此外，请省略任何货币符号。</span><span class="sxs-lookup"><span data-stu-id="9e12f-211">Also, please omit any currency symbols.</span></span>

> [!NOTE]
> <span data-ttu-id="9e12f-212">插入的接口不包括任何 RequiredFieldValidator 控件，即使`ProductName`字段`Products`数据库表不允许`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="9e12f-212">The inserting interface does not include any RequiredFieldValidator controls, even though the `ProductName` field in the `Products` database table does not allow `NULL` values.</span></span> <span data-ttu-id="9e12f-213">这是因为我们想要让用户输入最多五个产品。</span><span class="sxs-lookup"><span data-stu-id="9e12f-213">This is because we want to let the user enter up to five products.</span></span> <span data-ttu-id="9e12f-214">例如，如果用户已为前三个行中提供的产品名称和单位价格，将最后两行保留为空白，d 我们只需添加三个新产品到系统。</span><span class="sxs-lookup"><span data-stu-id="9e12f-214">For example, if the user were to provide the product name and unit price for the first three rows, leaving the last two rows blank, we d just add three new products to the system.</span></span> <span data-ttu-id="9e12f-215">由于`ProductName`是必需的但是，我们将需要以编程方式检查以确保如果单价输入提供相应的产品名称值。</span><span class="sxs-lookup"><span data-stu-id="9e12f-215">Since `ProductName` is required, however, we will need to programmatically check to ensure that if a unit price is entered that a corresponding product name value is provided.</span></span> <span data-ttu-id="9e12f-216">例如，我们将介绍在步骤 4 中的此检查。</span><span class="sxs-lookup"><span data-stu-id="9e12f-216">We'll tackle this check in Step 4.</span></span>


<span data-ttu-id="9e12f-217">当验证的用户的输入，CompareValidator 报告无效的数据，如果值包含货币符号。</span><span class="sxs-lookup"><span data-stu-id="9e12f-217">When validating the user s input, the CompareValidator reports invalid data if the value contains a currency symbol.</span></span> <span data-ttu-id="9e12f-218">添加每个单位价格文本框中以用作一个视觉提示，指示用户输入价格时忽略的货币符号的前面的 $。</span><span class="sxs-lookup"><span data-stu-id="9e12f-218">Add a $ in front of each of the unit price TextBoxes to serve as a visual cue that instructs the user to omit the currency symbol when entering the price.</span></span>

<span data-ttu-id="9e12f-219">最后，添加内的 ValidationSummary 控件`InsertingInterface`面板中，设置其`ShowMessageBox`属性`true`及其`ShowSummary`属性`false`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-219">Lastly, add a ValidationSummary control within the `InsertingInterface` Panel, settings its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span> <span data-ttu-id="9e12f-220">使用这些设置，如果用户输入无效的单位价格值，有问题的 TextBox 控件旁边将出现一个星号，并且 ValidationSummary 将显示一个显示我们在前面指定的错误消息的客户端 messagebox。</span><span class="sxs-lookup"><span data-stu-id="9e12f-220">With these settings, if the user enters an invalid unit price value, an asterisk will appear next to the offending TextBox controls and the ValidationSummary will display a client-side messagebox that shows the error message we specified earlier.</span></span>

<span data-ttu-id="9e12f-221">此时，你的屏幕应类似于图 10。</span><span class="sxs-lookup"><span data-stu-id="9e12f-221">At this point, your screen should look similar to Figure 10.</span></span>


<span data-ttu-id="9e12f-222">[![插入的接口现在包含文本框中的产品名称和产品价格](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-222">[![The Inserting Interface Now Includes TextBoxes for the Products Names and Prices](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span></span>

<span data-ttu-id="9e12f-223">**图 10**: 插入接口现在包含文本框中的产品名称和价格 ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-223">**Figure 10**: The Inserting Interface Now Includes TextBoxes for the Products Names and Prices ([Click to view full-size image](batch-inserting-cs/_static/image30.png))</span></span>


<span data-ttu-id="9e12f-224">接下来，我们需要将添加产品从装运和取消按钮添加到页脚行。</span><span class="sxs-lookup"><span data-stu-id="9e12f-224">Next we need to add the Add Products from Shipment and Cancel buttons to the footer row.</span></span> <span data-ttu-id="9e12f-225">将两个按钮控件从工具箱插入的接口中，页脚设置按钮`ID`属性设置为`AddProducts`和`CancelButton`和`Text`属性以分别从装运和取消，添加产品。</span><span class="sxs-lookup"><span data-stu-id="9e12f-225">Drag two Button controls from the Toolbox into the footer of the inserting interface, setting the Buttons `ID` properties to `AddProducts` and `CancelButton` and `Text` properties to Add Products from Shipment and Cancel, respectively.</span></span> <span data-ttu-id="9e12f-226">此外，设置`CancelButton`控件 s`CausesValidation`属性`false`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-226">In addition, set the `CancelButton` control s `CausesValidation` property to `false`.</span></span>

<span data-ttu-id="9e12f-227">最后，我们需要添加标签 Web 控件将显示两个接口的状态消息。</span><span class="sxs-lookup"><span data-stu-id="9e12f-227">Finally, we need to add a Label Web control that will display status messages for the two interfaces.</span></span> <span data-ttu-id="9e12f-228">例如，当用户成功添加一批新的产品，我们想要返回到显示接口并显示一条确认消息。</span><span class="sxs-lookup"><span data-stu-id="9e12f-228">For example, when a user successfully adds a new shipment of products, we want to return to the display interface and display a confirmation message.</span></span> <span data-ttu-id="9e12f-229">如果，但是，用户可为新产品但不关闭关闭产品名称中提供价格，我们需要显示一条警告消息，因为`ProductName`字段是必填。</span><span class="sxs-lookup"><span data-stu-id="9e12f-229">If, however, the user provides a price for a new product but leaves off the product name, we need to display a warning message since the `ProductName` field is required.</span></span> <span data-ttu-id="9e12f-230">因为我们需要此消息，以显示为这两个接口，则将其放置在外部面板页的顶部。</span><span class="sxs-lookup"><span data-stu-id="9e12f-230">Since we need this message to display for both interfaces, place it at the top of the page outside of the Panels.</span></span>

<span data-ttu-id="9e12f-231">将标签 Web 控件从工具箱拖到设计器中页的顶部。</span><span class="sxs-lookup"><span data-stu-id="9e12f-231">Drag a Label Web control from the Toolbox to the top of the page in the Designer.</span></span> <span data-ttu-id="9e12f-232">设置`ID`属性`StatusLabel`，清除出`Text`属性，同时设置`Visible`和`EnableViewState`属性设置为`false`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-232">Set the `ID` property to `StatusLabel`, clear out the `Text` property, and set the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="9e12f-233">如我们所看到在前面的教程中，设置`EnableViewState`属性`false`使我们能够以编程方式更改标签的属性值并将它们返回到各自的默认值在后续回发时自动还原。</span><span class="sxs-lookup"><span data-stu-id="9e12f-233">As we have seen in previous tutorials, setting the `EnableViewState` property to `false` allows us to programmatically change the Label s property values and have them automatically revert back to their defaults on the subsequent postback.</span></span> <span data-ttu-id="9e12f-234">这简化了显示状态消息以响应在后续回发时消失某些用户操作的代码。</span><span class="sxs-lookup"><span data-stu-id="9e12f-234">This simplifies the code for showing a status message in response to some user action that disappears on the subsequent postback.</span></span> <span data-ttu-id="9e12f-235">最后，设置`StatusLabel`控件 s`CssClass`中定义的警告，这是 CSS 类的名称的属性`Styles.css`大型、 斜体、 粗体和红色字体中显示文本。</span><span class="sxs-lookup"><span data-stu-id="9e12f-235">Finally, set the `StatusLabel` control s `CssClass` property to Warning, which is the name of a CSS class defined in `Styles.css` that displays text in a large, italic, bold, red font.</span></span>

<span data-ttu-id="9e12f-236">图 11 显示 Visual Studio 设计器添加标签并将其配置之后。</span><span class="sxs-lookup"><span data-stu-id="9e12f-236">Figure 11 shows the Visual Studio Designer after the Label has been added and configured.</span></span>


<span data-ttu-id="9e12f-237">[![将上面两个面板控件 StatusLabel 控件放](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-237">[![Place the StatusLabel Control Above the Two Panel Controls](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span></span>

<span data-ttu-id="9e12f-238">**图 11**： 位置`StatusLabel`控件上面两个面板控件 ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-238">**Figure 11**: Place the `StatusLabel` Control Above the Two Panel Controls ([Click to view full-size image](batch-inserting-cs/_static/image33.png))</span></span>


## <a name="step-3-switching-between-the-display-and-inserting-interfaces"></a><span data-ttu-id="9e12f-239">步骤 3： 显示和插入接口之间切换</span><span class="sxs-lookup"><span data-stu-id="9e12f-239">Step 3: Switching Between the Display and Inserting Interfaces</span></span>

<span data-ttu-id="9e12f-240">此时我们已经完成标记用于我们显示和插入接口，但我们重新仍会余下两个任务：</span><span class="sxs-lookup"><span data-stu-id="9e12f-240">At this point we have completed the markup for our display and inserting interfaces, but we re still left with two tasks:</span></span>

- <span data-ttu-id="9e12f-241">在显示之间切换，并将插入接口</span><span class="sxs-lookup"><span data-stu-id="9e12f-241">Switching between the display and inserting interfaces</span></span>
- <span data-ttu-id="9e12f-242">在运送到数据库中添加产品</span><span class="sxs-lookup"><span data-stu-id="9e12f-242">Adding the products in the shipment to the database</span></span>

<span data-ttu-id="9e12f-243">目前，显示接口是可见，但插入接口处于隐藏状态。</span><span class="sxs-lookup"><span data-stu-id="9e12f-243">Currently, the display interface is visible but the inserting interface is hidden.</span></span> <span data-ttu-id="9e12f-244">这是因为`DisplayInterface`面板 s`Visible`属性设置为`true`（默认值），而`InsertingInterface`面板 s`Visible`属性设置为`false`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-244">This is because the `DisplayInterface` Panel s `Visible` property is set to `true` (the default value), while the `InsertingInterface` Panel s `Visible` property is set to `false`.</span></span> <span data-ttu-id="9e12f-245">我们只需切换 s 的每个控件的两个接口之间进行切换`Visible`属性值。</span><span class="sxs-lookup"><span data-stu-id="9e12f-245">To switch between the two interfaces we simply need to toggle each control s `Visible` property value.</span></span>

<span data-ttu-id="9e12f-246">我们想要从移动显示接口到插入接口过程，产品交付按钮。</span><span class="sxs-lookup"><span data-stu-id="9e12f-246">We want to move from the display interface to the inserting interface when the Process Product Shipment button is clicked.</span></span> <span data-ttu-id="9e12f-247">因此，为此按钮 s 创建事件处理程序`Click`包含下面的代码的事件：</span><span class="sxs-lookup"><span data-stu-id="9e12f-247">Therefore, create an event handler for this Button s `Click` event that contains the following code:</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample4.cs)]

<span data-ttu-id="9e12f-248">此代码只需隐藏`DisplayInterface`面板并显示`InsertingInterface`面板。</span><span class="sxs-lookup"><span data-stu-id="9e12f-248">This code simply hides the `DisplayInterface` Panel and shows the `InsertingInterface` Panel.</span></span>

<span data-ttu-id="9e12f-249">接下来，为插入的界面中的装运和取消按钮控件中的添加产品创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="9e12f-249">Next, create event handlers for the Add Products from Shipment and Cancel Button controls in the inserting interface.</span></span> <span data-ttu-id="9e12f-250">单击其中任一个按钮时，我们需要还原到的显示接口。</span><span class="sxs-lookup"><span data-stu-id="9e12f-250">When either of these Buttons is clicked, we need to revert back to the display interface.</span></span> <span data-ttu-id="9e12f-251">创建`Click`两个事件处理程序按钮控件，以便它们调用`ReturnToDisplayInterface`，我们将稍后添加的方法。</span><span class="sxs-lookup"><span data-stu-id="9e12f-251">Create `Click` event handlers for both Button controls so that they call `ReturnToDisplayInterface`, a method we will add momentarily.</span></span> <span data-ttu-id="9e12f-252">除了隐藏`InsertingInterface`面板和显示`DisplayInterface`面板中，`ReturnToDisplayInterface`方法需要 Web 控件返回到其预编辑状态。</span><span class="sxs-lookup"><span data-stu-id="9e12f-252">In addition to hiding the `InsertingInterface` Panel and showing the `DisplayInterface` Panel, the `ReturnToDisplayInterface` method needs to return the Web controls to their pre-editing state.</span></span> <span data-ttu-id="9e12f-253">这涉及设置 DropDownLists`SelectedIndex`属性设置为 0 和清除`Text`文本框中控件的属性。</span><span class="sxs-lookup"><span data-stu-id="9e12f-253">This involves setting the DropDownLists `SelectedIndex` properties to 0 and clearing out the `Text` properties of the TextBox controls.</span></span>

> [!NOTE]
> <span data-ttu-id="9e12f-254">请考虑可能会出现什么如果我们没有 t 返回到显示接口之前将控件恢复到其预编辑状态。</span><span class="sxs-lookup"><span data-stu-id="9e12f-254">Consider what might happen if we didn t return the controls to their pre-editing state before returning to the display interface.</span></span> <span data-ttu-id="9e12f-255">用户可能单击处理产品装运按钮，从装运，输入产品，然后单击添加产品装运。</span><span class="sxs-lookup"><span data-stu-id="9e12f-255">A user might click the Process Product Shipment button, enter the products from the shipment, and then click Add Products from Shipment.</span></span> <span data-ttu-id="9e12f-256">这将添加的产品，并将用户返回到显示接口。</span><span class="sxs-lookup"><span data-stu-id="9e12f-256">This would add the products and return the user to the display interface.</span></span> <span data-ttu-id="9e12f-257">此时，用户可能想要添加另一个运送送达。</span><span class="sxs-lookup"><span data-stu-id="9e12f-257">At this point the user might want to add another shipment.</span></span> <span data-ttu-id="9e12f-258">单击它们将返回到插入接口，但 DropDownList 处理产品装运按钮时文本框中的值，并选择仍将使用其以前的值填充。</span><span class="sxs-lookup"><span data-stu-id="9e12f-258">Upon clicking the Process Product Shipment button they would return to the inserting interface but the DropDownList selections and TextBox values would still be populated with their previous values.</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample5.cs)]

<span data-ttu-id="9e12f-259">同时`Click`事件处理程序只需调用`ReturnToDisplayInterface`方法，尽管我们将从装运返回到添加产品`Click`步骤 4 中的事件处理程序，然后添加代码来保存产品。</span><span class="sxs-lookup"><span data-stu-id="9e12f-259">Both `Click` event handlers simply call the `ReturnToDisplayInterface` method, although we'll return to the Add Products from Shipment `Click` event handler in Step 4 and add code to save the products.</span></span> <span data-ttu-id="9e12f-260">`ReturnToDisplayInterface`通过返回启动`Suppliers`和`Categories`DropDownLists 其第一个选项。</span><span class="sxs-lookup"><span data-stu-id="9e12f-260">`ReturnToDisplayInterface` starts by returning the `Suppliers` and `Categories` DropDownLists to their first options.</span></span> <span data-ttu-id="9e12f-261">两个常量`firstControlID`和`lastControlID`标记的起始和结束命名接口中插入文本框中，并在的界限内使用的的产品名称和单价中使用的控件索引值`for`设置的循环`Text`文本框中控件的属性以返回一个空字符串。</span><span class="sxs-lookup"><span data-stu-id="9e12f-261">The two constants `firstControlID` and `lastControlID` mark the starting and ending control index values used in naming the product name and unit price TextBoxes in the inserting interface and are used in the bounds of the `for` loop that sets the `Text` properties of the TextBox controls back to an empty string.</span></span> <span data-ttu-id="9e12f-262">最后，面板`Visible`属性被重置，以便插入界面隐藏和显示的显示界面。</span><span class="sxs-lookup"><span data-stu-id="9e12f-262">Finally, the Panels `Visible` properties are reset so that the inserting interface is hidden and the display interface shown.</span></span>

<span data-ttu-id="9e12f-263">需要一段时间来测试此页在浏览器。</span><span class="sxs-lookup"><span data-stu-id="9e12f-263">Take a moment to test out this page in a browser.</span></span> <span data-ttu-id="9e12f-264">首先访问页时你应看到显示接口，如图 5 中所示。</span><span class="sxs-lookup"><span data-stu-id="9e12f-264">When first visiting the page you should see the display interface as was shown in Figure 5.</span></span> <span data-ttu-id="9e12f-265">单击处理产品装运按钮。</span><span class="sxs-lookup"><span data-stu-id="9e12f-265">Click the Process Product Shipment button.</span></span> <span data-ttu-id="9e12f-266">将回发页面，你现在应该看到插入接口，如图 12 中所示。</span><span class="sxs-lookup"><span data-stu-id="9e12f-266">The page will postback and you should now see the inserting interface as shown in Figure 12.</span></span> <span data-ttu-id="9e12f-267">单击任一添加中的产品装运或取消按钮返回到显示接口。</span><span class="sxs-lookup"><span data-stu-id="9e12f-267">Clicking either the Add Products from Shipment or Cancel buttons returns you to the display interface.</span></span>

> [!NOTE]
> <span data-ttu-id="9e12f-268">在查看插入的接口时，需要一段时间来测试 CompareValidators 上单价文本框。</span><span class="sxs-lookup"><span data-stu-id="9e12f-268">While viewing the inserting interface, take a moment to test out the CompareValidators on the unit price TextBoxes.</span></span> <span data-ttu-id="9e12f-269">你应看到一个警告时单击具有无效的货币值的装运按钮或价格与小于零的值中的添加产品的客户端 messagebox。</span><span class="sxs-lookup"><span data-stu-id="9e12f-269">You should see a client-side messagebox warning when clicking the Add Products from Shipment button with invalid currency values or prices with a value less than zero.</span></span>


<span data-ttu-id="9e12f-270">[![单击处理产品装运按钮后显示的插入界面](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-270">[![The Inserting Interface is Displayed After Clicking the Process Product Shipment Button](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span></span>

<span data-ttu-id="9e12f-271">**图 12**： 单击处理产品装运按钮后显示插入接口 ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-271">**Figure 12**: The Inserting Interface is Displayed After Clicking the Process Product Shipment Button ([Click to view full-size image](batch-inserting-cs/_static/image36.png))</span></span>


## <a name="step-4-adding-the-products"></a><span data-ttu-id="9e12f-272">步骤 4： 添加产品</span><span class="sxs-lookup"><span data-stu-id="9e12f-272">Step 4: Adding the Products</span></span>

<span data-ttu-id="9e12f-273">所有剩余本教程是将产品保存到的数据库中添加产品中，从装运按钮的`Click`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="9e12f-273">All that remains for this tutorial is to save the products to the database in the Add Products from Shipment Button s `Click` event handler.</span></span> <span data-ttu-id="9e12f-274">这可以通过创建`ProductsDataTable`和添加`ProductsRow`为每个提供的产品名称的实例。</span><span class="sxs-lookup"><span data-stu-id="9e12f-274">This can be accomplished by creating a `ProductsDataTable` and adding a `ProductsRow` instance for each of the product names supplied.</span></span> <span data-ttu-id="9e12f-275">一次这些`ProductsRow`中添加了我们将调用`ProductsBLL`类 s`UpdateWithTransaction`方法并传入`ProductsDataTable`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-275">Once these `ProductsRow` s have been added we will make a call to the `ProductsBLL` class s `UpdateWithTransaction` method passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="9e12f-276">回想一下，`UpdateWithTransaction`方法，创建返回[在事务中包装数据库修改](wrapping-database-modifications-within-a-transaction-cs.md)教程，则传递`ProductsDataTable`到`ProductsTableAdapter`s`UpdateWithTransaction`方法。</span><span class="sxs-lookup"><span data-stu-id="9e12f-276">Recall that the `UpdateWithTransaction` method, which was created back in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial, passes the `ProductsDataTable` to the `ProductsTableAdapter` s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="9e12f-277">在这里，ADO.NET 事务启动和 TableAdatper 问题`INSERT`到每个添加的数据库的语句`ProductsRow`数据表中。</span><span class="sxs-lookup"><span data-stu-id="9e12f-277">From there, an ADO.NET transaction is started and the TableAdatper issues an `INSERT` statement to the database for each added `ProductsRow` in the DataTable.</span></span> <span data-ttu-id="9e12f-278">假设所有产品都添加未生成错误，则提交此事务，否则它将回滚。</span><span class="sxs-lookup"><span data-stu-id="9e12f-278">Assuming all products are added without error, the transaction is committed, otherwise it is rolled back.</span></span>

<span data-ttu-id="9e12f-279">装运按钮 s 中的添加产品代码`Click`事件处理程序还需要执行一些错误检查。</span><span class="sxs-lookup"><span data-stu-id="9e12f-279">The code for the Add Products from Shipment Button s `Click` event handler also needs to perform a bit of error checking.</span></span> <span data-ttu-id="9e12f-280">因为在插入界面中使用任何 RequiredFieldValidators 不不存在，则用户可以输入价格的产品时省略其名称。</span><span class="sxs-lookup"><span data-stu-id="9e12f-280">Since there are no RequiredFieldValidators used in the inserting interface, a user could enter a price for a product while omitting its name.</span></span> <span data-ttu-id="9e12f-281">由于产品的名称是必需的如果此类条件展开我们需要向用户发出警报并不继续执行插入操作。</span><span class="sxs-lookup"><span data-stu-id="9e12f-281">Since the product s name is required, if such a condition unfolds we need to alert the user and not proceed with the inserts.</span></span> <span data-ttu-id="9e12f-282">完整`Click`事件处理程序代码之后：</span><span class="sxs-lookup"><span data-stu-id="9e12f-282">The complete `Click` event handler code follows:</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample6.cs)]

<span data-ttu-id="9e12f-283">事件处理程序首先确保`Page.IsValid`属性返回的值`true`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-283">The event handler starts by ensuring that the `Page.IsValid` property returns a value of `true`.</span></span> <span data-ttu-id="9e12f-284">如果它返回`false`、 然后这意味着一个或多个 CompareValidators 是否正报告无效的数据; 在这种情况下我们不希望尝试插入的输入的产品或我们将得到的异常时尝试分配的用户输入的单位价格将值为`ProductsRow`s`UnitPrice`属性。</span><span class="sxs-lookup"><span data-stu-id="9e12f-284">If it returns `false`, then that means one or more of the CompareValidators are reporting invalid data; in such a case we do not want to attempt to insert the entered products or we'll end up with an exception when attempting to assign the user-entered unit price value to the `ProductsRow` s `UnitPrice` property.</span></span>

<span data-ttu-id="9e12f-285">下一步、 新`ProductsDataTable`创建实例 (`products`)。</span><span class="sxs-lookup"><span data-stu-id="9e12f-285">Next, a new `ProductsDataTable` instance is created (`products`).</span></span> <span data-ttu-id="9e12f-286">A`for`循环用于循环访问产品名称和单价文本框中和`Text`属性读取到的本地变量`productName`和`unitPrice`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-286">A `for` loop is used to iterate through the product name and unit price TextBoxes and the `Text` properties are read into the local variables `productName` and `unitPrice`.</span></span> <span data-ttu-id="9e12f-287">如果用户输入的值的单位价格而非相应的产品名称，`StatusLabel`显示消息，如果你提供一个单元价格你还必须包含产品的名称并退出事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="9e12f-287">If the user has entered a value for the unit price but not for the corresponding product name, the `StatusLabel` displays the message If you provide a unit price you must also include the name of the product and the event handler is exited.</span></span>

<span data-ttu-id="9e12f-288">如果已提供的产品名称，一个新`ProductsRow`使用创建实例`ProductsDataTable`s`NewProductsRow`方法。</span><span class="sxs-lookup"><span data-stu-id="9e12f-288">If a product name has been provided, a new `ProductsRow` instance is created using the `ProductsDataTable` s `NewProductsRow` method.</span></span> <span data-ttu-id="9e12f-289">此新`ProductsRow`实例 s`ProductName`属性设置为当前产品名称文本框中时`SupplierID`和`CategoryID`属性分配给`SelectedValue`DropDownLists 插入接口 s 标头中的属性。</span><span class="sxs-lookup"><span data-stu-id="9e12f-289">This new `ProductsRow` instance s `ProductName` property is set to the current product name TextBox while the `SupplierID` and `CategoryID` properties are assigned to the `SelectedValue` properties of the DropDownLists in the inserting interface s header.</span></span> <span data-ttu-id="9e12f-290">如果用户输入的产品的价格一个值，则将它分配给`ProductsRow`实例 s`UnitPrice`属性; 否则，该属性是左未分配状态，这将导致`NULL`值`UnitPrice`数据库中。</span><span class="sxs-lookup"><span data-stu-id="9e12f-290">If the user entered a value for the product s price, it is assigned to the `ProductsRow` instance s `UnitPrice` property; otherwise, the property is left unassigned, which will result in a `NULL` value for `UnitPrice` in the database.</span></span> <span data-ttu-id="9e12f-291">最后，`Discontinued`和`UnitsOnOrder`属性分配给硬编码值`false`和 0 分别。</span><span class="sxs-lookup"><span data-stu-id="9e12f-291">Finally, the `Discontinued` and `UnitsOnOrder` properties are assigned to the hard-coded values `false` and 0, respectively.</span></span>

<span data-ttu-id="9e12f-292">为分配了属性后`ProductsRow`实例添加到`ProductsDataTable`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-292">After the properties have been assigned to the `ProductsRow` instance it is added to the `ProductsDataTable`.</span></span>

<span data-ttu-id="9e12f-293">在完成`for`循环中，我们将检查是否已添加的任何产品。</span><span class="sxs-lookup"><span data-stu-id="9e12f-293">At the completion of the `for` loop, we check whether any products have been added.</span></span> <span data-ttu-id="9e12f-294">用户可能，在所有情况下，单击在进入任何产品名称或价格之前的装运中的添加产品。</span><span class="sxs-lookup"><span data-stu-id="9e12f-294">The user may, after all, have clicked the Add Products from Shipment before entering any product names or prices.</span></span> <span data-ttu-id="9e12f-295">如果没有至少一个产品中的`ProductsDataTable`、`ProductsBLL`类的`UpdateWithTransaction`调用方法。</span><span class="sxs-lookup"><span data-stu-id="9e12f-295">If there is at least one product in the `ProductsDataTable`, the `ProductsBLL` class s `UpdateWithTransaction` method is called.</span></span> <span data-ttu-id="9e12f-296">接下来，数据重新绑定到`ProductsGrid`GridView，以便在显示界面中将显示新添加的产品。</span><span class="sxs-lookup"><span data-stu-id="9e12f-296">Next, the data is rebound to the `ProductsGrid` GridView so that the newly added products will appear in the display interface.</span></span> <span data-ttu-id="9e12f-297">`StatusLabel`更新以显示一条确认消息和`ReturnToDisplayInterface`隐藏插入接口和显示的显示接口的调用。</span><span class="sxs-lookup"><span data-stu-id="9e12f-297">The `StatusLabel` is updated to display a confirmation message and the `ReturnToDisplayInterface` is invoked, hiding the inserting interface and showing the display interface.</span></span>

<span data-ttu-id="9e12f-298">如果输入的产品，插入的接口都显示但没有产品已添加的消息。</span><span class="sxs-lookup"><span data-stu-id="9e12f-298">If no products were entered, the inserting interface remains displayed but the message No products were added.</span></span> <span data-ttu-id="9e12f-299">请输入产品名称和显示在文本框中的单位价格。</span><span class="sxs-lookup"><span data-stu-id="9e12f-299">Please enter the product names and unit prices in the textboxes is displayed.</span></span>

<span data-ttu-id="9e12f-300">图 13、 14 中和 15 显示插入和在操作中显示接口。</span><span class="sxs-lookup"><span data-stu-id="9e12f-300">Figure s 13, 14, and 15 show the inserting and display interfaces in action.</span></span> <span data-ttu-id="9e12f-301">在图 13 中，用户输入没有相应的产品名称的单位价格值。</span><span class="sxs-lookup"><span data-stu-id="9e12f-301">In Figure 13, the user has entered a unit price value without a corresponding product name.</span></span> <span data-ttu-id="9e12f-302">图 14 显示了显示接口三次新产品已添加成功，而图 15 将显示两个新添加的产品中 GridView （位于前一页的第三个）。</span><span class="sxs-lookup"><span data-stu-id="9e12f-302">Figure 14 shows the display interface after three new products have been added successfully, while Figure 15 shows two of the newly added products in the GridView (the third one is on the previous page).</span></span>


<span data-ttu-id="9e12f-303">[![产品名称是所需时输入的单位价格](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-303">[![A Product Name is Required When Entering a Unit Price](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span></span>

<span data-ttu-id="9e12f-304">**图 13**: 产品名称是所需时输入的单位价格 ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-304">**Figure 13**: A Product Name is Required When Entering a Unit Price ([Click to view full-size image](batch-inserting-cs/_static/image39.png))</span></span>


<span data-ttu-id="9e12f-305">[![三个新 Veggies 中添加了供应商 Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-305">[![Three New Veggies Have Been Added for the Supplier Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span></span>

<span data-ttu-id="9e12f-306">**图 14**： 三个新 Veggies 中添加了供应商 Mayumi s ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-306">**Figure 14**: Three New Veggies Have Been Added for the Supplier Mayumi s ([Click to view full-size image](batch-inserting-cs/_static/image42.png))</span></span>


<span data-ttu-id="9e12f-307">[![在 GridView 的最后一页中找不到新产品](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="9e12f-307">[![The New Products Can Be Found in the Last Page of the GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span></span>

<span data-ttu-id="9e12f-308">**图 15**: 新产品可在 GridView 最后一页 ([单击以查看实际尺寸的图像](batch-inserting-cs/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="9e12f-308">**Figure 15**: The New Products Can Be Found in the Last Page of the GridView ([Click to view full-size image](batch-inserting-cs/_static/image45.png))</span></span>


> [!NOTE]
> <span data-ttu-id="9e12f-309">批处理插入本教程中使用的逻辑包装在事务范围内的插入操作。</span><span class="sxs-lookup"><span data-stu-id="9e12f-309">The batch inserting logic used in this tutorial wraps the inserts within the scope of transaction.</span></span> <span data-ttu-id="9e12f-310">若要验证这一点，有意引入一个数据库级错误。</span><span class="sxs-lookup"><span data-stu-id="9e12f-310">To verify this, purposefully introduce a database-level error.</span></span> <span data-ttu-id="9e12f-311">例如，这些操作都而不必分配新`ProductsRow`实例 s`CategoryID`属性中的选定值`Categories`DropDownList，分配到一个值喜欢`i * 5`。</span><span class="sxs-lookup"><span data-stu-id="9e12f-311">For example, rather than assigning the new `ProductsRow` instance s `CategoryID` property to the selected value in the `Categories` DropDownList, assign it to a value like `i * 5`.</span></span> <span data-ttu-id="9e12f-312">此处`i`是循环索引器和具有介于 1 到 5 的值。</span><span class="sxs-lookup"><span data-stu-id="9e12f-312">Here `i` is the loop indexer and has values ranging from 1 to 5.</span></span> <span data-ttu-id="9e12f-313">因此，当添加两个或多个产品的批处理插入的第一个产品将有一个有效`CategoryID`值 (5)，但后续产品将具有`CategoryID`达不匹配的值`CategoryID`中值`Categories`表。</span><span class="sxs-lookup"><span data-stu-id="9e12f-313">Therefore, when adding two or more products in batch insert the first product will have a valid `CategoryID` value (5), but subsequent products will have `CategoryID` values that do not match up to `CategoryID` values in the `Categories` table.</span></span> <span data-ttu-id="9e12f-314">净效果是，同时第一`INSERT`将成功，但后续的具有外键约束冲突将失败。</span><span class="sxs-lookup"><span data-stu-id="9e12f-314">The net effect is that while the first `INSERT` will succeed, subsequent ones will fail with a foreign key constraint violation.</span></span> <span data-ttu-id="9e12f-315">批处理插入是原子操作，因为第一个`INSERT`将被回滚，返回到之前批插入过程的状态数据库开始。</span><span class="sxs-lookup"><span data-stu-id="9e12f-315">Since the batch insert is atomic, the first `INSERT` will be rolled back, returning the database to its state before the batch insert process began.</span></span>


## <a name="summary"></a><span data-ttu-id="9e12f-316">摘要</span><span class="sxs-lookup"><span data-stu-id="9e12f-316">Summary</span></span>

<span data-ttu-id="9e12f-317">通过这和前面的两个教程中，我们已创建接口，便于更新，删除和插入的数据的批次，它们都使用我们将添加到数据访问层中的事务支持[包装数据库修改在事务中](wrapping-database-modifications-within-a-transaction-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="9e12f-317">Over this and the previous two tutorials we have created interfaces that allow for updating, deleting, and inserting batches of data, all of which used the transaction support we added to the Data Access Layer in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial.</span></span> <span data-ttu-id="9e12f-318">对于某些情况下，此类批处理处理用户界面极大地提高最终用户效率通过减少点击次数，回发和键盘鼠标上下文切换，同时还能保留基础数据的完整性。</span><span class="sxs-lookup"><span data-stu-id="9e12f-318">For certain scenarios, such batch processing user interfaces greatly improve end user efficiency by cutting down on the number of clicks, postbacks, and keyboard-to-mouse context switches, while also maintaining the integrity of the underlying data.</span></span>

<span data-ttu-id="9e12f-319">本教程中完成我们了解了如何使用批处理的数据。</span><span class="sxs-lookup"><span data-stu-id="9e12f-319">This tutorial completes our look at working with batched data.</span></span> <span data-ttu-id="9e12f-320">教程的下一步一套探讨各种高级数据访问层方案，包括使用存储的过程在 TableAdapter 的方法中，在 DAL、 加密连接字符串和详细信息中配置连接和命令级别设置 ！</span><span class="sxs-lookup"><span data-stu-id="9e12f-320">The next set of tutorials explores a variety of advanced Data Access Layer scenarios, including using stored procedures in the TableAdapter s methods, configuring connection- and command-level settings in the DAL, encrypting connection strings, and more!</span></span>

<span data-ttu-id="9e12f-321">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="9e12f-321">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="9e12f-322">关于作者</span><span class="sxs-lookup"><span data-stu-id="9e12f-322">About the Author</span></span>

<span data-ttu-id="9e12f-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七个 ASP/ASP.NET 书籍和的创始人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年使用与 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="9e12f-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9e12f-324">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="9e12f-324">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9e12f-325">最新书籍是[ *Sam 教授自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="9e12f-325">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="9e12f-326">他可以达到在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或通过他的博客，其中可以找到在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="9e12f-326">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="9e12f-327">特别感谢</span><span class="sxs-lookup"><span data-stu-id="9e12f-327">Special Thanks To</span></span>

<span data-ttu-id="9e12f-328">本教程系列已由许多有用的审阅者评审。</span><span class="sxs-lookup"><span data-stu-id="9e12f-328">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="9e12f-329">出于本教程已希尔顿 Giesenow 和 S ren 异世 Lauritsen 导致审阅者。</span><span class="sxs-lookup"><span data-stu-id="9e12f-329">Lead reviewers for this tutorial were Hilton Giesenow and S ren Jacob Lauritsen.</span></span> <span data-ttu-id="9e12f-330">对感兴趣查看我即将到来的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="9e12f-330">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="9e12f-331">如果是这样，删除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9e12f-331">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="9e12f-332">[上一页](batch-deleting-cs.md)
[下一页](wrapping-database-modifications-within-a-transaction-vb.md)</span><span class="sxs-lookup"><span data-stu-id="9e12f-332">[Previous](batch-deleting-cs.md)
[Next](wrapping-database-modifications-within-a-transaction-vb.md)</span></span>
