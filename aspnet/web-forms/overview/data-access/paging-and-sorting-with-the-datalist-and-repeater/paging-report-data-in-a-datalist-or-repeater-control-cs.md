---
uid: web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/paging-report-data-in-a-datalist-or-repeater-control-cs
title: 分页 DataList 或转发器控件 (C#) 中的报表数据 |Microsoft 文档
author: rick-anderson
description: 在 DataList 和转发器都不提供自动分页或排序支持时，本教程演示如何将分页支持添加到 DataList 或转发器...
ms.author: aspnetcontent
manager: wpickett
ms.date: 11/13/2006
ms.topic: article
ms.assetid: e8e0809b-25c4-4c3b-8d12-9a17048148ae
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/paging-report-data-in-a-datalist-or-repeater-control-cs
msc.type: authoredcontent
ms.openlocfilehash: 43b1370e1411858cef02bca534d082a3c105e51e
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/06/2018
---
<a name="paging-report-data-in-a-datalist-or-repeater-control-c"></a><span data-ttu-id="147e1-103">DataList 或转发器控件 (C#) 中的分页报表数据</span><span class="sxs-lookup"><span data-stu-id="147e1-103">Paging Report Data in a DataList or Repeater Control (C#)</span></span>
====================
<span data-ttu-id="147e1-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="147e1-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="147e1-105">[下载示例应用程序](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_44_CS.exe)或[下载 PDF](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/datatutorial44cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="147e1-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_44_CS.exe) or [Download PDF](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/datatutorial44cs1.pdf)</span></span>

> <span data-ttu-id="147e1-106">虽然 DataList 和转发器都不提供自动分页或排序支持，本教程演示如何将分页支持添加到 DataList 或转发器，允许更灵活的分页和数据的显示接口。</span><span class="sxs-lookup"><span data-stu-id="147e1-106">While neither the DataList nor Repeater offer automatic paging or sorting support, this tutorial shows how to add paging support to the DataList or Repeater, which allows for much more flexible paging and data display interfaces.</span></span>


## <a name="introduction"></a><span data-ttu-id="147e1-107">介绍</span><span class="sxs-lookup"><span data-stu-id="147e1-107">Introduction</span></span>

<span data-ttu-id="147e1-108">分页和排序是两个非常常见功能，当在联机应用程序中显示数据。</span><span class="sxs-lookup"><span data-stu-id="147e1-108">Paging and sorting are two very common features when displaying data in an online application.</span></span> <span data-ttu-id="147e1-109">例如，当搜索时在联机书店 ASP.NET 丛书，可能有数百个此类丛书，但此报表列出搜索结果将列出每页的仅十个匹配项。</span><span class="sxs-lookup"><span data-stu-id="147e1-109">For example, when searching for ASP.NET books at an online bookstore, there may be hundreds of such books, but the report listing the search results lists only ten matches per page.</span></span> <span data-ttu-id="147e1-110">此外，可以按标题、 价格、 页计数、 作者姓名等排序结果。</span><span class="sxs-lookup"><span data-stu-id="147e1-110">Moreover, the results can be sorted by title, price, page count, author name, and so on.</span></span> <span data-ttu-id="147e1-111">如我们所述[分页和排序报表数据](../paging-and-sorting/paging-and-sorting-report-data-cs.md)教程，都提供内置的分页支持，还可以启用在一个复选框的刻度线的 GridView、 说明如何和 FormView 控件。</span><span class="sxs-lookup"><span data-stu-id="147e1-111">As we discussed in the [Paging and Sorting Report Data](../paging-and-sorting/paging-and-sorting-report-data-cs.md) tutorial, the GridView, DetailsView, and FormView controls all provide built-in paging support that can be enabled at the tick of a checkbox.</span></span> <span data-ttu-id="147e1-112">GridView 还包括排序支持。</span><span class="sxs-lookup"><span data-stu-id="147e1-112">The GridView also includes sorting support.</span></span>

<span data-ttu-id="147e1-113">遗憾的是，DataList 和转发器都不提供自动分页或排序支持。</span><span class="sxs-lookup"><span data-stu-id="147e1-113">Unfortunately, neither the DataList nor Repeater offer automatic paging or sorting support.</span></span> <span data-ttu-id="147e1-114">在本教程中我们将查看如何将分页支持添加到 DataList 或转发器。</span><span class="sxs-lookup"><span data-stu-id="147e1-114">In this tutorial we'll examine how to add paging support to the DataList or Repeater.</span></span> <span data-ttu-id="147e1-115">我们必须手动创建的分页界面、 显示相应的页面的记录，并记住正在跨回发访问过的网页。</span><span class="sxs-lookup"><span data-stu-id="147e1-115">We must manually create the paging interface, display the appropriate page of records, and remember the page being visited across postbacks.</span></span> <span data-ttu-id="147e1-116">尽管这接受更多时间和代码比使用 GridView、 说明或 FormView，DataList 和转发器允许更灵活的分页和数据显示接口。</span><span class="sxs-lookup"><span data-stu-id="147e1-116">While this does take more time and code than with the GridView, DetailsView, or FormView, the DataList and Repeater allow for much more flexible paging and data display interfaces.</span></span>

> [!NOTE]
> <span data-ttu-id="147e1-117">本教程以独占方式重点分页。</span><span class="sxs-lookup"><span data-stu-id="147e1-117">This tutorial focuses exclusively on paging.</span></span> <span data-ttu-id="147e1-118">在下一教程中，我们将打开我们注意到添加排序功能。</span><span class="sxs-lookup"><span data-stu-id="147e1-118">In the next tutorial we'll turn our attention to adding sorting capabilities.</span></span>


## <a name="step-1-adding-the-paging-and-sorting-tutorial-web-pages"></a><span data-ttu-id="147e1-119">步骤 1： 添加分页和排序教程网页</span><span class="sxs-lookup"><span data-stu-id="147e1-119">Step 1: Adding the Paging and Sorting Tutorial Web Pages</span></span>

<span data-ttu-id="147e1-120">在开始本教程之前，让 s 先花点时间以添加我们需要用于本教程; 下一步的另一个的 ASP.NET 页面。</span><span class="sxs-lookup"><span data-stu-id="147e1-120">Before we start this tutorial, let s first take a moment to add the ASP.NET pages we'll need for this tutorial and the next one.</span></span> <span data-ttu-id="147e1-121">首先创建一个新文件夹中名为的项目`PagingSortingDataListRepeater`。</span><span class="sxs-lookup"><span data-stu-id="147e1-121">Start by creating a new folder in the project named `PagingSortingDataListRepeater`.</span></span> <span data-ttu-id="147e1-122">接下来，将以下五个 ASP.NET 页添加到此文件夹中，让所有的它们配置为使用母版页`Site.master`:</span><span class="sxs-lookup"><span data-stu-id="147e1-122">Next, add the following five ASP.NET pages to this folder, having all of them configured to use the master page `Site.master`:</span></span>

- `Default.aspx`
- `Paging.aspx`
- `Sorting.aspx`
- `SortingWithDefaultPaging.aspx`
- `SortingWithCustomPaging.aspx`


![创建 PagingSortingDataListRepeater 文件夹并添加教程 ASP.NET 页](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image1.png)

<span data-ttu-id="147e1-124">**图 1**： 创建`PagingSortingDataListRepeater`文件夹并添加教程 ASP.NET 页</span><span class="sxs-lookup"><span data-stu-id="147e1-124">**Figure 1**: Create a `PagingSortingDataListRepeater` Folder and Add the Tutorial ASP.NET Pages</span></span>


<span data-ttu-id="147e1-125">接下来，打开`Default.aspx`页上，并将其拖`SectionLevelTutorialListing.ascx`从用户控件`UserControls`到设计图面上的文件夹。</span><span class="sxs-lookup"><span data-stu-id="147e1-125">Next, open the `Default.aspx` page and drag the `SectionLevelTutorialListing.ascx` User Control from the `UserControls` folder onto the Design surface.</span></span> <span data-ttu-id="147e1-126">用户控件中，我们在中创建的[母版页和网站的导航](../introduction/master-pages-and-site-navigation-cs.md)教程中，枚举站点图，并在项目符号列表中的当前节中显示这些教程。</span><span class="sxs-lookup"><span data-stu-id="147e1-126">This User Control, which we created in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial, enumerates the site map and displays those tutorials in the current section in a bulleted list.</span></span>


<span data-ttu-id="147e1-127">[![SectionLevelTutorialListing.ascx 用户控件添加到 Default.aspx](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image3.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="147e1-127">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image3.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image2.png)</span></span>

<span data-ttu-id="147e1-128">**图 2**： 添加`SectionLevelTutorialListing.ascx`用户控件`Default.aspx`([单击以查看实际尺寸的图像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="147e1-128">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image4.png))</span></span>


<span data-ttu-id="147e1-129">为了具有显示分页和排序的教程中我们将创建的项目符号列表，我们需要将它们添加到站点映射。</span><span class="sxs-lookup"><span data-stu-id="147e1-129">In order to have the bulleted list display the paging and sorting tutorials we'll be creating, we need to add them to the site map.</span></span> <span data-ttu-id="147e1-130">打开`Web.sitemap`文件，并替换为 DataList 站点映射节点标记的编辑和删除之后添加以下标记：</span><span class="sxs-lookup"><span data-stu-id="147e1-130">Open the `Web.sitemap` file and add the following markup after the Editing and Deleting with the DataList site map node markup:</span></span>


[!code-xml[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample1.xml)]


![更新包括新的 ASP.NET 页的站点图](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image5.png)

<span data-ttu-id="147e1-132">**图 3**： 更新包括新的 ASP.NET 页的站点图</span><span class="sxs-lookup"><span data-stu-id="147e1-132">**Figure 3**: Update the Site Map to Include the New ASP.NET Pages</span></span>


## <a name="a-review-of-paging"></a><span data-ttu-id="147e1-133">分页一项检查</span><span class="sxs-lookup"><span data-stu-id="147e1-133">A Review of Paging</span></span>

<span data-ttu-id="147e1-134">在前面的教程中，我们已了解如何通过 GridView、 说明如何和 FormView 控件中的数据页上。</span><span class="sxs-lookup"><span data-stu-id="147e1-134">In previous tutorials we saw how to page through the data in the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="147e1-135">这三个控件提供一个简单窗体的分页调用*默认分页*，可以通过只需选中启用分页中的控件 s 智能标记选项来实现。</span><span class="sxs-lookup"><span data-stu-id="147e1-135">These three controls offer a simple form of paging called *default paging* that can be implemented by simply checking the Enable Paging option in the control s smart tag.</span></span> <span data-ttu-id="147e1-136">使用默认分页，每次请求一页数据的第一页上访问或当用户导航到另一页数据 GridView，说明如何，或 FormView 控件重新请求*所有*的中的数据对象数据源。</span><span class="sxs-lookup"><span data-stu-id="147e1-136">With default paging, each time a page of data is requested either on the first page visit or when the user navigates to a different page of data the GridView, DetailsView, or FormView control re-requests *all* of the data from the ObjectDataSource.</span></span> <span data-ttu-id="147e1-137">它然后片段出这组特定的记录，以显示给定请求的页索引和要每页显示的记录数。</span><span class="sxs-lookup"><span data-stu-id="147e1-137">It then snips out the particular set of records to display given the requested page index and the number of records to display per page.</span></span> <span data-ttu-id="147e1-138">我们讨论了中的详细信息中的默认分页[分页和排序报表数据](../paging-and-sorting/paging-and-sorting-report-data-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="147e1-138">We discussed default paging in detail in the [Paging and Sorting Report Data](../paging-and-sorting/paging-and-sorting-report-data-cs.md) tutorial.</span></span>

<span data-ttu-id="147e1-139">由于默认分页重新请求为每个页的所有记录，它是不可行时充分大量的数据进行分页。</span><span class="sxs-lookup"><span data-stu-id="147e1-139">Since default paging re-requests all records for each page, it is not practical when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="147e1-140">例如，假设通过使用页面大小为 10 的 50,000 个记录的分页。</span><span class="sxs-lookup"><span data-stu-id="147e1-140">For example, imagine paging through 50,000 records with a page size of 10.</span></span> <span data-ttu-id="147e1-141">用户移到新的页上，每次必须检索所有 50,000 个记录从数据库中，尽管唯一 10 个，其中会显示。</span><span class="sxs-lookup"><span data-stu-id="147e1-141">Each time the user moves to a new page, all 50,000 records must be retrieved from the database, even though only ten of them are displayed.</span></span>

<span data-ttu-id="147e1-142">*自定义分页*通过抓取仅记录在请求的页面上显示的精确子集解决了默认分页的性能问题。</span><span class="sxs-lookup"><span data-stu-id="147e1-142">*Custom paging* solves the performance concerns of default paging by grabbing only the precise subset of records to display on the requested page.</span></span> <span data-ttu-id="147e1-143">在实现自定义分页时，我们必须编写 SQL 查询将有效地返回只是正确的记录集。</span><span class="sxs-lookup"><span data-stu-id="147e1-143">When implementing custom paging, we must write the SQL query that will efficiently return just the correct set of records.</span></span> <span data-ttu-id="147e1-144">我们已了解如何创建一个查询使用 SQL Server 2005 s 新[`ROW_NUMBER()`关键字](http://www.4guysfromrolla.com/webtech/010406-1.shtml)进来[高效地分页通过大型金额的数据](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="147e1-144">We saw how to create such a query using SQL Server 2005 s new [`ROW_NUMBER()` keyword](http://www.4guysfromrolla.com/webtech/010406-1.shtml) back in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md) tutorial.</span></span>

<span data-ttu-id="147e1-145">若要在 DataList 或转发器控件中实现默认分页，我们可以使用[`PagedDataSource`类](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.aspx)作为周围的包装器`ProductsDataTable`其内容正在通过寻呼发送。</span><span class="sxs-lookup"><span data-stu-id="147e1-145">To implement default paging in the DataList or Repeater controls, we can use the [`PagedDataSource` class](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.aspx) as a wrapper around the `ProductsDataTable` whose contents are being paged.</span></span> <span data-ttu-id="147e1-146">`PagedDataSource`类具有`DataSource`可以分配给任何可枚举对象的属性和[ `PageSize` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.pagesize.aspx)和[ `CurrentPageIndex` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.currentpageindex.aspx)属性用来指示多少条记录到每页的显示和当前的页索引。</span><span class="sxs-lookup"><span data-stu-id="147e1-146">The `PagedDataSource` class has a `DataSource` property that can be assigned to any enumerable object and [`PageSize`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.pagesize.aspx) and [`CurrentPageIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.currentpageindex.aspx) properties that indicate how many records to show per page and the current page index.</span></span> <span data-ttu-id="147e1-147">已设置这些属性之后,`PagedDataSource`可以用作 Web 控件的任何数据的数据源。</span><span class="sxs-lookup"><span data-stu-id="147e1-147">Once these properties have been set, the `PagedDataSource` can be used as the data source of any data Web control.</span></span> <span data-ttu-id="147e1-148">`PagedDataSource`，当枚举时，将只返回其内部的记录的相应子集`DataSource`基于`PageSize`和`CurrentPageIndex`属性。</span><span class="sxs-lookup"><span data-stu-id="147e1-148">The `PagedDataSource`, when enumerated, will only return the appropriate subset of records of its inner `DataSource` based on the `PageSize` and `CurrentPageIndex` properties.</span></span> <span data-ttu-id="147e1-149">图 4 展示了的功能`PagedDataSource`类。</span><span class="sxs-lookup"><span data-stu-id="147e1-149">Figure 4 depicts the functionality of the `PagedDataSource` class.</span></span>


![PagedDataSource 包装具有可分页接口的可枚举对象](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image6.png)

<span data-ttu-id="147e1-151">**图 4**:`PagedDataSource`包装具有可分页接口的可枚举对象</span><span class="sxs-lookup"><span data-stu-id="147e1-151">**Figure 4**: The `PagedDataSource` Wraps an Enumerable Object with a Pageable Interface</span></span>


<span data-ttu-id="147e1-152">`PagedDataSource`对象可以是创建和配置直接从业务逻辑层和绑定到 DataList 或转发器通过对象数据源，或可以创建和配置 ASP.NET 页面的代码隐藏类中直接。</span><span class="sxs-lookup"><span data-stu-id="147e1-152">The `PagedDataSource` object can be created and configured directly from the Business Logic Layer and bound to a DataList or Repeater through an ObjectDataSource, or can be created and configured directly in the ASP.NET page s code-behind class.</span></span> <span data-ttu-id="147e1-153">如果使用后一种方法，我们必须放弃使用对象数据源，并改为将分页的数据绑定到 DataList 或转发器以编程方式。</span><span class="sxs-lookup"><span data-stu-id="147e1-153">If the latter approach is used, we must forgo using the ObjectDataSource and instead bind the paged data to the DataList or Repeater programmatically.</span></span>

<span data-ttu-id="147e1-154">`PagedDataSource`对象还具有属性，以支持自定义分页。</span><span class="sxs-lookup"><span data-stu-id="147e1-154">The `PagedDataSource` object also has properties to support custom paging.</span></span> <span data-ttu-id="147e1-155">但是，我们可以绕过使用`PagedDataSource`的自定义分页，因为我们在已有 BLL 方法`ProductsBLL`用于返回精确的记录，若要显示的自定义分页的类。</span><span class="sxs-lookup"><span data-stu-id="147e1-155">However, we can bypass using a `PagedDataSource` for custom paging because we already have BLL methods in the `ProductsBLL` class designed for custom paging that return the precise records to display.</span></span>

<span data-ttu-id="147e1-156">在本教程中我们将查看通过添加一个新方法中 DataList 实现默认分页`ProductsBLL`返回进行了适当配置的类`PagedDataSource`对象。</span><span class="sxs-lookup"><span data-stu-id="147e1-156">In this tutorial we'll look at implementing default paging in a DataList by adding a new method to the `ProductsBLL` class that returns an appropriately configured `PagedDataSource` object.</span></span> <span data-ttu-id="147e1-157">在下一步的教程中，我们将了解如何使用自定义分页。</span><span class="sxs-lookup"><span data-stu-id="147e1-157">In the next tutorial, we'll see how to use custom paging.</span></span>

## <a name="step-2-adding-a-default-paging-method-in-the-business-logic-layer"></a><span data-ttu-id="147e1-158">步骤 2： 在业务逻辑层中添加默认分页方法</span><span class="sxs-lookup"><span data-stu-id="147e1-158">Step 2: Adding a Default Paging Method in the Business Logic Layer</span></span>

<span data-ttu-id="147e1-159">`ProductsBLL`类当前具有返回所有产品信息的方法`GetProducts()`，另一个用于都返回起始索引处的产品的特定子集`GetProductsPaged(startRowIndex, maximumRows)`。</span><span class="sxs-lookup"><span data-stu-id="147e1-159">The `ProductsBLL` class currently has a method for returning all product information `GetProducts()` and one for returning a particular subset of products at a starting index `GetProductsPaged(startRowIndex, maximumRows)`.</span></span> <span data-ttu-id="147e1-160">使用默认分页的 GridView，说明如何和 FormView 控制所有使用`GetProducts()`方法来检索所有产品，但然后使用`PagedDataSource`内部以显示仅记录的正确子集。</span><span class="sxs-lookup"><span data-stu-id="147e1-160">With default paging, the GridView, DetailsView, and FormView controls all use the `GetProducts()` method to retrieve all products, but then use a `PagedDataSource` internally to display only the correct subset of records.</span></span> <span data-ttu-id="147e1-161">若要复制此功能，带有 DataList 和转发器控件，我们可以在模仿此行为 BLL 中创建一个新方法。</span><span class="sxs-lookup"><span data-stu-id="147e1-161">To replicate this functionality with the DataList and Repeater controls, we can create a new method in the BLL that mimics this behavior.</span></span>

<span data-ttu-id="147e1-162">将方法添加到`ProductsBLL`类名为`GetProductsAsPagedDataSource`采用在两个整数的输入参数：</span><span class="sxs-lookup"><span data-stu-id="147e1-162">Add a method to the `ProductsBLL` class named `GetProductsAsPagedDataSource` that takes in two integer input parameters:</span></span>

- <span data-ttu-id="147e1-163">`pageIndex` 若要显示，页的索引索引为零，并</span><span class="sxs-lookup"><span data-stu-id="147e1-163">`pageIndex` the index of the page to display, indexed at zero, and</span></span>
- <span data-ttu-id="147e1-164">`pageSize` 要显示每页的记录数。</span><span class="sxs-lookup"><span data-stu-id="147e1-164">`pageSize` the number of records to display per page.</span></span>

<span data-ttu-id="147e1-165">`GetProductsAsPagedDataSource` 通过检索启动*所有*的从记录`GetProducts()`。</span><span class="sxs-lookup"><span data-stu-id="147e1-165">`GetProductsAsPagedDataSource` starts by retrieving *all* of the records from `GetProducts()`.</span></span> <span data-ttu-id="147e1-166">然后，它创建`PagedDataSource`对象，并设置其`CurrentPageIndex`和`PageSize`属性的值传入的`pageIndex`和`pageSize`参数。</span><span class="sxs-lookup"><span data-stu-id="147e1-166">It then creates a `PagedDataSource` object, setting its `CurrentPageIndex` and `PageSize` properties to the values of the passed-in `pageIndex` and `pageSize` parameters.</span></span> <span data-ttu-id="147e1-167">该方法最后返回此进行配置`PagedDataSource`:</span><span class="sxs-lookup"><span data-stu-id="147e1-167">The method concludes by returning this configured `PagedDataSource`:</span></span>


[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample2.cs)]

## <a name="step-3-displaying-product-information-in-a-datalist-using-default-paging"></a><span data-ttu-id="147e1-168">步骤 3： 在使用默认分页 DataList 中显示产品信息</span><span class="sxs-lookup"><span data-stu-id="147e1-168">Step 3: Displaying Product Information in a DataList Using Default Paging</span></span>

<span data-ttu-id="147e1-169">与`GetProductsAsPagedDataSource`方法添加到`ProductsBLL`类，我们现在可以创建 DataList 或提供默认分页的转发器。</span><span class="sxs-lookup"><span data-stu-id="147e1-169">With the `GetProductsAsPagedDataSource` method added to the `ProductsBLL` class, we can now create a DataList or Repeater that provides default paging.</span></span> <span data-ttu-id="147e1-170">首先打开`Paging.aspx`页面`PagingSortingDataListRepeater`文件夹，然后从工具箱中拖动到设计器中，设置 DataList 的拖动 DataList`ID`属性`ProductsDefaultPaging`。</span><span class="sxs-lookup"><span data-stu-id="147e1-170">Start by opening the `Paging.aspx` page in the `PagingSortingDataListRepeater` folder and drag a DataList from the Toolbox onto the Designer, setting the DataList s `ID` property to `ProductsDefaultPaging`.</span></span> <span data-ttu-id="147e1-171">从 DataList s 智能标记，创建名为新 ObjectDataSource`ProductsDefaultPagingDataSource`并将其配置，以便它检索数据使用`GetProductsAsPagedDataSource`方法。</span><span class="sxs-lookup"><span data-stu-id="147e1-171">From the DataList s smart tag, create a new ObjectDataSource named `ProductsDefaultPagingDataSource` and configure it so that it retrieves data using the `GetProductsAsPagedDataSource` method.</span></span>


<span data-ttu-id="147e1-172">[![创建 ObjectDataSource 并将其配置为使用 GetProductsAsPagedDataSource （） 方法](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image8.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="147e1-172">[![Create an ObjectDataSource and Configure it to Use the GetProductsAsPagedDataSource () Method](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image8.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image7.png)</span></span>

<span data-ttu-id="147e1-173">**图 5**： 创建对象数据源并将它配置为使用`GetProductsAsPagedDataSource``()`方法 ([单击以查看实际尺寸的图像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="147e1-173">**Figure 5**: Create an ObjectDataSource and Configure it to Use the `GetProductsAsPagedDataSource` `()` Method ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image9.png))</span></span>


<span data-ttu-id="147e1-174">在更新中，INSERT、 设置的下拉列表和删除选项卡添加到 （无）。</span><span class="sxs-lookup"><span data-stu-id="147e1-174">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="147e1-175">[![在更新中，INSERT、 设置下拉列表将列出和删除选项卡添加到 （无）](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image11.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="147e1-175">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE tabs to (None)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image11.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image10.png)</span></span>

<span data-ttu-id="147e1-176">**图 6**： 在更新中，INSERT、 设置下拉列表将列出和删除选项卡添加到 （无） ([单击以查看实际尺寸的图像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="147e1-176">**Figure 6**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE tabs to (None) ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image12.png))</span></span>


<span data-ttu-id="147e1-177">由于`GetProductsAsPagedDataSource`方法需要两个输入的参数，该向导将提示我们为这些参数值的源。</span><span class="sxs-lookup"><span data-stu-id="147e1-177">Since the `GetProductsAsPagedDataSource` method expects two input parameters, the wizard prompts us for the source of these parameter values.</span></span>

<span data-ttu-id="147e1-178">必须在回发记住的页索引和页大小的值。</span><span class="sxs-lookup"><span data-stu-id="147e1-178">The page index and page size values must be remembered across postbacks.</span></span> <span data-ttu-id="147e1-179">它们可以存储在视图状态、 保存到查询字符串、 存储在会话变量或记住使用其他方法。</span><span class="sxs-lookup"><span data-stu-id="147e1-179">They can be stored in view state, persisted to the querystring, stored in session variables, or remembered using some other technique.</span></span> <span data-ttu-id="147e1-180">对于本教程中，我们将使用查询字符串，它具有要将标有书签的数据的特定页的优势。</span><span class="sxs-lookup"><span data-stu-id="147e1-180">For this tutorial we'll use the querystring, which has the advantage of allowing a particular page of data to be bookmarked.</span></span>

<span data-ttu-id="147e1-181">具体而言，使用的查询字符串字段 pageIndex 和有关的 pageSize`pageIndex`和`pageSize`参数，分别 （请参阅图 7）。</span><span class="sxs-lookup"><span data-stu-id="147e1-181">In particular, use the querystring fields pageIndex and pageSize for the `pageIndex` and `pageSize` parameters, respectively (see Figure 7).</span></span> <span data-ttu-id="147e1-182">需要一段时间来设置这些参数的默认值，如下图所获胜 t 的查询字符串值时必须存在的用户首次访问此页。</span><span class="sxs-lookup"><span data-stu-id="147e1-182">Take a moment to set the default values for these parameters, as the querystring values won t be present when a user first visits this page.</span></span> <span data-ttu-id="147e1-183">有关`pageIndex`，设置默认值为 0 （这将显示数据的第一页） 和`pageSize`的默认值为 4。</span><span class="sxs-lookup"><span data-stu-id="147e1-183">For `pageIndex`, set the default value to 0 (which will show the first page of data) and `pageSize` s default value to 4.</span></span>


<span data-ttu-id="147e1-184">[![使用查询字符串作为源的 pageIndex 和 pageSize 参数](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image14.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="147e1-184">[![Use the QueryString as the Source for the pageIndex and pageSize Parameters](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image14.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image13.png)</span></span>

<span data-ttu-id="147e1-185">**图 7**： 查询字符串用作源`pageIndex`和`pageSize`参数 ([单击以查看实际尺寸的图像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="147e1-185">**Figure 7**: Use the QueryString as the Source for the `pageIndex` and `pageSize` Parameters ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image15.png))</span></span>


<span data-ttu-id="147e1-186">在配置对象数据源后，Visual Studio 自动创建`ItemTemplate`DataList 有关。</span><span class="sxs-lookup"><span data-stu-id="147e1-186">After configuring the ObjectDataSource, Visual Studio automatically creates an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="147e1-187">自定义`ItemTemplate`以便显示产品的名称、 类别和供应商。</span><span class="sxs-lookup"><span data-stu-id="147e1-187">Customize the `ItemTemplate` so that only the product s name, category, and supplier are shown.</span></span> <span data-ttu-id="147e1-188">此外设置 DataList s`RepeatColumns`属性设置为 2，其`Width`为 100%，并将其`ItemStyle`s`Width`至 50%。</span><span class="sxs-lookup"><span data-stu-id="147e1-188">Also set the DataList s `RepeatColumns` property to 2, its `Width` to 100%, and its `ItemStyle` s `Width` to 50%.</span></span> <span data-ttu-id="147e1-189">这些宽度设置将提供两个列的间距相等。</span><span class="sxs-lookup"><span data-stu-id="147e1-189">These width settings will provide equal spacing for the two columns.</span></span>

<span data-ttu-id="147e1-190">进行这些更改后，DataList 和 ObjectDataSource 的标记应类似于以下：</span><span class="sxs-lookup"><span data-stu-id="147e1-190">After making these changes, the DataList and ObjectDataSource s markup should look similar to the following:</span></span>


[!code-aspx[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample3.aspx)]

> [!NOTE]
> <span data-ttu-id="147e1-191">由于我们并不执行任何更新或删除功能在本教程中，你可以通过禁用 DataList 的视图状态，以减少呈现的页面大小。</span><span class="sxs-lookup"><span data-stu-id="147e1-191">Since we are not performing any update or delete functionality in this tutorial, you may disable the DataList s view state to reduce the rendered page size.</span></span>


<span data-ttu-id="147e1-192">在最初两者访问通过浏览器，此页时`pageIndex`也不`pageSize`提供查询字符串参数。</span><span class="sxs-lookup"><span data-stu-id="147e1-192">When initially visiting this page through a browser, neither the `pageIndex` nor `pageSize` querystring parameters are provided.</span></span> <span data-ttu-id="147e1-193">因此，使用默认值为 0 和 4。</span><span class="sxs-lookup"><span data-stu-id="147e1-193">Hence, the default values of 0 and 4 are used.</span></span> <span data-ttu-id="147e1-194">如图 8 所示，这将导致显示的前四个产品 DataList。</span><span class="sxs-lookup"><span data-stu-id="147e1-194">As Figure 8 shows, this results in a DataList that displays the first four products.</span></span>


<span data-ttu-id="147e1-195">[![列出了第一个四个产品](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image17.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="147e1-195">[![The First Four Products are Listed](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image17.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image16.png)</span></span>

<span data-ttu-id="147e1-196">**图 8**： 列出的第一个四个产品 ([单击以查看实际尺寸的图像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="147e1-196">**Figure 8**: The First Four Products are Listed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image18.png))</span></span>


<span data-ttu-id="147e1-197">没有用户导航到数据的第二页意味着分页接口，那里 s 当前不简单。</span><span class="sxs-lookup"><span data-stu-id="147e1-197">Without a paging interface, there s currently no straightforward means for a user to navigate to the second page of data.</span></span> <span data-ttu-id="147e1-198">我们将在步骤 4 中创建分页接口。</span><span class="sxs-lookup"><span data-stu-id="147e1-198">We'll create a paging interface in step 4.</span></span> <span data-ttu-id="147e1-199">现在，不过，分页仅可通过直接在查询字符串中指定的分页条件。</span><span class="sxs-lookup"><span data-stu-id="147e1-199">For now, though, paging can only be accomplished by directly specifying the paging criteria in the querystring.</span></span> <span data-ttu-id="147e1-200">例如，若要查看的第二页，更改从浏览器的地址栏中的 URL`Paging.aspx`到`Paging.aspx?pageIndex=2`然后按 Enter。</span><span class="sxs-lookup"><span data-stu-id="147e1-200">For example, to view the second page, change the URL in the browser s Address bar from `Paging.aspx` to `Paging.aspx?pageIndex=2` and hit Enter.</span></span> <span data-ttu-id="147e1-201">这将导致要显示数据的第二页 （请参阅图 9）。</span><span class="sxs-lookup"><span data-stu-id="147e1-201">This causes the second page of data to be displayed (see Figure 9).</span></span>


<span data-ttu-id="147e1-202">[![显示第二个数据页](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image20.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="147e1-202">[![The Second Page of Data is Displayed](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image20.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image19.png)</span></span>

<span data-ttu-id="147e1-203">**图 9**： 显示第二个页面的数据 ([单击以查看实际尺寸的图像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="147e1-203">**Figure 9**: The Second Page of Data is Displayed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image21.png))</span></span>


## <a name="step-4-creating-the-paging-interface"></a><span data-ttu-id="147e1-204">步骤 4： 创建分页接口</span><span class="sxs-lookup"><span data-stu-id="147e1-204">Step 4: Creating the Paging Interface</span></span>

<span data-ttu-id="147e1-205">有各种不同的分页接口，可以实现。</span><span class="sxs-lookup"><span data-stu-id="147e1-205">There are a variety of different paging interfaces that can be implemented.</span></span> <span data-ttu-id="147e1-206">GridView、 说明如何和 FormView 控件提供四个不同的接口之间进行选择：</span><span class="sxs-lookup"><span data-stu-id="147e1-206">The GridView, DetailsView, and FormView controls provide four different interfaces to choose among:</span></span>

- <span data-ttu-id="147e1-207">**下一步、 上一条**用户，到下一个或上一次移动一个页。</span><span class="sxs-lookup"><span data-stu-id="147e1-207">**Next, Previous** users can move one page at a time, to either the next or previous one.</span></span>
- <span data-ttu-id="147e1-208">**下一步上, 一步，首先，最后**除了下一步和上一步按钮，该接口包括用于移动到第一个或最后一页的第一个和最后一个按钮。</span><span class="sxs-lookup"><span data-stu-id="147e1-208">**Next, Previous, First, Last** in addition to Next and Previous buttons, this interface includes First and Last buttons for moving to the very first or very last page.</span></span>
- <span data-ttu-id="147e1-209">**数值**列出中的页码的分页界面，允许用户快速跳转到特定页。</span><span class="sxs-lookup"><span data-stu-id="147e1-209">**Numeric** lists the page numbers in the paging interface, allowing a user to quickly jump to a particular page.</span></span>
- <span data-ttu-id="147e1-210">**数字，首先，最后**数值的页码，除了包括用于移动到第一个或最后一页的按钮。</span><span class="sxs-lookup"><span data-stu-id="147e1-210">**Numeric, First, Last** in addition to the numeric page numbers, includes buttons for moving to the very first or very last page.</span></span>

<span data-ttu-id="147e1-211">DataList 和转发器中，为我们负责决定在分页接口和实现它。</span><span class="sxs-lookup"><span data-stu-id="147e1-211">For the DataList and Repeater, we are responsible for deciding upon a paging interface and implementing it.</span></span> <span data-ttu-id="147e1-212">这涉及到创建所需的 Web 控件在页和单击特定的分页接口按钮时显示请求的页。</span><span class="sxs-lookup"><span data-stu-id="147e1-212">This involves creating the needed Web controls in the page and displaying the requested page when a particular paging interface button is clicked.</span></span> <span data-ttu-id="147e1-213">此外，某些分页界面控件可能需要禁用。</span><span class="sxs-lookup"><span data-stu-id="147e1-213">Additionally, certain paging interface controls may need to be disabled.</span></span> <span data-ttu-id="147e1-214">例如，查看时使用下一个数据的第一页上, 一步，首先，上次接口，第一个和上一步按钮将被禁用。</span><span class="sxs-lookup"><span data-stu-id="147e1-214">For example, when viewing the first page of data using the Next, Previous, First, Last interface, both the First and Previous buttons would be disabled.</span></span>

<span data-ttu-id="147e1-215">对于本教程，让的 s 使用下一步上, 一步，首先，最后的接口。</span><span class="sxs-lookup"><span data-stu-id="147e1-215">For this tutorial, let s use the Next, Previous, First, Last interface.</span></span> <span data-ttu-id="147e1-216">向页面添加四个按钮 Web 控件并设置其`ID`到`FirstPage`， `PrevPage`， `NextPage`，和`LastPage`。</span><span class="sxs-lookup"><span data-stu-id="147e1-216">Add four Button Web controls to the page and set their `ID` s to `FirstPage`, `PrevPage`, `NextPage`, and `LastPage`.</span></span> <span data-ttu-id="147e1-217">设置`Text`属性设置为&lt;&lt;第一个，&lt;上一步、 下一步&gt;，和最后一个&gt; &gt; 。</span><span class="sxs-lookup"><span data-stu-id="147e1-217">Set the `Text` properties to &lt;&lt; First, &lt; Prev, Next &gt;, and Last &gt;&gt; .</span></span>


[!code-aspx[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample4.aspx)]

<span data-ttu-id="147e1-218">接下来，创建`Click`为每个这些按钮的事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="147e1-218">Next, create a `Click` event handler for each of these Buttons.</span></span> <span data-ttu-id="147e1-219">在稍后我们将添加需显示请求的页的代码。</span><span class="sxs-lookup"><span data-stu-id="147e1-219">In a moment we'll add the code necessary to display the requested page.</span></span>

## <a name="remembering-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="147e1-220">记住正在通过寻呼发送到的记录的总数</span><span class="sxs-lookup"><span data-stu-id="147e1-220">Remembering the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="147e1-221">无论选择的分页界面，我们需要计算并记住的正在通过寻呼发送到的记录总数。</span><span class="sxs-lookup"><span data-stu-id="147e1-221">Regardless of the paging interface selected, we need to compute and remember the total number of records being paged through.</span></span> <span data-ttu-id="147e1-222">总行数 （结合使用页面大小） 确定的数据的多少总页数正在通过寻呼发送通过，它确定分页界面控件添加或启用。</span><span class="sxs-lookup"><span data-stu-id="147e1-222">The total row count (in conjunction with the page size) determines how many total pages of data are being paged through, which determines what paging interface controls are added or are enabled.</span></span> <span data-ttu-id="147e1-223">在下一步、 上一步、 第一个中，最后一个接口，我们要生成的页计数是两种方式使用：</span><span class="sxs-lookup"><span data-stu-id="147e1-223">In the Next, Previous, First, Last interface that we are building, the page count is used in two ways:</span></span>

- <span data-ttu-id="147e1-224">若要确定是否我们正在查看的最后一页，在这种情况下禁用下一步和最后一个按钮。</span><span class="sxs-lookup"><span data-stu-id="147e1-224">To determine whether we are viewing the last page, in which case the Next and Last buttons are disabled.</span></span>
- <span data-ttu-id="147e1-225">如果用户单击到最后一个 whisk 它们，我们需要最后一个按钮页上，其索引是一种小于页计数。</span><span class="sxs-lookup"><span data-stu-id="147e1-225">If the user clicks the Last button we need to whisk them to the last page, whose index is one less than the page count.</span></span>

<span data-ttu-id="147e1-226">如总行数的上限除以页大小计算页计数。</span><span class="sxs-lookup"><span data-stu-id="147e1-226">The page count is calculated as the ceiling of the total row count divided by the page size.</span></span> <span data-ttu-id="147e1-227">例如，如果我们分页 79 记录每页的四个记录，然后页计数为 20 (79 上限 / 4)。</span><span class="sxs-lookup"><span data-stu-id="147e1-227">For example, if we are paging through 79 records with four records per page, then the page count is 20 (the ceiling of 79 / 4).</span></span> <span data-ttu-id="147e1-228">如果我们使用数字分页接口时，此信息通知我们并显示; 多少数字寻呼按钮如果我们分页接口包括下一步或上一次按钮，，用于确定何时要禁用下一步或上一次按钮页计数。</span><span class="sxs-lookup"><span data-stu-id="147e1-228">If we are using the Numeric paging interface, this information informs us as to how many numeric page buttons to display; if our paging interface includes Next or Last buttons, the page count is used to determine when to disable the Next or Last buttons.</span></span>

<span data-ttu-id="147e1-229">如果分页接口包含最后一个按钮，则命令性，以便当最后一个按钮被单击时我们可以确定最后一个的页索引，在回发记住的正在通过寻呼发送到的记录总数。</span><span class="sxs-lookup"><span data-stu-id="147e1-229">If the paging interface includes a Last button, it is imperative that the total number of records being paged through be remembered across postbacks so that when the Last button is clicked we can determine the last page index.</span></span> <span data-ttu-id="147e1-230">若要为此，创建`TotalRowCount`仍然存在其值可查看状态 ASP.NET 页的代码隐藏类中的属性：</span><span class="sxs-lookup"><span data-stu-id="147e1-230">To facilitate this, create a `TotalRowCount` property in the ASP.NET page s code-behind class that persists its value to view state:</span></span>


[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample5.cs)]

<span data-ttu-id="147e1-231">除了`TotalRowCount`、 花点时间查看创建用于轻松地访问页索引、 页大小的只读的页级别的属性和页计数：</span><span class="sxs-lookup"><span data-stu-id="147e1-231">In addition to `TotalRowCount`, take a minute to create read-only page-level properties for easily accessing the page index, page size, and page count:</span></span>


[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample6.cs)]

## <a name="determining-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="147e1-232">确定正在通过寻呼发送到的记录总数</span><span class="sxs-lookup"><span data-stu-id="147e1-232">Determining the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="147e1-233">`PagedDataSource`对象从 ObjectDataSource s 返回`Select()`方法已在其中*所有*条产品记录，即使它们的一个子集显示在 DataList。</span><span class="sxs-lookup"><span data-stu-id="147e1-233">The `PagedDataSource` object returned from the ObjectDataSource s `Select()` method has within it *all* of the product records, even though only a subset of them are displayed in the DataList.</span></span> <span data-ttu-id="147e1-234">`PagedDataSource` S [ `Count`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.count.aspx)只返回数的项将显示在 DataList; [ `DataSourceCount`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.datasourcecount.aspx)返回中的项的总数`PagedDataSource`.</span><span class="sxs-lookup"><span data-stu-id="147e1-234">The `PagedDataSource` s [`Count` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.count.aspx) returns only the number of items that will be displayed in the DataList; the [`DataSourceCount` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.datasourcecount.aspx) returns the total number of items within the `PagedDataSource`.</span></span> <span data-ttu-id="147e1-235">因此，我们需要分配 ASP.NET 页 s`TotalRowCount`属性值的`PagedDataSource`s`DataSourceCount`属性。</span><span class="sxs-lookup"><span data-stu-id="147e1-235">Therefore, we need to assign the ASP.NET page s `TotalRowCount` property the value of the `PagedDataSource` s `DataSourceCount` property.</span></span>

<span data-ttu-id="147e1-236">若要实现此目的，创建的事件处理程序 ObjectDataSource 的`Selected`事件。</span><span class="sxs-lookup"><span data-stu-id="147e1-236">To accomplish this, create an event handler for the ObjectDataSource s `Selected` event.</span></span> <span data-ttu-id="147e1-237">在`Selected`我们有权访问 ObjectDataSource s 的返回值的事件处理程序`Select()`方法在此情况下， `PagedDataSource`。</span><span class="sxs-lookup"><span data-stu-id="147e1-237">In the `Selected` event handler we have access to the return value of the ObjectDataSource s `Select()` method in this case, the `PagedDataSource`.</span></span>


[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample7.cs)]

## <a name="displaying-the-requested-page-of-data"></a><span data-ttu-id="147e1-238">显示请求的数据页</span><span class="sxs-lookup"><span data-stu-id="147e1-238">Displaying the Requested Page of Data</span></span>

<span data-ttu-id="147e1-239">当用户单击分页接口中的按钮之一时，我们需要显示请求的数据页。</span><span class="sxs-lookup"><span data-stu-id="147e1-239">When the user clicks one of the buttons in the paging interface, we need to display the requested page of data.</span></span> <span data-ttu-id="147e1-240">由于分页参数通过指定查询字符串，以显示数据使用的请求的页面`Response.Redirect(url)`具有用户 s 浏览器重新请求`Paging.aspx`结合适当的分页参数的页。</span><span class="sxs-lookup"><span data-stu-id="147e1-240">Since the paging parameters are specified via the querystring, to show the requested page of data use `Response.Redirect(url)` to have the user s browser re-request the `Paging.aspx` page with the appropriate paging parameters.</span></span> <span data-ttu-id="147e1-241">例如，若要显示的数据的第二页，我们会将用户重定向到`Paging.aspx?pageIndex=1`。</span><span class="sxs-lookup"><span data-stu-id="147e1-241">For example, to display the second page of data, we would redirect the user to `Paging.aspx?pageIndex=1`.</span></span>

<span data-ttu-id="147e1-242">若要为此，创建`RedirectUser(sendUserToPageIndex)`方法，将重定向到用户`Paging.aspx?pageIndex=sendUserToPageIndex`。</span><span class="sxs-lookup"><span data-stu-id="147e1-242">To facilitate this, create a `RedirectUser(sendUserToPageIndex)` method that redirects the user to `Paging.aspx?pageIndex=sendUserToPageIndex`.</span></span> <span data-ttu-id="147e1-243">然后，从四个按钮调用此方法`Click`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="147e1-243">Then, call this method from the four Button `Click` event handlers.</span></span> <span data-ttu-id="147e1-244">在`FirstPage``Click`事件处理程序，请调用`RedirectUser(0)`，以将其发送到第一页; 在`PrevPage``Click`事件处理程序中，使用`PageIndex - 1`页索引中; 为，依此类推。</span><span class="sxs-lookup"><span data-stu-id="147e1-244">In the `FirstPage` `Click` event handler, call `RedirectUser(0)`, to send them to the first page; in the `PrevPage` `Click` event handler, use `PageIndex - 1` as the page index; and so on.</span></span>


[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample8.cs)]

<span data-ttu-id="147e1-245">与`Click`事件处理程序完成，DataList 的记录可以通过单击的按钮分页通过。</span><span class="sxs-lookup"><span data-stu-id="147e1-245">With the `Click` event handlers complete, the DataList s records can be paged through by clicking the buttons.</span></span> <span data-ttu-id="147e1-246">花一些时间来试试看 ！</span><span class="sxs-lookup"><span data-stu-id="147e1-246">Take a moment to try it out!</span></span>

## <a name="disabling-paging-interface-controls"></a><span data-ttu-id="147e1-247">禁用分页界面控件</span><span class="sxs-lookup"><span data-stu-id="147e1-247">Disabling Paging Interface Controls</span></span>

<span data-ttu-id="147e1-248">目前，所有四个按钮而不考虑查看的页的启用。</span><span class="sxs-lookup"><span data-stu-id="147e1-248">Currently, all four buttons are enabled regardless of the page being viewed.</span></span> <span data-ttu-id="147e1-249">但是，我们想要禁用的第一个和上一步按钮时显示的最后一页时显示的数据，以及下一步和最后一个按钮的第一页。</span><span class="sxs-lookup"><span data-stu-id="147e1-249">However, we want to disable the First and Previous buttons when showing the first page of data, and the Next and Last buttons when showing the last page.</span></span> <span data-ttu-id="147e1-250">`PagedDataSource`返回 ObjectDataSource 的对象`Select()`方法具有属性[ `IsFirstPage` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.isfirstpage.aspx)和[ `IsLastPage` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.islastpage.aspx) ，我们可以检查以确定是否我们正在查看数据的第一个或最后一页。</span><span class="sxs-lookup"><span data-stu-id="147e1-250">The `PagedDataSource` object returned by the ObjectDataSource s `Select()` method has properties [`IsFirstPage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.isfirstpage.aspx) and [`IsLastPage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.islastpage.aspx) that we can examine to determine if we are viewing the first or last page of data.</span></span>

<span data-ttu-id="147e1-251">将以下代码添加到 ObjectDataSource 的`Selected`事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="147e1-251">Add the following to the ObjectDataSource s `Selected` event handler:</span></span>


[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample9.cs)]

<span data-ttu-id="147e1-252">添加此元素后，查看第一页中，负载测试时查看的最后一页时，将禁用下一步和最后一个按钮时，将禁用第一个和上一步按钮。</span><span class="sxs-lookup"><span data-stu-id="147e1-252">With this addition, the First and Previous buttons will be disabled when viewing the first page, while the Next and Last buttons will be disabled when viewing the last page.</span></span>

<span data-ttu-id="147e1-253">允许 s 完成分页接口通过告知用户哪一页它们重新当前正在查看和存在多少总页数。</span><span class="sxs-lookup"><span data-stu-id="147e1-253">Let s complete the paging interface by informing the user what page they re currently viewing and how many total pages exist.</span></span> <span data-ttu-id="147e1-254">向页面添加标签 Web 控件并设置其`ID`属性`CurrentPageNumber`。</span><span class="sxs-lookup"><span data-stu-id="147e1-254">Add a Label Web control to the page and set its `ID` property to `CurrentPageNumber`.</span></span> <span data-ttu-id="147e1-255">设置其`Text`ObjectDataSource s 所选事件处理程序中此类的属性，它包含当前正在查看的页 (`PageIndex + 1`) 和总页数 (`PageCount`)。</span><span class="sxs-lookup"><span data-stu-id="147e1-255">Set its `Text` property in the ObjectDataSource s Selected event handler such that it includes the current page being viewed (`PageIndex + 1`) and the total number of pages (`PageCount`).</span></span>


[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample10.cs)]

<span data-ttu-id="147e1-256">图 10 显示`Paging.aspx`时首次访问。</span><span class="sxs-lookup"><span data-stu-id="147e1-256">Figure 10 shows `Paging.aspx` when first visited.</span></span> <span data-ttu-id="147e1-257">DataList 因为查询字符串为空，默认为显示的前四个产品;第一个和上一步按钮被禁用。</span><span class="sxs-lookup"><span data-stu-id="147e1-257">Since the querystring is empty, the DataList defaults to showing the first four products; the First and Previous buttons are disabled.</span></span> <span data-ttu-id="147e1-258">单击下一步显示 （请参阅图 11） 的下一步四个记录;第一个和上一步按钮现已启用。</span><span class="sxs-lookup"><span data-stu-id="147e1-258">Clicking Next displays the next four records (see Figure 11); the First and Previous buttons are now enabled.</span></span>


<span data-ttu-id="147e1-259">[![显示第一个数据页](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image23.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="147e1-259">[![The First Page of Data is Displayed](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image23.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image22.png)</span></span>

<span data-ttu-id="147e1-260">**图 10**： 第一页的显示数据时 ([单击以查看实际尺寸的图像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="147e1-260">**Figure 10**: The First Page of Data is Displayed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image24.png))</span></span>


<span data-ttu-id="147e1-261">[![显示第二个数据页](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image26.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="147e1-261">[![The Second Page of Data is Displayed](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image26.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image25.png)</span></span>

<span data-ttu-id="147e1-262">**图 11**： 显示第二个页面的数据 ([单击以查看实际尺寸的图像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="147e1-262">**Figure 11**: The Second Page of Data is Displayed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image27.png))</span></span>


> [!NOTE]
> <span data-ttu-id="147e1-263">可以进一步增强分页接口，通过允许用户指定多少页来查看每页。</span><span class="sxs-lookup"><span data-stu-id="147e1-263">The paging interface can be further enhanced by allowing the user to specify how many pages to view per page.</span></span> <span data-ttu-id="147e1-264">例如，DropDownList 无法添加列表类似 5、 10、 25，50，和所有的页面大小选项。</span><span class="sxs-lookup"><span data-stu-id="147e1-264">For example, a DropDownList could be added listing page size options like 5, 10, 25, 50, and All.</span></span> <span data-ttu-id="147e1-265">在选择的页大小，用户将需要重定向回`Paging.aspx?pageIndex=0&pageSize=selectedPageSize`。</span><span class="sxs-lookup"><span data-stu-id="147e1-265">Upon selecting a page size, the user would need to be redirected back to `Paging.aspx?pageIndex=0&pageSize=selectedPageSize`.</span></span> <span data-ttu-id="147e1-266">我将保留为读取器为实现此增强功能。</span><span class="sxs-lookup"><span data-stu-id="147e1-266">I leave implementing this enhancement as an exercise for the reader.</span></span>


## <a name="using-custom-paging"></a><span data-ttu-id="147e1-267">使用自定义分页</span><span class="sxs-lookup"><span data-stu-id="147e1-267">Using Custom Paging</span></span>

<span data-ttu-id="147e1-268">通过使用效率低下的默认分页技术其数据 DataList 页中。</span><span class="sxs-lookup"><span data-stu-id="147e1-268">The DataList pages through its data using the inefficient default paging technique.</span></span> <span data-ttu-id="147e1-269">当足够大，大量数据进行分页时, 是命令性，使用自定义分页。</span><span class="sxs-lookup"><span data-stu-id="147e1-269">When paging through sufficiently large amounts of data, it is imperative that custom paging be used.</span></span> <span data-ttu-id="147e1-270">尽管略有不同的实现详细信息，在 DataList 中实现自定义分页背后的概念并使用默认分页相同。</span><span class="sxs-lookup"><span data-stu-id="147e1-270">Although the implementation details differ slightly, the concepts behind implementing custom paging in a DataList are the same as with default paging.</span></span> <span data-ttu-id="147e1-271">使用自定义分页，使用`ProductBLL`类 s`GetProductsPaged`方法 (而不是`GetProductsAsPagedDataSource`)。</span><span class="sxs-lookup"><span data-stu-id="147e1-271">With custom paging, use the `ProductBLL` class s `GetProductsPaged` method (instead of `GetProductsAsPagedDataSource`).</span></span> <span data-ttu-id="147e1-272">中所述[高效地分页通过大型金额的数据](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md)教程中，`GetProductsPaged`必须传递要返回的行开始行索引和最大值数。</span><span class="sxs-lookup"><span data-stu-id="147e1-272">As discussed in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md) tutorial, `GetProductsPaged` must be passed the start row index and maximum number of rows to return.</span></span> <span data-ttu-id="147e1-273">这些参数可以通过查询字符串就像一样维护`pageIndex`和`pageSize`使用默认分页的参数。</span><span class="sxs-lookup"><span data-stu-id="147e1-273">These parameters can be maintained through the querystring just like the `pageIndex` and `pageSize` parameters used in default paging.</span></span>

<span data-ttu-id="147e1-274">由于存在 s 没有`PagedDataSource`使用自定义分页，必须使用其他方法来确定总通过以及是否正在通过寻呼发送的记录数我们重新显示数据的第一个或最后一页。</span><span class="sxs-lookup"><span data-stu-id="147e1-274">Since there s no `PagedDataSource` with custom paging, alternative techniques must be used to determine the total number of records being paged through and whether we re displaying the first or last page of data.</span></span> <span data-ttu-id="147e1-275">`TotalNumberOfProducts()`中的方法`ProductsBLL`类返回正在通过寻呼发送到的产品的总数。</span><span class="sxs-lookup"><span data-stu-id="147e1-275">The `TotalNumberOfProducts()` method in the `ProductsBLL` class returns the total number of products being paged through.</span></span> <span data-ttu-id="147e1-276">若要确定是否在查看数据的第一页，检查开始的行索引如果它是零，则在查看第一页。</span><span class="sxs-lookup"><span data-stu-id="147e1-276">To determine if the first page of data is being viewed, examine the start row index if it is zero, then the first page is being viewed.</span></span> <span data-ttu-id="147e1-277">如果开始的行索引加上要返回的最大行是大于或等于的记录正在通过寻呼发送通过总数在查看的最后一页。</span><span class="sxs-lookup"><span data-stu-id="147e1-277">The last page is being viewed if the start row index plus the maximum rows to return is greater than or equal to the total number of records being paged through.</span></span>

<span data-ttu-id="147e1-278">我们将探讨在下一教程中更详细地实现自定义分页。</span><span class="sxs-lookup"><span data-stu-id="147e1-278">We'll explore implementing custom paging in greater detail in the next tutorial.</span></span>

## <a name="summary"></a><span data-ttu-id="147e1-279">总结</span><span class="sxs-lookup"><span data-stu-id="147e1-279">Summary</span></span>

<span data-ttu-id="147e1-280">DataList 和转发器都不提供外框分页支持位于 GridView，说明如何，和 FormView 控制，可以使用最小的工作量添加这样的功能。</span><span class="sxs-lookup"><span data-stu-id="147e1-280">While neither the DataList nor Repeater offers the out of the box paging support found in the GridView, DetailsView, and FormView controls, such functionality can be added with minimal effort.</span></span> <span data-ttu-id="147e1-281">实现默认分页的最简单方法是将中的产品的整个集`PagedDataSource`，然后将绑定`PagedDataSource`到 DataList 或转发器。</span><span class="sxs-lookup"><span data-stu-id="147e1-281">The easiest way to implement default paging is to wrap the entire set of products within a `PagedDataSource` and then bind the `PagedDataSource` to the DataList or Repeater.</span></span> <span data-ttu-id="147e1-282">在本教程，我们添加`GetProductsAsPagedDataSource`方法`ProductsBLL`类返回`PagedDataSource`。</span><span class="sxs-lookup"><span data-stu-id="147e1-282">In this tutorial we added the `GetProductsAsPagedDataSource` method to the `ProductsBLL` class to return the `PagedDataSource`.</span></span> <span data-ttu-id="147e1-283">`ProductsBLL`类已包含所需的自定义分页方法`GetProductsPaged`和`TotalNumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="147e1-283">The `ProductsBLL` class already contains the methods needed for custom paging `GetProductsPaged` and `TotalNumberOfProducts`.</span></span>

<span data-ttu-id="147e1-284">检索要显示的自定义分页的记录的精确集，或者中的所有记录以及`PagedDataSource`对于默认分页，我们还需要手动添加分页接口。</span><span class="sxs-lookup"><span data-stu-id="147e1-284">Along with retrieving either the precise set of records to display for custom paging or all records in a `PagedDataSource` for default paging, we also need to manually add the paging interface.</span></span> <span data-ttu-id="147e1-285">对于本教程中，我们将创建下一步上, 一步，首先，上次接口与四个按钮 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="147e1-285">For this tutorial we created a Next, Previous, First, Last interface with four Button Web controls.</span></span> <span data-ttu-id="147e1-286">此外，还添加显示当前页码和总页数的标签控件。</span><span class="sxs-lookup"><span data-stu-id="147e1-286">Also, a Label control displaying the current page number and total number of pages was added.</span></span>

<span data-ttu-id="147e1-287">在下一步的教程，我们将了解如何将排序支持添加到 DataList 和转发器。</span><span class="sxs-lookup"><span data-stu-id="147e1-287">In the next tutorial we'll see how to add sorting support to the DataList and Repeater.</span></span> <span data-ttu-id="147e1-288">我们将了解如何创建 DataList 可以同时分页和排序 （与使用默认和自定义分页的示例）。</span><span class="sxs-lookup"><span data-stu-id="147e1-288">We'll also see how to create a DataList that can be both paged and sorted (with examples using default and custom paging).</span></span>

<span data-ttu-id="147e1-289">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="147e1-289">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="147e1-290">关于作者</span><span class="sxs-lookup"><span data-stu-id="147e1-290">About the Author</span></span>

<span data-ttu-id="147e1-291">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七个 ASP/ASP.NET 书籍和的创始人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年使用与 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="147e1-291">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="147e1-292">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="147e1-292">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="147e1-293">最新书籍是[ *Sam 教授自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="147e1-293">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="147e1-294">他可以达到在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或通过他的博客，其中可以找到在[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="147e1-294">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="147e1-295">特别感谢</span><span class="sxs-lookup"><span data-stu-id="147e1-295">Special Thanks To</span></span>

<span data-ttu-id="147e1-296">本教程系列已由许多有用的审阅者评审。</span><span class="sxs-lookup"><span data-stu-id="147e1-296">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="147e1-297">本教程中的前导审阅者已沈 Shulok、 Ken Pespisa 和伯纳黛特 Leigh。</span><span class="sxs-lookup"><span data-stu-id="147e1-297">Lead reviewers for this tutorial were Liz Shulok, Ken Pespisa, and Bernadette Leigh.</span></span> <span data-ttu-id="147e1-298">对感兴趣查看我即将到来的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="147e1-298">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="147e1-299">如果是这样，删除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="147e1-299">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="147e1-300">下一篇</span><span class="sxs-lookup"><span data-stu-id="147e1-300">Next</span></span>](sorting-data-in-a-datalist-or-repeater-control-cs.md)
