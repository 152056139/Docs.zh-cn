---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-the-production-web-application-to-use-the-production-database-cs
title: 配置用于生产数据库 (C#) 的生产 Web 应用程序 |Microsoft 文档
author: rick-anderson
description: 如前面的教程中所述，是很常见的开发和生产环境之间不同的配置信息。 这是 es...
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/23/2009
ms.topic: article
ms.assetid: 0177dabd-d888-449f-91b2-24190cf5e842
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-the-production-web-application-to-use-the-production-database-cs
msc.type: authoredcontent
ms.openlocfilehash: 21eac6a4d829795f02eeeca5f9870b1ab8132d08
ms.sourcegitcommit: 493a215355576cfa481773365de021bcf04bb9c7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/15/2018
---
<a name="configuring-the-production-web-application-to-use-the-production-database-c"></a><span data-ttu-id="f75df-104">配置用于生产数据库 (C#) 的生产 Web 应用程序</span><span class="sxs-lookup"><span data-stu-id="f75df-104">Configuring the Production Web Application to Use the Production Database (C#)</span></span>
====================
<span data-ttu-id="f75df-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="f75df-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="f75df-106">[下载代码](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_08_CS.zip)或[下载 PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial08_DBConfig_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="f75df-106">[Download Code](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_08_CS.zip) or [Download PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial08_DBConfig_cs.pdf)</span></span>

> <span data-ttu-id="f75df-107">如前面的教程中所述，是很常见的开发和生产环境之间不同的配置信息。</span><span class="sxs-lookup"><span data-stu-id="f75df-107">As discussed in earlier tutorials, it is not uncommon for configuration information to differ between the development and production environments.</span></span> <span data-ttu-id="f75df-108">这是对于数据驱动的 web 应用程序，尤其如此，因为数据库连接字符串的开发和生产环境之间存在差异。</span><span class="sxs-lookup"><span data-stu-id="f75df-108">This is especially true for data-driven web applications, as the database connection strings differ between the development and production environments.</span></span> <span data-ttu-id="f75df-109">本教程将探讨方法来配置要在更多详细信息中包括适当的连接字符串的生产环境。</span><span class="sxs-lookup"><span data-stu-id="f75df-109">This tutorial explores ways to configure the production environment to include the appropriate connection string in more detail.</span></span>


## <a name="introduction"></a><span data-ttu-id="f75df-110">介绍</span><span class="sxs-lookup"><span data-stu-id="f75df-110">Introduction</span></span>

<span data-ttu-id="f75df-111">数据驱动的 web 应用程序通常在生产中使用不同的数据库时比开发中。</span><span class="sxs-lookup"><span data-stu-id="f75df-111">Data-driven web applications usually use a different database when in development than when in production.</span></span> <span data-ttu-id="f75df-112">对于 web 主机提供商托管的和本地开发的应用程序，开发数据库通常驻留在开发人员的计算机时生产数据库托管在 web 托管公司的设施数据库服务器上。</span><span class="sxs-lookup"><span data-stu-id="f75df-112">For applications hosted by a web host provider and developed locally, the development database typically resides on the developer s computer while the production database is hosted on a database server at the web hosting company s facility.</span></span> <span data-ttu-id="f75df-113">部署数据驱动的 web 应用程序时，需要将开发数据库复制到生产数据库服务器。</span><span class="sxs-lookup"><span data-stu-id="f75df-113">Deploying a data-driven web application entails copying the development database to the production database server.</span></span> <span data-ttu-id="f75df-114">在以前的教程，我们看方法完成此步骤。</span><span class="sxs-lookup"><span data-stu-id="f75df-114">In the previous tutorial we looked at ways to accomplish this step.</span></span>

<span data-ttu-id="f75df-115">Web 应用程序使用中的信息*连接字符串*以与数据库建立连接。</span><span class="sxs-lookup"><span data-stu-id="f75df-115">The web application uses the information in a *connection string* to establish a connection with the database.</span></span> <span data-ttu-id="f75df-116">连接字符串，通常存储在`Web.config`，指定数据库服务器名称、 数据库、 安全上下文中和其他信息的名称。</span><span class="sxs-lookup"><span data-stu-id="f75df-116">The connection string, which is typically stored in `Web.config`, specifies the database server name, the name of the database, the security context, and other information.</span></span> <span data-ttu-id="f75df-117">因为 web 应用程序使用的数据库依赖于是否在开发或生产环境中运行 web 应用程序，连接字符串必须与不同的两种环境之间。</span><span class="sxs-lookup"><span data-stu-id="f75df-117">Because the database used by the web application depends on whether the web application is running in the development or production environments, the connection strings must differ between the two environments.</span></span>

<span data-ttu-id="f75df-118">它是很常见的开发和生产环境之间不同的配置信息。</span><span class="sxs-lookup"><span data-stu-id="f75df-118">It is not uncommon for configuration information to differ between the development and production environments.</span></span> <span data-ttu-id="f75df-119">*常见配置差异之间开发和生产*教程讨论上维护单独的配置信息之间这两种环境，以及简要介绍的技术数据库连接字符串。</span><span class="sxs-lookup"><span data-stu-id="f75df-119">The *Common Configuration Differences Between Development and Production* tutorial discussed techniques for maintaining separate configuration information between these two environments, as well as a brief discussion on database connection strings.</span></span> <span data-ttu-id="f75df-120">本教程将探讨方法来配置要在更多详细信息中包括适当的连接字符串的生产环境。</span><span class="sxs-lookup"><span data-stu-id="f75df-120">This tutorial explores ways to configure the production environment to include the appropriate connection string in more detail.</span></span>

## <a name="examining-the-connection-string-information"></a><span data-ttu-id="f75df-121">检查连接字符串信息</span><span class="sxs-lookup"><span data-stu-id="f75df-121">Examining the Connection String Information</span></span>

<span data-ttu-id="f75df-122">所用的图书评论 web 应用程序的连接字符串存储在应用程序的配置文件， `Web.config`。</span><span class="sxs-lookup"><span data-stu-id="f75df-122">The connection string used by the Book Reviews web application is stored in the application s configuration file, `Web.config`.</span></span> <span data-ttu-id="f75df-123">`Web.config` 包含一个特殊的节，用于存储连接字符串，命名恰当[ &lt;connectionStrings&gt;](https://msdn.microsoft.com/library/bf7sd233.aspx)。</span><span class="sxs-lookup"><span data-stu-id="f75df-123">`Web.config` includes a special section for storing connection strings, aptly named [&lt;connectionStrings&gt;](https://msdn.microsoft.com/library/bf7sd233.aspx).</span></span> <span data-ttu-id="f75df-124">`Web.config`文件图书评论网站具有一个名为此节中定义的连接字符串`ReviewsConnectionString`:</span><span class="sxs-lookup"><span data-stu-id="f75df-124">The `Web.config` file for the Book Reviews website has one connection string defined in this section named `ReviewsConnectionString`:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample1.xml)]

<span data-ttu-id="f75df-125">连接字符串的数据源 =。 \SQLEXPRESS;AttachDbFilename = |DataDirectory|\Reviews.mdf;Integrated 安全 = True;用户实例 = True-并且组成大量的选项和值，由分号和每个选项分隔的选项/值对，并且由一个等号分隔的值。</span><span class="sxs-lookup"><span data-stu-id="f75df-125">The connection string - Data Source=.\SQLEXPRESS;AttachDbFilename=|DataDirectory|\Reviews.mdf;Integrated Security=True;User Instance=True - is composed of a number of options and values, with option/value pairs delimited by a semicolon and each option and value delimited by an equals sign.</span></span> <span data-ttu-id="f75df-126">在此连接字符串中使用的四个选项如下：</span><span class="sxs-lookup"><span data-stu-id="f75df-126">The four options used in this connection string are:</span></span>

- <span data-ttu-id="f75df-127">`Data Source` -指定的数据库服务器和数据库服务器实例名称的位置 （如果有）。</span><span class="sxs-lookup"><span data-stu-id="f75df-127">`Data Source` - specifies the location of the database server and the database server instance name (if any).</span></span> <span data-ttu-id="f75df-128">值， `.\SQLEXPRESS`，是一个示例： 有数据库服务器和实例名称。</span><span class="sxs-lookup"><span data-stu-id="f75df-128">The value, `.\SQLEXPRESS`, is an example where there is a database server and an instance name.</span></span> <span data-ttu-id="f75df-129">期指定数据库服务器位于同一台计算机作为该应用程序;实例名称是`SQLEXPRESS`。</span><span class="sxs-lookup"><span data-stu-id="f75df-129">The period specifies that the database server is on the same computer as the application; the instance name is `SQLEXPRESS`.</span></span>
- <span data-ttu-id="f75df-130">`AttachDbFilename` -指定数据库文件的位置。</span><span class="sxs-lookup"><span data-stu-id="f75df-130">`AttachDbFilename` - specifies the location of the database file.</span></span> <span data-ttu-id="f75df-131">值包含占位符`|DataDirectory|`，即解析为应用程序 s 的完整路径`App_Data`在运行时的文件夹。</span><span class="sxs-lookup"><span data-stu-id="f75df-131">The value contains the placeholder `|DataDirectory|`, which is resolved to the full path of the application s `App_Data` folder at runtime.</span></span>
- <span data-ttu-id="f75df-132">`Integrated Security` -一个布尔值，该值指示是否在连接到数据库 (false) 或当前的 Windows 帐户凭据 (true) 时使用指定的用户名/密码。</span><span class="sxs-lookup"><span data-stu-id="f75df-132">`Integrated Security` - a Boolean value that indicates whether to use a specified username/password when connecting to the database (false) or the current Windows account credentials (true).</span></span>
- <span data-ttu-id="f75df-133">`User Instance` -特定于 SQL Server Express 版本，该值指示是否允许本地计算机上的非管理用户附加并连接到 SQL Server Express Edition 数据库的配置选项。</span><span class="sxs-lookup"><span data-stu-id="f75df-133">`User Instance` - a configuration option specific to the SQL Server Express Editions that indicates whether to allow non-Administrative users on the local computer attach and connect to a SQL Server Express Edition database.</span></span> <span data-ttu-id="f75df-134">请参阅[SQL Server Express 用户实例](https://msdn.microsoft.com/library/ms254504.aspx)有关对此设置的详细信息。</span><span class="sxs-lookup"><span data-stu-id="f75df-134">See [SQL Server Express User Instances](https://msdn.microsoft.com/library/ms254504.aspx) for more information on this setting.</span></span>
  

<span data-ttu-id="f75df-135">允许的连接字符串选项取决于你连接到的数据库和正在使用的 ADO.NET 数据库提供程序。</span><span class="sxs-lookup"><span data-stu-id="f75df-135">The allowable connection string options depend on the database you are connecting to and the ADO.NET database provider being used.</span></span> <span data-ttu-id="f75df-136">例如，用于连接到 Microsoft SQL Server 数据库不同于用来连接到 Oracle 数据库连接字符串。</span><span class="sxs-lookup"><span data-stu-id="f75df-136">For example, the connection string for connecting to a Microsoft SQL Server database differs from that used to connect to an Oracle database.</span></span> <span data-ttu-id="f75df-137">同样，连接到 Microsoft SQL Server 数据库使用 SqlClient 提供程序使用不同的连接字符串比时使用的 OLE DB 访问接口。</span><span class="sxs-lookup"><span data-stu-id="f75df-137">Likewise, connecting to a Microsoft SQL Server database using the SqlClient provider uses a different connection string than when using the OLE-DB provider.</span></span>

<span data-ttu-id="f75df-138">你可通过使用如站点的现有生成的数据库连接字符串[ConnectionStrings.com](http://www.connectionstrings.com/)为那些选项可以使用的资源。</span><span class="sxs-lookup"><span data-stu-id="f75df-138">You can build the database connection string by hand using a site like [ConnectionStrings.com](http://www.connectionstrings.com/) as a resource for what options are available.</span></span> <span data-ttu-id="f75df-139">但是，较简单的方法是将数据库添加到 Visual Studio 中的服务器资源管理器，然后抓住属性窗口中的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="f75df-139">However, an easier approach is to add the database to the Server Explorer in Visual Studio and then to grab the connection string from the Properties window.</span></span> <span data-ttu-id="f75df-140">让我们来使用此后一种方法来进行构造生产数据库服务器的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="f75df-140">Let s use this latter technique for constructing the connection string to the production database server.</span></span>

<span data-ttu-id="f75df-141">打开 Visual Studio，然后导航到服务器资源管理器窗口 （在 Visual Web Developer 中，此窗口调用数据库资源管理器）。</span><span class="sxs-lookup"><span data-stu-id="f75df-141">Open Visual Studio and then navigate to the Server Explorer window (in Visual Web Developer, this window is called Database Explorer).</span></span> <span data-ttu-id="f75df-142">右键单击数据连接选项，然后从上下文菜单中选择添加连接选项。</span><span class="sxs-lookup"><span data-stu-id="f75df-142">Right-click on the Data Connections option and choose the Add Connection option from the context menu.</span></span> <span data-ttu-id="f75df-143">这将显示向导中图 1 所示。</span><span class="sxs-lookup"><span data-stu-id="f75df-143">This brings up the wizard shown in Figure 1.</span></span> <span data-ttu-id="f75df-144">选择适当的数据源并单击继续。</span><span class="sxs-lookup"><span data-stu-id="f75df-144">Choose the appropriate data source and click Continue.</span></span>


<span data-ttu-id="f75df-145">[![选择将新的数据库添加到服务器资源管理器](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image2.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="f75df-145">[![Choose to Add a New Database to the Server Explorer](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image2.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image1.jpg)</span></span> 

<span data-ttu-id="f75df-146">**图 1**： 选择将新的数据库添加到服务器资源管理器 ([单击以查看实际尺寸的图像](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image3.jpg))</span><span class="sxs-lookup"><span data-stu-id="f75df-146">**Figure 1**: Choose to Add a New Database to the Server Explorer ([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image3.jpg))</span></span>


<span data-ttu-id="f75df-147">接下来，指定各种数据库连接信息 （请参见图 2）。</span><span class="sxs-lookup"><span data-stu-id="f75df-147">Next, specify the various database connection information (see Figure 2).</span></span> <span data-ttu-id="f75df-148">当您使用您的 web 托管公司注册它们应如何连接到数据库的数据库服务器名称、 数据库名称、 用户名和密码用于连接到数据库，依次类推提供了信息。</span><span class="sxs-lookup"><span data-stu-id="f75df-148">When you signed up with your web hosting company they should have provided information on how to connect to the database - the database server name, the database name, the username and password to use to connect to the database, and so on.</span></span> <span data-ttu-id="f75df-149">输入此信息后，单击确定以完成此向导并将数据库添加到服务器资源管理器。</span><span class="sxs-lookup"><span data-stu-id="f75df-149">After entering this information click OK to complete this wizard and to add the database to the Server Explorer.</span></span>


<span data-ttu-id="f75df-150">[![指定的数据库连接信息](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image5.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="f75df-150">[![Specify the Database Connection Information](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image5.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image4.jpg)</span></span> 

<span data-ttu-id="f75df-151">**图 2**： 指定数据库连接信息 ([单击以查看实际尺寸的图像](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image6.jpg))</span><span class="sxs-lookup"><span data-stu-id="f75df-151">**Figure 2**: Specify the Database Connection Information ([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image6.jpg))</span></span>


<span data-ttu-id="f75df-152">现在，生产环境数据库应列在服务器资源管理器。</span><span class="sxs-lookup"><span data-stu-id="f75df-152">The production environment database should now be listed in the Server Explorer.</span></span> <span data-ttu-id="f75df-153">从服务器资源管理器中选择数据库并转到属性窗口。</span><span class="sxs-lookup"><span data-stu-id="f75df-153">Select the database from the Server Explorer and go to the Properties window.</span></span> <span data-ttu-id="f75df-154">您将找到名为使用数据库 s 的连接字符串的连接字符串的属性。</span><span class="sxs-lookup"><span data-stu-id="f75df-154">There you will find a property named Connection String with the database s connection string.</span></span> <span data-ttu-id="f75df-155">假定你在生产和 SqlClient 提供程序上使用 Microsoft SQL Server 数据库连接字符串应类似于以下：</span><span class="sxs-lookup"><span data-stu-id="f75df-155">Assuming you are using a Microsoft SQL Server database on production and the SqlClient provider your connection string should look similar to the following:</span></span>

<span data-ttu-id="f75df-156">**数据源=*serverName*; 初始目录=*databaseName*; 持久性安全信息=True; 用户 ID=*用户名*; 密码=*密码**\*</span><span class="sxs-lookup"><span data-stu-id="f75df-156">**Data Source=*serverName*; Initial Catalog=*databaseName*; Persist Security Info=True; User ID=*username*; Password=*password***</span></span>

<span data-ttu-id="f75df-157">其中*serverName*， *databaseName*，*用户名*，和*密码*与数据库服务器名称，数据库的值名称和用户名和密码由你的 web 主机公司提供给你。</span><span class="sxs-lookup"><span data-stu-id="f75df-157">Where *serverName*, *databaseName*, *username*, and *password* are with the values for the database server name, the database name, and the username and password supplied to you by your web host company.</span></span>

## <a name="deploying-the-book-reviews-web-application"></a><span data-ttu-id="f75df-158">部署簿评审 Web 应用程序</span><span class="sxs-lookup"><span data-stu-id="f75df-158">Deploying the Book Reviews Web Application</span></span>

<span data-ttu-id="f75df-159">前面的教程进行单步遍历将开发数据库复制到生产环境中，但未将不介绍将数据驱动应用程序部署。</span><span class="sxs-lookup"><span data-stu-id="f75df-159">The preceding tutorial stepped through copying the development database to the production environment, but did not explore deploying the data-driven application.</span></span> <span data-ttu-id="f75df-160">此时生产环境中包含的数据库，但与静态评审使用簿评审应用程序的版本。</span><span class="sxs-lookup"><span data-stu-id="f75df-160">At this point the production environment contains the database but is using the version of the Book Reviews application with static reviews.</span></span> <span data-ttu-id="f75df-161">我们需要新的、 数据驱动应用程序部署到生产服务器以及更新的配置信息。</span><span class="sxs-lookup"><span data-stu-id="f75df-161">We need to deploy the new, data-driven application to the production server along with the updated configuration information.</span></span>

<span data-ttu-id="f75df-162">需要一段时间来部署数据驱动应用程序从开发环境到生产环境。</span><span class="sxs-lookup"><span data-stu-id="f75df-162">Take a moment to deploy the data-driven application from the development environment to production.</span></span> <span data-ttu-id="f75df-163">此过程已在前面的教程中详细介绍。</span><span class="sxs-lookup"><span data-stu-id="f75df-163">This process was covered in detail in previous tutorials.</span></span> <span data-ttu-id="f75df-164">如果你需要使用刷新程序，请参阅*部署您的网站使用 FTP 客户端*或*部署您的网站使用 Visual Studio*教程。</span><span class="sxs-lookup"><span data-stu-id="f75df-164">If you need a refresher, see the *Deploying Your Website Using an FTP Client* or the *Deploying Your Website Using Visual Studio* tutorials.</span></span> <span data-ttu-id="f75df-165">你将需要确保生产数据库连接字符串是一个用于生产环境，这意味着备用`Web.config`文件必须部署。</span><span class="sxs-lookup"><span data-stu-id="f75df-165">You will need to ensure that the production database connection string is the one used in the production environment, which means that an alternate `Web.config` file must be deployed.</span></span> <span data-ttu-id="f75df-166">具体而言，此修改`Web.config`文件的`<connectionStrings>`元素需要包含生产数据库连接字符串和外观应与以下类似：</span><span class="sxs-lookup"><span data-stu-id="f75df-166">Specifically, this modified `Web.config` file s `<connectionStrings>` element needs to contain the production database connection string and should look similar to the following:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample2.xml)]

<span data-ttu-id="f75df-167">请注意，该连接字符串中`<connectionStrings>`元素名为相同 (`ReviewsConnectionString`)，但现在却包含生产数据库连接字符串，而不是开发数据库连接字符串。</span><span class="sxs-lookup"><span data-stu-id="f75df-167">Note that the connection string in the `<connectionStrings>` element is named the same (`ReviewsConnectionString`), but now contains the production database connection string instead of the development database connection string.</span></span>

<span data-ttu-id="f75df-168">除非你有更正式的部署工作流，请手动修改`Web.config`文件部署 （请记住要恢复为使用开发数据库连接字符串之前，使用生产数据库连接字符串之后） 或维护一个单独`Web.config`获取作为部署过程的一部分上载到生产环境的生产环境配置信息的文件。</span><span class="sxs-lookup"><span data-stu-id="f75df-168">Unless you have a more formalized deployment workflow, either manually modify the `Web.config` file to use the production database connection string before deploying (remembering to revert it back to using the development database connection string afterwards) or maintain a separate `Web.config` file with the production environment configuration information that gets uploaded to the production environment as part of the deployment process.</span></span>

> [!NOTE]
> <span data-ttu-id="f75df-169">如果你意外地部署`Web.config`包含开发数据库连接字符串，然后对生产应用程序尝试连接到数据库时将会出错的文件。</span><span class="sxs-lookup"><span data-stu-id="f75df-169">If you accidentally deploy a `Web.config` file that contains the development database connection string then there will be an error when the application on production attempts to connect to the database.</span></span> <span data-ttu-id="f75df-170">此错误表现为`SqlException`使用报表服务器找不到或无法访问的消息。</span><span class="sxs-lookup"><span data-stu-id="f75df-170">This error manifests as a `SqlException` with a message reporting that the server was not found or was not accessible.</span></span>


<span data-ttu-id="f75df-171">站点部署到生产环境后，请访问你在浏览器将生产站点。</span><span class="sxs-lookup"><span data-stu-id="f75df-171">Once the site has been deployed to production, visit the production site through your browser.</span></span> <span data-ttu-id="f75df-172">你应查看和在本地运行数据驱动应用程序时享受与相同的用户体验。</span><span class="sxs-lookup"><span data-stu-id="f75df-172">You should see and enjoy the same user experience as when running the data-driven application locally.</span></span> <span data-ttu-id="f75df-173">这是当然的时你访问的网站上生产站点是由提供支持生产数据库服务器上，而访问在开发环境中的网站开发中使用数据库。</span><span class="sxs-lookup"><span data-stu-id="f75df-173">Of course when you visit the website on production the site is powered by the production database server, whereas visiting the website in the development environment uses the database in development.</span></span> <span data-ttu-id="f75df-174">图 3 显示*教授自己 ASP.NET 3.5 24 小时内*查看从生产环境 （请注意浏览器的地址栏中的 URL） 中的网站的页。</span><span class="sxs-lookup"><span data-stu-id="f75df-174">Figure 3 shows the *Teach Yourself ASP.NET 3.5 in 24 Hours* review page from the website in the production environment (note the URL in the browser s Address bar).</span></span>


<span data-ttu-id="f75df-175">[![数据驱动应用程序是现在可在生产 ！](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image8.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="f75df-175">[![The Data-Driven Application is Now Available On Production!](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image8.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image7.jpg)</span></span> 

<span data-ttu-id="f75df-176">**图 3**: The Data-Driven 应用程序是现在可在生产 ！</span><span class="sxs-lookup"><span data-stu-id="f75df-176">**Figure 3**: The Data-Driven Application is Now Available On Production!</span></span> <span data-ttu-id="f75df-177">([单击以查看实际尺寸的图像](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image9.jpg))</span><span class="sxs-lookup"><span data-stu-id="f75df-177">([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image9.jpg))</span></span>


### <a name="storing-connection-strings-in-a-separate-configuration-file"></a><span data-ttu-id="f75df-178">将连接字符串存储在单独的配置文件</span><span class="sxs-lookup"><span data-stu-id="f75df-178">Storing Connection Strings in a Separate Configuration File</span></span>

<span data-ttu-id="f75df-179">维护上开发和生产环境的单独的配置信息的常用的方法是让两个版本的`Web.config`： 一个用于开发环境，一个用于生产。</span><span class="sxs-lookup"><span data-stu-id="f75df-179">A common technique for maintaining separate configuration information on the development and production environments is to have two versions of the `Web.config`: one for the development environment and one for production.</span></span> <span data-ttu-id="f75df-180">在部署时相应`Web.config`版本可以复制到生产环境。</span><span class="sxs-lookup"><span data-stu-id="f75df-180">At deploy-time the appropriate `Web.config` version can be copied to the production environment.</span></span> <span data-ttu-id="f75df-181">理想情况下，此过程将自动部署工作流的一部分。</span><span class="sxs-lookup"><span data-stu-id="f75df-181">Ideally, this process would be automated as part of the deployment workflow.</span></span>

<span data-ttu-id="f75df-182">而不是维护两个单独`Web.config`文件 （可选） 可以提供更精细的差异。</span><span class="sxs-lookup"><span data-stu-id="f75df-182">Instead of maintaining two separate `Web.config` files you can, optionally, provide more granular differences.</span></span> <span data-ttu-id="f75df-183">构成元素`Web.config`文件可以在然后中引用外部配置文件中定义`Web.config`文件。</span><span class="sxs-lookup"><span data-stu-id="f75df-183">The elements that make up the `Web.config` file can be defined in an external configuration files that are then referenced in the `Web.config` file.</span></span> <span data-ttu-id="f75df-184">简而言之，你可以有一个`Web.config`文件引用一个 databaseConnectionStrings.config 文件，其中将包含连接字符串这两个环境由应用程序，并且将是唯一的每个环境。</span><span class="sxs-lookup"><span data-stu-id="f75df-184">In a nutshell you can have one `Web.config` file for both environments that references a databaseConnectionStrings.config file, which would contain the connection strings used by the application and would be unique for each environment.</span></span> <span data-ttu-id="f75df-185">找到分隔到单独的文件不同的配置信息提供整洁简单`Web.config`文件以及更多清楚地概述了开发和生产环境之间的配置区别。</span><span class="sxs-lookup"><span data-stu-id="f75df-185">I find that separating the differing configuration information into separate files provides a tidier and simpler `Web.config` file and more clearly outlines the configuration differences between the development and production environments.</span></span>

<span data-ttu-id="f75df-186">若要使用此方法，请首先在名为 web 应用程序中创建一个新文件夹`ConfigSections`。</span><span class="sxs-lookup"><span data-stu-id="f75df-186">To use this technique, start by creating a new folder in the web application named `ConfigSections`.</span></span> <span data-ttu-id="f75df-187">接下来，将两个文件添加到名为 databaseConnectionStrings.dev.config 和 databaseConnectionStrings.production.config 此新文件夹。接下来，将复制`<connectionStrings>`元素从`Web.config`到 databaseConnectionStrings.dev.config 和 databaseConnectionStrings.production.config 的文件，然后修改中的连接字符串databaseConnectionStrings.production.config 文件，以便它指定生产数据库连接字符串。</span><span class="sxs-lookup"><span data-stu-id="f75df-187">Next, add two files to this new folder named databaseConnectionStrings.dev.config and databaseConnectionStrings.production.config. Next, copy the `<connectionStrings>` element from `Web.config` into the databaseConnectionStrings.dev.config and databaseConnectionStrings.production.config files, and then modify the connection string in the databaseConnectionStrings.production.config file so that it specifies the production database connection string.</span></span> <span data-ttu-id="f75df-188">例如，databaseConnectionStrings.dev.config 文件应包含仅`<connectionStrings>`元素引用开发数据库的连接字符串：</span><span class="sxs-lookup"><span data-stu-id="f75df-188">For example, the databaseConnectionStrings.dev.config file should contain just the `<connectionStrings>` element with a connection string that references the development database:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample3.xml)]

<span data-ttu-id="f75df-189">同样，databaseConnectionStrings.production.config 文件应只包含`<connectionStrings>`元素，但其中一个具有的生产数据库连接字符串。</span><span class="sxs-lookup"><span data-stu-id="f75df-189">Similarly, the databaseConnectionStrings.production.config file should contain just a `<connectionStrings>` element, but one that has the production database connection string.</span></span>

<span data-ttu-id="f75df-190">请 databaseConnectionStrings.dev.config 文件的副本并将其命名 databaseConnectionStrings.config。</span><span class="sxs-lookup"><span data-stu-id="f75df-190">Make a copy of the databaseConnectionStrings.dev.config file and name it databaseConnectionStrings.config.</span></span>

> [!NOTE]
> <span data-ttu-id="f75df-191">你可以将配置文件名称以外的 databaseConnectionStrings.config，如果你 d 喜欢，如`connectionStrings.config`或`dbInfo.config`。</span><span class="sxs-lookup"><span data-stu-id="f75df-191">You can name the configuration file something other than databaseConnectionStrings.config, if you d like, such as `connectionStrings.config` or `dbInfo.config`.</span></span> <span data-ttu-id="f75df-192">但是，请务必将与该文件`.config`扩展作为`.config`文件，默认情况下，不提供由 ASP.NET 引擎。</span><span class="sxs-lookup"><span data-stu-id="f75df-192">However, be sure to name the file with a `.config` extension as `.config` files are, by default, not served by the ASP.NET engine.</span></span> <span data-ttu-id="f75df-193">如果您其他命名该文件，例如`connectionStrings.txt`，用户无法其浏览器指向[www.yoursite.com/ConfigSettings/connectionStrings.txt](http://www.yoursite.com/ConfigSettings/connectionStrings.txt)和查看文件的内容 ！</span><span class="sxs-lookup"><span data-stu-id="f75df-193">If you name the file something else, like `connectionStrings.txt`, a user could point their browser to [www.yoursite.com/ConfigSettings/connectionStrings.txt](http://www.yoursite.com/ConfigSettings/connectionStrings.txt) and view the contents of the file!</span></span>


<span data-ttu-id="f75df-194">此时`ConfigSections`文件夹应包含三个文件 （请参见图 4）。</span><span class="sxs-lookup"><span data-stu-id="f75df-194">At this point the `ConfigSections` folder should contain three files (see Figure 4).</span></span> <span data-ttu-id="f75df-195">DatabaseConnectionStrings.dev.config 和 databaseConnectionStrings.production.config 文件分别包含开发和生产环境中，连接字符串。</span><span class="sxs-lookup"><span data-stu-id="f75df-195">The databaseConnectionStrings.dev.config and databaseConnectionStrings.production.config files contain the connection strings for the development and production environments, respectively.</span></span> <span data-ttu-id="f75df-196">DatabaseConnectionStrings.config 文件包含 web 应用程序在运行时将使用的连接字符串信息。</span><span class="sxs-lookup"><span data-stu-id="f75df-196">The databaseConnectionStrings.config file contains the connection string information that will be used by the web application at runtime.</span></span> <span data-ttu-id="f75df-197">因此，databaseConnectionStrings.config 文件应该是相同的 databaseConnectionStrings.dev.config 文件在开发环境中，而在生产 databaseConnectionStrings.config 文件应该相同databaseConnectionStrings.production.config。</span><span class="sxs-lookup"><span data-stu-id="f75df-197">Consequently, the databaseConnectionStrings.config file should be identical to the databaseConnectionStrings.dev.config file in the development environment, whereas on production the databaseConnectionStrings.config file should be identical to databaseConnectionStrings.production.config.</span></span>


<span data-ttu-id="f75df-198">[![ConfigSections](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image11.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image10.jpg)</span><span class="sxs-lookup"><span data-stu-id="f75df-198">[![ConfigSections](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image11.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image10.jpg)</span></span> 

<span data-ttu-id="f75df-199">**图 4**: ConfigSections ([单击以查看实际尺寸的图像](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image12.jpg))</span><span class="sxs-lookup"><span data-stu-id="f75df-199">**Figure 4**: ConfigSections ([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image12.jpg))</span></span>


<span data-ttu-id="f75df-200">现在，我们需要指示`Web.config`将 databaseConnectionStrings.config 文件用于其连接字符串存储区。</span><span class="sxs-lookup"><span data-stu-id="f75df-200">We now need to instruct `Web.config` to use the databaseConnectionStrings.config file for its connection string store.</span></span> <span data-ttu-id="f75df-201">打开 `Web.config` 并将现有 `<connectionStrings>` 元素替换为以下内容：</span><span class="sxs-lookup"><span data-stu-id="f75df-201">Open `Web.config` and replace the existing `<connectionStrings>` element with the following:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample4.xml)]

<span data-ttu-id="f75df-202">`configSource`属性指定相对于的物理路径`Web.config`文件。</span><span class="sxs-lookup"><span data-stu-id="f75df-202">The `configSource` attribute specifies a physical path relative to the `Web.config` file.</span></span> <span data-ttu-id="f75df-203">如果外部`.config`文件位于与相同的目录`Web.config`然后将此属性设置为的文件名称`.config`文件。</span><span class="sxs-lookup"><span data-stu-id="f75df-203">If the external `.config` file is in the same directory as `Web.config` then set this attribute to the file name of the `.config` file.</span></span> <span data-ttu-id="f75df-204">如果它在一个子目录，s 原样 databaseConnectionStrings.config，这种情况指定使用反斜杠来分隔类似 ConfigSections\databaseConnectionStrings.config 文件夹和文件名称的子文件夹。</span><span class="sxs-lookup"><span data-stu-id="f75df-204">If it s in a subdirectory, as is the case with databaseConnectionStrings.config, specify the subfolder using a backslash to delimit the folder and file names, like ConfigSections\databaseConnectionStrings.config.</span></span>

<span data-ttu-id="f75df-205">经过此修改后，开发和生产环境包含相同`Web.config`文件。</span><span class="sxs-lookup"><span data-stu-id="f75df-205">With this modification, the development and production environments contain the same `Web.config` file.</span></span> <span data-ttu-id="f75df-206">现在，唯一的区别是 databaseConnectionStrings.config 文件。</span><span class="sxs-lookup"><span data-stu-id="f75df-206">Now the only difference is the databaseConnectionStrings.config file.</span></span> <span data-ttu-id="f75df-207">将 databaseConnectionStrings.production.config 文件复制到生产环境，并将它重命名为 databaseConnectionStrings.config。如果在将来，有向生产数据库的连接字符串的更改将需要使它们到 databaseConnectionStrings.production.config 文件，然后将该文件上载到生产环境，重命名 databaseConnectionStrings.config。</span><span class="sxs-lookup"><span data-stu-id="f75df-207">Copy the databaseConnectionStrings.production.config file to production and rename it to databaseConnectionStrings.config. If, in the future, there are changes to the production database connection string you will need to make them to the databaseConnectionStrings.production.config file and then upload that file to production, renaming it databaseConnectionStrings.config.</span></span>

> [!NOTE]
> <span data-ttu-id="f75df-208">你可以指定任何信息`Web.config`中单独的文件并使用元素`configSource`属性中引用该文件`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="f75df-208">You may specify the information for any `Web.config` element in a separate file and use the `configSource` attribute to reference that file from within `Web.config`.</span></span>


## <a name="summary"></a><span data-ttu-id="f75df-209">摘要</span><span class="sxs-lookup"><span data-stu-id="f75df-209">Summary</span></span>

<span data-ttu-id="f75df-210">数据驱动应用程序通常在开发和生产环境中使用不同的数据库。</span><span class="sxs-lookup"><span data-stu-id="f75df-210">Data-driven applications usually use different databases in the development and production environments.</span></span> <span data-ttu-id="f75df-211">因此，存储在 web 应用程序的配置的数据库连接字符串必须是唯一每个环境。</span><span class="sxs-lookup"><span data-stu-id="f75df-211">Consequently, the database connection strings stored in the web application s configuration must be unique per environment.</span></span> <span data-ttu-id="f75df-212">在本教程中我们介绍了如何确定了生产数据库连接字符串以及要维护的两种环境中的唯一连接字符串信息的方式。</span><span class="sxs-lookup"><span data-stu-id="f75df-212">In this tutorial we looked at how to determine the production database connection string and ways to maintain unique connection string information in the two environments.</span></span>

<span data-ttu-id="f75df-213">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="f75df-213">Happy Programming!</span></span>

#### <a name="further-reading"></a><span data-ttu-id="f75df-214">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="f75df-214">Further Reading</span></span>

<span data-ttu-id="f75df-215">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="f75df-215">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="f75df-216">连接字符串和配置文件</span><span class="sxs-lookup"><span data-stu-id="f75df-216">Connection Strings and Configuration Files</span></span>](https://msdn.microsoft.com/library/ms254494.aspx)
- [<span data-ttu-id="f75df-217">数据库配置字符串信息 @ ConnectionStrings.com</span><span class="sxs-lookup"><span data-stu-id="f75df-217">Database Configuration Strings Information @ ConnectionStrings.com</span></span>](http://www.connectionstrings.com/)
- [<span data-ttu-id="f75df-218">移出 Web.config 文件的设置</span><span class="sxs-lookup"><span data-stu-id="f75df-218">Move Settings Out of the Web.config File</span></span>](http://www.asp101.com/tips/index.asp?id=154)
- [<span data-ttu-id="f75df-219">技术文档&lt;connectionStrings&gt;元素</span><span class="sxs-lookup"><span data-stu-id="f75df-219">Technical Documentation for the &lt;connectionStrings&gt; Element</span></span>](https://msdn.microsoft.com/library/bf7sd233.aspx)

>[!div class="step-by-step"]
<span data-ttu-id="f75df-220">[上一页](deploying-a-database-cs.md)
[下一页](configuring-a-website-that-uses-application-services-cs.md)</span><span class="sxs-lookup"><span data-stu-id="f75df-220">[Previous](deploying-a-database-cs.md)
[Next](configuring-a-website-that-uses-application-services-cs.md)</span></span>
