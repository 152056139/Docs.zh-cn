---
uid: web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-web-services
title: 了解 ASP.NET AJAX Web 服务 |Microsoft 文档
author: scottcate
description: Web 服务是为分布式系统之间交换数据提供跨平台解决方案的.NET framework 的必要组成部分。 尽管 Web...
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/28/2008
ms.topic: article
ms.assetid: 3332d6e7-e2e1-4144-b805-e71d51e7e415
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-web-services
msc.type: authoredcontent
ms.openlocfilehash: 0b9f61f895fea1960ebd25780454b86d5c3ba1bb
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/06/2018
ms.locfileid: "30889337"
---
<a name="understanding-aspnet-ajax-web-services"></a><span data-ttu-id="49f0b-104">了解 ASP.NET AJAX Web 服务</span><span class="sxs-lookup"><span data-stu-id="49f0b-104">Understanding ASP.NET AJAX Web Services</span></span>
====================
<span data-ttu-id="49f0b-105">通过[Scott 类别](https://github.com/scottcate)</span><span class="sxs-lookup"><span data-stu-id="49f0b-105">by [Scott Cate](https://github.com/scottcate)</span></span>

[<span data-ttu-id="49f0b-106">下载 PDF</span><span class="sxs-lookup"><span data-stu-id="49f0b-106">Download PDF</span></span>](http://download.microsoft.com/download/C/1/9/C19A3451-1D14-477C-B703-54EF22E197EE/AJAX_tutorial05_Web_Services_with_MS_Ajax_cs.pdf)

> <span data-ttu-id="49f0b-107">Web 服务是为分布式系统之间交换数据提供跨平台解决方案的.NET framework 的必要组成部分。</span><span class="sxs-lookup"><span data-stu-id="49f0b-107">Web Services are an integral part of the .NET framework that provide a cross-platform solution for exchanging data between distributed systems.</span></span> <span data-ttu-id="49f0b-108">尽管 Web 服务通常用于允许不同的操作系统、 对象模型和编程语言来发送和接收数据，但它们也可动态地将数据注入到的 ASP.NET AJAX 页上或将数据从页发送到后端系统。</span><span class="sxs-lookup"><span data-stu-id="49f0b-108">Although Web Services are normally used to allow different operating systems, object models and programming languages to send and receive data, they can also be used to dynamically inject data into an ASP.NET AJAX page or send data from a page to a back-end system.</span></span> <span data-ttu-id="49f0b-109">上述所有操作均可以而无需进行重新排序以回发的操作。</span><span class="sxs-lookup"><span data-stu-id="49f0b-109">All of this can be done without resorting to postback operations.</span></span>


## <a name="calling-web-services-with-aspnet-ajax"></a><span data-ttu-id="49f0b-110">与 ASP.NET AJAX 一起调用 Web 服务</span><span class="sxs-lookup"><span data-stu-id="49f0b-110">Calling Web Services with ASP.NET AJAX</span></span>

<span data-ttu-id="49f0b-111">Dan Wahlin</span><span class="sxs-lookup"><span data-stu-id="49f0b-111">Dan Wahlin</span></span>

<span data-ttu-id="49f0b-112">Web 服务是为分布式系统之间交换数据提供跨平台解决方案的.NET framework 的必要组成部分。</span><span class="sxs-lookup"><span data-stu-id="49f0b-112">Web Services are an integral part of the .NET framework that provide a cross-platform solution for exchanging data between distributed systems.</span></span> <span data-ttu-id="49f0b-113">尽管 Web 服务通常用于允许不同的操作系统、 对象模型和编程语言来发送和接收数据，但它们也可动态地将数据注入到的 ASP.NET AJAX 页上或将数据从页发送到后端系统。</span><span class="sxs-lookup"><span data-stu-id="49f0b-113">Although Web Services are normally used to allow different operating systems, object models and programming languages to send and receive data, they can also be used to dynamically inject data into an ASP.NET AJAX page or send data from a page to a back-end system.</span></span> <span data-ttu-id="49f0b-114">上述所有操作均可以而无需进行重新排序以回发的操作。</span><span class="sxs-lookup"><span data-stu-id="49f0b-114">All of this can be done without resorting to postback operations.</span></span>

<span data-ttu-id="49f0b-115">ASP.NET AJAX UpdatePanel 控件提供一种简单到 AJAX 启用任何 ASP.NET 页，可能有些时候你何时需要动态而无需使用 UpdatePanel 访问服务器上的数据。</span><span class="sxs-lookup"><span data-stu-id="49f0b-115">While the ASP.NET AJAX UpdatePanel control provides a simple way to AJAX enable any ASP.NET page, there may be times when you need to dynamically access data on the server without using an UpdatePanel.</span></span> <span data-ttu-id="49f0b-116">这篇文章中你将了解如何通过创建和使用 Web 服务在 ASP.NET AJAX 页内完成此操作。</span><span class="sxs-lookup"><span data-stu-id="49f0b-116">In this article you'll see how to accomplish this by creating and consuming Web Services within ASP.NET AJAX pages.</span></span>

<span data-ttu-id="49f0b-117">本文将重点核心 ASP.NET AJAX 扩展，以及调用 AutoCompleteExtender ASP.NET AJAX 工具包中的启用的 Web 服务控件中提供的功能。</span><span class="sxs-lookup"><span data-stu-id="49f0b-117">This article will focus on functionality available in the core ASP.NET AJAX Extensions as well as a Web Service enabled control in the ASP.NET AJAX Toolkit called the AutoCompleteExtender.</span></span> <span data-ttu-id="49f0b-118">涵盖的主题包括定义启用了 AJAX 的 Web 服务、 创建客户端代理和调用 Web 服务使用 JavaScript。</span><span class="sxs-lookup"><span data-stu-id="49f0b-118">Topics covered include defining AJAX-enabled Web Services, creating client proxies and calling Web Services with JavaScript.</span></span> <span data-ttu-id="49f0b-119">你还将看到如何直接到 ASP.NET 页方法进行 Web 服务调用。</span><span class="sxs-lookup"><span data-stu-id="49f0b-119">You'll also see how Web Service calls can be made directly to ASP.NET page methods.</span></span>

## <a name="web-services-configuration"></a><span data-ttu-id="49f0b-120">Web 服务配置</span><span class="sxs-lookup"><span data-stu-id="49f0b-120">Web Services Configuration</span></span>

<span data-ttu-id="49f0b-121">使用 Visual Studio 2008 创建新的网站项目后，web.config 文件将具有大量可能不熟悉的 Visual Studio 的早期版本的用户的新增功能。</span><span class="sxs-lookup"><span data-stu-id="49f0b-121">When a new Web Site project is created with Visual Studio 2008, the web.config file has a number of new additions that may be unfamiliar to users of previous versions of Visual Studio.</span></span> <span data-ttu-id="49f0b-122">以便它们可以用于在页中定义的其它必需 HttpHandlers 和 Httpmodule 时，这些修改的某些值映射到 ASP.NET AJAX 控件"asp"前缀。</span><span class="sxs-lookup"><span data-stu-id="49f0b-122">Some of these modifications map the "asp" prefix to ASP.NET AJAX controls so they can be used in pages while others define required HttpHandlers and HttpModules.</span></span> <span data-ttu-id="49f0b-123">列表 1 显示对所做的修改`<httpHandlers>`影响 Web 服务调用的 web.config 中的元素。</span><span class="sxs-lookup"><span data-stu-id="49f0b-123">Listing 1 shows modifications made to the `<httpHandlers>` element in web.config that affects Web Service calls.</span></span> <span data-ttu-id="49f0b-124">删除 HttpHandler 用于处理.asmx 调用默认值并将其替换为中 System.Web.Extensions.dll 程序集的 ScriptHandlerFactory 类。</span><span class="sxs-lookup"><span data-stu-id="49f0b-124">The default HttpHandler used to process .asmx calls is removed and replaced with a ScriptHandlerFactory class located in the System.Web.Extensions.dll assembly.</span></span> <span data-ttu-id="49f0b-125">System.Web.Extensions.dll 包含所有由 ASP.NET AJAX 的核心功能。</span><span class="sxs-lookup"><span data-stu-id="49f0b-125">System.Web.Extensions.dll contains all of the core functionality used by ASP.NET AJAX.</span></span>

<span data-ttu-id="49f0b-126">**列表 1。ASP.NET AJAX Web 服务处理程序配置**</span><span class="sxs-lookup"><span data-stu-id="49f0b-126">**Listing 1. ASP.NET AJAX Web Service Handler Configuration**</span></span>

[!code-xml[Main](understanding-asp-net-ajax-web-services/samples/sample1.xml)]

<span data-ttu-id="49f0b-127">使用 JavaScript Web 服务代理以便允许 JavaScript 对象表示法 (JSON) 调用必须做出从 ASP.NET AJAX 网页的.NET Web 服务，进行此 HttpHandler 替换。</span><span class="sxs-lookup"><span data-stu-id="49f0b-127">This HttpHandler replacement is made in order to allow JavaScript Object Notation (JSON) calls to be made from ASP.NET AJAX pages to .NET Web Services using a JavaScript Web Service proxy.</span></span> <span data-ttu-id="49f0b-128">ASP.NET AJAX 将 JSON 消息发送到 Web 服务，而不是标准的简单对象访问协议 (SOAP) 调用通常与 Web 服务相关联。</span><span class="sxs-lookup"><span data-stu-id="49f0b-128">ASP.NET AJAX sends JSON messages to Web Services as opposed to the standard Simple Object Access Protocol (SOAP) calls typically associated with Web Services.</span></span> <span data-ttu-id="49f0b-129">这会导致较小的请求和响应消息总体。</span><span class="sxs-lookup"><span data-stu-id="49f0b-129">This results in smaller request and response messages overall.</span></span> <span data-ttu-id="49f0b-130">它还允许将客户端处理更高效的数据由于 ASP.NET AJAX JavaScript 库进行优化，以使用 JSON 对象。</span><span class="sxs-lookup"><span data-stu-id="49f0b-130">It also allows for more efficient client-side processing of data since the ASP.NET AJAX JavaScript library is optimized to work with JSON objects.</span></span> <span data-ttu-id="49f0b-131">列出 2 和列出 3 显示的 Web 服务请求和响应消息序列化为 JSON 格式的示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-131">Listing 2 and Listing 3 show examples of Web Service request and response messages serialized to JSON format.</span></span> <span data-ttu-id="49f0b-132">列出 3 中的响应消息传递客户对象的数组和及其关联的属性时，请求消息中列出 2 所示将值为"比利时"国家/地区参数进行传递。</span><span class="sxs-lookup"><span data-stu-id="49f0b-132">The request message shown in Listing 2 passes a country parameter with a value of "Belgium" while the response message in Listing 3 passes an array of Customer objects and their associated properties.</span></span>

<span data-ttu-id="49f0b-133">**列出 2。Web 服务请求消息序列化为 JSON**</span><span class="sxs-lookup"><span data-stu-id="49f0b-133">**Listing 2. Web Service Request Message Serialized to JSON**</span></span>

[!code-json[Main](understanding-asp-net-ajax-web-services/samples/sample2.json)]

> <span data-ttu-id="49f0b-134">*> [!NOTE] 操作名称被指到 web 服务; URL 的一部分此外，请求消息不会始终提交通过 JSON。Web 服务可以利用 ScriptMethod 属性 UseHttpGet 参数设置为 true，这会导致参数通过传递查询字符串参数。*</span><span class="sxs-lookup"><span data-stu-id="49f0b-134">*> [!NOTE] the operation name is defined as part of the URL to the web service; additionally, request messages are not always submitted via JSON. Web Services can utilize the ScriptMethod attribute with the UseHttpGet parameter set to true, which causes parameters to be passed via a the query string parameters.*</span></span>


<span data-ttu-id="49f0b-135">**列出 3。Web 服务响应消息序列化为 JSON**</span><span class="sxs-lookup"><span data-stu-id="49f0b-135">**Listing 3. Web Service Response Message Serialized to JSON**</span></span>

[!code-json[Main](understanding-asp-net-ajax-web-services/samples/sample3.json)]

<span data-ttu-id="49f0b-136">在下一部分中，你将看到如何创建 Web 服务能够处理 JSON 请求消息和响应简单和复杂类型。</span><span class="sxs-lookup"><span data-stu-id="49f0b-136">In the next section you'll see how to create Web Services capable of handling JSON request messages and responding with both simple and complex types.</span></span>

## <a name="creating-ajax-enabled-web-services"></a><span data-ttu-id="49f0b-137">创建启用了 AJAX 的 Web 服务</span><span class="sxs-lookup"><span data-stu-id="49f0b-137">Creating AJAX-Enabled Web Services</span></span>

<span data-ttu-id="49f0b-138">ASP.NET AJAX 框架提供多种不同的方式来调用 Web 服务。</span><span class="sxs-lookup"><span data-stu-id="49f0b-138">The ASP.NET AJAX framework provides several different ways to call Web Services.</span></span> <span data-ttu-id="49f0b-139">你可以使用 AutoCompleteExtender 控件 （在 ASP.NET AJAX 工具包中可用） 或 JavaScript。</span><span class="sxs-lookup"><span data-stu-id="49f0b-139">You can use the AutoCompleteExtender control (available in the ASP.NET AJAX Toolkit) or JavaScript.</span></span> <span data-ttu-id="49f0b-140">但是，在调用服务之前必须 AJAX 启用它，以便它可以由客户端脚本代码调用。</span><span class="sxs-lookup"><span data-stu-id="49f0b-140">However, before calling a service you have to AJAX-enable it so that it can be called by client-script code.</span></span>

<span data-ttu-id="49f0b-141">无论你不熟悉 ASP.NET Web 服务，你将找到它简单地创建和支持 AJAX 的服务。</span><span class="sxs-lookup"><span data-stu-id="49f0b-141">Whether or not you're new to ASP.NET Web Services, you'll find it straightforward to create and AJAX-enable services.</span></span> <span data-ttu-id="49f0b-142">.NET framework 已支持的自 2002年中其初始发布 ASP.NET Web 服务的创建和使用 ASP.NET AJAX Extensions 提供基于.NET framework 的组默认的功能的其他 AJAX 功能。</span><span class="sxs-lookup"><span data-stu-id="49f0b-142">The .NET framework has supported the creation of ASP.NET Web Services since its initial release in 2002 and the ASP.NET AJAX Extensions provide additional AJAX functionality that builds upon the .NET framework's default set of features.</span></span> <span data-ttu-id="49f0b-143">Visual Studio.NET 2008 Beta 2 创建.asmx Web 服务文件的内置支持，并自动从 System.Web.Services.WebService 类派生类旁边的关联的代码。</span><span class="sxs-lookup"><span data-stu-id="49f0b-143">Visual Studio .NET 2008 Beta 2 has built-in support for creating .asmx Web Service files and automatically derives associated code beside classes from the System.Web.Services.WebService class.</span></span> <span data-ttu-id="49f0b-144">像将方法添加到类必须将应用以使其调用由 Web 服务使用者 WebMethod 特性。</span><span class="sxs-lookup"><span data-stu-id="49f0b-144">As you add methods into the class you must apply the WebMethod attribute in order for them to be called by Web Service consumers.</span></span>

<span data-ttu-id="49f0b-145">列出 4 显示了将 WebMethod 特性应用于一个名为 GetCustomersByCountry() 方法的示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-145">Listing 4 shows an example of applying the WebMethod attribute to a method named GetCustomersByCountry().</span></span>

<span data-ttu-id="49f0b-146">**列出 4。Web 服务中使用 WebMethod 特性**</span><span class="sxs-lookup"><span data-stu-id="49f0b-146">**Listing 4. Using the WebMethod Attribute in a Web Service**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample4.cs)]

<span data-ttu-id="49f0b-147">GetCustomersByCountry() 方法接受国家/地区参数，并返回一个客户对象数组。</span><span class="sxs-lookup"><span data-stu-id="49f0b-147">The GetCustomersByCountry() method accepts a country parameter and returns a Customer object array.</span></span> <span data-ttu-id="49f0b-148">传递给方法的国家/地区值转发到的业务层类，后者又调用以从数据库中检索数据的数据层类用数据填充客户对象属性，并返回的数组。</span><span class="sxs-lookup"><span data-stu-id="49f0b-148">The country value passed into the method is forwarded to a business layer class which in turn calls a data layer class to retrieve the data from the database, fill the Customer object properties with data and return the array.</span></span>

## <a name="using-the-scriptservice-attribute"></a><span data-ttu-id="49f0b-149">使用 ScriptService 特性</span><span class="sxs-lookup"><span data-stu-id="49f0b-149">Using the ScriptService Attribute</span></span>

<span data-ttu-id="49f0b-150">添加属性允许的标准 SOAP 消息发送到 Web 服务的客户端调用的 GetCustomersByCountry() 方法 WebMethod，时它不允许使用 JSON 调用以从 ASP.NET AJAX 应用程序在初始状态下进行。</span><span class="sxs-lookup"><span data-stu-id="49f0b-150">While adding the WebMethod attribute allows the GetCustomersByCountry() method to be called by clients that send standard SOAP messages to the Web Service, it doesn't allow JSON calls to be made from ASP.NET AJAX applications out of the box.</span></span> <span data-ttu-id="49f0b-151">若要允许进行你需要应用 ASP.NET AJAX 扩展的 JSON 调用`ScriptService`属性设为 Web 服务类。</span><span class="sxs-lookup"><span data-stu-id="49f0b-151">To allow JSON calls to be made you have to apply the ASP.NET AJAX Extension's `ScriptService` attribute to the Web Service class.</span></span> <span data-ttu-id="49f0b-152">这提供 Web 服务以发送响应消息使用 JSON 格式设置，并允许客户端脚本，以调用服务，将 JSON 消息发送。</span><span class="sxs-lookup"><span data-stu-id="49f0b-152">This enables a Web Service to send response messages formatted using JSON and allows client-side script to call a service by sending JSON messages.</span></span>

<span data-ttu-id="49f0b-153">列出 5 演示将 ScriptService 特性应用于一个名为 CustomersService 的 Web 服务类的一个示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-153">Listing 5 shows an example of applying the ScriptService attribute to a Web Service class named CustomersService.</span></span>

<span data-ttu-id="49f0b-154">**列出 5。使用支持 AJAX 的 Web 服务将 ScriptService 属性**</span><span class="sxs-lookup"><span data-stu-id="49f0b-154">**Listing 5. Using the ScriptService Attribute to AJAX-enable a Web Service**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample5.cs)]

<span data-ttu-id="49f0b-155">ScriptService 属性充当一种标记，该值指示它可以 AJAX 脚本代码中调用。</span><span class="sxs-lookup"><span data-stu-id="49f0b-155">The ScriptService attribute acts as a marker that indicates it can be called from AJAX script code.</span></span> <span data-ttu-id="49f0b-156">实际上，它不会处理任何 JSON 序列化或反序列化的任务在后台发生。</span><span class="sxs-lookup"><span data-stu-id="49f0b-156">It doesn't actually handle any of the JSON serialization or deserialization tasks that occur behind the scenes.</span></span> <span data-ttu-id="49f0b-157">（在 web.config 中配置） ScriptHandlerFactory 和其他相关的类执行大容量的 JSON 处理。</span><span class="sxs-lookup"><span data-stu-id="49f0b-157">The ScriptHandlerFactory (configured in web.config) and other related classes do the bulk of JSON processing.</span></span>

## <a name="using-the-scriptmethod-attribute"></a><span data-ttu-id="49f0b-158">使用 ScriptMethod 特性</span><span class="sxs-lookup"><span data-stu-id="49f0b-158">Using the ScriptMethod Attribute</span></span>

<span data-ttu-id="49f0b-159">ScriptService 属性是.NET Web 服务以使其以使用 ASP.NET AJAX 页中定义的唯一 ASP.NET AJAX 属性。</span><span class="sxs-lookup"><span data-stu-id="49f0b-159">The ScriptService attribute is the only ASP.NET AJAX attribute that has to be defined in a .NET Web Service in order for it to be used by ASP.NET AJAX pages.</span></span> <span data-ttu-id="49f0b-160">但是，还可以直接向服务中的 Web 方法应用名为 ScriptMethod 的另一个属性。</span><span class="sxs-lookup"><span data-stu-id="49f0b-160">However, another attribute named ScriptMethod can also be applied directly to Web Methods in a service.</span></span> <span data-ttu-id="49f0b-161">ScriptMethod 定义三个属性包括`UseHttpGet`，`ResponseFormat`和`XmlSerializeString`。</span><span class="sxs-lookup"><span data-stu-id="49f0b-161">ScriptMethod defines three properties including `UseHttpGet`, `ResponseFormat` and `XmlSerializeString`.</span></span> <span data-ttu-id="49f0b-162">更改这些属性的值可能会在接受 Web 方法的请求的类型需要更改为 GET、 Web 方法需要的形式返回原始 XML 数据时的情况下有用`XmlDocument`或`XmlElement`对象或从返回数据时 始终应为而不是 JSON 的 XML 序列化服务。</span><span class="sxs-lookup"><span data-stu-id="49f0b-162">Changing the values of these properties can be useful in cases where the type of request accepted by a Web Method needs to be changed to GET, when a Web Method needs to return raw XML data in the form of an `XmlDocument` or `XmlElement` object or when data returned from a service should always be serialized as XML instead of JSON.</span></span>

<span data-ttu-id="49f0b-163">当 Web 方法应接受时，可以使用属性 UseHttpGet 获取而不是发出的 POST 请求的请求。</span><span class="sxs-lookup"><span data-stu-id="49f0b-163">The UseHttpGet property can be used when a Web Method should accept GET requests as opposed to POST requests.</span></span> <span data-ttu-id="49f0b-164">使用 URL 与 Web 方法的输入参数转换为查询字符串参数发送请求。</span><span class="sxs-lookup"><span data-stu-id="49f0b-164">Requests are sent using a URL with Web Method input parameters converted to QueryString parameters.</span></span> <span data-ttu-id="49f0b-165">UseHttpGet 属性默认为 false，仅应设置为`true`当已知操作安全且当敏感数据不会传递到 Web 服务。</span><span class="sxs-lookup"><span data-stu-id="49f0b-165">The UseHttpGet property defaults to false and should only be set to `true` when operations are known to be safe and when sensitive data is not passed to a Web Service.</span></span> <span data-ttu-id="49f0b-166">列出 6 显示与 UseHttpGet 属性使用 ScriptMethod 属性的示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-166">Listing 6 shows an example of using the ScriptMethod attribute with the UseHttpGet property.</span></span>

<span data-ttu-id="49f0b-167">**列出 6。使用 UseHttpGet 属性 ScriptMethod 属性。**</span><span class="sxs-lookup"><span data-stu-id="49f0b-167">**Listing 6. Using the ScriptMethod attribute with the UseHttpGet property.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample6.cs)]

<span data-ttu-id="49f0b-168">下一步显示的列表 6 中所示的 HttpGetEcho Web 方法调用时发送的标头示例：</span><span class="sxs-lookup"><span data-stu-id="49f0b-168">An example of the headers sent when the HttpGetEcho Web Method shown in Listing 6 is called are shown next:</span></span>

`GET /CustomerViewer/DemoService.asmx/HttpGetEcho?input=%22Input Value%22 HTTP/1.1`

<span data-ttu-id="49f0b-169">当需要从服务，而不是 JSON 返回 XML 响应时，也可以还允许以接受 HTTP GET 请求的 Web 方法，使用 ScriptMethod 属性。</span><span class="sxs-lookup"><span data-stu-id="49f0b-169">In addition to allowing Web Methods to accept HTTP GET requests, the ScriptMethod attribute can also be used when XML responses need to be returned from a service rather than JSON.</span></span> <span data-ttu-id="49f0b-170">例如，Web 服务可能会检索远程站点中的 RSS 源，并将其作为 XmlDocument 或 XmlElement 对象。</span><span class="sxs-lookup"><span data-stu-id="49f0b-170">For example, a Web Service may retrieve an RSS feed from a remote site and return it as an XmlDocument or XmlElement object.</span></span> <span data-ttu-id="49f0b-171">处理 XML 数据然后出现客户端上。</span><span class="sxs-lookup"><span data-stu-id="49f0b-171">Processing of the XML data can then occur on the client.</span></span>

<span data-ttu-id="49f0b-172">列出 7 显示使用 ResponseFormat 属性来指定应从 Web 方法返回的 XML 数据的示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-172">Listing 7 shows an example of using the ResponseFormat property to specify that XML data should be returned from a Web Method.</span></span>

<span data-ttu-id="49f0b-173">**列出 7。使用 ResponseFormat 属性 ScriptMethod 属性。**</span><span class="sxs-lookup"><span data-stu-id="49f0b-173">**Listing 7. Using the ScriptMethod attribute with the ResponseFormat property.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample7.cs)]

<span data-ttu-id="49f0b-174">ResponseFormat 属性还可以与 XmlSerializeString 属性一起使用。</span><span class="sxs-lookup"><span data-stu-id="49f0b-174">The ResponseFormat property can also be used along with the XmlSerializeString property.</span></span> <span data-ttu-id="49f0b-175">XmlSerializeString 属性具有默认值为 false，这意味着所有返回除从某一 Web 方法返回的字符串之外的类型扩展会序列化为 XML 时`ResponseFormat`属性设置为`ResponseFormat.Xml`。</span><span class="sxs-lookup"><span data-stu-id="49f0b-175">The XmlSerializeString property has a default value of false which means that all return types except strings returned from a Web Method are serialized as XML when the `ResponseFormat` property is set to `ResponseFormat.Xml`.</span></span> <span data-ttu-id="49f0b-176">当`XmlSerializeString`设置为`true`，从某一 Web 方法返回的所有类型扩展会都序列化为 XML 包括字符串类型。</span><span class="sxs-lookup"><span data-stu-id="49f0b-176">When `XmlSerializeString` is set to `true`, all types returned from a Web Method are serialized as XML including string types.</span></span> <span data-ttu-id="49f0b-177">如果 ResponseFormat 属性值为`ResponseFormat.Json`XmlSerializeString 属性将被忽略。</span><span class="sxs-lookup"><span data-stu-id="49f0b-177">If the ResponseFormat property has a value of `ResponseFormat.Json` the XmlSerializeString property is ignored.</span></span>

<span data-ttu-id="49f0b-178">列出 8 演示使用 XmlSerializeString 属性以强制要序列化为 XML 的字符串的示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-178">Listing 8 shows an example of using the XmlSerializeString property to force strings to be serialized as XML.</span></span>

<span data-ttu-id="49f0b-179">**列出 8。ScriptMethod 属性使用 XmlSerializeString 属性**</span><span class="sxs-lookup"><span data-stu-id="49f0b-179">**Listing 8. Using the ScriptMethod attribute with the XmlSerializeString property**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample8.cs)]

<span data-ttu-id="49f0b-180">从调用列出 8 中所示的 GetXmlString Web 方法返回的值显示下一步：</span><span class="sxs-lookup"><span data-stu-id="49f0b-180">The value returned from calling the GetXmlString Web Method shown in Listing 8 is shown next:</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample9.cs)]

<span data-ttu-id="49f0b-181">尽管默认 JSON 格式的请求和响应消息的总体大小降到最低，以跨浏览器的方式更轻松地使用 ASP.NET AJAX 客户端，ResponseFormat 和 XmlSerializeString 属性可以是利用时客户端如 Internet Explorer 5 或更高版本的应用程序希望要从 Web 方法返回 XML 数据。</span><span class="sxs-lookup"><span data-stu-id="49f0b-181">Although the default JSON format minimizes the overall size of request and response messages and is more readily consumed by ASP.NET AJAX clients in a cross-browser manner, the ResponseFormat and XmlSerializeString properties can be utilized when client applications such as Internet Explorer 5 or higher expect XML data to be returned from a Web Method.</span></span>

## <a name="working-with-complex-types"></a><span data-ttu-id="49f0b-182">使用复杂类型</span><span class="sxs-lookup"><span data-stu-id="49f0b-182">Working with Complex Types</span></span>

<span data-ttu-id="49f0b-183">列出 5 介绍了返回名为从 Web 服务的客户的复杂类型的一个示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-183">Listing 5 showed an example of returning a complex type named Customer from a Web Service.</span></span> <span data-ttu-id="49f0b-184">Customer 类内部定义为属性，例如 FirstName 和 LastName 的几种不同的简单类型。</span><span class="sxs-lookup"><span data-stu-id="49f0b-184">The Customer class defines several different simple types internally as properties such as FirstName and LastName.</span></span> <span data-ttu-id="49f0b-185">复杂类型用作输入参数，或在启用了 AJAX 的 Web 方法的返回类型将自动序列化为 JSON 发送到客户端之前。</span><span class="sxs-lookup"><span data-stu-id="49f0b-185">Complex types used as an input parameter or return type on an AJAX-enabled Web Method are automatically serialized into JSON before being sent to the client-side.</span></span> <span data-ttu-id="49f0b-186">但是，嵌套的复杂类型 （那些在另一个类型内内部定义） 不将提供给客户端作为独立对象默认情况下。</span><span class="sxs-lookup"><span data-stu-id="49f0b-186">However, nested complex types (those defined internally within another type) are not made available to the client as standalone objects by default.</span></span>

<span data-ttu-id="49f0b-187">在其中嵌套复杂类型由 Web 服务还必须使用在客户端页中的情况下，ASP.NET AJAX GenerateScriptType 属性可以添加到 Web 服务。</span><span class="sxs-lookup"><span data-stu-id="49f0b-187">In cases where a nested complex type used by a Web Service must also be used in a client page, the ASP.NET AJAX GenerateScriptType attribute can be added to the Web Service.</span></span> <span data-ttu-id="49f0b-188">例如，列出 9 所示的 CustomerDetails 类包含地址和性别属性其中***表示嵌套的复杂类型。***</span><span class="sxs-lookup"><span data-stu-id="49f0b-188">For example, the CustomerDetails class shown in Listing 9 contains Address and Gender properties which ***represent nested complex types.***</span></span>

<span data-ttu-id="49f0b-189">**列出 9。此处显示的 CustomerDetails 类包含两个嵌套的复杂类型。**</span><span class="sxs-lookup"><span data-stu-id="49f0b-189">**Listing 9. The CustomerDetails class shown here contains two nested complex types.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample10.cs)]

<span data-ttu-id="49f0b-190">列出 9 所示 CustomerDetails 类中定义的地址和性别对象不会自动将提供用于在通过 JavaScript 客户端由于它们是嵌套的类型 （地址是一个类和性别是一个枚举）。</span><span class="sxs-lookup"><span data-stu-id="49f0b-190">The Address and Gender objects defined within the CustomerDetails class shown in Listing 9 won't automatically be made available for use on the client-side via JavaScript since they are nested types (Address is a class and Gender is an enumeration).</span></span> <span data-ttu-id="49f0b-191">可以在其中使用在 Web 服务内的嵌套的类型必须在客户端上可用的情况下，使用前面所述 GenerateScriptType 属性 （请参阅列出 10）。</span><span class="sxs-lookup"><span data-stu-id="49f0b-191">In situations where a nested type used within a Web Service must be available on the client-side, the GenerateScriptType attribute mentioned earlier can be used (see Listing 10).</span></span> <span data-ttu-id="49f0b-192">在其中从服务返回不同的嵌套复杂类型的情况下，此属性可以添加多个时间。</span><span class="sxs-lookup"><span data-stu-id="49f0b-192">This attribute can be added multiple times in cases where different nested complex types are returned from a service.</span></span> <span data-ttu-id="49f0b-193">它可以应用直接与 Web 服务类或更高版本特定的 Web 方法。</span><span class="sxs-lookup"><span data-stu-id="49f0b-193">It can be applied directly to the Web Service class or above specific Web Methods.</span></span>

<span data-ttu-id="49f0b-194">**列出 10。使用 GenerateScriptService 特性定义应可供客户端的嵌套的类型。**</span><span class="sxs-lookup"><span data-stu-id="49f0b-194">**Listing 10. Using the GenerateScriptService attribute to define nested types that should be available to the client.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample11.cs)]

<span data-ttu-id="49f0b-195">通过应用`GenerateScriptType`到 Web 服务、 地址和性别类型的属性将自动变为可供使用的客户端 ASP.NET AJAX JavaScript 代码。</span><span class="sxs-lookup"><span data-stu-id="49f0b-195">By applying the `GenerateScriptType` attribute to the Web Service, the Address and Gender types will automatically be made available for use by client-side ASP.NET AJAX JavaScript code.</span></span> <span data-ttu-id="49f0b-196">自动生成并通过 Web 服务上添加 GenerateScriptType 属性发送到客户端 JavaScript 的示例所示列出 11。</span><span class="sxs-lookup"><span data-stu-id="49f0b-196">An example of the JavaScript that is automatically generated and sent to the client by adding the GenerateScriptType attribute on a Web Service is shown in Listing 11.</span></span> <span data-ttu-id="49f0b-197">你将看到如何更高版本在文章中使用嵌套的复杂类型。</span><span class="sxs-lookup"><span data-stu-id="49f0b-197">You'll see how to use nested complex types later in the article.</span></span>

<span data-ttu-id="49f0b-198">**列出 11。提供给 ASP.NET AJAX 页上的嵌套复杂类型。**</span><span class="sxs-lookup"><span data-stu-id="49f0b-198">**Listing 11. Nested complex types made available to an ASP.NET AJAX page.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample12.cs)]

<span data-ttu-id="49f0b-199">现在，你已了解如何创建 Web 服务并使它们的 ASP.NET AJAX 页可以访问，让我们看看如何创建和使用 JavaScript 代理，以便可以检索数据，或将其发送到 Web 服务。</span><span class="sxs-lookup"><span data-stu-id="49f0b-199">Now that you've seen how to create Web Services and make them accessible to ASP.NET AJAX pages, let's take a look at how to create and use JavaScript proxies so that data can be retrieved or sent to Web Services.</span></span>

## <a name="creating-javascript-proxies"></a><span data-ttu-id="49f0b-200">创建 JavaScript 代理</span><span class="sxs-lookup"><span data-stu-id="49f0b-200">Creating JavaScript Proxies</span></span>

<span data-ttu-id="49f0b-201">调用标准 Web 服务 （.NET 或另一个平台） 通常涉及到创建从发送 SOAP 请求和响应消息的复杂性可保护你的代理对象。</span><span class="sxs-lookup"><span data-stu-id="49f0b-201">Calling a standard Web Service (.NET or another platform) typically involves creating a proxy object that shields you from the complexities of sending SOAP request and response messages.</span></span> <span data-ttu-id="49f0b-202">与 ASP.NET AJAX Web 服务调用，可创建和用于轻松地调用而无需担心序列化和反序列化 JSON 消息的服务的 JavaScript 代理。</span><span class="sxs-lookup"><span data-stu-id="49f0b-202">With ASP.NET AJAX Web Service calls, JavaScript proxies can be created and used to easily call services without worrying about serializing and deserializing JSON messages.</span></span> <span data-ttu-id="49f0b-203">可以通过使用 ASP.NET AJAX ScriptManager 控件自动生成 JavaScript 代理。</span><span class="sxs-lookup"><span data-stu-id="49f0b-203">JavaScript proxies can be automatically generated by using the ASP.NET AJAX ScriptManager control.</span></span>

<span data-ttu-id="49f0b-204">创建可调用 Web 服务的 JavaScript 代理是通过 ScriptManager 的服务属性来完成。</span><span class="sxs-lookup"><span data-stu-id="49f0b-204">Creating a JavaScript proxy that can call Web Services is accomplished by using the ScriptManager's Services property.</span></span> <span data-ttu-id="49f0b-205">此属性允许你定义一个或多个服务的 ASP.NET AJAX 页上可以以异步方式调用，以发送或接收数据，而无需回发的操作。</span><span class="sxs-lookup"><span data-stu-id="49f0b-205">This property allows you to define one or more services that an ASP.NET AJAX page can call asynchronously to send or receive data without requiring postback operations.</span></span> <span data-ttu-id="49f0b-206">通过使用 ASP.NET AJAX 定义服务`ServiceReference`控件并将 Web 服务 URL 分配给控件的`Path`属性。</span><span class="sxs-lookup"><span data-stu-id="49f0b-206">You define a service by using the ASP.NET AJAX `ServiceReference` control and assigning the Web Service URL to the control's `Path` property.</span></span> <span data-ttu-id="49f0b-207">列出 12 显示一个引用名为 CustomersService.asmx 的服务的示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-207">Listing 12 shows an example of referencing a service named CustomersService.asmx.</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample13.aspx)]

<span data-ttu-id="49f0b-208">**列出 12。定义中的 ASP.NET AJAX 页上使用的 Web 服务。**</span><span class="sxs-lookup"><span data-stu-id="49f0b-208">**Listing 12. Defining a Web Service used in an ASP.NET AJAX page.**</span></span>

<span data-ttu-id="49f0b-209">添加对通过 ScriptManager 控件 CustomersService.asmx 的引用会导致一个 JavaScript 代理，以动态生成并被的页引用。</span><span class="sxs-lookup"><span data-stu-id="49f0b-209">Adding a reference to the CustomersService.asmx through the ScriptManager control causes a JavaScript proxy to be dynamically generated and referenced by the page.</span></span> <span data-ttu-id="49f0b-210">通过使用嵌入代理&lt;脚本&gt;标记和动态加载通过调用 CustomersService.asmx 文件并正在并可通过 /js 追加到末尾。</span><span class="sxs-lookup"><span data-stu-id="49f0b-210">The proxy is embedded by using the &lt;script&gt; tag and dynamically loaded by calling the CustomersService.asmx file and appending /js to the end of it.</span></span> <span data-ttu-id="49f0b-211">下面的示例演示如何 JavaScript 代理在页中时嵌入在 web.config 中禁用调试：</span><span class="sxs-lookup"><span data-stu-id="49f0b-211">The following example shows how the JavaScript proxy is embedded in the page when debugging is disabled in web.config:</span></span>

[!code-html[Main](understanding-asp-net-ajax-web-services/samples/sample14.html)]

> <span data-ttu-id="49f0b-212">*> [!NOTE] 如果你想要查看生成的实际 JavaScript 代理代码可以在 Internet Explorer 的地址框中键入所需的.NET Web 服务的 URL，还可以将并可通过 /js 追加到它的末尾。*</span><span class="sxs-lookup"><span data-stu-id="49f0b-212">*> [!NOTE] If you'd like to see the actual JavaScript proxy code that is generated you can type the URL to the desired .NET Web Service into Internet Explorer's address box and append /js to the end of it.*</span></span>


<span data-ttu-id="49f0b-213">如果 JavaScript 代理的调试版本将在页中为嵌入的 web.config 中启用了调试显示下一步:</span><span class="sxs-lookup"><span data-stu-id="49f0b-213">If debugging is enabled in web.config a debug version of the JavaScript proxy will be embedded in the page as shown next:</span></span>

[!code-html[Main](understanding-asp-net-ajax-web-services/samples/sample15.html)]

<span data-ttu-id="49f0b-214">创建通过 ScriptManager 的 JavaScript 代理也可以直接到页面嵌入而不是使用引用&lt;脚本&gt;标记的 src 属性。</span><span class="sxs-lookup"><span data-stu-id="49f0b-214">The JavaScript proxy created by the ScriptManager can also be embedded directly into the page rather than referenced using the &lt;script&gt; tag's src attribute.</span></span> <span data-ttu-id="49f0b-215">这可以通过将 ServiceReference 控件的 InlineScript 属性设置为 true （默认值为 false）。</span><span class="sxs-lookup"><span data-stu-id="49f0b-215">This can be done by setting the ServiceReference control's InlineScript property to true (the default is false).</span></span> <span data-ttu-id="49f0b-216">代理不共享跨多页和你想要减少对服务器进行网络调用的数量时，这很有用。</span><span class="sxs-lookup"><span data-stu-id="49f0b-216">This can be useful when a proxy isn't shared across multiple pages and when you'd like to reduce the number of network calls made to the server.</span></span> <span data-ttu-id="49f0b-217">不会由浏览器缓存 InlineScript 当设置为 true 的代理脚本，因此在其中由 ASP.NET AJAX 应用程序中的多个页使用的代理的情况下建议的默认值为 false。</span><span class="sxs-lookup"><span data-stu-id="49f0b-217">When InlineScript is set to true the proxy script won't be cached by the browser so the default value of false is recommended in cases where the proxy is used by multiple pages in an ASP.NET AJAX application.</span></span> <span data-ttu-id="49f0b-218">使用 InlineScript 属性的示例显示下一步：</span><span class="sxs-lookup"><span data-stu-id="49f0b-218">An example of using the InlineScript property is shown next:</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample16.aspx)]

## <a name="using-javascript-proxies"></a><span data-ttu-id="49f0b-219">使用 JavaScript 代理</span><span class="sxs-lookup"><span data-stu-id="49f0b-219">Using JavaScript Proxies</span></span>

<span data-ttu-id="49f0b-220">一旦 Web 服务引用使用 ScriptManager 控件的 ASP.NET AJAX 页上，可以对 Web 服务进行调用，并且可以使用回调函数对返回的数据进行处理。</span><span class="sxs-lookup"><span data-stu-id="49f0b-220">Once a Web Service is referenced by an ASP.NET AJAX page using the ScriptManager control, a call can be made to the Web Service and the returned data can be handled using callback functions.</span></span> <span data-ttu-id="49f0b-221">引用命名空间 （如果存在）、 类名和 Web 方法名称由调用 Web 服务。</span><span class="sxs-lookup"><span data-stu-id="49f0b-221">A Web Service is called by referencing its namespace (if one exists), class name and Web Method name.</span></span> <span data-ttu-id="49f0b-222">以及处理返回的数据的回调函数，可以定义传递给 Web 服务的任何参数。</span><span class="sxs-lookup"><span data-stu-id="49f0b-222">Any parameters passed to the Web Service can be defined along with a callback function that handles the returned data.</span></span>

<span data-ttu-id="49f0b-223">使用 JavaScript 代理来调用一个名为 GetCustomersByCountry() 的 Web 方法的示例所示列出 13。</span><span class="sxs-lookup"><span data-stu-id="49f0b-223">An example of using a JavaScript proxy to call a Web Method named GetCustomersByCountry() is shown in Listing 13.</span></span> <span data-ttu-id="49f0b-224">当最终用户单击页面上的按钮时调用 GetCustomersByCountry() 函数。</span><span class="sxs-lookup"><span data-stu-id="49f0b-224">The GetCustomersByCountry() function is called when an end user clicks a button on the page.</span></span>

<span data-ttu-id="49f0b-225">**列出 13。调用 Web 服务时使用的 JavaScript 代理。**</span><span class="sxs-lookup"><span data-stu-id="49f0b-225">**Listing 13. Calling a Web Service with a JavaScript proxy.**</span></span>

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample17.js)]

<span data-ttu-id="49f0b-226">此调用引用 InterfaceTraining 命名空间，在服务中定义 CustomersService 类和 GetCustomersByCountry Web 方法。</span><span class="sxs-lookup"><span data-stu-id="49f0b-226">This call references the InterfaceTraining namespace, CustomersService class and GetCustomersByCountry Web Method defined in the service.</span></span> <span data-ttu-id="49f0b-227">它将传递从文本框中获取一个国家/地区值，以及一个名为 OnWSRequestComplete 异步的 Web 服务调用返回时应调用的回调函数。</span><span class="sxs-lookup"><span data-stu-id="49f0b-227">It passes a country value obtained from a textbox as well as a callback function named OnWSRequestComplete that should be invoked when the asynchronous Web Service call returns.</span></span> <span data-ttu-id="49f0b-228">OnWSRequestComplete 处理从服务返回的客户对象的数组，并将它们转换为页中显示的表。</span><span class="sxs-lookup"><span data-stu-id="49f0b-228">OnWSRequestComplete handles the array of Customer objects returned from the service and converts them into a table that is displayed in the page.</span></span> <span data-ttu-id="49f0b-229">从调用生成的输出，如图 1 所示。</span><span class="sxs-lookup"><span data-stu-id="49f0b-229">The output generated from the call is shown in Figure 1.</span></span>


<span data-ttu-id="49f0b-230">[![通过进行异步 AJAX 调用到 Web 服务获取的数据绑定。](understanding-asp-net-ajax-web-services/_static/image2.png)](understanding-asp-net-ajax-web-services/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="49f0b-230">[![Binding data obtained by making an asynchronous AJAX call to a Web Service.](understanding-asp-net-ajax-web-services/_static/image2.png)](understanding-asp-net-ajax-web-services/_static/image1.png)</span></span>

<span data-ttu-id="49f0b-231">**图 1**： 将数据绑定通过进行异步 AJAX 调用到 Web 服务。</span><span class="sxs-lookup"><span data-stu-id="49f0b-231">**Figure 1**: Binding data obtained by making an asynchronous AJAX call to a Web Service.</span></span>  <span data-ttu-id="49f0b-232">([单击以查看实际尺寸的图像](understanding-asp-net-ajax-web-services/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="49f0b-232">([Click to view full-size image](understanding-asp-net-ajax-web-services/_static/image3.png))</span></span>


<span data-ttu-id="49f0b-233">JavaScript 代理还可单向调用到 Web 服务在情况下，应调用 Web 方法，但代理不应等待的响应。</span><span class="sxs-lookup"><span data-stu-id="49f0b-233">JavaScript proxies can also make one-way calls to Web Services in cases where a Web Method should be called but the proxy shouldn't wait for a response.</span></span> <span data-ttu-id="49f0b-234">例如，你可能想要调用 Web 服务以启动进程如工作流，但不是等待从服务返回值。</span><span class="sxs-lookup"><span data-stu-id="49f0b-234">For example, you may want to call a Web Service to start a process such as a work-flow but not wait for a return value from the service.</span></span> <span data-ttu-id="49f0b-235">在单向调用需要向服务发出的情况下，只需可以省略列出 13 中所示的回调函数。</span><span class="sxs-lookup"><span data-stu-id="49f0b-235">In cases where a one-way call needs to be made to a service, the callback function shown in Listing 13 can simply be omitted.</span></span> <span data-ttu-id="49f0b-236">由于不定义任何回调函数的代理对象不会等待 Web 服务以返回数据。</span><span class="sxs-lookup"><span data-stu-id="49f0b-236">Since no callback function is defined the proxy object will not wait for the Web Service to return data.</span></span>

## <a name="handling-errors"></a><span data-ttu-id="49f0b-237">处理错误</span><span class="sxs-lookup"><span data-stu-id="49f0b-237">Handling Errors</span></span>

<span data-ttu-id="49f0b-238">对 Web 服务的异步回调可能会遇到错误，例如网络停机，Web 服务变得不可用或返回异常的不同的类型。</span><span class="sxs-lookup"><span data-stu-id="49f0b-238">Asynchronous callbacks to Web Services can encounter different types of errors such as the network being down, the Web Service being unavailable or an exception being returned.</span></span> <span data-ttu-id="49f0b-239">幸运的是，生成的 ScriptManager 的 JavaScript 代理对象允许将多个回调，以定义用于处理错误和失败除了前面所示的 success 回调。</span><span class="sxs-lookup"><span data-stu-id="49f0b-239">Fortunately, JavaScript proxy objects generated by the ScriptManager allow multiple callbacks to be defined to handle errors and failures in addition to the success callback shown earlier.</span></span> <span data-ttu-id="49f0b-240">列出 14 中所示，可以对 Web 方法的调用中的标准的回调函数后立即定义了错误的回调函数。</span><span class="sxs-lookup"><span data-stu-id="49f0b-240">An error callback function can be defined immediately after the standard callback function in the call to the Web Method as shown in Listing 14.</span></span>

<span data-ttu-id="49f0b-241">**列出 14。定义了错误的回调函数并显示错误。**</span><span class="sxs-lookup"><span data-stu-id="49f0b-241">**Listing 14. Defining an error callback function and displaying errors.**</span></span>

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample18.js)]

<span data-ttu-id="49f0b-242">当调用 Web 服务发生任何错误将触发 OnWSRequestFailed() 回调函数，它接受一个表示错误作为参数的对象调用。</span><span class="sxs-lookup"><span data-stu-id="49f0b-242">Any errors that occur when the Web Service is called will trigger the OnWSRequestFailed() callback function to be called which accepts an object representing the error as a parameter.</span></span> <span data-ttu-id="49f0b-243">错误对象公开几个不同的函数，以确定错误的原因以及调用的操作已超时。列出 14 举例说明如何使用不同的错误函数和图 2 显示了由函数生成的输出示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-243">The error object exposes several different functions to determine the cause of the error as well as whether or not the call timed out. Listing 14 shows an example of using the different error functions and Figure 2 shows an example of the output generated by the functions.</span></span>


<span data-ttu-id="49f0b-244">[![通过调用 ASP.NET AJAX 错误函数生成的输出。](understanding-asp-net-ajax-web-services/_static/image5.png)](understanding-asp-net-ajax-web-services/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="49f0b-244">[![Output generated by calling ASP.NET AJAX error functions.](understanding-asp-net-ajax-web-services/_static/image5.png)](understanding-asp-net-ajax-web-services/_static/image4.png)</span></span>

<span data-ttu-id="49f0b-245">**图 2**： 通过调用 ASP.NET AJAX 错误函数生成的输出。</span><span class="sxs-lookup"><span data-stu-id="49f0b-245">**Figure 2**: Output generated by calling ASP.NET AJAX error functions.</span></span>  <span data-ttu-id="49f0b-246">([单击以查看实际尺寸的图像](understanding-asp-net-ajax-web-services/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="49f0b-246">([Click to view full-size image](understanding-asp-net-ajax-web-services/_static/image6.png))</span></span>


## <a name="handling-xml-data-returned-from-a-web-service"></a><span data-ttu-id="49f0b-247">处理从 Web 服务返回的 XML 数据</span><span class="sxs-lookup"><span data-stu-id="49f0b-247">Handling XML Data Returned from a Web Service</span></span>

<span data-ttu-id="49f0b-248">前面你已了解如何 Web 方法无法返回原始 XML 数据，通过使用 ScriptMethod 属性以及其 ResponseFormat 属性。</span><span class="sxs-lookup"><span data-stu-id="49f0b-248">Earlier you saw how a Web Method could return raw XML data by using the ScriptMethod attribute along with its ResponseFormat property.</span></span> <span data-ttu-id="49f0b-249">当 ResponseFormat 设置为 ResponseFormat.Xml 时，从 Web 服务返回的数据被序列化为 xml 格式，而不是 JSON。</span><span class="sxs-lookup"><span data-stu-id="49f0b-249">When ResponseFormat is set to ResponseFormat.Xml, data returned from the Web Service is serialized as XML rather than JSON.</span></span> <span data-ttu-id="49f0b-250">如果需要被直接传递到客户端使用 JavaScript 或 XSLT 处理 XML 数据，这很有用。</span><span class="sxs-lookup"><span data-stu-id="49f0b-250">This can be useful when XML data needs to be passed directly to the client for processing using JavaScript or XSLT.</span></span> <span data-ttu-id="49f0b-251">在当前时间，Internet Explorer 5 或更高版本提供最佳的客户端对象模型，用于分析和筛选由于它内置对 MSXML 支持的 XML 数据。</span><span class="sxs-lookup"><span data-stu-id="49f0b-251">At the current time, Internet Explorer 5 or higher provides the best client-side object model for parsing and filtering XML data due to its built-in support for MSXML.</span></span>

<span data-ttu-id="49f0b-252">从 Web 服务检索 XML 数据是比检索其他数据类型没有什么不同。</span><span class="sxs-lookup"><span data-stu-id="49f0b-252">Retrieving XML data from a Web Service is no different than retrieving other data types.</span></span> <span data-ttu-id="49f0b-253">通过调用要调用相应的函数，并定义回调函数的 JavaScript 代理启动。</span><span class="sxs-lookup"><span data-stu-id="49f0b-253">Start by invoking the JavaScript proxy to call the appropriate function and define a callback function.</span></span> <span data-ttu-id="49f0b-254">在调用返回后，你可以然后处理回调函数中的数据。</span><span class="sxs-lookup"><span data-stu-id="49f0b-254">Once the call returns you can then process the data in the callback function.</span></span>

<span data-ttu-id="49f0b-255">列出 15 显示调用一个名为 GetRssFeed() 返回一个 XmlElement 对象的 Web 方法的示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-255">Listing 15 shows an example of calling a Web Method named GetRssFeed() that returns an XmlElement object.</span></span> <span data-ttu-id="49f0b-256">GetRssFeed() 接受单个参数的 rss 源来检索表示 URL。</span><span class="sxs-lookup"><span data-stu-id="49f0b-256">GetRssFeed() accepts a single parameter representing the URL for the RSS feed to retrieve.</span></span>

<span data-ttu-id="49f0b-257">**列出 15。使用 Web 服务返回的 XML 数据。**</span><span class="sxs-lookup"><span data-stu-id="49f0b-257">**Listing 15. Working with XML data returned from a Web Service.**</span></span>

[!code-html[Main](understanding-asp-net-ajax-web-services/samples/sample19.html)]

<span data-ttu-id="49f0b-258">此示例将 URL 传递给 RSS 源，并处理 OnWSRequestComplete() 函数中返回的 XML 数据。</span><span class="sxs-lookup"><span data-stu-id="49f0b-258">This example passes a URL to an RSS feed and processes the returned XML data in the OnWSRequestComplete() function.</span></span> <span data-ttu-id="49f0b-259">OnWSRequestComplete() 首先进行检查，以查看浏览器是否知道 MSXML 分析器是可用的 Internet Explorer。</span><span class="sxs-lookup"><span data-stu-id="49f0b-259">OnWSRequestComplete() first checks to see if the browser is Internet Explorer to know whether or not the MSXML parser is available.</span></span> <span data-ttu-id="49f0b-260">如果是，使用 XPath 语句查找全部&lt;项&gt;RSS 源中的标记。</span><span class="sxs-lookup"><span data-stu-id="49f0b-260">If it is, an XPath statement is used to locate all &lt;item&gt; tags within the RSS feed.</span></span> <span data-ttu-id="49f0b-261">然后循环访问每个项和关联&lt;标题&gt;和&lt;链接&gt;标记是位于和处理以显示每个项的数据。</span><span class="sxs-lookup"><span data-stu-id="49f0b-261">Each item is then iterated through and the associated &lt;title&gt; and &lt;link&gt; tags are located and processed to display each item's data.</span></span> <span data-ttu-id="49f0b-262">图 3 显示生成进行调用通过指向 GetRssFeed() Web 方法的 JavaScript 代理 ASP.NET AJAX 的输出的示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-262">Figure 3 shows an example of the output generated from making an ASP.NET AJAX call through a JavaScript proxy to the GetRssFeed() Web Method.</span></span>

## <a name="handling-complex-types"></a><span data-ttu-id="49f0b-263">处理复杂类型</span><span class="sxs-lookup"><span data-stu-id="49f0b-263">Handling Complex Types</span></span>

<span data-ttu-id="49f0b-264">通过 JavaScript 代理自动公开接受或 Web 服务返回的复杂类型。</span><span class="sxs-lookup"><span data-stu-id="49f0b-264">Complex types accepted or returned by a Web Service are automatically exposed through a JavaScript proxy.</span></span> <span data-ttu-id="49f0b-265">但是，除非 GenerateScriptType 属性应用于服务，如前文所述嵌套复杂类型不直接访问客户端上。</span><span class="sxs-lookup"><span data-stu-id="49f0b-265">However, nested complex types are not directly accessible on the client-side unless the GenerateScriptType attribute is applied to the service as discussed earlier.</span></span> <span data-ttu-id="49f0b-266">为什么要在客户端使用嵌套的复杂类型？</span><span class="sxs-lookup"><span data-stu-id="49f0b-266">Why would you want to use a nested complex type on the client-side?</span></span>

<span data-ttu-id="49f0b-267">若要回答这个问题，假设的 ASP.NET AJAX 页上显示客户数据，并允许最终用户以更新客户的地址。</span><span class="sxs-lookup"><span data-stu-id="49f0b-267">To answer this question, assume that an ASP.NET AJAX page displays customer data and allows end users to update a customer's address.</span></span> <span data-ttu-id="49f0b-268">如果 Web 服务指定地址类型 （CustomerDetails 类中定义的复杂类型），可以发送到客户端的更新过程可以分为供重复使用更好代码单独的功能。</span><span class="sxs-lookup"><span data-stu-id="49f0b-268">If the Web Service specifies that the Address type (a complex type defined within a CustomerDetails class) can be sent to the client then the update process can be divided into separate functions for better code re-use.</span></span>


<span data-ttu-id="49f0b-269">[![从调用返回 RSS 数据的 Web 服务创建的输出。](understanding-asp-net-ajax-web-services/_static/image8.png)](understanding-asp-net-ajax-web-services/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="49f0b-269">[![Output creating from calling a Web Service that returns RSS data.](understanding-asp-net-ajax-web-services/_static/image8.png)](understanding-asp-net-ajax-web-services/_static/image7.png)</span></span>

<span data-ttu-id="49f0b-270">**图 3**： 输出从调用返回 RSS 数据的 Web 服务创建。</span><span class="sxs-lookup"><span data-stu-id="49f0b-270">**Figure 3**: Output creating from calling a Web Service that returns RSS data.</span></span>  <span data-ttu-id="49f0b-271">([单击以查看实际尺寸的图像](understanding-asp-net-ajax-web-services/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="49f0b-271">([Click to view full-size image](understanding-asp-net-ajax-web-services/_static/image9.png))</span></span>


<span data-ttu-id="49f0b-272">列出 16 显示模型命名空间中，在定义的地址对象时，将调用的客户端代码的示例使用更新后的数据填充它，并将其分配给 CustomerDetails 对象的地址属性。</span><span class="sxs-lookup"><span data-stu-id="49f0b-272">Listing 16 shows an example of client-side code that invokes an Address object defined in a Model namespace, fills it with updated data and assigns it to a CustomerDetails object's Address property.</span></span> <span data-ttu-id="49f0b-273">然后将 CustomerDetails 对象传递到 Web 服务进行处理。</span><span class="sxs-lookup"><span data-stu-id="49f0b-273">The CustomerDetails object is then passed to the Web Service for processing.</span></span>

<span data-ttu-id="49f0b-274">**列出 16。使用嵌套的复杂类型**</span><span class="sxs-lookup"><span data-stu-id="49f0b-274">**Listing 16. Using nested complex types**</span></span>

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample20.js)]

## <a name="creating-and-using-page-methods"></a><span data-ttu-id="49f0b-275">创建和使用页方法</span><span class="sxs-lookup"><span data-stu-id="49f0b-275">Creating and Using Page Methods</span></span>

<span data-ttu-id="49f0b-276">Web 服务提供将重新可用服务向客户端包括 ASP.NET AJAX 页各种的极佳途径。</span><span class="sxs-lookup"><span data-stu-id="49f0b-276">Web Services provide an excellent way to expose re-useable services to a variety of clients including ASP.NET AJAX pages.</span></span> <span data-ttu-id="49f0b-277">但是，可能需要检索数据，而不会使用或由其他页面共享页的情况。</span><span class="sxs-lookup"><span data-stu-id="49f0b-277">However, there may be cases where a page needs to retrieve data that won't ever be used or shared by other pages.</span></span> <span data-ttu-id="49f0b-278">在这种情况下，.asmx 文件来允许页后，可以访问的数据可能看上去太过严厉因为单个页面仅使用该服务。</span><span class="sxs-lookup"><span data-stu-id="49f0b-278">In this case, making an .asmx file to allow the page to access the data may seem like overkill since the service is only used by a single page.</span></span>

<span data-ttu-id="49f0b-279">ASP.NET AJAX 提供了另一种机制，而无需创建独立.asmx 文件以 Web 类似于服务的调用。</span><span class="sxs-lookup"><span data-stu-id="49f0b-279">ASP.NET AJAX provides another mechanism for making Web Service-like calls without creating standalone .asmx files.</span></span> <span data-ttu-id="49f0b-280">这可通过使用一种技术称为"页方法"。</span><span class="sxs-lookup"><span data-stu-id="49f0b-280">This is done by using a technique referred to as "page methods".</span></span> <span data-ttu-id="49f0b-281">页方法是静态 (共享在 VB.NET) 方法直接在页或代码旁置文件中嵌入具有应用于它们的 WebMethod 属性。</span><span class="sxs-lookup"><span data-stu-id="49f0b-281">Page methods are static (shared in VB.NET) methods embedded directly in a page or code-beside file that have the WebMethod attribute applied to them.</span></span> <span data-ttu-id="49f0b-282">通过应用 WebMethod 特性它们可以调用使用名为 PageMethods 获取在运行时动态创建一个特殊的 JavaScript 对象。</span><span class="sxs-lookup"><span data-stu-id="49f0b-282">By applying the WebMethod attribute they can be called using a special JavaScript object named PageMethods that gets dynamically created at runtime.</span></span> <span data-ttu-id="49f0b-283">PageMethods 对象充当一个 JSON 序列化/反序列化过程中保护你的代理服务器。</span><span class="sxs-lookup"><span data-stu-id="49f0b-283">The PageMethods object acts as a proxy that shields you from the JSON serialization/deserialization process.</span></span> <span data-ttu-id="49f0b-284">请注意，为了使用 PageMethods 对象必须将 ScriptManager EnablePageMethods 属性设置为 true。</span><span class="sxs-lookup"><span data-stu-id="49f0b-284">Note that in order to use the PageMethods object you must set the ScriptManager's EnablePageMethods property to true.</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample21.aspx)]

<span data-ttu-id="49f0b-285">列出 17 演示在 ASP.NET 代码旁置类定义两个页方法的示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-285">Listing 17 shows an example of defining two page methods in an ASP.NET code-beside class.</span></span> <span data-ttu-id="49f0b-286">这些方法从应用中的业务层类中检索数据\_的网站代码文件夹。</span><span class="sxs-lookup"><span data-stu-id="49f0b-286">These methods retrieve data from a business layer class located in the App\_Code folder of the Website.</span></span>

<span data-ttu-id="49f0b-287">**列出 17。定义页方法。**</span><span class="sxs-lookup"><span data-stu-id="49f0b-287">**Listing 17. Defining page methods.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample22.cs)]

<span data-ttu-id="49f0b-288">ScriptManager 在页中检测存在 Web 方法时它会生成对前面所述 PageMethods 对象的动态引用。</span><span class="sxs-lookup"><span data-stu-id="49f0b-288">When ScriptManager detects the presence of Web Methods in the page it generates a dynamic reference to the PageMethods object mentioned earlier.</span></span> <span data-ttu-id="49f0b-289">调用 Web 方法是通过引用该方法应传递任何必要的参数数据的名称后跟 PageMethods 类实现的。</span><span class="sxs-lookup"><span data-stu-id="49f0b-289">Calling a Web Method is accomplished by referencing the PageMethods class followed by the name of the method and any necessary parameter data that should be passed.</span></span> <span data-ttu-id="49f0b-290">列出 18 显示调用前面所示的两个页方法的示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-290">Listing 18 shows examples of calling the two page methods shown earlier.</span></span>

<span data-ttu-id="49f0b-291">**列出 18。调用页与 PageMethods JavaScript 对象的方法。**</span><span class="sxs-lookup"><span data-stu-id="49f0b-291">**Listing 18. Calling page methods with the PageMethods JavaScript object.**</span></span>

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample23.js)]

<span data-ttu-id="49f0b-292">使用 PageMethods 对象是非常类似于使用 JavaScript 代理对象。</span><span class="sxs-lookup"><span data-stu-id="49f0b-292">Using the PageMethods object is very similar to using a JavaScript proxy object.</span></span> <span data-ttu-id="49f0b-293">你首先指定所有应传递给页方法，然后定义异步调用返回时应调用的回调函数的参数数据。</span><span class="sxs-lookup"><span data-stu-id="49f0b-293">You first specify all of the parameter data that should be passed to the page method and then define the callback function that should be called when the asynchronous call returns.</span></span> <span data-ttu-id="49f0b-294">此外可以指定故障回调 （请参阅列出 14 有关的处理故障示例）。</span><span class="sxs-lookup"><span data-stu-id="49f0b-294">A failure callback can also be specified (refer to Listing 14 for an example of handling failures).</span></span>

## <a name="the-autocompleteextender-and-the-aspnet-ajax-toolkit"></a><span data-ttu-id="49f0b-295">AutoCompleteExtender 和 ASP.NET AJAX 工具包</span><span class="sxs-lookup"><span data-stu-id="49f0b-295">The AutoCompleteExtender and the ASP.NET AJAX Toolkit</span></span>

<span data-ttu-id="49f0b-296">ASP.NET AJAX 工具包 (可从[ http://ajax.asp.net ](http://ajax.asp.net)) 提供了几个控件，可用来访问 Web 服务。</span><span class="sxs-lookup"><span data-stu-id="49f0b-296">The ASP.NET AJAX Toolkit (available from [http://ajax.asp.net](http://ajax.asp.net)) offers several controls that can be used to access Web Services.</span></span> <span data-ttu-id="49f0b-297">具体而言，此工具包中包含一个名为的有用控件`AutoCompleteExtender`，可以用来调用 Web 服务和而无需编写任何 JavaScript 代码在所有页中显示数据。</span><span class="sxs-lookup"><span data-stu-id="49f0b-297">Specifically, the toolkit contains a useful control named `AutoCompleteExtender` that can be used to call Web Services and show data in pages without writing any JavaScript code at all.</span></span>

<span data-ttu-id="49f0b-298">AutoCompleteExtender 控件可用来扩展现有功能的文本框中，帮助用户更轻松地找到它们正在寻找的数据。</span><span class="sxs-lookup"><span data-stu-id="49f0b-298">The AutoCompleteExtender control can be used to extend existing functionality of a textbox and help users more easily locate data they're looking for.</span></span> <span data-ttu-id="49f0b-299">在键入到文本框中时该控件可用于查询 Web 服务，并动态显示文本框下的结果。</span><span class="sxs-lookup"><span data-stu-id="49f0b-299">As they type into a textbox the control can be used to query a Web Service and shows results below the textbox dynamically.</span></span> <span data-ttu-id="49f0b-300">图 4 显示使用 AutoCompleteExtender 控件以显示支持应用程序的客户 id 的示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-300">Figure 4 shows an example of using the AutoCompleteExtender control to display customer ids for a support application.</span></span> <span data-ttu-id="49f0b-301">当用户在文本框中键入不同的字符，将显示不同的项在下面它基于其输入。</span><span class="sxs-lookup"><span data-stu-id="49f0b-301">As the user types different characters into the textbox, different items will be shown below it based upon their input.</span></span> <span data-ttu-id="49f0b-302">然后，用户可以选择所需的客户 id。</span><span class="sxs-lookup"><span data-stu-id="49f0b-302">Users can then select the desired customer id.</span></span>

<span data-ttu-id="49f0b-303">使用 ASP.NET AJAX 页中的 AutoCompleteExtender 要求 AjaxControlToolkit.dll 程序集添加到网站的 bin 文件夹。</span><span class="sxs-lookup"><span data-stu-id="49f0b-303">Using the AutoCompleteExtender within an ASP.NET AJAX page requires that the AjaxControlToolkit.dll assembly be added to the Website's bin folder.</span></span> <span data-ttu-id="49f0b-304">一旦添加工具包程序集，你将想要在 web.config 中进行引用，以便它包含的控件可用于应用程序中的所有网页。</span><span class="sxs-lookup"><span data-stu-id="49f0b-304">Once the toolkit assembly has been added, you'll want to reference it in web.config so that the controls it contains are available to all pages in an application.</span></span> <span data-ttu-id="49f0b-305">这可以通过添加以下标记内 web.config 的&lt;控件&gt;标记：</span><span class="sxs-lookup"><span data-stu-id="49f0b-305">This can be done by adding the following tag within web.config's &lt;controls&gt; tag:</span></span>

[!code-xml[Main](understanding-asp-net-ajax-web-services/samples/sample24.xml)]

<span data-ttu-id="49f0b-306">在其中你只需使用特定的页中的控件的情况下你可以引用它通过将引用指令添加到页面顶部，如下所示而不是更新 web.config:</span><span class="sxs-lookup"><span data-stu-id="49f0b-306">In cases where you only need to use the control in a specific page you can reference it by adding the Reference directive to the top of a page as shown next rather than updating web.config:</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample25.aspx)]


<span data-ttu-id="49f0b-307">[![使用 AutoCompleteExtender 控件。](understanding-asp-net-ajax-web-services/_static/image11.png)](understanding-asp-net-ajax-web-services/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="49f0b-307">[![Using the AutoCompleteExtender control.](understanding-asp-net-ajax-web-services/_static/image11.png)](understanding-asp-net-ajax-web-services/_static/image10.png)</span></span>

<span data-ttu-id="49f0b-308">**图 4**： 使用 AutoCompleteExtender 控件。</span><span class="sxs-lookup"><span data-stu-id="49f0b-308">**Figure 4**: Using the AutoCompleteExtender control.</span></span>  <span data-ttu-id="49f0b-309">([单击以查看实际尺寸的图像](understanding-asp-net-ajax-web-services/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="49f0b-309">([Click to view full-size image](understanding-asp-net-ajax-web-services/_static/image12.png))</span></span>


<span data-ttu-id="49f0b-310">一旦网站已配置为使用 ASP.NET AJAX 工具包，AutoCompleteExtender 控件可以添加到页面中更像添加正则的 ASP.NET 服务器控件。</span><span class="sxs-lookup"><span data-stu-id="49f0b-310">Once the Website has been configured to use the ASP.NET AJAX Toolkit, an AutoCompleteExtender control can be added into the page much like you'd add a regular ASP.NET server control.</span></span> <span data-ttu-id="49f0b-311">列出 19 显示使用控件能够调用 Web 服务的示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-311">Listing 19 shows an example of using the control to call a Web Service.</span></span>

<span data-ttu-id="49f0b-312">**列出 19。使用 ASP.NET AJAX 工具包 AutoCompleteExtender 控件。**</span><span class="sxs-lookup"><span data-stu-id="49f0b-312">**Listing 19. Using the ASP.NET AJAX Toolkit AutoCompleteExtender control.**</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample26.aspx)]

<span data-ttu-id="49f0b-313">AutoCompleteExtender 具有多个不同的属性包括在服务器控件上找到的标准 ID 和 runat 属性。</span><span class="sxs-lookup"><span data-stu-id="49f0b-313">The AutoCompleteExtender has several different properties including the standard ID and runat properties found on server controls.</span></span> <span data-ttu-id="49f0b-314">除此之外，它允许你定义 Web 服务之前最终用户类型查询的数据的多少个字符。</span><span class="sxs-lookup"><span data-stu-id="49f0b-314">In addition to these, it allows you to define how many characters an end user types before the Web Service is queried for data.</span></span> <span data-ttu-id="49f0b-315">列出 19 中所示的 MinimumPrefixLength 属性会导致在文本框中键入字符每次调用服务。</span><span class="sxs-lookup"><span data-stu-id="49f0b-315">The MinimumPrefixLength property shown in Listing 19 causes the service to be called each time a character is typed into the textbox.</span></span> <span data-ttu-id="49f0b-316">你将需要小心设置此值，因为每次用户键入的字符 Web 服务将调用以搜索在文本框中的字符匹配的值。</span><span class="sxs-lookup"><span data-stu-id="49f0b-316">You'll want to be careful setting this value since each time the user types a character the Web Service will be called to search for values that match the characters in the textbox.</span></span> <span data-ttu-id="49f0b-317">要调用的 Web 服务，以及目标 Web 方法的分别使用 ServicePath 和 ServiceMethod 属性定义。</span><span class="sxs-lookup"><span data-stu-id="49f0b-317">The Web Service to call as well as the target Web Method are defined using the ServicePath and ServiceMethod properties respectively.</span></span> <span data-ttu-id="49f0b-318">最后，TargetControlID 属性标识的文本框中，将挂钩到 AutoCompleteExtender 控件。</span><span class="sxs-lookup"><span data-stu-id="49f0b-318">Finally, the TargetControlID property identifies which textbox to hook the AutoCompleteExtender control to.</span></span>

<span data-ttu-id="49f0b-319">要调用的 Web 服务必须具有应用前面所述的 ScriptService 属性，并且目标 Web 方法必须接受名为 prefixText 和计数的两个参数。</span><span class="sxs-lookup"><span data-stu-id="49f0b-319">The Web Service being called must have the ScriptService attribute applied as discussed earlier and the target Web Method must accept two parameters named prefixText and count.</span></span> <span data-ttu-id="49f0b-320">PrefixText 参数表示的最终用户键入的字符，count 参数表示要返回的项目数 （默认值为 10）。</span><span class="sxs-lookup"><span data-stu-id="49f0b-320">The prefixText parameter represents the characters typed by the end user and the count parameter represents how many items to return (the default is 10).</span></span> <span data-ttu-id="49f0b-321">列出 20 显示了由列出 19 前面所示的 AutoCompleteExtender 控件调用 GetCustomerIDs Web 方法的示例。</span><span class="sxs-lookup"><span data-stu-id="49f0b-321">Listing 20 shows an example of the GetCustomerIDs Web Method called by the AutoCompleteExtender control shown earlier in Listing 19.</span></span> <span data-ttu-id="49f0b-322">Web 方法调用，反过来调用数据层处理筛选数据并返回匹配的结果的方法的业务层方法。</span><span class="sxs-lookup"><span data-stu-id="49f0b-322">The Web Method calls a business layer method that in turn calls a data layer method that handles filtering the data and returning the matching results.</span></span> <span data-ttu-id="49f0b-323">数据层方法的代码所示列出 21。</span><span class="sxs-lookup"><span data-stu-id="49f0b-323">The code for the data layer method is shown in Listing 21.</span></span>

<span data-ttu-id="49f0b-324">**列出 20。筛选从 AutoCompleteExtender 控件发送的数据。**</span><span class="sxs-lookup"><span data-stu-id="49f0b-324">**Listing 20. Filtering data sent from the AutoCompleteExtender control.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample27.cs)]

<span data-ttu-id="49f0b-325">**列出 21。筛选基于最终用户输入的结果。**</span><span class="sxs-lookup"><span data-stu-id="49f0b-325">**Listing 21. Filtering results based upon end user input.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample28.cs)]

## <a name="conclusion"></a><span data-ttu-id="49f0b-326">结束语</span><span class="sxs-lookup"><span data-stu-id="49f0b-326">Conclusion</span></span>

<span data-ttu-id="49f0b-327">ASP.NET AJAX 提供了用于调用 Web 服务，而无需编写大量的自定义 JavaScript 代码来处理请求和响应消息的优秀的支持。</span><span class="sxs-lookup"><span data-stu-id="49f0b-327">ASP.NET AJAX provides excellent support for calling Web Services without writing a lot of custom JavaScript code to handle the request and response messages.</span></span> <span data-ttu-id="49f0b-328">在这篇文章你已了解如何启用 AJAX 的.NET Web 服务，以使它们能够处理 JSON 消息以及如何定义使用 ScriptManager 控件的 JavaScript 代理。</span><span class="sxs-lookup"><span data-stu-id="49f0b-328">In this article you've seen how to AJAX-enable .NET Web Services to enable them to process JSON messages and how to define JavaScript proxies using the ScriptManager control.</span></span> <span data-ttu-id="49f0b-329">您还已了解如何可以使用代理服务器来调用 Web 服务的 JavaScript 处理简单和复杂类型和处理失败。</span><span class="sxs-lookup"><span data-stu-id="49f0b-329">You've also seen how JavaScript proxies can be used to call Web Services, handle simple and complex types and deal with failures.</span></span> <span data-ttu-id="49f0b-330">最后，你已了解如何使用页方法来简化创建和 Web 服务调用的过程，以及如何 AutoCompleteExtender 控件可以提供给最终用户的帮助，在键入时。</span><span class="sxs-lookup"><span data-stu-id="49f0b-330">Finally, you've seen how page methods can be used to simplify the process of creating and making Web Service calls and how the AutoCompleteExtender control can provide help to end users as they type.</span></span> <span data-ttu-id="49f0b-331">尽管 ASP.NET AJAX 中可用 UpdatePanel 肯定将选择其简易性由于许多 AJAX 程序员的控制，让我们了解如何通过 JavaScript 代理调用 Web 服务可在许多应用程序。</span><span class="sxs-lookup"><span data-stu-id="49f0b-331">Although the UpdatePanel available in ASP.NET AJAX will certainly be the control of choice for many AJAX programmers due to its simplicity, knowing how to call Web Services through JavaScript proxies can be useful in many applications.</span></span>

## <a name="bio"></a><span data-ttu-id="49f0b-332">简介</span><span class="sxs-lookup"><span data-stu-id="49f0b-332">Bio</span></span>

<span data-ttu-id="49f0b-333">Dan Wahlin （Microsoft 最有价值专家 ASP.NET 和 XML Web 服务） 是在接口技术培训的.NET 开发教师和体系结构顾问 ([http://www.interfacett.com](http://www.interfacett.com))。</span><span class="sxs-lookup"><span data-stu-id="49f0b-333">Dan Wahlin (Microsoft Most Valuable Professional for ASP.NET and XML Web Services) is a .NET development instructor and architecture consultant at Interface Technical Training ([http://www.interfacett.com](http://www.interfacett.com)).</span></span> <span data-ttu-id="49f0b-334">Dan 成立 ASP.NET 开发人员网站的 XML ([www.XMLforASP.NET](http://www.XMLforASP.NET))、 位于 INETA 扬声器局和在几个有关参加会议讲话时。</span><span class="sxs-lookup"><span data-stu-id="49f0b-334">Dan founded the XML for ASP.NET Developers Web site ([www.XMLforASP.NET](http://www.XMLforASP.NET)), is on the INETA Speaker's Bureau and speaks at several conferences.</span></span> <span data-ttu-id="49f0b-335">Dan 共同撰写 Professional Windows dna 的解码 (Wrox) ASP.NET： 提示、 教程和代码 (Sam)、 ASP.NET 1.1 内部解决方案、 Professional ASP.NET 2.0 AJAX (Wrox)、 ASP.NET 2.0 MVP Hacks 和编写的 XML for ASP.NET 开发人员 (Sam)。</span><span class="sxs-lookup"><span data-stu-id="49f0b-335">Dan co-authored Professional Windows DNA (Wrox), ASP.NET: Tips, Tutorials and Code (Sams), ASP.NET 1.1 Insider Solutions, Professional ASP.NET 2.0 AJAX (Wrox), ASP.NET 2.0 MVP Hacks and authored XML for ASP.NET Developers (Sams).</span></span> <span data-ttu-id="49f0b-336">当他不编写代码、 项目或丛书时，Dan 将喜欢编写和录制音乐和播放高尔夫球和儿童他妻子与支篮球队。</span><span class="sxs-lookup"><span data-stu-id="49f0b-336">When he's not writing code, articles or books, Dan enjoys writing and recording music and playing golf and basketball with his wife and kids.</span></span>

<span data-ttu-id="49f0b-337">Scott 类别自 1997 年以来处理与 Microsoft Web 技术，并且是 myKB.com 总裁 ([www.myKB.com](http://www.myKB.com)) 其中他专注于编写 ASP.NET 基于侧重于知识库软件解决方案的应用程序。</span><span class="sxs-lookup"><span data-stu-id="49f0b-337">Scott Cate has been working with Microsoft Web technologies since 1997 and is the President of myKB.com ([www.myKB.com](http://www.myKB.com)) where he specializes in writing ASP.NET based applications focused on Knowledge Base Software solutions.</span></span> <span data-ttu-id="49f0b-338">可以通过在电子邮件联系 Scott [ scott.cate@myKB.com ](mailto:scott.cate@myKB.com)或在其博客地址[ScottCate.com](http://ScottCate.com)</span><span class="sxs-lookup"><span data-stu-id="49f0b-338">Scott can be contacted via email at [scott.cate@myKB.com](mailto:scott.cate@myKB.com) or his blog at [ScottCate.com](http://ScottCate.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="49f0b-339">[上一页](understanding-asp-net-ajax-localization.md)
> [下一页](understanding-asp-net-ajax-debugging-capabilities.md)</span><span class="sxs-lookup"><span data-stu-id="49f0b-339">[Previous](understanding-asp-net-ajax-localization.md)
[Next](understanding-asp-net-ajax-debugging-capabilities.md)</span></span>
