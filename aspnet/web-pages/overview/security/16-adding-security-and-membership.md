---
uid: web-pages/overview/security/16-adding-security-and-membership
title: "将安全和成员身份添加到 ASP.NET Web 页 (Razor) 站点 |Microsoft 文档"
author: tfitzmac
description: "本章展示如何保护你的网站，以便仅供登录的人员的某些页。 （你还将了解如何创建页 tha..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/24/2014
ms.topic: article
ms.assetid: 7a77c2c0-deea-4290-a9c3-97958891758e
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/security/16-adding-security-and-membership
msc.type: authoredcontent
ms.openlocfilehash: af2eeb128cff554e7ae3d903e2117861087344e9
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/24/2018
---
<a name="adding-security-and-membership-to-an-aspnet-web-pages-razor-site"></a><span data-ttu-id="e2a5e-104">将安全和成员身份添加到 ASP.NET 网站页 (Razor)</span><span class="sxs-lookup"><span data-stu-id="e2a5e-104">Adding Security and Membership to an ASP.NET Web Pages (Razor) Site</span></span>
====================
<span data-ttu-id="e2a5e-105">通过[Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="e2a5e-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="e2a5e-106">此文章介绍了如何保护 ASP.NET Web 页 (Razor) 网站，以便仅供登录的人员的某些页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-106">This article explains how to secure an ASP.NET Web Pages (Razor) website so that some of the pages are available only to people who log in.</span></span> <span data-ttu-id="e2a5e-107">（你将另请参阅如何创建任何人都可以访问的页面。）</span><span class="sxs-lookup"><span data-stu-id="e2a5e-107">(You'll also see how to create pages that anyone can access.)</span></span>
> 
> <span data-ttu-id="e2a5e-108">**你将学习：**</span><span class="sxs-lookup"><span data-stu-id="e2a5e-108">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="e2a5e-109">如何创建了一个注册页，并且登录页，因此，对于某些页中，你可以限制对仅成员的访问的网站。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-109">How to create a website that has a registration page and a login page so that for some pages you can limit access to only members.</span></span>
> - <span data-ttu-id="e2a5e-110">如何创建公共和仅限成员的页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-110">How to create public and member-only pages.</span></span>
> - <span data-ttu-id="e2a5e-111">如何定义角色，是在你的站点具有不同的安全权限的组，以及如何将用户分配到角色。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-111">How to define roles, which are groups that have different security permissions on your site, and how to assign users to a role.</span></span>
> - <span data-ttu-id="e2a5e-112">如何使用 CAPTCHA 以防止自动的程序 （机器人） 创建帐户的成员。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-112">How to use CAPTCHA to prevent automated programs (bots) from creating member accounts.</span></span>
>   
> 
> <span data-ttu-id="e2a5e-113">这些是文章中引入的 ASP.NET 功能：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-113">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="e2a5e-114">WebMatrix**入门站点**模板。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-114">The WebMatrix **Starter Site** template.</span></span>
> - <span data-ttu-id="e2a5e-115">`WebSecurity`帮助器和`Roles`类。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-115">The `WebSecurity` helper and `Roles` class.</span></span>
> - <span data-ttu-id="e2a5e-116">`ReCaptcha`帮助器。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-116">The `ReCaptcha` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="e2a5e-117">在本教程中使用的软件版本</span><span class="sxs-lookup"><span data-stu-id="e2a5e-117">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="e2a5e-118">ASP.NET Web Pages (Razor) 2</span><span class="sxs-lookup"><span data-stu-id="e2a5e-118">ASP.NET Web Pages (Razor) 2</span></span>
> - <span data-ttu-id="e2a5e-119">WebMatrix 3</span><span class="sxs-lookup"><span data-stu-id="e2a5e-119">WebMatrix 3</span></span>
> - <span data-ttu-id="e2a5e-120">ASP.NET Web 帮助程序库</span><span class="sxs-lookup"><span data-stu-id="e2a5e-120">ASP.NET Web Helpers Library</span></span>


<span data-ttu-id="e2a5e-121">你可以设置你的网站，以便用户可以登录到 （&） #8212;也就是说，以便站点支持*成员资格*。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-121">You can set up your website so that users can log into it &#8212; that is, so that the site supports *membership*.</span></span> <span data-ttu-id="e2a5e-122">这可以是有用出于许多原因。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-122">This can be useful for many reasons.</span></span> <span data-ttu-id="e2a5e-123">例如，你的站点可能具有可仅对成员的页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-123">For example, your site might have pages that should be available only to members.</span></span> <span data-ttu-id="e2a5e-124">在某些情况下，你可能会要求用户进行登录，才能向你发送反馈或发表评论。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-124">In some cases, you might require users to log in in order to send you feedback or leave a comment.</span></span>

<span data-ttu-id="e2a5e-125">即使你的网站支持成员资格，则用户不一定需要登录，然后在站点上使用的某些页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-125">Even if your website supports membership, users aren't necessarily required to log in before they use some of the pages on the site.</span></span> <span data-ttu-id="e2a5e-126">没有登录的用户被称为*匿名用户*。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-126">Users who aren't logged in are known as *anonymous users*.</span></span>

<span data-ttu-id="e2a5e-127">用户可在网站上注册，并可以然后登录到站点。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-127">A user can register on your website and can then log in to the site.</span></span> <span data-ttu-id="e2a5e-128">网站需要用户名 （电子邮件地址） 和密码以确认用户所声称的身份。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-128">The website requires a user name (an email address) and a password to confirm that users are who they claim to be.</span></span> <span data-ttu-id="e2a5e-129">登录并确认用户的标识的此过程被称为*身份验证*。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-129">This process of logging in and confirming a user's identity is known as *authentication*.</span></span>

<span data-ttu-id="e2a5e-130">你可以设置安全和成员身份以不同的方式：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-130">You can set up security and membership in different ways:</span></span>

- <span data-ttu-id="e2a5e-131">如果你使用的 WebMatrix，一种简便方法是创建基于新站点作为**入门站点**模板。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-131">If you're using WebMatrix, an easy way is to create as new site based on the **Starter Site** template.</span></span> <span data-ttu-id="e2a5e-132">此模板已配置为安全和成员身份，并已注册页、 登录页上，依次类推。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-132">This template is already configured for security and membership and already has a registration page, a login page, and so on.</span></span>

    <span data-ttu-id="e2a5e-133">由模板创建的站点也有一个选项以让用户使用如 Facebook、 Google、 外部站点登录或 Twitter。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-133">The site created by the template also has an option to let users log in using an external site like Facebook, Google, or Twitter.</span></span>
- <span data-ttu-id="e2a5e-134">如果你想要将安全添加到现有站点，或如果你不想要使用**入门站点**模板，您可以创建你自己的注册页、 登录页上，依次类推。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-134">If you want to add security to an existing site, or if you don't want to use the **Starter Site** template, you can create your own registration page, login page, and so on.</span></span>

<span data-ttu-id="e2a5e-135">本文重点介绍在第一个选项&mdash;如何通过使用添加安全**入门站点**模板。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-135">This article focuses on the first option &mdash; how to add security by using the **Starter Site** template.</span></span> <span data-ttu-id="e2a5e-136">它还提供了有关如何实现你自己的安全一些基本信息，然后提供指向有关如何执行该操作的详细信息。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-136">It also provides some basic information about how to implement your own security and then provides links to more information about how to do that.</span></span> <span data-ttu-id="e2a5e-137">此外，还有若要了解如何启用外部登录名，在单独的文章中详细的介绍。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-137">There is also information about how to enable external logins, which is described in more detail in a separate article.</span></span>

## <a name="creating-website-security-using-the-starter-site-template"></a><span data-ttu-id="e2a5e-138">创建使用初学者站点模板的网站安全</span><span class="sxs-lookup"><span data-stu-id="e2a5e-138">Creating Website Security Using the Starter Site Template</span></span>

<span data-ttu-id="e2a5e-139">在 WebMatrix 中，你可以使用**入门站点**模板来创建包含以下网站：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-139">In WebMatrix, you can use the **Starter Site** template to create a website that contains the following:</span></span>

- <span data-ttu-id="e2a5e-140">用于存储用户名和密码，为了使成员数据库。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-140">A database that's used to store user names and passwords for your members.</span></span>
- <span data-ttu-id="e2a5e-141">（新） 的匿名用户可以在其中注册注册页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-141">A registration page where anonymous (new) users can register.</span></span>
- <span data-ttu-id="e2a5e-142">登录和注销页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-142">A login and logout page.</span></span>
- <span data-ttu-id="e2a5e-143">密码恢复和重置页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-143">A password recovery and reset page.</span></span>

<span data-ttu-id="e2a5e-144">以下过程描述如何创建站点，并对其进行配置。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-144">The following procedure describes how to create the site and configure it.</span></span>

1. <span data-ttu-id="e2a5e-145">启动 WebMatrix 和在**快速启动**页上，选择**站点从模板**。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-145">Start WebMatrix and in the **Quick Start** page, select **Site From Template**.</span></span>
2. <span data-ttu-id="e2a5e-146">选择**入门站点**模板，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-146">Select the **Starter Site** template and then click **OK**.</span></span> <span data-ttu-id="e2a5e-147">WebMatrix 创建新的站点。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-147">WebMatrix creates a new site.</span></span>
3. <span data-ttu-id="e2a5e-148">在左窗格中，单击**文件**工作区中选择器。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-148">In the left pane, click the **Files** workspace selector.</span></span>
4. <span data-ttu-id="e2a5e-149">在你的网站的根文件夹，打开 *\_AppStart.cshtml*文件，它是一个特殊文件，用于包含全局设置。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-149">In the root folder of your website, open the *\_AppStart.cshtml* file, which is a special file that's used to contain global settings.</span></span> <span data-ttu-id="e2a5e-150">它包含已被注释掉使用的一些语句`//`字符：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-150">It contains some statements that are commented out using the `//` characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample1.cs)]

    <span data-ttu-id="e2a5e-151">这些语句配置`WebMail`帮助器，可用于发送电子邮件。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-151">These statements configure the `WebMail` helper, which can be used to send email.</span></span> <span data-ttu-id="e2a5e-152">成员资格系统可以使用电子邮件发送确认消息，当用户注册时或当他们想要更改其密码。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-152">The membership system can use email to send confirmation messages when users register or when they want to change their passwords.</span></span> <span data-ttu-id="e2a5e-153">（例如，用户注册后，它们收到的电子邮件，其中包含一个链接，则可以单击为了完成注册过程。）</span><span class="sxs-lookup"><span data-stu-id="e2a5e-153">(For example, after users register, they get an email that includes a link that they can click in order to finish the registration process.)</span></span>

    <span data-ttu-id="e2a5e-154">发送电子邮件都需要访问 SMTP 服务器时中, 所述[添加到 ASP.NET Web Pages 站点的电子邮件](https://go.microsoft.com/fwlink/?LinkId=202899)。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-154">Sending email requires access to an SMTP server, as described in [Adding Email to an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=202899).</span></span> <span data-ttu-id="e2a5e-155">将此 central 中存储电子邮件设置 *\_AppStart.cshtml*文件，以便无需到可以发送电子邮件的每一页重复代码。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-155">You'll store the email settings in this central *\_AppStart.cshtml* file so that you don't have to code them repeatedly into each page that can send email.</span></span> <span data-ttu-id="e2a5e-156">（不需要配置 SMTP 设置，以将注册数据库设置; 如果你想要验证用户从其电子邮件别名，并让用户重置忘记了的密码，则会仅需要 SMTP 设置。）</span><span class="sxs-lookup"><span data-stu-id="e2a5e-156">(You don't need to configure SMTP settings to set up a registration database; you only need SMTP settings if you want to validate users from their email alias and let users reset a forgotten password.)</span></span>
5. <span data-ttu-id="e2a5e-157">取消语句注释通过删除`//`每个前面。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-157">Uncomment the statements by removing `//` from in front of each one.</span></span>

    <span data-ttu-id="e2a5e-158">如果您不想要设置电子邮件确认，则可以跳过此步骤和下一步。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-158">If you do not want to set up email confirmation, you can skip this step and the next step.</span></span> <span data-ttu-id="e2a5e-159">如果未设置 SMTP 值，则新的帐户是立即可用，而无需确认电子邮件。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-159">If the SMTP values are not set, the new account is immediately available without a confirmation email.</span></span>
6. <span data-ttu-id="e2a5e-160">修改代码中电子邮件相关的以下设置：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-160">Modify the following email-related settings in the code:</span></span>

    - <span data-ttu-id="e2a5e-161">设置`WebMail.SmtpServer`到可以访问 SMTP 服务器的名称。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-161">Set `WebMail.SmtpServer` to the name of the SMTP server that you have access to.</span></span>
    - <span data-ttu-id="e2a5e-162">保留`WebMail.EnableSsl`设置为`true`。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-162">Leave `WebMail.EnableSsl` set to `true`.</span></span> <span data-ttu-id="e2a5e-163">此设置能保护对它们进行加密发送到 SMTP 服务器的凭据。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-163">This setting secures the credentials that are sent to the SMTP server by encrypting them.</span></span>
    - <span data-ttu-id="e2a5e-164">设置`WebMail.UserName`到您的 SMTP 服务器帐户的用户名。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-164">Set `WebMail.UserName` to the user name for your SMTP server account.</span></span>
    - <span data-ttu-id="e2a5e-165">设置`WebMail.Password`到您的 SMTP 服务器帐户的密码。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-165">Set `WebMail.Password` to the password for your SMTP server account.</span></span>
    - <span data-ttu-id="e2a5e-166">设置`WebMail.From`为您自己的电子邮件地址。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-166">Set `WebMail.From` to your own email address.</span></span> <span data-ttu-id="e2a5e-167">这是从发送消息的电子邮件地址。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-167">This is the email address that the message is sent from.</span></span>

    > [!NOTE] 
    > 
    > <span data-ttu-id="e2a5e-168">**提示**有关这些属性的值的其他信息，请参阅[配置电子邮件设置](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings)中[自定义站点范围的行为的 ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkID=202906)。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-168">**Tip** For additional information about the values for these properties, see [Configuring Email Settings](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkID=202906).</span></span>
7. <span data-ttu-id="e2a5e-169">保存并关闭 *\_AppStart.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-169">Save and close *\_AppStart.cshtml*.</span></span>
8. <span data-ttu-id="e2a5e-170">运行*Default.cshtml*在浏览器中的页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-170">Run the *Default.cshtml* page in a browser.</span></span>

    ![security-membership-2](16-adding-security-and-membership/_static/image1.png)

    > [!NOTE]
    > <span data-ttu-id="e2a5e-172">如果你看到错误，告知你属性必须为实例`ExtendedMembershipProvider`，不可能将站点配置为使用 ASP.NET Web Pages 成员资格系统 (SimpleMembership)。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-172">If you see an error that tells you that a property must be an instance of `ExtendedMembershipProvider`, the site might not be configured to use the ASP.NET Web Pages membership system (SimpleMembership).</span></span> <span data-ttu-id="e2a5e-173">如果宿主提供程序的服务器配置不同于你的本地服务器，有时会出现此问题。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-173">This can sometimes occur if a hosting provider's server is configured differently than your local server.</span></span> <span data-ttu-id="e2a5e-174">若要解决此问题，请将下面的元素添加到站点的*Web.config*文件：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-174">To fix this, add the following element to the site's *Web.config* file:</span></span>
    > 
    > [!code-xml[Main](16-adding-security-and-membership/samples/sample2.xml)]
    > 
    > <span data-ttu-id="e2a5e-175">添加此元素的子级作为`<configuration>`元素的对等方的以及`<system.web>`元素。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-175">Add this element as a child of the `<configuration>` element and as a peer of the `<system.web>` element.</span></span>
9. <span data-ttu-id="e2a5e-176">在页面右上角，单击**注册**链接。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-176">In the upper-right corner of the page, click the **Register** link.</span></span> <span data-ttu-id="e2a5e-177">*Register.cshtml*显示页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-177">The *Register.cshtml* page is displayed.</span></span>
10. <span data-ttu-id="e2a5e-178">输入用户名和密码，然后单击**注册**。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-178">Enter a user name and password and then click **Register**.</span></span>

    ![security-membership-3](16-adding-security-and-membership/_static/image2.png)

    <span data-ttu-id="e2a5e-180">当创建对网站从**入门站点**模板、 一个名为数据库*StarterSite.sdf*在站点中创建*应用\_数据*文件夹。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-180">When you created the website from the **Starter Site** template, a database named *StarterSite.sdf* was created in the site's *App\_Data* folder.</span></span> <span data-ttu-id="e2a5e-181">在注册期间，你的用户信息添加到数据库。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-181">During registration, your user information is added to the database.</span></span> <span data-ttu-id="e2a5e-182">如果设置 SMTP 值时，一条消息是发送到电子邮件地址中，使用使你可以完成注册。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-182">If you set the SMTP values, a message is sent to the email address you used so you can finish registering.</span></span>

    ![security-membership-4](16-adding-security-and-membership/_static/image3.png)
11. <span data-ttu-id="e2a5e-184">转到你的电子邮件程序，查找的消息，这将到站点中具有你确认代码链接和超链接。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-184">Go to your email program and find the message, which will have your confirmation code and a hyperlink to the site.</span></span>
12. <span data-ttu-id="e2a5e-185">单击超链接以激活你的帐户。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-185">Click the hyperlink to activate your account.</span></span> <span data-ttu-id="e2a5e-186">确认超链接打开注册确认页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-186">The confirmation hyperlink opens a registration confirmation page.</span></span>

    ![security-membership-5](16-adding-security-and-membership/_static/image4.png)
- <span data-ttu-id="e2a5e-188">单击**登录**链接，然后使用你注册的帐户，然后登录。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-188">Click the **Login** link, and then log in using the account that you registered.</span></span>

    <span data-ttu-id="e2a5e-189">你登录后**登录**和**注册**链接替换为**注销**链接。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-189">After you log in, the **Login** and **Register** links are replaced by a **Logout** link.</span></span> <span data-ttu-id="e2a5e-190">您的登录名显示为链接。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-190">Your login name is displayed as a link.</span></span> <span data-ttu-id="e2a5e-191">（链接使你能够转到一个页面，你可以在其中更改你的密码。）</span><span class="sxs-lookup"><span data-stu-id="e2a5e-191">(The link lets you go to a page where you can change your password.)</span></span>

    ![security-membership-6](16-adding-security-and-membership/_static/image5.png)

    > [!NOTE]
    > <span data-ttu-id="e2a5e-193">默认情况下，ASP.NET 网页将凭据发送到服务器以明文形式 （作为用户可读文本）。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-193">By default, ASP.NET web pages send credentials to the server in clear text (as human-readable text).</span></span> <span data-ttu-id="e2a5e-194">生产站点应使用安全 HTTP (也称为 https://*安全套接字层*或 SSL) 与的服务器交换的敏感信息进行加密。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-194">A production site should use secure HTTP (https://, also known as the *secure sockets layer* or SSL) to encrypt sensitive information that's exchanged with the server.</span></span> <span data-ttu-id="e2a5e-195">你可以所需的电子邮件发送的消息使用 SSL 通过设置`WebMail.EnableSsl=true`如同前面的示例。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-195">You can required email messages to be sent using SSL by setting `WebMail.EnableSsl=true` as in the previous example.</span></span> <span data-ttu-id="e2a5e-196">有关 SSL 的详细信息，请参阅[保护 Web 通信： 证书、 SSL 和 https://](https://go.microsoft.com/fwlink/?LinkId=208660)。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-196">For more information about SSL, see [Securing Web Communications: Certificates, SSL, and https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span></span>

## <a name="additional-membership-functionality-in-the-site"></a><span data-ttu-id="e2a5e-197">站点中的其他成员身份功能</span><span class="sxs-lookup"><span data-stu-id="e2a5e-197">Additional Membership Functionality in the Site</span></span>

<span data-ttu-id="e2a5e-198">您的网站包含其他功能，从而让用户管理他们的帐户。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-198">Your site contains other functionality that lets users manage their accounts.</span></span> <span data-ttu-id="e2a5e-199">用户可以执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-199">Users can do the following:</span></span>

- <span data-ttu-id="e2a5e-200">更改其密码。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-200">Change their passwords.</span></span> <span data-ttu-id="e2a5e-201">登录后，他们可以单击的用户名 （这是一个链接）。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-201">After logging in, they can click the user name (which is a link).</span></span> <span data-ttu-id="e2a5e-202">这使它们转到一个页面它们可以在其中创建新的密码 (*Account/ChangePassword.cshtml*)。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-202">This takes them to a page where they can create a new password (*Account/ChangePassword.cshtml*).</span></span>
- <span data-ttu-id="e2a5e-203">恢复忘记的密码。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-203">Recover a forgotten password.</span></span> <span data-ttu-id="e2a5e-204">在登录页上，是的链接 (**是否忘记了密码？**) 采用用户定向到页 (*Account/ForgotPassword.cshtml*) 它们可以在其中输入电子邮件地址。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-204">On the login page, there's a link (**Did you forget your password?**) that takes users to a page (*Account/ForgotPassword.cshtml*) where they can enter an email address.</span></span> <span data-ttu-id="e2a5e-205">站点将其发送电子邮件具有一个链接，则可以单击以设置新密码 (*Account/PasswordReset.cshtml*)。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-205">The site sends them an email message that has a link that they can click in order to set a new password (*Account/PasswordReset.cshtml*).</span></span>

<span data-ttu-id="e2a5e-206">你还可以让用户还可以使用外部站点，登录，详见后面。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-206">You can also let users can also log in using an external site, as explained later.</span></span>

<a id="Creating_a_Members-Only_Page"></a>
## <a name="creating-a-members-only-page"></a><span data-ttu-id="e2a5e-207">创建仅限成员页</span><span class="sxs-lookup"><span data-stu-id="e2a5e-207">Creating a Members-Only Page</span></span>

<span data-ttu-id="e2a5e-208">目前，任何人都可以浏览到你的网站中的任意页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-208">For the time being, anyone can browse to any page in your website.</span></span> <span data-ttu-id="e2a5e-209">但你可能想要仅适用于已登录的人员的页 (即，对成员)。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-209">But you might want to have pages that are available only to people who have logged in (that is, to members).</span></span> <span data-ttu-id="e2a5e-210">ASP.NET 允许您创建可以访问只能由登录的成员的页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-210">ASP.NET lets you create pages that can be accessed only by logged-in members.</span></span> <span data-ttu-id="e2a5e-211">通常情况下，如果匿名用户尝试访问仅限成员的页，你将它们重定向到登录页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-211">Typically, if anonymous users try to access a members-only page, you redirect them to the login page.</span></span>

<span data-ttu-id="e2a5e-212">在此过程中，将创建一个文件夹将包含仅适用于登录的用户的页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-212">In this procedure, you'll create a folder that will contain pages that are available only to logged-in users.</span></span>

1. <span data-ttu-id="e2a5e-213">在站点的根目录，创建一个新文件夹。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-213">At the root of the site, create a new folder.</span></span> <span data-ttu-id="e2a5e-214">(在功能区中，单击下的箭头**新建**，然后选择**新文件夹**。)</span><span class="sxs-lookup"><span data-stu-id="e2a5e-214">(In the ribbon, click the arrow underneath **New** and then choose **New Folder**.)</span></span>
2. <span data-ttu-id="e2a5e-215">将新文件夹命名*成员*。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-215">Name the new folder *Members*.</span></span>
3. <span data-ttu-id="e2a5e-216">内部*成员*文件夹中，创建一个新页，并将其命名为*MembersInformation.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-216">Inside the *Members* folder, create a new page and named it *MembersInformation.cshtml*.</span></span>
4. <span data-ttu-id="e2a5e-217">将现有内容替换下面的代码和标记：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-217">Replace the existing content with the following code and markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample3.cshtml)]

    <span data-ttu-id="e2a5e-218">此代码测试`IsAuthenticated`属性`WebSecurity`对象，它返回`true`如果用户已登录。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-218">This code tests the `IsAuthenticated` property of the `WebSecurity` object, which returns `true` if the user has logged in.</span></span> <span data-ttu-id="e2a5e-219">如果用户未登录，该代码调用`Response.Redirect`发送到用户*Login.cshtml*页面*帐户*文件夹。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-219">If the user is not logged in, the code calls `Response.Redirect` to send the user to the *Login.cshtml* page in the *Account* folder.</span></span>

    <span data-ttu-id="e2a5e-220">重定向 URL 包括`returnUrl`查询使用的字符串值`Request.Url.LocalPath`设置当前页的路径。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-220">The URL of the redirection includes a `returnUrl` query string value that uses `Request.Url.LocalPath` to set the path of the current page.</span></span> <span data-ttu-id="e2a5e-221">如果你设置`returnUrl`如下查询字符串中的值 （和返回 URL 是否是本地路径），登录页将用户后返回到此页在登录。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-221">If you set the `returnUrl` value in the query string like this (and if the return URL is a local path), the login page will return users to this page after they log in.</span></span>

    <span data-ttu-id="e2a5e-222">此代码还设置 *\_SiteLayout.cshtml*作为其布局页的页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-222">The code also sets *\_SiteLayout.cshtml* page as its layout page.</span></span> <span data-ttu-id="e2a5e-223">(有关详细信息布局页，请参阅[在 ASP.NET 网页站点中创建一致的布局](https://go.microsoft.com/fwlink/?LinkId=202891)。)</span><span class="sxs-lookup"><span data-stu-id="e2a5e-223">(For more about layout pages, see [Creating a Consistent Layout in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202891).)</span></span>
5. <span data-ttu-id="e2a5e-224">运行该站点。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-224">Run the site.</span></span> <span data-ttu-id="e2a5e-225">如果你仍登录，请单击**注销**页顶部的按钮。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-225">If you're still logged in, click the **Logout** button at the top of the page.</span></span>
6. <span data-ttu-id="e2a5e-226">在浏览器中，请求页*/Members/MembersInformation*。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-226">In the browser, request the page */Members/MembersInformation*.</span></span> <span data-ttu-id="e2a5e-227">例如，URL 可能如下所示：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-227">For example, the URL might look like this:</span></span>

    `http://localhost:38366/Members/MembersInformation`

    <span data-ttu-id="e2a5e-228">（端口号 (38366) 可能将你 URL 中不同。）</span><span class="sxs-lookup"><span data-stu-id="e2a5e-228">(The port number (38366) will probably be different in your URL.)</span></span>

    <span data-ttu-id="e2a5e-229">要重定向到*Login.cshtml*页上，因为您没有登录。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-229">You're redirected to the *Login.cshtml* page, because you aren't logged in.</span></span>
- <span data-ttu-id="e2a5e-230">使用前面创建的帐户登录。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-230">Log in using the account you created earlier.</span></span> <span data-ttu-id="e2a5e-231">要重定向回*MembersInformation*页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-231">You're redirected back to the *MembersInformation* page.</span></span> <span data-ttu-id="e2a5e-232">因为在你登录的此时会显示页面内容。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-232">Because you're logged in, this time you see the page contents.</span></span>

<span data-ttu-id="e2a5e-233">若要保护对多个页的访问，可以执行此操作：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-233">To secure access to multiple pages, you can do this:</span></span>

- <span data-ttu-id="e2a5e-234">添加到每个页面的安全检查。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-234">Add the security check to each page.</span></span>
- <span data-ttu-id="e2a5e-235">创建 *\_PageStart.cshtml*页中的文件夹，其中保留受保护的页，并添加的安全检查。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-235">Create a *\_PageStart.cshtml* page in the folder where you keep protected pages, and add the security check there.</span></span> <span data-ttu-id="e2a5e-236">*\_PageStart.cshtml*页用作一种类型的全局文件夹中的所有页的页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-236">The *\_PageStart.cshtml* page acts as a kind of global page for all the pages in the folder.</span></span> <span data-ttu-id="e2a5e-237">此技术中的详细说明了[自定义站点范围的行为的 ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access)。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-237">This technique is explained in more detail in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span></span>

## <a name="creating-security-for-groups-of-users-roles"></a><span data-ttu-id="e2a5e-238">创建安全组的用户 （角色）</span><span class="sxs-lookup"><span data-stu-id="e2a5e-238">Creating Security for Groups of Users (Roles)</span></span>

<span data-ttu-id="e2a5e-239">如果你的站点具有大量成员，它不是有效之前让他们看到一个页面，分别检查每个用户的权限。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-239">If your site has a lot of members, it's not efficient to check permission for each user individually before you let them see a page.</span></span> <span data-ttu-id="e2a5e-240">你可以执行的操作相反的是，创建组，或*角色*，各个成员属于。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-240">What you can do instead is to create groups, or *roles*, that individual members belong to.</span></span> <span data-ttu-id="e2a5e-241">然后，你可以检查基于角色的权限。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-241">You can then check permissions based on role.</span></span> <span data-ttu-id="e2a5e-242">在本部分中，你将创建&quot;管理员&quot;角色，然后创建用户都可以访问的页面中 （属于） 该角色。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-242">In this section, you'll create an &quot;admin&quot; role and then create a page that's accessible to users who are in (who belong to) that role.</span></span>

<span data-ttu-id="e2a5e-243">ASP.NET 成员资格系统设置以支持角色。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-243">The ASP.NET membership system is set up to support roles.</span></span> <span data-ttu-id="e2a5e-244">但是，与成员身份注册和登录名，不同**入门站点**模板不包含页，可帮助你管理角色。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-244">However, unlike membership registration and login, the **Starter Site** template does not contain pages that help you manage roles.</span></span> <span data-ttu-id="e2a5e-245">（管理角色是一个管理任务，而不是一个用户任务。）但是，您可以直接在 WebMatrix 中的成员资格数据库中添加组。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-245">(Managing roles is an administrative task rather than a user task.) However, you can add groups directly in the membership database in WebMatrix.</span></span>

1. <span data-ttu-id="e2a5e-246">在 WebMatrix 中，单击**数据库**工作区中选择器。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-246">In WebMatrix, click the **Databases** workspace selector.</span></span>
2. <span data-ttu-id="e2a5e-247">在左窗格中，打开*StarterSite.sdf*节点，打开**表**节点，然后再双击*网页\_角色*表。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-247">In the left pane, open the *StarterSite.sdf* node, open the **Tables** node, and then double-click the *webpages\_Roles* table.</span></span>

    ![security-membership-7](16-adding-security-and-membership/_static/image6.png)
3. <span data-ttu-id="e2a5e-249">添加名为的角色&quot;管理员&quot;。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-249">Add a role named &quot;admin&quot;.</span></span> <span data-ttu-id="e2a5e-250">*RoleId*自动填写字段。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-250">The *RoleId* field is filled in automatically.</span></span> <span data-ttu-id="e2a5e-251">(它是主键，已设置为标识字段中中, 所述[使用 ASP.NET Web Pages 站点中的数据库的简介](https://go.microsoft.com/fwlink/?LinkId=202893)。)</span><span class="sxs-lookup"><span data-stu-id="e2a5e-251">(It's the primary key and has been set to be an identify field, as explained in [Introduction to Working with a Database in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202893).)</span></span>
4. <span data-ttu-id="e2a5e-252">请记下的值是什么*RoleId*字段。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-252">Take note of what the value is for the *RoleId* field.</span></span> <span data-ttu-id="e2a5e-253">（如果这是你定义的第一个角色，它将是 1）。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-253">(If this is the first role you're defining, it will be 1.)</span></span>

    ![security-membership-8](16-adding-security-and-membership/_static/image7.png)
5. <span data-ttu-id="e2a5e-255">关闭*网页\_角色*表。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-255">Close the *webpages\_Roles* table.</span></span>
6. <span data-ttu-id="e2a5e-256">打开*UserProfile*表。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-256">Open the *UserProfile* table.</span></span>
7. <span data-ttu-id="e2a5e-257">记下*UserId*的一个或多个表，然后关闭表中的用户的值。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-257">Make a note of the *UserId* value of one or more of the users in the table and then close the table.</span></span>
8. <span data-ttu-id="e2a5e-258">打开*网页\_UserInRoles*表，然后输入*UserID*和*RoleID*到表的值。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-258">Open the *webpages\_UserInRoles* table and enter a *UserID* and a *RoleID* value into the table.</span></span> <span data-ttu-id="e2a5e-259">例如，若要将用户 2 到&quot;管理员&quot;角色，则输入这些值：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-259">For example, to put user 2 into the &quot;admin&quot; role, you'd enter these values:</span></span>

    ![security-membership-9](16-adding-security-and-membership/_static/image8.png)
9. <span data-ttu-id="e2a5e-261">关闭*网页\_UsersInRoles*表。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-261">Close the *webpages\_UsersInRoles* table.</span></span>

    <span data-ttu-id="e2a5e-262">现在，你已定义的角色，你可以配置该角色中的用户可以访问的页面。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-262">Now that you have roles defined, you can configure a page that's accessible to users who are in that role.</span></span>
10. <span data-ttu-id="e2a5e-263">在网站根文件夹中，创建一个名为的新页*AdminError.cshtml*并将现有内容替换为下面的代码。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-263">In the website root folder, create a new page named *AdminError.cshtml* and replace the existing content with the following code.</span></span> <span data-ttu-id="e2a5e-264">这将是将用户重定向到如果它们不允许访问的页的页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-264">This will be the page that users are redirected to if they aren't allowed access to a page.</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample4.cshtml)]
11. <span data-ttu-id="e2a5e-265">在网站根文件夹中，创建一个名为的新页*AdminOnly.cshtml*和替换为以下代码替换现有代码：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-265">In the website root folder, create a new page named *AdminOnly.cshtml* and replace the existing code with the following code:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample5.cshtml)]

    <span data-ttu-id="e2a5e-266">`Roles.IsUserInRole`方法返回`true`当前用户是否属于指定角色 （在此情况下，"管理员"角色）。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-266">The `Roles.IsUserInRole` method returns `true` if the current user is a member of the specified role (in this case, the "admin" role).</span></span>
12. <span data-ttu-id="e2a5e-267">运行*Default.cshtml*在浏览器中，但不登录。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-267">Run *Default.cshtml* in a browser, but don't log in.</span></span> <span data-ttu-id="e2a5e-268">（如果你已登录，注销。）</span><span class="sxs-lookup"><span data-stu-id="e2a5e-268">(If you're already logged in, log out.)</span></span>
13. <span data-ttu-id="e2a5e-269">在浏览器的地址栏中，添加*AdminOnly*在 URL 中。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-269">In the browser's address bar, add *AdminOnly* in the URL.</span></span> <span data-ttu-id="e2a5e-270">(在换而言之，请求*AdminOnly.cshtml*文件。)要重定向到*AdminError.cshtml*页上，因为你没有当前登录中的用户身份&quot;管理员&quot;角色。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-270">(In other words, request the *AdminOnly.cshtml* file.) You're redirected to the *AdminError.cshtml* page, because you aren't currently logged in as a user in the &quot;admin&quot; role.</span></span>
14. <span data-ttu-id="e2a5e-271">返回到*Default.cshtml*和添加到用户身份登录&quot;管理员&quot;角色。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-271">Return to *Default.cshtml* and log in as the user you added to the &quot;admin&quot; role.</span></span>
15. <span data-ttu-id="e2a5e-272">浏览到*AdminOnly.cshtml*页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-272">Browse to *AdminOnly.cshtml* page.</span></span> <span data-ttu-id="e2a5e-273">此时会显示页。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-273">This time you see the page.</span></span>

## <a name="preventing-automated-programs-from-joining-your-website"></a><span data-ttu-id="e2a5e-274">阻止自动的程序加入你的网站</span><span class="sxs-lookup"><span data-stu-id="e2a5e-274">Preventing Automated Programs from Joining Your Website</span></span>

<span data-ttu-id="e2a5e-275">登录页不会停止自动的程序 (有时称为*web 机器人*或*机器人*) 注册与您的网站。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-275">The login page will not stop automated programs (sometimes referred to as *web robots* or *bots*) from registering with your website.</span></span> <span data-ttu-id="e2a5e-276">此过程介绍如何启用注册页的 ReCaptcha 测试。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-276">This procedure describes how to enable a ReCaptcha test for the registration page.</span></span>

![/media/38777/ch16securitymembership-18.jpg](16-adding-security-and-membership/_static/image1.jpg)

1. <span data-ttu-id="e2a5e-278">注册你的网站在 ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net))。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-278">Register your website at ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span></span> <span data-ttu-id="e2a5e-279">你已完成注册，你会获得一个公钥和私钥。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-279">When you've completed registration, you'll get a public key and a private key.</span></span>
2. <span data-ttu-id="e2a5e-280">将 ASP.NET Web 帮助程序库添加到你的网站中所述[安装 ASP.NET 网页站点中的帮助器](https://go.microsoft.com/fwlink/?LinkId=252372)，如果你尚未。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-280">Add the ASP.NET Web Helpers Library to your website as described in [Installing Helpers in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=252372), if you haven't already.</span></span>
3. <span data-ttu-id="e2a5e-281">在*帐户*文件夹中，打开的文件命名为*Register.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-281">In the *Account* folder, open the file named *Register.cshtml*.</span></span>
4. <span data-ttu-id="e2a5e-282">在页面顶部的代码中，找到以下行并取消其注释通过删除`//`注释字符：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-282">In the code at the top of the page, find the following lines and uncomment them by removing the `//` comment characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample6.cs)]
5. <span data-ttu-id="e2a5e-283">替换`PRIVATE_KEY`替换为你自己 ReCaptcha 私有密钥。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-283">Replace `PRIVATE_KEY` with your own ReCaptcha private key.</span></span>
6. <span data-ttu-id="e2a5e-284">在页面的标记中，删除`@*`和`*@`周围的页标记中的以下行的注释字符：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-284">In the markup of the page, remove the `@*` and `*@` commenting characters from around the following lines in the page markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample7.cshtml)]
7. <span data-ttu-id="e2a5e-285">替换`PUBLIC_KEY`与你的密钥。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-285">Replace `PUBLIC_KEY` with your key.</span></span>
8. <span data-ttu-id="e2a5e-286">如果你尚未已删除它，则删除`<div>`包含文本"若要启用 CAPTCHA 验证..."开头的元素。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-286">If you haven't removed it already, remove the `<div>` element that contains text that starts with "To enable CAPTCHA verification ...".</span></span> <span data-ttu-id="e2a5e-287">(删除整个`<div>`元素和其内容。)</span><span class="sxs-lookup"><span data-stu-id="e2a5e-287">(Remove the entire `<div>` element and its contents.)</span></span>

1. <span data-ttu-id="e2a5e-288">运行*Default.cshtml*在浏览器。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-288">Run *Default.cshtml* in a browser.</span></span> <span data-ttu-id="e2a5e-289">如果你登录到站点，请单击**注销**链接。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-289">If you're logged into the site, click the **Logout** link.</span></span>
2. <span data-ttu-id="e2a5e-290">单击**注册**链接以及测试使用 CAPTCHA 测试的注册。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-290">Click the **Register** link and test the registration using the CAPTCHA test.</span></span>

    ![security-membership-10](16-adding-security-and-membership/_static/image9.png)

<span data-ttu-id="e2a5e-292">有关详细信息`ReCaptcha`帮助器，请参阅[到防止自动程序 （机器人） 从使用你的 ASP.NET Web 站点使用 CATPCHA](https://go.microsoft.com/fwlink/?LinkId=251967)。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-292">For more information about the `ReCaptcha` helper, see [Using a CATPCHA to Prevent Automated Programs (Bots) from Using Your ASP.NET Web Site](https://go.microsoft.com/fwlink/?LinkId=251967).</span></span>

<a id="Additional_Resources"></a>
## <a name="letting-users-log-in-using-an-external-site"></a><span data-ttu-id="e2a5e-293">允许用户在使用外部站点进行登录</span><span class="sxs-lookup"><span data-stu-id="e2a5e-293">Letting Users Log In Using an External Site</span></span>

<span data-ttu-id="e2a5e-294">**入门站点**模板包括代码和标记，从而让用户使用 Facebook、 Windows Live、 Twitter、 Google 或 Yahoo 登录。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-294">The **Starter Site** template includes code and markup that lets users log in using Facebook, Windows Live, Twitter, Google, or Yahoo.</span></span> <span data-ttu-id="e2a5e-295">默认情况下，不启用此功能。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-295">By default, this functionality is not enabled.</span></span> <span data-ttu-id="e2a5e-296">一般的过程使用让用户使用这些外部提供程序的登录名是此：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-296">The general procedure for using letting users log in using these external providers is this:</span></span>

- <span data-ttu-id="e2a5e-297">确定你想要支持哪个外部站点。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-297">Decide which of the external sites you want to support.</span></span>
- <span data-ttu-id="e2a5e-298">如果需要，转到该网站并设置登录应用。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-298">If required, go to that site and set up a login app.</span></span> <span data-ttu-id="e2a5e-299">（例如，你必须这样做以便允许 Facebook 登录名。）</span><span class="sxs-lookup"><span data-stu-id="e2a5e-299">(For example, you have to do this in order to allow Facebook logins.)</span></span>
- <span data-ttu-id="e2a5e-300">在你站点中，配置提供程序。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-300">In your site, configure the provider.</span></span> <span data-ttu-id="e2a5e-301">在大多数情况下，你只需取消注释中的某些代码 *\_AppStart.cshtml*文件。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-301">In most cases, you just have to uncomment some code in the *\_AppStart.cshtml* file.</span></span>
- <span data-ttu-id="e2a5e-302">将标记添加到让用户能够注册页登录的外部站点的链接。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-302">Add markup to the registration page that lets people link to the external site for logging in.</span></span> <span data-ttu-id="e2a5e-303">通常，你可以复制需要并略有更改的文本的标记。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-303">You can usually copy the markup you need and change the text slightly.</span></span>

<span data-ttu-id="e2a5e-304">你可以在主题中找到的分步说明[启用从 ASP.NET Web Pages 站点中的外部网站的登录名](https://go.microsoft.com/fwlink/?LinkId=251969)。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-304">You can find step-by-step instructions in the topic [Enabling Login from External Sites in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=251969).</span></span>

<span data-ttu-id="e2a5e-305">用户登录从另一个站点后，用户返回到你的站点和*将相关联*该登录名与您的网站。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-305">After a user logs in from another site, the user returns to your site and *associates* that login with your site.</span></span> <span data-ttu-id="e2a5e-306">实际上，这将在用户的外部登录你站点中创建成员身份条目。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-306">In effect, this creates a membership entry in your site for the user's external login.</span></span> <span data-ttu-id="e2a5e-307">这允许你使用的外部登录名使用 （例如角色） 的成员身份的正常功能。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-307">This lets you use the normal facilities of membership (such as roles) with the external login.</span></span>

## <a name="adding-security-to-an-existing-website"></a><span data-ttu-id="e2a5e-308">将安全添加到现有网站</span><span class="sxs-lookup"><span data-stu-id="e2a5e-308">Adding Security to an Existing Website</span></span>

<span data-ttu-id="e2a5e-309">在本文前面的过程依赖于使用**入门站点**模板作为网站的安全性的基础。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-309">The procedure earlier in this article relies on using the **Starter Site** template as the basis for website security.</span></span> <span data-ttu-id="e2a5e-310">如果它不适合将你从启动**入门站点**模板或者若要从基于该模板站点复制相关页，你可以实现相同类型的安全自己站点中通过自己编码。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-310">If it isn't practical for you to start from the **Starter Site** template or to copy the relevant pages from a site based on that template, you can implement the same type of security in your own site by coding it yourself.</span></span> <span data-ttu-id="e2a5e-311">创建相同类型的页-注册、 登录名，等等 — 然后使用帮助器和类将成员资格设置。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-311">You create the same types of pages — registration, login, and so on — and then use helpers and classes to set up membership.</span></span>

<span data-ttu-id="e2a5e-312">基本过程篇博客文章中所述[最基本的方法来实现 ASP.NET Razor 安全](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240)。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-312">The basic process is described in the blog post [THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span></span> <span data-ttu-id="e2a5e-313">完成大部分工作的以下方法和属性使用`WebSecurity`帮助器：</span><span class="sxs-lookup"><span data-stu-id="e2a5e-313">Most of the work is done using the following methods and properties of the `WebSecurity` helper:</span></span>

- <span data-ttu-id="e2a5e-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx)， [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx)。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span></span> <span data-ttu-id="e2a5e-315">这些方法使你可以确定是否有人已注册并对它们进行注册。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-315">These methods let you determine whether someone is already registered and to register them.</span></span>
- <span data-ttu-id="e2a5e-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="e2a5e-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span></span> <span data-ttu-id="e2a5e-317">此属性允许您确定当前用户是否已登录。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-317">This property lets you determine whether the current user is logged in.</span></span> <span data-ttu-id="e2a5e-318">这可用于将用户重定向到登录页，如果它们未已登录。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-318">This is useful to redirect users to a login page if they have not already logged in.</span></span>
- <span data-ttu-id="e2a5e-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx)， [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx)。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span></span> <span data-ttu-id="e2a5e-320">这些方法将用户登录，或缩小。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-320">These methods log a user in or out.</span></span>
- <span data-ttu-id="e2a5e-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="e2a5e-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span></span> <span data-ttu-id="e2a5e-322">此属性可用于显示当前用户的登录名 （如果用户已登录）。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-322">This property is useful for displaying the current user's logged-in name (if the user is logged in).</span></span>
- <span data-ttu-id="e2a5e-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="e2a5e-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span></span> <span data-ttu-id="e2a5e-324">此方法是设置注册的电子邮件确认的情况下很有用。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-324">This method is useful if you set up email confirmation for registration.</span></span> <span data-ttu-id="e2a5e-325">(详细信息所述的博客文章[确认功能用于 ASP.NET Web Pages 安全](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267)。)</span><span class="sxs-lookup"><span data-stu-id="e2a5e-325">(Details are described in the blog post [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).)</span></span>

<span data-ttu-id="e2a5e-326">若要管理角色，可以使用[角色](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx)和[成员资格](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx)类，如博客文章中所述。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-326">To manage roles, you can use the [Roles](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) and [Membership](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) classes, as described in the blog entry.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="e2a5e-327">其他资源</span><span class="sxs-lookup"><span data-stu-id="e2a5e-327">Additional Resources</span></span>

- [<span data-ttu-id="e2a5e-328">自定义站点范围内的行为</span><span class="sxs-lookup"><span data-stu-id="e2a5e-328">Customizing Site-Wide Behavior</span></span>](https://go.microsoft.com/fwlink/?LinkId=202906)
- [<span data-ttu-id="e2a5e-329">保护 Web 通信： 证书、 SSL 和 https://</span><span class="sxs-lookup"><span data-stu-id="e2a5e-329">Securing Web Communications: Certificates, SSL, and https://</span></span>](https://go.microsoft.com/fwlink/?LinkId=208660)
- <span data-ttu-id="e2a5e-330">[最基本的方法来实现 ASP.NET Razor 安全](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240)和[确认功能用于 ASP.NET Web Pages 安全](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267)。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-330">[THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) and [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span></span> <span data-ttu-id="e2a5e-331">这些是描述如何实现 ASP.NET 成员资格功能而无需使用的博客文章**入门站点**模板。</span><span class="sxs-lookup"><span data-stu-id="e2a5e-331">These are blog posts that describe how to implement ASP.NET membership features without using the **Starter Site** template.</span></span>
- [<span data-ttu-id="e2a5e-332">在 ASP.NET 网站中启用从外部站点进行登录</span><span class="sxs-lookup"><span data-stu-id="e2a5e-332">Enabling Login from External Sites in an ASP.NET Web Pages Site</span></span>](https://go.microsoft.com/fwlink/?LinkId=251969)
- <span data-ttu-id="e2a5e-333">[WebSecurity 类 API 参考](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99))(MSDN)</span><span class="sxs-lookup"><span data-stu-id="e2a5e-333">[WebSecurity Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="e2a5e-334">[SimpleRoleProvider 类 API 参考](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99))(MSDN)</span><span class="sxs-lookup"><span data-stu-id="e2a5e-334">[SimpleRoleProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="e2a5e-335">[SimpleMembershipProvider 类 API 参考](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99))(MSDN)</span><span class="sxs-lookup"><span data-stu-id="e2a5e-335">[SimpleMembershipProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span></span>
